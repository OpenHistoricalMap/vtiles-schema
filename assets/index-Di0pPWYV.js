var eP=Object.defineProperty;var tP=(i,a,f)=>a in i?eP(i,a,{enumerable:!0,configurable:!0,writable:!0,value:f}):i[a]=f;var yt=(i,a,f)=>tP(i,typeof a!="symbol"?a+"":a,f);(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const S of document.querySelectorAll('link[rel="modulepreload"]'))v(S);new MutationObserver(S=>{for(const C of S)if(C.type==="childList")for(const w of C.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&v(w)}).observe(document,{childList:!0,subtree:!0});function f(S){const C={};return S.integrity&&(C.integrity=S.integrity),S.referrerPolicy&&(C.referrerPolicy=S.referrerPolicy),S.crossOrigin==="use-credentials"?C.credentials="include":S.crossOrigin==="anonymous"?C.credentials="omit":C.credentials="same-origin",C}function v(S){if(S.ep)return;S.ep=!0;const C=f(S);fetch(S.href,C)}})();var rP=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Z1(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var W1={exports:{}},am={},H1={exports:{}},At={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _d=Symbol.for("react.element"),nP=Symbol.for("react.portal"),iP=Symbol.for("react.fragment"),sP=Symbol.for("react.strict_mode"),oP=Symbol.for("react.profiler"),aP=Symbol.for("react.provider"),lP=Symbol.for("react.context"),uP=Symbol.for("react.forward_ref"),cP=Symbol.for("react.suspense"),hP=Symbol.for("react.memo"),dP=Symbol.for("react.lazy"),Ax=Symbol.iterator;function pP(i){return i===null||typeof i!="object"?null:(i=Ax&&i[Ax]||i["@@iterator"],typeof i=="function"?i:null)}var X1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Y1=Object.assign,K1={};function cc(i,a,f){this.props=i,this.context=a,this.refs=K1,this.updater=f||X1}cc.prototype.isReactComponent={};cc.prototype.setState=function(i,a){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,a,"setState")};cc.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function Q1(){}Q1.prototype=cc.prototype;function by(i,a,f){this.props=i,this.context=a,this.refs=K1,this.updater=f||X1}var wy=by.prototype=new Q1;wy.constructor=by;Y1(wy,cc.prototype);wy.isPureReactComponent=!0;var zx=Array.isArray,J1=Object.prototype.hasOwnProperty,Ty={current:null},eb={key:!0,ref:!0,__self:!0,__source:!0};function tb(i,a,f){var v,S={},C=null,w=null;if(a!=null)for(v in a.ref!==void 0&&(w=a.ref),a.key!==void 0&&(C=""+a.key),a)J1.call(a,v)&&!eb.hasOwnProperty(v)&&(S[v]=a[v]);var c=arguments.length-2;if(c===1)S.children=f;else if(1<c){for(var N=Array(c),K=0;K<c;K++)N[K]=arguments[K+2];S.children=N}if(i&&i.defaultProps)for(v in c=i.defaultProps,c)S[v]===void 0&&(S[v]=c[v]);return{$$typeof:_d,type:i,key:C,ref:w,props:S,_owner:Ty.current}}function fP(i,a){return{$$typeof:_d,type:i.type,key:a,ref:i.ref,props:i.props,_owner:i._owner}}function Sy(i){return typeof i=="object"&&i!==null&&i.$$typeof===_d}function mP(i){var a={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(f){return a[f]})}var Dx=/\/+/g;function Yg(i,a){return typeof i=="object"&&i!==null&&i.key!=null?mP(""+i.key):a.toString(36)}function wf(i,a,f,v,S){var C=typeof i;(C==="undefined"||C==="boolean")&&(i=null);var w=!1;if(i===null)w=!0;else switch(C){case"string":case"number":w=!0;break;case"object":switch(i.$$typeof){case _d:case nP:w=!0}}if(w)return w=i,S=S(w),i=v===""?"."+Yg(w,0):v,zx(S)?(f="",i!=null&&(f=i.replace(Dx,"$&/")+"/"),wf(S,a,f,"",function(K){return K})):S!=null&&(Sy(S)&&(S=fP(S,f+(!S.key||w&&w.key===S.key?"":(""+S.key).replace(Dx,"$&/")+"/")+i)),a.push(S)),1;if(w=0,v=v===""?".":v+":",zx(i))for(var c=0;c<i.length;c++){C=i[c];var N=v+Yg(C,c);w+=wf(C,a,f,N,S)}else if(N=pP(i),typeof N=="function")for(i=N.call(i),c=0;!(C=i.next()).done;)C=C.value,N=v+Yg(C,c++),w+=wf(C,a,f,N,S);else if(C==="object")throw a=String(i),Error("Objects are not valid as a React child (found: "+(a==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":a)+"). If you meant to render a collection of children, use an array instead.");return w}function rf(i,a,f){if(i==null)return i;var v=[],S=0;return wf(i,v,"","",function(C){return a.call(f,C,S++)}),v}function gP(i){if(i._status===-1){var a=i._result;a=a(),a.then(function(f){(i._status===0||i._status===-1)&&(i._status=1,i._result=f)},function(f){(i._status===0||i._status===-1)&&(i._status=2,i._result=f)}),i._status===-1&&(i._status=0,i._result=a)}if(i._status===1)return i._result.default;throw i._result}var Wn={current:null},Tf={transition:null},_P={ReactCurrentDispatcher:Wn,ReactCurrentBatchConfig:Tf,ReactCurrentOwner:Ty};function rb(){throw Error("act(...) is not supported in production builds of React.")}At.Children={map:rf,forEach:function(i,a,f){rf(i,function(){a.apply(this,arguments)},f)},count:function(i){var a=0;return rf(i,function(){a++}),a},toArray:function(i){return rf(i,function(a){return a})||[]},only:function(i){if(!Sy(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};At.Component=cc;At.Fragment=iP;At.Profiler=oP;At.PureComponent=by;At.StrictMode=sP;At.Suspense=cP;At.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=_P;At.act=rb;At.cloneElement=function(i,a,f){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var v=Y1({},i.props),S=i.key,C=i.ref,w=i._owner;if(a!=null){if(a.ref!==void 0&&(C=a.ref,w=Ty.current),a.key!==void 0&&(S=""+a.key),i.type&&i.type.defaultProps)var c=i.type.defaultProps;for(N in a)J1.call(a,N)&&!eb.hasOwnProperty(N)&&(v[N]=a[N]===void 0&&c!==void 0?c[N]:a[N])}var N=arguments.length-2;if(N===1)v.children=f;else if(1<N){c=Array(N);for(var K=0;K<N;K++)c[K]=arguments[K+2];v.children=c}return{$$typeof:_d,type:i.type,key:S,ref:C,props:v,_owner:w}};At.createContext=function(i){return i={$$typeof:lP,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:aP,_context:i},i.Consumer=i};At.createElement=tb;At.createFactory=function(i){var a=tb.bind(null,i);return a.type=i,a};At.createRef=function(){return{current:null}};At.forwardRef=function(i){return{$$typeof:uP,render:i}};At.isValidElement=Sy;At.lazy=function(i){return{$$typeof:dP,_payload:{_status:-1,_result:i},_init:gP}};At.memo=function(i,a){return{$$typeof:hP,type:i,compare:a===void 0?null:a}};At.startTransition=function(i){var a=Tf.transition;Tf.transition={};try{i()}finally{Tf.transition=a}};At.unstable_act=rb;At.useCallback=function(i,a){return Wn.current.useCallback(i,a)};At.useContext=function(i){return Wn.current.useContext(i)};At.useDebugValue=function(){};At.useDeferredValue=function(i){return Wn.current.useDeferredValue(i)};At.useEffect=function(i,a){return Wn.current.useEffect(i,a)};At.useId=function(){return Wn.current.useId()};At.useImperativeHandle=function(i,a,f){return Wn.current.useImperativeHandle(i,a,f)};At.useInsertionEffect=function(i,a){return Wn.current.useInsertionEffect(i,a)};At.useLayoutEffect=function(i,a){return Wn.current.useLayoutEffect(i,a)};At.useMemo=function(i,a){return Wn.current.useMemo(i,a)};At.useReducer=function(i,a,f){return Wn.current.useReducer(i,a,f)};At.useRef=function(i){return Wn.current.useRef(i)};At.useState=function(i){return Wn.current.useState(i)};At.useSyncExternalStore=function(i,a,f){return Wn.current.useSyncExternalStore(i,a,f)};At.useTransition=function(){return Wn.current.useTransition()};At.version="18.3.1";H1.exports=At;var Re=H1.exports;const yP=Z1(Re);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vP=Re,xP=Symbol.for("react.element"),bP=Symbol.for("react.fragment"),wP=Object.prototype.hasOwnProperty,TP=vP.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,SP={key:!0,ref:!0,__self:!0,__source:!0};function nb(i,a,f){var v,S={},C=null,w=null;f!==void 0&&(C=""+f),a.key!==void 0&&(C=""+a.key),a.ref!==void 0&&(w=a.ref);for(v in a)wP.call(a,v)&&!SP.hasOwnProperty(v)&&(S[v]=a[v]);if(i&&i.defaultProps)for(v in a=i.defaultProps,a)S[v]===void 0&&(S[v]=a[v]);return{$$typeof:xP,type:i,key:C,ref:w,props:S,_owner:TP.current}}am.Fragment=bP;am.jsx=nb;am.jsxs=nb;W1.exports=am;var de=W1.exports,P_={},ib={exports:{}},Ci={},sb={exports:{}},ob={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function a(ot,st){var vt=ot.length;ot.push(st);e:for(;0<vt;){var Lt=vt-1>>>1,rr=ot[Lt];if(0<S(rr,st))ot[Lt]=st,ot[vt]=rr,vt=Lt;else break e}}function f(ot){return ot.length===0?null:ot[0]}function v(ot){if(ot.length===0)return null;var st=ot[0],vt=ot.pop();if(vt!==st){ot[0]=vt;e:for(var Lt=0,rr=ot.length,Ii=rr>>>1;Lt<Ii;){var mn=2*(Lt+1)-1,Rr=ot[mn],Vr=mn+1,Mn=ot[Vr];if(0>S(Rr,vt))Vr<rr&&0>S(Mn,Rr)?(ot[Lt]=Mn,ot[Vr]=vt,Lt=Vr):(ot[Lt]=Rr,ot[mn]=vt,Lt=mn);else if(Vr<rr&&0>S(Mn,vt))ot[Lt]=Mn,ot[Vr]=vt,Lt=Vr;else break e}}return st}function S(ot,st){var vt=ot.sortIndex-st.sortIndex;return vt!==0?vt:ot.id-st.id}if(typeof performance=="object"&&typeof performance.now=="function"){var C=performance;i.unstable_now=function(){return C.now()}}else{var w=Date,c=w.now();i.unstable_now=function(){return w.now()-c}}var N=[],K=[],fe=1,pe=null,ye=3,Ae=!1,we=!1,_e=!1,se=typeof setTimeout=="function"?setTimeout:null,ue=typeof clearTimeout=="function"?clearTimeout:null,Y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ne(ot){for(var st=f(K);st!==null;){if(st.callback===null)v(K);else if(st.startTime<=ot)v(K),st.sortIndex=st.expirationTime,a(N,st);else break;st=f(K)}}function Be(ot){if(_e=!1,ne(ot),!we)if(f(N)!==null)we=!0,ls(qe);else{var st=f(K);st!==null&&en(Be,st.startTime-ot)}}function qe(ot,st){we=!1,_e&&(_e=!1,ue(Ke),Ke=-1),Ae=!0;var vt=ye;try{for(ne(st),pe=f(N);pe!==null&&(!(pe.expirationTime>st)||ot&&!Qt());){var Lt=pe.callback;if(typeof Lt=="function"){pe.callback=null,ye=pe.priorityLevel;var rr=Lt(pe.expirationTime<=st);st=i.unstable_now(),typeof rr=="function"?pe.callback=rr:pe===f(N)&&v(N),ne(st)}else v(N);pe=f(N)}if(pe!==null)var Ii=!0;else{var mn=f(K);mn!==null&&en(Be,mn.startTime-st),Ii=!1}return Ii}finally{pe=null,ye=vt,Ae=!1}}var et=!1,We=null,Ke=-1,_t=5,at=-1;function Qt(){return!(i.unstable_now()-at<_t)}function br(){if(We!==null){var ot=i.unstable_now();at=ot;var st=!0;try{st=We(!0,ot)}finally{st?jr():(et=!1,We=null)}}else et=!1}var jr;if(typeof Y=="function")jr=function(){Y(br)};else if(typeof MessageChannel<"u"){var Xn=new MessageChannel,Gi=Xn.port2;Xn.port1.onmessage=br,jr=function(){Gi.postMessage(null)}}else jr=function(){se(br,0)};function ls(ot){We=ot,et||(et=!0,jr())}function en(ot,st){Ke=se(function(){ot(i.unstable_now())},st)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(ot){ot.callback=null},i.unstable_continueExecution=function(){we||Ae||(we=!0,ls(qe))},i.unstable_forceFrameRate=function(ot){0>ot||125<ot?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):_t=0<ot?Math.floor(1e3/ot):5},i.unstable_getCurrentPriorityLevel=function(){return ye},i.unstable_getFirstCallbackNode=function(){return f(N)},i.unstable_next=function(ot){switch(ye){case 1:case 2:case 3:var st=3;break;default:st=ye}var vt=ye;ye=st;try{return ot()}finally{ye=vt}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(ot,st){switch(ot){case 1:case 2:case 3:case 4:case 5:break;default:ot=3}var vt=ye;ye=ot;try{return st()}finally{ye=vt}},i.unstable_scheduleCallback=function(ot,st,vt){var Lt=i.unstable_now();switch(typeof vt=="object"&&vt!==null?(vt=vt.delay,vt=typeof vt=="number"&&0<vt?Lt+vt:Lt):vt=Lt,ot){case 1:var rr=-1;break;case 2:rr=250;break;case 5:rr=1073741823;break;case 4:rr=1e4;break;default:rr=5e3}return rr=vt+rr,ot={id:fe++,callback:st,priorityLevel:ot,startTime:vt,expirationTime:rr,sortIndex:-1},vt>Lt?(ot.sortIndex=vt,a(K,ot),f(N)===null&&ot===f(K)&&(_e?(ue(Ke),Ke=-1):_e=!0,en(Be,vt-Lt))):(ot.sortIndex=rr,a(N,ot),we||Ae||(we=!0,ls(qe))),ot},i.unstable_shouldYield=Qt,i.unstable_wrapCallback=function(ot){var st=ye;return function(){var vt=ye;ye=st;try{return ot.apply(this,arguments)}finally{ye=vt}}}})(ob);sb.exports=ob;var PP=sb.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var EP=Re,Ei=PP;function Xe(i){for(var a="https://reactjs.org/docs/error-decoder.html?invariant="+i,f=1;f<arguments.length;f++)a+="&args[]="+encodeURIComponent(arguments[f]);return"Minified React error #"+i+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var ab=new Set,Jh={};function Il(i,a){nc(i,a),nc(i+"Capture",a)}function nc(i,a){for(Jh[i]=a,i=0;i<a.length;i++)ab.add(a[i])}var uo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),E_=Object.prototype.hasOwnProperty,CP=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Rx={},Lx={};function MP(i){return E_.call(Lx,i)?!0:E_.call(Rx,i)?!1:CP.test(i)?Lx[i]=!0:(Rx[i]=!0,!1)}function IP(i,a,f,v){if(f!==null&&f.type===0)return!1;switch(typeof a){case"function":case"symbol":return!0;case"boolean":return v?!1:f!==null?!f.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function kP(i,a,f,v){if(a===null||typeof a>"u"||IP(i,a,f,v))return!0;if(v)return!1;if(f!==null)switch(f.type){case 3:return!a;case 4:return a===!1;case 5:return isNaN(a);case 6:return isNaN(a)||1>a}return!1}function Hn(i,a,f,v,S,C,w){this.acceptsBooleans=a===2||a===3||a===4,this.attributeName=v,this.attributeNamespace=S,this.mustUseProperty=f,this.propertyName=i,this.type=a,this.sanitizeURL=C,this.removeEmptyString=w}var Cn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){Cn[i]=new Hn(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var a=i[0];Cn[a]=new Hn(a,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){Cn[i]=new Hn(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){Cn[i]=new Hn(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){Cn[i]=new Hn(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){Cn[i]=new Hn(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){Cn[i]=new Hn(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){Cn[i]=new Hn(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){Cn[i]=new Hn(i,5,!1,i.toLowerCase(),null,!1,!1)});var Py=/[\-:]([a-z])/g;function Ey(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var a=i.replace(Py,Ey);Cn[a]=new Hn(a,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var a=i.replace(Py,Ey);Cn[a]=new Hn(a,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var a=i.replace(Py,Ey);Cn[a]=new Hn(a,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){Cn[i]=new Hn(i,1,!1,i.toLowerCase(),null,!1,!1)});Cn.xlinkHref=new Hn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){Cn[i]=new Hn(i,1,!1,i.toLowerCase(),null,!0,!0)});function Cy(i,a,f,v){var S=Cn.hasOwnProperty(a)?Cn[a]:null;(S!==null?S.type!==0:v||!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(kP(a,f,S,v)&&(f=null),v||S===null?MP(a)&&(f===null?i.removeAttribute(a):i.setAttribute(a,""+f)):S.mustUseProperty?i[S.propertyName]=f===null?S.type===3?!1:"":f:(a=S.attributeName,v=S.attributeNamespace,f===null?i.removeAttribute(a):(S=S.type,f=S===3||S===4&&f===!0?"":""+f,v?i.setAttributeNS(v,a,f):i.setAttribute(a,f))))}var mo=EP.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,nf=Symbol.for("react.element"),Nu=Symbol.for("react.portal"),ju=Symbol.for("react.fragment"),My=Symbol.for("react.strict_mode"),C_=Symbol.for("react.profiler"),lb=Symbol.for("react.provider"),ub=Symbol.for("react.context"),Iy=Symbol.for("react.forward_ref"),M_=Symbol.for("react.suspense"),I_=Symbol.for("react.suspense_list"),ky=Symbol.for("react.memo"),Jo=Symbol.for("react.lazy"),cb=Symbol.for("react.offscreen"),Fx=Symbol.iterator;function kh(i){return i===null||typeof i!="object"?null:(i=Fx&&i[Fx]||i["@@iterator"],typeof i=="function"?i:null)}var Dr=Object.assign,Kg;function Nh(i){if(Kg===void 0)try{throw Error()}catch(f){var a=f.stack.trim().match(/\n( *(at )?)/);Kg=a&&a[1]||""}return`
`+Kg+i}var Qg=!1;function Jg(i,a){if(!i||Qg)return"";Qg=!0;var f=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(a)if(a=function(){throw Error()},Object.defineProperty(a.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(a,[])}catch(K){var v=K}Reflect.construct(i,[],a)}else{try{a.call()}catch(K){v=K}i.call(a.prototype)}else{try{throw Error()}catch(K){v=K}i()}}catch(K){if(K&&v&&typeof K.stack=="string"){for(var S=K.stack.split(`
`),C=v.stack.split(`
`),w=S.length-1,c=C.length-1;1<=w&&0<=c&&S[w]!==C[c];)c--;for(;1<=w&&0<=c;w--,c--)if(S[w]!==C[c]){if(w!==1||c!==1)do if(w--,c--,0>c||S[w]!==C[c]){var N=`
`+S[w].replace(" at new "," at ");return i.displayName&&N.includes("<anonymous>")&&(N=N.replace("<anonymous>",i.displayName)),N}while(1<=w&&0<=c);break}}}finally{Qg=!1,Error.prepareStackTrace=f}return(i=i?i.displayName||i.name:"")?Nh(i):""}function AP(i){switch(i.tag){case 5:return Nh(i.type);case 16:return Nh("Lazy");case 13:return Nh("Suspense");case 19:return Nh("SuspenseList");case 0:case 2:case 15:return i=Jg(i.type,!1),i;case 11:return i=Jg(i.type.render,!1),i;case 1:return i=Jg(i.type,!0),i;default:return""}}function k_(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case ju:return"Fragment";case Nu:return"Portal";case C_:return"Profiler";case My:return"StrictMode";case M_:return"Suspense";case I_:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case ub:return(i.displayName||"Context")+".Consumer";case lb:return(i._context.displayName||"Context")+".Provider";case Iy:var a=i.render;return i=i.displayName,i||(i=a.displayName||a.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case ky:return a=i.displayName||null,a!==null?a:k_(i.type)||"Memo";case Jo:a=i._payload,i=i._init;try{return k_(i(a))}catch{}}return null}function zP(i){var a=i.type;switch(i.tag){case 24:return"Cache";case 9:return(a.displayName||"Context")+".Consumer";case 10:return(a._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=a.render,i=i.displayName||i.name||"",a.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return a;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return k_(a);case 8:return a===My?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a}return null}function pa(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function hb(i){var a=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function DP(i){var a=hb(i)?"checked":"value",f=Object.getOwnPropertyDescriptor(i.constructor.prototype,a),v=""+i[a];if(!i.hasOwnProperty(a)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var S=f.get,C=f.set;return Object.defineProperty(i,a,{configurable:!0,get:function(){return S.call(this)},set:function(w){v=""+w,C.call(this,w)}}),Object.defineProperty(i,a,{enumerable:f.enumerable}),{getValue:function(){return v},setValue:function(w){v=""+w},stopTracking:function(){i._valueTracker=null,delete i[a]}}}}function sf(i){i._valueTracker||(i._valueTracker=DP(i))}function db(i){if(!i)return!1;var a=i._valueTracker;if(!a)return!0;var f=a.getValue(),v="";return i&&(v=hb(i)?i.checked?"true":"false":i.value),i=v,i!==f?(a.setValue(i),!0):!1}function Ff(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function A_(i,a){var f=a.checked;return Dr({},a,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:f??i._wrapperState.initialChecked})}function Bx(i,a){var f=a.defaultValue==null?"":a.defaultValue,v=a.checked!=null?a.checked:a.defaultChecked;f=pa(a.value!=null?a.value:f),i._wrapperState={initialChecked:v,initialValue:f,controlled:a.type==="checkbox"||a.type==="radio"?a.checked!=null:a.value!=null}}function pb(i,a){a=a.checked,a!=null&&Cy(i,"checked",a,!1)}function z_(i,a){pb(i,a);var f=pa(a.value),v=a.type;if(f!=null)v==="number"?(f===0&&i.value===""||i.value!=f)&&(i.value=""+f):i.value!==""+f&&(i.value=""+f);else if(v==="submit"||v==="reset"){i.removeAttribute("value");return}a.hasOwnProperty("value")?D_(i,a.type,f):a.hasOwnProperty("defaultValue")&&D_(i,a.type,pa(a.defaultValue)),a.checked==null&&a.defaultChecked!=null&&(i.defaultChecked=!!a.defaultChecked)}function Ox(i,a,f){if(a.hasOwnProperty("value")||a.hasOwnProperty("defaultValue")){var v=a.type;if(!(v!=="submit"&&v!=="reset"||a.value!==void 0&&a.value!==null))return;a=""+i._wrapperState.initialValue,f||a===i.value||(i.value=a),i.defaultValue=a}f=i.name,f!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,f!==""&&(i.name=f)}function D_(i,a,f){(a!=="number"||Ff(i.ownerDocument)!==i)&&(f==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+f&&(i.defaultValue=""+f))}var jh=Array.isArray;function Ku(i,a,f,v){if(i=i.options,a){a={};for(var S=0;S<f.length;S++)a["$"+f[S]]=!0;for(f=0;f<i.length;f++)S=a.hasOwnProperty("$"+i[f].value),i[f].selected!==S&&(i[f].selected=S),S&&v&&(i[f].defaultSelected=!0)}else{for(f=""+pa(f),a=null,S=0;S<i.length;S++){if(i[S].value===f){i[S].selected=!0,v&&(i[S].defaultSelected=!0);return}a!==null||i[S].disabled||(a=i[S])}a!==null&&(a.selected=!0)}}function R_(i,a){if(a.dangerouslySetInnerHTML!=null)throw Error(Xe(91));return Dr({},a,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function Nx(i,a){var f=a.value;if(f==null){if(f=a.children,a=a.defaultValue,f!=null){if(a!=null)throw Error(Xe(92));if(jh(f)){if(1<f.length)throw Error(Xe(93));f=f[0]}a=f}a==null&&(a=""),f=a}i._wrapperState={initialValue:pa(f)}}function fb(i,a){var f=pa(a.value),v=pa(a.defaultValue);f!=null&&(f=""+f,f!==i.value&&(i.value=f),a.defaultValue==null&&i.defaultValue!==f&&(i.defaultValue=f)),v!=null&&(i.defaultValue=""+v)}function jx(i){var a=i.textContent;a===i._wrapperState.initialValue&&a!==""&&a!==null&&(i.value=a)}function mb(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function L_(i,a){return i==null||i==="http://www.w3.org/1999/xhtml"?mb(a):i==="http://www.w3.org/2000/svg"&&a==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var of,gb=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(a,f,v,S){MSApp.execUnsafeLocalFunction(function(){return i(a,f,v,S)})}:i}(function(i,a){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=a;else{for(of=of||document.createElement("div"),of.innerHTML="<svg>"+a.valueOf().toString()+"</svg>",a=of.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;a.firstChild;)i.appendChild(a.firstChild)}});function ed(i,a){if(a){var f=i.firstChild;if(f&&f===i.lastChild&&f.nodeType===3){f.nodeValue=a;return}}i.textContent=a}var Gh={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},RP=["Webkit","ms","Moz","O"];Object.keys(Gh).forEach(function(i){RP.forEach(function(a){a=a+i.charAt(0).toUpperCase()+i.substring(1),Gh[a]=Gh[i]})});function _b(i,a,f){return a==null||typeof a=="boolean"||a===""?"":f||typeof a!="number"||a===0||Gh.hasOwnProperty(i)&&Gh[i]?(""+a).trim():a+"px"}function yb(i,a){i=i.style;for(var f in a)if(a.hasOwnProperty(f)){var v=f.indexOf("--")===0,S=_b(f,a[f],v);f==="float"&&(f="cssFloat"),v?i.setProperty(f,S):i[f]=S}}var LP=Dr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function F_(i,a){if(a){if(LP[i]&&(a.children!=null||a.dangerouslySetInnerHTML!=null))throw Error(Xe(137,i));if(a.dangerouslySetInnerHTML!=null){if(a.children!=null)throw Error(Xe(60));if(typeof a.dangerouslySetInnerHTML!="object"||!("__html"in a.dangerouslySetInnerHTML))throw Error(Xe(61))}if(a.style!=null&&typeof a.style!="object")throw Error(Xe(62))}}function B_(i,a){if(i.indexOf("-")===-1)return typeof a.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var O_=null;function Ay(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var N_=null,Qu=null,Ju=null;function Vx(i){if(i=xd(i)){if(typeof N_!="function")throw Error(Xe(280));var a=i.stateNode;a&&(a=dm(a),N_(i.stateNode,i.type,a))}}function vb(i){Qu?Ju?Ju.push(i):Ju=[i]:Qu=i}function xb(){if(Qu){var i=Qu,a=Ju;if(Ju=Qu=null,Vx(i),a)for(i=0;i<a.length;i++)Vx(a[i])}}function bb(i,a){return i(a)}function wb(){}var e_=!1;function Tb(i,a,f){if(e_)return i(a,f);e_=!0;try{return bb(i,a,f)}finally{e_=!1,(Qu!==null||Ju!==null)&&(wb(),xb())}}function td(i,a){var f=i.stateNode;if(f===null)return null;var v=dm(f);if(v===null)return null;f=v[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(v=!v.disabled)||(i=i.type,v=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!v;break e;default:i=!1}if(i)return null;if(f&&typeof f!="function")throw Error(Xe(231,a,typeof f));return f}var j_=!1;if(uo)try{var Ah={};Object.defineProperty(Ah,"passive",{get:function(){j_=!0}}),window.addEventListener("test",Ah,Ah),window.removeEventListener("test",Ah,Ah)}catch{j_=!1}function FP(i,a,f,v,S,C,w,c,N){var K=Array.prototype.slice.call(arguments,3);try{a.apply(f,K)}catch(fe){this.onError(fe)}}var qh=!1,Bf=null,Of=!1,V_=null,BP={onError:function(i){qh=!0,Bf=i}};function OP(i,a,f,v,S,C,w,c,N){qh=!1,Bf=null,FP.apply(BP,arguments)}function NP(i,a,f,v,S,C,w,c,N){if(OP.apply(this,arguments),qh){if(qh){var K=Bf;qh=!1,Bf=null}else throw Error(Xe(198));Of||(Of=!0,V_=K)}}function kl(i){var a=i,f=i;if(i.alternate)for(;a.return;)a=a.return;else{i=a;do a=i,a.flags&4098&&(f=a.return),i=a.return;while(i)}return a.tag===3?f:null}function Sb(i){if(i.tag===13){var a=i.memoizedState;if(a===null&&(i=i.alternate,i!==null&&(a=i.memoizedState)),a!==null)return a.dehydrated}return null}function Ux(i){if(kl(i)!==i)throw Error(Xe(188))}function jP(i){var a=i.alternate;if(!a){if(a=kl(i),a===null)throw Error(Xe(188));return a!==i?null:i}for(var f=i,v=a;;){var S=f.return;if(S===null)break;var C=S.alternate;if(C===null){if(v=S.return,v!==null){f=v;continue}break}if(S.child===C.child){for(C=S.child;C;){if(C===f)return Ux(S),i;if(C===v)return Ux(S),a;C=C.sibling}throw Error(Xe(188))}if(f.return!==v.return)f=S,v=C;else{for(var w=!1,c=S.child;c;){if(c===f){w=!0,f=S,v=C;break}if(c===v){w=!0,v=S,f=C;break}c=c.sibling}if(!w){for(c=C.child;c;){if(c===f){w=!0,f=C,v=S;break}if(c===v){w=!0,v=C,f=S;break}c=c.sibling}if(!w)throw Error(Xe(189))}}if(f.alternate!==v)throw Error(Xe(190))}if(f.tag!==3)throw Error(Xe(188));return f.stateNode.current===f?i:a}function Pb(i){return i=jP(i),i!==null?Eb(i):null}function Eb(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var a=Eb(i);if(a!==null)return a;i=i.sibling}return null}var Cb=Ei.unstable_scheduleCallback,$x=Ei.unstable_cancelCallback,VP=Ei.unstable_shouldYield,UP=Ei.unstable_requestPaint,Gr=Ei.unstable_now,$P=Ei.unstable_getCurrentPriorityLevel,zy=Ei.unstable_ImmediatePriority,Mb=Ei.unstable_UserBlockingPriority,Nf=Ei.unstable_NormalPriority,GP=Ei.unstable_LowPriority,Ib=Ei.unstable_IdlePriority,lm=null,Ms=null;function qP(i){if(Ms&&typeof Ms.onCommitFiberRoot=="function")try{Ms.onCommitFiberRoot(lm,i,void 0,(i.current.flags&128)===128)}catch{}}var ss=Math.clz32?Math.clz32:HP,ZP=Math.log,WP=Math.LN2;function HP(i){return i>>>=0,i===0?32:31-(ZP(i)/WP|0)|0}var af=64,lf=4194304;function Vh(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function jf(i,a){var f=i.pendingLanes;if(f===0)return 0;var v=0,S=i.suspendedLanes,C=i.pingedLanes,w=f&268435455;if(w!==0){var c=w&~S;c!==0?v=Vh(c):(C&=w,C!==0&&(v=Vh(C)))}else w=f&~S,w!==0?v=Vh(w):C!==0&&(v=Vh(C));if(v===0)return 0;if(a!==0&&a!==v&&!(a&S)&&(S=v&-v,C=a&-a,S>=C||S===16&&(C&4194240)!==0))return a;if(v&4&&(v|=f&16),a=i.entangledLanes,a!==0)for(i=i.entanglements,a&=v;0<a;)f=31-ss(a),S=1<<f,v|=i[f],a&=~S;return v}function XP(i,a){switch(i){case 1:case 2:case 4:return a+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function YP(i,a){for(var f=i.suspendedLanes,v=i.pingedLanes,S=i.expirationTimes,C=i.pendingLanes;0<C;){var w=31-ss(C),c=1<<w,N=S[w];N===-1?(!(c&f)||c&v)&&(S[w]=XP(c,a)):N<=a&&(i.expiredLanes|=c),C&=~c}}function U_(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function kb(){var i=af;return af<<=1,!(af&4194240)&&(af=64),i}function t_(i){for(var a=[],f=0;31>f;f++)a.push(i);return a}function yd(i,a,f){i.pendingLanes|=a,a!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,a=31-ss(a),i[a]=f}function KP(i,a){var f=i.pendingLanes&~a;i.pendingLanes=a,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=a,i.mutableReadLanes&=a,i.entangledLanes&=a,a=i.entanglements;var v=i.eventTimes;for(i=i.expirationTimes;0<f;){var S=31-ss(f),C=1<<S;a[S]=0,v[S]=-1,i[S]=-1,f&=~C}}function Dy(i,a){var f=i.entangledLanes|=a;for(i=i.entanglements;f;){var v=31-ss(f),S=1<<v;S&a|i[v]&a&&(i[v]|=a),f&=~S}}var Kt=0;function Ab(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var zb,Ry,Db,Rb,Lb,$_=!1,uf=[],sa=null,oa=null,aa=null,rd=new Map,nd=new Map,ta=[],QP="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Gx(i,a){switch(i){case"focusin":case"focusout":sa=null;break;case"dragenter":case"dragleave":oa=null;break;case"mouseover":case"mouseout":aa=null;break;case"pointerover":case"pointerout":rd.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":nd.delete(a.pointerId)}}function zh(i,a,f,v,S,C){return i===null||i.nativeEvent!==C?(i={blockedOn:a,domEventName:f,eventSystemFlags:v,nativeEvent:C,targetContainers:[S]},a!==null&&(a=xd(a),a!==null&&Ry(a)),i):(i.eventSystemFlags|=v,a=i.targetContainers,S!==null&&a.indexOf(S)===-1&&a.push(S),i)}function JP(i,a,f,v,S){switch(a){case"focusin":return sa=zh(sa,i,a,f,v,S),!0;case"dragenter":return oa=zh(oa,i,a,f,v,S),!0;case"mouseover":return aa=zh(aa,i,a,f,v,S),!0;case"pointerover":var C=S.pointerId;return rd.set(C,zh(rd.get(C)||null,i,a,f,v,S)),!0;case"gotpointercapture":return C=S.pointerId,nd.set(C,zh(nd.get(C)||null,i,a,f,v,S)),!0}return!1}function Fb(i){var a=vl(i.target);if(a!==null){var f=kl(a);if(f!==null){if(a=f.tag,a===13){if(a=Sb(f),a!==null){i.blockedOn=a,Lb(i.priority,function(){Db(f)});return}}else if(a===3&&f.stateNode.current.memoizedState.isDehydrated){i.blockedOn=f.tag===3?f.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Sf(i){if(i.blockedOn!==null)return!1;for(var a=i.targetContainers;0<a.length;){var f=G_(i.domEventName,i.eventSystemFlags,a[0],i.nativeEvent);if(f===null){f=i.nativeEvent;var v=new f.constructor(f.type,f);O_=v,f.target.dispatchEvent(v),O_=null}else return a=xd(f),a!==null&&Ry(a),i.blockedOn=f,!1;a.shift()}return!0}function qx(i,a,f){Sf(i)&&f.delete(a)}function eE(){$_=!1,sa!==null&&Sf(sa)&&(sa=null),oa!==null&&Sf(oa)&&(oa=null),aa!==null&&Sf(aa)&&(aa=null),rd.forEach(qx),nd.forEach(qx)}function Dh(i,a){i.blockedOn===a&&(i.blockedOn=null,$_||($_=!0,Ei.unstable_scheduleCallback(Ei.unstable_NormalPriority,eE)))}function id(i){function a(S){return Dh(S,i)}if(0<uf.length){Dh(uf[0],i);for(var f=1;f<uf.length;f++){var v=uf[f];v.blockedOn===i&&(v.blockedOn=null)}}for(sa!==null&&Dh(sa,i),oa!==null&&Dh(oa,i),aa!==null&&Dh(aa,i),rd.forEach(a),nd.forEach(a),f=0;f<ta.length;f++)v=ta[f],v.blockedOn===i&&(v.blockedOn=null);for(;0<ta.length&&(f=ta[0],f.blockedOn===null);)Fb(f),f.blockedOn===null&&ta.shift()}var ec=mo.ReactCurrentBatchConfig,Vf=!0;function tE(i,a,f,v){var S=Kt,C=ec.transition;ec.transition=null;try{Kt=1,Ly(i,a,f,v)}finally{Kt=S,ec.transition=C}}function rE(i,a,f,v){var S=Kt,C=ec.transition;ec.transition=null;try{Kt=4,Ly(i,a,f,v)}finally{Kt=S,ec.transition=C}}function Ly(i,a,f,v){if(Vf){var S=G_(i,a,f,v);if(S===null)h_(i,a,v,Uf,f),Gx(i,v);else if(JP(S,i,a,f,v))v.stopPropagation();else if(Gx(i,v),a&4&&-1<QP.indexOf(i)){for(;S!==null;){var C=xd(S);if(C!==null&&zb(C),C=G_(i,a,f,v),C===null&&h_(i,a,v,Uf,f),C===S)break;S=C}S!==null&&v.stopPropagation()}else h_(i,a,v,null,f)}}var Uf=null;function G_(i,a,f,v){if(Uf=null,i=Ay(v),i=vl(i),i!==null)if(a=kl(i),a===null)i=null;else if(f=a.tag,f===13){if(i=Sb(a),i!==null)return i;i=null}else if(f===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;i=null}else a!==i&&(i=null);return Uf=i,null}function Bb(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch($P()){case zy:return 1;case Mb:return 4;case Nf:case GP:return 16;case Ib:return 536870912;default:return 16}default:return 16}}var na=null,Fy=null,Pf=null;function Ob(){if(Pf)return Pf;var i,a=Fy,f=a.length,v,S="value"in na?na.value:na.textContent,C=S.length;for(i=0;i<f&&a[i]===S[i];i++);var w=f-i;for(v=1;v<=w&&a[f-v]===S[C-v];v++);return Pf=S.slice(i,1<v?1-v:void 0)}function Ef(i){var a=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&a===13&&(i=13)):i=a,i===10&&(i=13),32<=i||i===13?i:0}function cf(){return!0}function Zx(){return!1}function Mi(i){function a(f,v,S,C,w){this._reactName=f,this._targetInst=S,this.type=v,this.nativeEvent=C,this.target=w,this.currentTarget=null;for(var c in i)i.hasOwnProperty(c)&&(f=i[c],this[c]=f?f(C):C[c]);return this.isDefaultPrevented=(C.defaultPrevented!=null?C.defaultPrevented:C.returnValue===!1)?cf:Zx,this.isPropagationStopped=Zx,this}return Dr(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var f=this.nativeEvent;f&&(f.preventDefault?f.preventDefault():typeof f.returnValue!="unknown"&&(f.returnValue=!1),this.isDefaultPrevented=cf)},stopPropagation:function(){var f=this.nativeEvent;f&&(f.stopPropagation?f.stopPropagation():typeof f.cancelBubble!="unknown"&&(f.cancelBubble=!0),this.isPropagationStopped=cf)},persist:function(){},isPersistent:cf}),a}var hc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},By=Mi(hc),vd=Dr({},hc,{view:0,detail:0}),nE=Mi(vd),r_,n_,Rh,um=Dr({},vd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Oy,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==Rh&&(Rh&&i.type==="mousemove"?(r_=i.screenX-Rh.screenX,n_=i.screenY-Rh.screenY):n_=r_=0,Rh=i),r_)},movementY:function(i){return"movementY"in i?i.movementY:n_}}),Wx=Mi(um),iE=Dr({},um,{dataTransfer:0}),sE=Mi(iE),oE=Dr({},vd,{relatedTarget:0}),i_=Mi(oE),aE=Dr({},hc,{animationName:0,elapsedTime:0,pseudoElement:0}),lE=Mi(aE),uE=Dr({},hc,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),cE=Mi(uE),hE=Dr({},hc,{data:0}),Hx=Mi(hE),dE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},pE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},fE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function mE(i){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(i):(i=fE[i])?!!a[i]:!1}function Oy(){return mE}var gE=Dr({},vd,{key:function(i){if(i.key){var a=dE[i.key]||i.key;if(a!=="Unidentified")return a}return i.type==="keypress"?(i=Ef(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?pE[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Oy,charCode:function(i){return i.type==="keypress"?Ef(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Ef(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),_E=Mi(gE),yE=Dr({},um,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Xx=Mi(yE),vE=Dr({},vd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Oy}),xE=Mi(vE),bE=Dr({},hc,{propertyName:0,elapsedTime:0,pseudoElement:0}),wE=Mi(bE),TE=Dr({},um,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),SE=Mi(TE),PE=[9,13,27,32],Ny=uo&&"CompositionEvent"in window,Zh=null;uo&&"documentMode"in document&&(Zh=document.documentMode);var EE=uo&&"TextEvent"in window&&!Zh,Nb=uo&&(!Ny||Zh&&8<Zh&&11>=Zh),Yx=" ",Kx=!1;function jb(i,a){switch(i){case"keyup":return PE.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Vb(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Vu=!1;function CE(i,a){switch(i){case"compositionend":return Vb(a);case"keypress":return a.which!==32?null:(Kx=!0,Yx);case"textInput":return i=a.data,i===Yx&&Kx?null:i;default:return null}}function ME(i,a){if(Vu)return i==="compositionend"||!Ny&&jb(i,a)?(i=Ob(),Pf=Fy=na=null,Vu=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Nb&&a.locale!=="ko"?null:a.data;default:return null}}var IE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Qx(i){var a=i&&i.nodeName&&i.nodeName.toLowerCase();return a==="input"?!!IE[i.type]:a==="textarea"}function Ub(i,a,f,v){vb(v),a=$f(a,"onChange"),0<a.length&&(f=new By("onChange","change",null,f,v),i.push({event:f,listeners:a}))}var Wh=null,sd=null;function kE(i){Jb(i,0)}function cm(i){var a=Gu(i);if(db(a))return i}function AE(i,a){if(i==="change")return a}var $b=!1;if(uo){var s_;if(uo){var o_="oninput"in document;if(!o_){var Jx=document.createElement("div");Jx.setAttribute("oninput","return;"),o_=typeof Jx.oninput=="function"}s_=o_}else s_=!1;$b=s_&&(!document.documentMode||9<document.documentMode)}function e1(){Wh&&(Wh.detachEvent("onpropertychange",Gb),sd=Wh=null)}function Gb(i){if(i.propertyName==="value"&&cm(sd)){var a=[];Ub(a,sd,i,Ay(i)),Tb(kE,a)}}function zE(i,a,f){i==="focusin"?(e1(),Wh=a,sd=f,Wh.attachEvent("onpropertychange",Gb)):i==="focusout"&&e1()}function DE(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return cm(sd)}function RE(i,a){if(i==="click")return cm(a)}function LE(i,a){if(i==="input"||i==="change")return cm(a)}function FE(i,a){return i===a&&(i!==0||1/i===1/a)||i!==i&&a!==a}var as=typeof Object.is=="function"?Object.is:FE;function od(i,a){if(as(i,a))return!0;if(typeof i!="object"||i===null||typeof a!="object"||a===null)return!1;var f=Object.keys(i),v=Object.keys(a);if(f.length!==v.length)return!1;for(v=0;v<f.length;v++){var S=f[v];if(!E_.call(a,S)||!as(i[S],a[S]))return!1}return!0}function t1(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function r1(i,a){var f=t1(i);i=0;for(var v;f;){if(f.nodeType===3){if(v=i+f.textContent.length,i<=a&&v>=a)return{node:f,offset:a-i};i=v}e:{for(;f;){if(f.nextSibling){f=f.nextSibling;break e}f=f.parentNode}f=void 0}f=t1(f)}}function qb(i,a){return i&&a?i===a?!0:i&&i.nodeType===3?!1:a&&a.nodeType===3?qb(i,a.parentNode):"contains"in i?i.contains(a):i.compareDocumentPosition?!!(i.compareDocumentPosition(a)&16):!1:!1}function Zb(){for(var i=window,a=Ff();a instanceof i.HTMLIFrameElement;){try{var f=typeof a.contentWindow.location.href=="string"}catch{f=!1}if(f)i=a.contentWindow;else break;a=Ff(i.document)}return a}function jy(i){var a=i&&i.nodeName&&i.nodeName.toLowerCase();return a&&(a==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||a==="textarea"||i.contentEditable==="true")}function BE(i){var a=Zb(),f=i.focusedElem,v=i.selectionRange;if(a!==f&&f&&f.ownerDocument&&qb(f.ownerDocument.documentElement,f)){if(v!==null&&jy(f)){if(a=v.start,i=v.end,i===void 0&&(i=a),"selectionStart"in f)f.selectionStart=a,f.selectionEnd=Math.min(i,f.value.length);else if(i=(a=f.ownerDocument||document)&&a.defaultView||window,i.getSelection){i=i.getSelection();var S=f.textContent.length,C=Math.min(v.start,S);v=v.end===void 0?C:Math.min(v.end,S),!i.extend&&C>v&&(S=v,v=C,C=S),S=r1(f,C);var w=r1(f,v);S&&w&&(i.rangeCount!==1||i.anchorNode!==S.node||i.anchorOffset!==S.offset||i.focusNode!==w.node||i.focusOffset!==w.offset)&&(a=a.createRange(),a.setStart(S.node,S.offset),i.removeAllRanges(),C>v?(i.addRange(a),i.extend(w.node,w.offset)):(a.setEnd(w.node,w.offset),i.addRange(a)))}}for(a=[],i=f;i=i.parentNode;)i.nodeType===1&&a.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof f.focus=="function"&&f.focus(),f=0;f<a.length;f++)i=a[f],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var OE=uo&&"documentMode"in document&&11>=document.documentMode,Uu=null,q_=null,Hh=null,Z_=!1;function n1(i,a,f){var v=f.window===f?f.document:f.nodeType===9?f:f.ownerDocument;Z_||Uu==null||Uu!==Ff(v)||(v=Uu,"selectionStart"in v&&jy(v)?v={start:v.selectionStart,end:v.selectionEnd}:(v=(v.ownerDocument&&v.ownerDocument.defaultView||window).getSelection(),v={anchorNode:v.anchorNode,anchorOffset:v.anchorOffset,focusNode:v.focusNode,focusOffset:v.focusOffset}),Hh&&od(Hh,v)||(Hh=v,v=$f(q_,"onSelect"),0<v.length&&(a=new By("onSelect","select",null,a,f),i.push({event:a,listeners:v}),a.target=Uu)))}function hf(i,a){var f={};return f[i.toLowerCase()]=a.toLowerCase(),f["Webkit"+i]="webkit"+a,f["Moz"+i]="moz"+a,f}var $u={animationend:hf("Animation","AnimationEnd"),animationiteration:hf("Animation","AnimationIteration"),animationstart:hf("Animation","AnimationStart"),transitionend:hf("Transition","TransitionEnd")},a_={},Wb={};uo&&(Wb=document.createElement("div").style,"AnimationEvent"in window||(delete $u.animationend.animation,delete $u.animationiteration.animation,delete $u.animationstart.animation),"TransitionEvent"in window||delete $u.transitionend.transition);function hm(i){if(a_[i])return a_[i];if(!$u[i])return i;var a=$u[i],f;for(f in a)if(a.hasOwnProperty(f)&&f in Wb)return a_[i]=a[f];return i}var Hb=hm("animationend"),Xb=hm("animationiteration"),Yb=hm("animationstart"),Kb=hm("transitionend"),Qb=new Map,i1="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ma(i,a){Qb.set(i,a),Il(a,[i])}for(var l_=0;l_<i1.length;l_++){var u_=i1[l_],NE=u_.toLowerCase(),jE=u_[0].toUpperCase()+u_.slice(1);ma(NE,"on"+jE)}ma(Hb,"onAnimationEnd");ma(Xb,"onAnimationIteration");ma(Yb,"onAnimationStart");ma("dblclick","onDoubleClick");ma("focusin","onFocus");ma("focusout","onBlur");ma(Kb,"onTransitionEnd");nc("onMouseEnter",["mouseout","mouseover"]);nc("onMouseLeave",["mouseout","mouseover"]);nc("onPointerEnter",["pointerout","pointerover"]);nc("onPointerLeave",["pointerout","pointerover"]);Il("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Il("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Il("onBeforeInput",["compositionend","keypress","textInput","paste"]);Il("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Il("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Il("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Uh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),VE=new Set("cancel close invalid load scroll toggle".split(" ").concat(Uh));function s1(i,a,f){var v=i.type||"unknown-event";i.currentTarget=f,NP(v,a,void 0,i),i.currentTarget=null}function Jb(i,a){a=(a&4)!==0;for(var f=0;f<i.length;f++){var v=i[f],S=v.event;v=v.listeners;e:{var C=void 0;if(a)for(var w=v.length-1;0<=w;w--){var c=v[w],N=c.instance,K=c.currentTarget;if(c=c.listener,N!==C&&S.isPropagationStopped())break e;s1(S,c,K),C=N}else for(w=0;w<v.length;w++){if(c=v[w],N=c.instance,K=c.currentTarget,c=c.listener,N!==C&&S.isPropagationStopped())break e;s1(S,c,K),C=N}}}if(Of)throw i=V_,Of=!1,V_=null,i}function vr(i,a){var f=a[K_];f===void 0&&(f=a[K_]=new Set);var v=i+"__bubble";f.has(v)||(ew(a,i,2,!1),f.add(v))}function c_(i,a,f){var v=0;a&&(v|=4),ew(f,i,v,a)}var df="_reactListening"+Math.random().toString(36).slice(2);function ad(i){if(!i[df]){i[df]=!0,ab.forEach(function(f){f!=="selectionchange"&&(VE.has(f)||c_(f,!1,i),c_(f,!0,i))});var a=i.nodeType===9?i:i.ownerDocument;a===null||a[df]||(a[df]=!0,c_("selectionchange",!1,a))}}function ew(i,a,f,v){switch(Bb(a)){case 1:var S=tE;break;case 4:S=rE;break;default:S=Ly}f=S.bind(null,a,f,i),S=void 0,!j_||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(S=!0),v?S!==void 0?i.addEventListener(a,f,{capture:!0,passive:S}):i.addEventListener(a,f,!0):S!==void 0?i.addEventListener(a,f,{passive:S}):i.addEventListener(a,f,!1)}function h_(i,a,f,v,S){var C=v;if(!(a&1)&&!(a&2)&&v!==null)e:for(;;){if(v===null)return;var w=v.tag;if(w===3||w===4){var c=v.stateNode.containerInfo;if(c===S||c.nodeType===8&&c.parentNode===S)break;if(w===4)for(w=v.return;w!==null;){var N=w.tag;if((N===3||N===4)&&(N=w.stateNode.containerInfo,N===S||N.nodeType===8&&N.parentNode===S))return;w=w.return}for(;c!==null;){if(w=vl(c),w===null)return;if(N=w.tag,N===5||N===6){v=C=w;continue e}c=c.parentNode}}v=v.return}Tb(function(){var K=C,fe=Ay(f),pe=[];e:{var ye=Qb.get(i);if(ye!==void 0){var Ae=By,we=i;switch(i){case"keypress":if(Ef(f)===0)break e;case"keydown":case"keyup":Ae=_E;break;case"focusin":we="focus",Ae=i_;break;case"focusout":we="blur",Ae=i_;break;case"beforeblur":case"afterblur":Ae=i_;break;case"click":if(f.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ae=Wx;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ae=sE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ae=xE;break;case Hb:case Xb:case Yb:Ae=lE;break;case Kb:Ae=wE;break;case"scroll":Ae=nE;break;case"wheel":Ae=SE;break;case"copy":case"cut":case"paste":Ae=cE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ae=Xx}var _e=(a&4)!==0,se=!_e&&i==="scroll",ue=_e?ye!==null?ye+"Capture":null:ye;_e=[];for(var Y=K,ne;Y!==null;){ne=Y;var Be=ne.stateNode;if(ne.tag===5&&Be!==null&&(ne=Be,ue!==null&&(Be=td(Y,ue),Be!=null&&_e.push(ld(Y,Be,ne)))),se)break;Y=Y.return}0<_e.length&&(ye=new Ae(ye,we,null,f,fe),pe.push({event:ye,listeners:_e}))}}if(!(a&7)){e:{if(ye=i==="mouseover"||i==="pointerover",Ae=i==="mouseout"||i==="pointerout",ye&&f!==O_&&(we=f.relatedTarget||f.fromElement)&&(vl(we)||we[co]))break e;if((Ae||ye)&&(ye=fe.window===fe?fe:(ye=fe.ownerDocument)?ye.defaultView||ye.parentWindow:window,Ae?(we=f.relatedTarget||f.toElement,Ae=K,we=we?vl(we):null,we!==null&&(se=kl(we),we!==se||we.tag!==5&&we.tag!==6)&&(we=null)):(Ae=null,we=K),Ae!==we)){if(_e=Wx,Be="onMouseLeave",ue="onMouseEnter",Y="mouse",(i==="pointerout"||i==="pointerover")&&(_e=Xx,Be="onPointerLeave",ue="onPointerEnter",Y="pointer"),se=Ae==null?ye:Gu(Ae),ne=we==null?ye:Gu(we),ye=new _e(Be,Y+"leave",Ae,f,fe),ye.target=se,ye.relatedTarget=ne,Be=null,vl(fe)===K&&(_e=new _e(ue,Y+"enter",we,f,fe),_e.target=ne,_e.relatedTarget=se,Be=_e),se=Be,Ae&&we)t:{for(_e=Ae,ue=we,Y=0,ne=_e;ne;ne=Ou(ne))Y++;for(ne=0,Be=ue;Be;Be=Ou(Be))ne++;for(;0<Y-ne;)_e=Ou(_e),Y--;for(;0<ne-Y;)ue=Ou(ue),ne--;for(;Y--;){if(_e===ue||ue!==null&&_e===ue.alternate)break t;_e=Ou(_e),ue=Ou(ue)}_e=null}else _e=null;Ae!==null&&o1(pe,ye,Ae,_e,!1),we!==null&&se!==null&&o1(pe,se,we,_e,!0)}}e:{if(ye=K?Gu(K):window,Ae=ye.nodeName&&ye.nodeName.toLowerCase(),Ae==="select"||Ae==="input"&&ye.type==="file")var qe=AE;else if(Qx(ye))if($b)qe=LE;else{qe=DE;var et=zE}else(Ae=ye.nodeName)&&Ae.toLowerCase()==="input"&&(ye.type==="checkbox"||ye.type==="radio")&&(qe=RE);if(qe&&(qe=qe(i,K))){Ub(pe,qe,f,fe);break e}et&&et(i,ye,K),i==="focusout"&&(et=ye._wrapperState)&&et.controlled&&ye.type==="number"&&D_(ye,"number",ye.value)}switch(et=K?Gu(K):window,i){case"focusin":(Qx(et)||et.contentEditable==="true")&&(Uu=et,q_=K,Hh=null);break;case"focusout":Hh=q_=Uu=null;break;case"mousedown":Z_=!0;break;case"contextmenu":case"mouseup":case"dragend":Z_=!1,n1(pe,f,fe);break;case"selectionchange":if(OE)break;case"keydown":case"keyup":n1(pe,f,fe)}var We;if(Ny)e:{switch(i){case"compositionstart":var Ke="onCompositionStart";break e;case"compositionend":Ke="onCompositionEnd";break e;case"compositionupdate":Ke="onCompositionUpdate";break e}Ke=void 0}else Vu?jb(i,f)&&(Ke="onCompositionEnd"):i==="keydown"&&f.keyCode===229&&(Ke="onCompositionStart");Ke&&(Nb&&f.locale!=="ko"&&(Vu||Ke!=="onCompositionStart"?Ke==="onCompositionEnd"&&Vu&&(We=Ob()):(na=fe,Fy="value"in na?na.value:na.textContent,Vu=!0)),et=$f(K,Ke),0<et.length&&(Ke=new Hx(Ke,i,null,f,fe),pe.push({event:Ke,listeners:et}),We?Ke.data=We:(We=Vb(f),We!==null&&(Ke.data=We)))),(We=EE?CE(i,f):ME(i,f))&&(K=$f(K,"onBeforeInput"),0<K.length&&(fe=new Hx("onBeforeInput","beforeinput",null,f,fe),pe.push({event:fe,listeners:K}),fe.data=We))}Jb(pe,a)})}function ld(i,a,f){return{instance:i,listener:a,currentTarget:f}}function $f(i,a){for(var f=a+"Capture",v=[];i!==null;){var S=i,C=S.stateNode;S.tag===5&&C!==null&&(S=C,C=td(i,f),C!=null&&v.unshift(ld(i,C,S)),C=td(i,a),C!=null&&v.push(ld(i,C,S))),i=i.return}return v}function Ou(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function o1(i,a,f,v,S){for(var C=a._reactName,w=[];f!==null&&f!==v;){var c=f,N=c.alternate,K=c.stateNode;if(N!==null&&N===v)break;c.tag===5&&K!==null&&(c=K,S?(N=td(f,C),N!=null&&w.unshift(ld(f,N,c))):S||(N=td(f,C),N!=null&&w.push(ld(f,N,c)))),f=f.return}w.length!==0&&i.push({event:a,listeners:w})}var UE=/\r\n?/g,$E=/\u0000|\uFFFD/g;function a1(i){return(typeof i=="string"?i:""+i).replace(UE,`
`).replace($E,"")}function pf(i,a,f){if(a=a1(a),a1(i)!==a&&f)throw Error(Xe(425))}function Gf(){}var W_=null,H_=null;function X_(i,a){return i==="textarea"||i==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var Y_=typeof setTimeout=="function"?setTimeout:void 0,GE=typeof clearTimeout=="function"?clearTimeout:void 0,l1=typeof Promise=="function"?Promise:void 0,qE=typeof queueMicrotask=="function"?queueMicrotask:typeof l1<"u"?function(i){return l1.resolve(null).then(i).catch(ZE)}:Y_;function ZE(i){setTimeout(function(){throw i})}function d_(i,a){var f=a,v=0;do{var S=f.nextSibling;if(i.removeChild(f),S&&S.nodeType===8)if(f=S.data,f==="/$"){if(v===0){i.removeChild(S),id(a);return}v--}else f!=="$"&&f!=="$?"&&f!=="$!"||v++;f=S}while(f);id(a)}function la(i){for(;i!=null;i=i.nextSibling){var a=i.nodeType;if(a===1||a===3)break;if(a===8){if(a=i.data,a==="$"||a==="$!"||a==="$?")break;if(a==="/$")return null}}return i}function u1(i){i=i.previousSibling;for(var a=0;i;){if(i.nodeType===8){var f=i.data;if(f==="$"||f==="$!"||f==="$?"){if(a===0)return i;a--}else f==="/$"&&a++}i=i.previousSibling}return null}var dc=Math.random().toString(36).slice(2),Cs="__reactFiber$"+dc,ud="__reactProps$"+dc,co="__reactContainer$"+dc,K_="__reactEvents$"+dc,WE="__reactListeners$"+dc,HE="__reactHandles$"+dc;function vl(i){var a=i[Cs];if(a)return a;for(var f=i.parentNode;f;){if(a=f[co]||f[Cs]){if(f=a.alternate,a.child!==null||f!==null&&f.child!==null)for(i=u1(i);i!==null;){if(f=i[Cs])return f;i=u1(i)}return a}i=f,f=i.parentNode}return null}function xd(i){return i=i[Cs]||i[co],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function Gu(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(Xe(33))}function dm(i){return i[ud]||null}var Q_=[],qu=-1;function ga(i){return{current:i}}function xr(i){0>qu||(i.current=Q_[qu],Q_[qu]=null,qu--)}function hr(i,a){qu++,Q_[qu]=i.current,i.current=a}var fa={},On=ga(fa),oi=ga(!1),Sl=fa;function ic(i,a){var f=i.type.contextTypes;if(!f)return fa;var v=i.stateNode;if(v&&v.__reactInternalMemoizedUnmaskedChildContext===a)return v.__reactInternalMemoizedMaskedChildContext;var S={},C;for(C in f)S[C]=a[C];return v&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=a,i.__reactInternalMemoizedMaskedChildContext=S),S}function ai(i){return i=i.childContextTypes,i!=null}function qf(){xr(oi),xr(On)}function c1(i,a,f){if(On.current!==fa)throw Error(Xe(168));hr(On,a),hr(oi,f)}function tw(i,a,f){var v=i.stateNode;if(a=a.childContextTypes,typeof v.getChildContext!="function")return f;v=v.getChildContext();for(var S in v)if(!(S in a))throw Error(Xe(108,zP(i)||"Unknown",S));return Dr({},f,v)}function Zf(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||fa,Sl=On.current,hr(On,i),hr(oi,oi.current),!0}function h1(i,a,f){var v=i.stateNode;if(!v)throw Error(Xe(169));f?(i=tw(i,a,Sl),v.__reactInternalMemoizedMergedChildContext=i,xr(oi),xr(On),hr(On,i)):xr(oi),hr(oi,f)}var io=null,pm=!1,p_=!1;function rw(i){io===null?io=[i]:io.push(i)}function XE(i){pm=!0,rw(i)}function _a(){if(!p_&&io!==null){p_=!0;var i=0,a=Kt;try{var f=io;for(Kt=1;i<f.length;i++){var v=f[i];do v=v(!0);while(v!==null)}io=null,pm=!1}catch(S){throw io!==null&&(io=io.slice(i+1)),Cb(zy,_a),S}finally{Kt=a,p_=!1}}return null}var Zu=[],Wu=0,Wf=null,Hf=0,Fi=[],Bi=0,Pl=null,so=1,oo="";function _l(i,a){Zu[Wu++]=Hf,Zu[Wu++]=Wf,Wf=i,Hf=a}function nw(i,a,f){Fi[Bi++]=so,Fi[Bi++]=oo,Fi[Bi++]=Pl,Pl=i;var v=so;i=oo;var S=32-ss(v)-1;v&=~(1<<S),f+=1;var C=32-ss(a)+S;if(30<C){var w=S-S%5;C=(v&(1<<w)-1).toString(32),v>>=w,S-=w,so=1<<32-ss(a)+S|f<<S|v,oo=C+i}else so=1<<C|f<<S|v,oo=i}function Vy(i){i.return!==null&&(_l(i,1),nw(i,1,0))}function Uy(i){for(;i===Wf;)Wf=Zu[--Wu],Zu[Wu]=null,Hf=Zu[--Wu],Zu[Wu]=null;for(;i===Pl;)Pl=Fi[--Bi],Fi[Bi]=null,oo=Fi[--Bi],Fi[Bi]=null,so=Fi[--Bi],Fi[Bi]=null}var Pi=null,Si=null,Cr=!1,ns=null;function iw(i,a){var f=Oi(5,null,null,0);f.elementType="DELETED",f.stateNode=a,f.return=i,a=i.deletions,a===null?(i.deletions=[f],i.flags|=16):a.push(f)}function d1(i,a){switch(i.tag){case 5:var f=i.type;return a=a.nodeType!==1||f.toLowerCase()!==a.nodeName.toLowerCase()?null:a,a!==null?(i.stateNode=a,Pi=i,Si=la(a.firstChild),!0):!1;case 6:return a=i.pendingProps===""||a.nodeType!==3?null:a,a!==null?(i.stateNode=a,Pi=i,Si=null,!0):!1;case 13:return a=a.nodeType!==8?null:a,a!==null?(f=Pl!==null?{id:so,overflow:oo}:null,i.memoizedState={dehydrated:a,treeContext:f,retryLane:1073741824},f=Oi(18,null,null,0),f.stateNode=a,f.return=i,i.child=f,Pi=i,Si=null,!0):!1;default:return!1}}function J_(i){return(i.mode&1)!==0&&(i.flags&128)===0}function ey(i){if(Cr){var a=Si;if(a){var f=a;if(!d1(i,a)){if(J_(i))throw Error(Xe(418));a=la(f.nextSibling);var v=Pi;a&&d1(i,a)?iw(v,f):(i.flags=i.flags&-4097|2,Cr=!1,Pi=i)}}else{if(J_(i))throw Error(Xe(418));i.flags=i.flags&-4097|2,Cr=!1,Pi=i}}}function p1(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;Pi=i}function ff(i){if(i!==Pi)return!1;if(!Cr)return p1(i),Cr=!0,!1;var a;if((a=i.tag!==3)&&!(a=i.tag!==5)&&(a=i.type,a=a!=="head"&&a!=="body"&&!X_(i.type,i.memoizedProps)),a&&(a=Si)){if(J_(i))throw sw(),Error(Xe(418));for(;a;)iw(i,a),a=la(a.nextSibling)}if(p1(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Xe(317));e:{for(i=i.nextSibling,a=0;i;){if(i.nodeType===8){var f=i.data;if(f==="/$"){if(a===0){Si=la(i.nextSibling);break e}a--}else f!=="$"&&f!=="$!"&&f!=="$?"||a++}i=i.nextSibling}Si=null}}else Si=Pi?la(i.stateNode.nextSibling):null;return!0}function sw(){for(var i=Si;i;)i=la(i.nextSibling)}function sc(){Si=Pi=null,Cr=!1}function $y(i){ns===null?ns=[i]:ns.push(i)}var YE=mo.ReactCurrentBatchConfig;function Lh(i,a,f){if(i=f.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(f._owner){if(f=f._owner,f){if(f.tag!==1)throw Error(Xe(309));var v=f.stateNode}if(!v)throw Error(Xe(147,i));var S=v,C=""+i;return a!==null&&a.ref!==null&&typeof a.ref=="function"&&a.ref._stringRef===C?a.ref:(a=function(w){var c=S.refs;w===null?delete c[C]:c[C]=w},a._stringRef=C,a)}if(typeof i!="string")throw Error(Xe(284));if(!f._owner)throw Error(Xe(290,i))}return i}function mf(i,a){throw i=Object.prototype.toString.call(a),Error(Xe(31,i==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":i))}function f1(i){var a=i._init;return a(i._payload)}function ow(i){function a(ue,Y){if(i){var ne=ue.deletions;ne===null?(ue.deletions=[Y],ue.flags|=16):ne.push(Y)}}function f(ue,Y){if(!i)return null;for(;Y!==null;)a(ue,Y),Y=Y.sibling;return null}function v(ue,Y){for(ue=new Map;Y!==null;)Y.key!==null?ue.set(Y.key,Y):ue.set(Y.index,Y),Y=Y.sibling;return ue}function S(ue,Y){return ue=da(ue,Y),ue.index=0,ue.sibling=null,ue}function C(ue,Y,ne){return ue.index=ne,i?(ne=ue.alternate,ne!==null?(ne=ne.index,ne<Y?(ue.flags|=2,Y):ne):(ue.flags|=2,Y)):(ue.flags|=1048576,Y)}function w(ue){return i&&ue.alternate===null&&(ue.flags|=2),ue}function c(ue,Y,ne,Be){return Y===null||Y.tag!==6?(Y=x_(ne,ue.mode,Be),Y.return=ue,Y):(Y=S(Y,ne),Y.return=ue,Y)}function N(ue,Y,ne,Be){var qe=ne.type;return qe===ju?fe(ue,Y,ne.props.children,Be,ne.key):Y!==null&&(Y.elementType===qe||typeof qe=="object"&&qe!==null&&qe.$$typeof===Jo&&f1(qe)===Y.type)?(Be=S(Y,ne.props),Be.ref=Lh(ue,Y,ne),Be.return=ue,Be):(Be=Df(ne.type,ne.key,ne.props,null,ue.mode,Be),Be.ref=Lh(ue,Y,ne),Be.return=ue,Be)}function K(ue,Y,ne,Be){return Y===null||Y.tag!==4||Y.stateNode.containerInfo!==ne.containerInfo||Y.stateNode.implementation!==ne.implementation?(Y=b_(ne,ue.mode,Be),Y.return=ue,Y):(Y=S(Y,ne.children||[]),Y.return=ue,Y)}function fe(ue,Y,ne,Be,qe){return Y===null||Y.tag!==7?(Y=Tl(ne,ue.mode,Be,qe),Y.return=ue,Y):(Y=S(Y,ne),Y.return=ue,Y)}function pe(ue,Y,ne){if(typeof Y=="string"&&Y!==""||typeof Y=="number")return Y=x_(""+Y,ue.mode,ne),Y.return=ue,Y;if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case nf:return ne=Df(Y.type,Y.key,Y.props,null,ue.mode,ne),ne.ref=Lh(ue,null,Y),ne.return=ue,ne;case Nu:return Y=b_(Y,ue.mode,ne),Y.return=ue,Y;case Jo:var Be=Y._init;return pe(ue,Be(Y._payload),ne)}if(jh(Y)||kh(Y))return Y=Tl(Y,ue.mode,ne,null),Y.return=ue,Y;mf(ue,Y)}return null}function ye(ue,Y,ne,Be){var qe=Y!==null?Y.key:null;if(typeof ne=="string"&&ne!==""||typeof ne=="number")return qe!==null?null:c(ue,Y,""+ne,Be);if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case nf:return ne.key===qe?N(ue,Y,ne,Be):null;case Nu:return ne.key===qe?K(ue,Y,ne,Be):null;case Jo:return qe=ne._init,ye(ue,Y,qe(ne._payload),Be)}if(jh(ne)||kh(ne))return qe!==null?null:fe(ue,Y,ne,Be,null);mf(ue,ne)}return null}function Ae(ue,Y,ne,Be,qe){if(typeof Be=="string"&&Be!==""||typeof Be=="number")return ue=ue.get(ne)||null,c(Y,ue,""+Be,qe);if(typeof Be=="object"&&Be!==null){switch(Be.$$typeof){case nf:return ue=ue.get(Be.key===null?ne:Be.key)||null,N(Y,ue,Be,qe);case Nu:return ue=ue.get(Be.key===null?ne:Be.key)||null,K(Y,ue,Be,qe);case Jo:var et=Be._init;return Ae(ue,Y,ne,et(Be._payload),qe)}if(jh(Be)||kh(Be))return ue=ue.get(ne)||null,fe(Y,ue,Be,qe,null);mf(Y,Be)}return null}function we(ue,Y,ne,Be){for(var qe=null,et=null,We=Y,Ke=Y=0,_t=null;We!==null&&Ke<ne.length;Ke++){We.index>Ke?(_t=We,We=null):_t=We.sibling;var at=ye(ue,We,ne[Ke],Be);if(at===null){We===null&&(We=_t);break}i&&We&&at.alternate===null&&a(ue,We),Y=C(at,Y,Ke),et===null?qe=at:et.sibling=at,et=at,We=_t}if(Ke===ne.length)return f(ue,We),Cr&&_l(ue,Ke),qe;if(We===null){for(;Ke<ne.length;Ke++)We=pe(ue,ne[Ke],Be),We!==null&&(Y=C(We,Y,Ke),et===null?qe=We:et.sibling=We,et=We);return Cr&&_l(ue,Ke),qe}for(We=v(ue,We);Ke<ne.length;Ke++)_t=Ae(We,ue,Ke,ne[Ke],Be),_t!==null&&(i&&_t.alternate!==null&&We.delete(_t.key===null?Ke:_t.key),Y=C(_t,Y,Ke),et===null?qe=_t:et.sibling=_t,et=_t);return i&&We.forEach(function(Qt){return a(ue,Qt)}),Cr&&_l(ue,Ke),qe}function _e(ue,Y,ne,Be){var qe=kh(ne);if(typeof qe!="function")throw Error(Xe(150));if(ne=qe.call(ne),ne==null)throw Error(Xe(151));for(var et=qe=null,We=Y,Ke=Y=0,_t=null,at=ne.next();We!==null&&!at.done;Ke++,at=ne.next()){We.index>Ke?(_t=We,We=null):_t=We.sibling;var Qt=ye(ue,We,at.value,Be);if(Qt===null){We===null&&(We=_t);break}i&&We&&Qt.alternate===null&&a(ue,We),Y=C(Qt,Y,Ke),et===null?qe=Qt:et.sibling=Qt,et=Qt,We=_t}if(at.done)return f(ue,We),Cr&&_l(ue,Ke),qe;if(We===null){for(;!at.done;Ke++,at=ne.next())at=pe(ue,at.value,Be),at!==null&&(Y=C(at,Y,Ke),et===null?qe=at:et.sibling=at,et=at);return Cr&&_l(ue,Ke),qe}for(We=v(ue,We);!at.done;Ke++,at=ne.next())at=Ae(We,ue,Ke,at.value,Be),at!==null&&(i&&at.alternate!==null&&We.delete(at.key===null?Ke:at.key),Y=C(at,Y,Ke),et===null?qe=at:et.sibling=at,et=at);return i&&We.forEach(function(br){return a(ue,br)}),Cr&&_l(ue,Ke),qe}function se(ue,Y,ne,Be){if(typeof ne=="object"&&ne!==null&&ne.type===ju&&ne.key===null&&(ne=ne.props.children),typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case nf:e:{for(var qe=ne.key,et=Y;et!==null;){if(et.key===qe){if(qe=ne.type,qe===ju){if(et.tag===7){f(ue,et.sibling),Y=S(et,ne.props.children),Y.return=ue,ue=Y;break e}}else if(et.elementType===qe||typeof qe=="object"&&qe!==null&&qe.$$typeof===Jo&&f1(qe)===et.type){f(ue,et.sibling),Y=S(et,ne.props),Y.ref=Lh(ue,et,ne),Y.return=ue,ue=Y;break e}f(ue,et);break}else a(ue,et);et=et.sibling}ne.type===ju?(Y=Tl(ne.props.children,ue.mode,Be,ne.key),Y.return=ue,ue=Y):(Be=Df(ne.type,ne.key,ne.props,null,ue.mode,Be),Be.ref=Lh(ue,Y,ne),Be.return=ue,ue=Be)}return w(ue);case Nu:e:{for(et=ne.key;Y!==null;){if(Y.key===et)if(Y.tag===4&&Y.stateNode.containerInfo===ne.containerInfo&&Y.stateNode.implementation===ne.implementation){f(ue,Y.sibling),Y=S(Y,ne.children||[]),Y.return=ue,ue=Y;break e}else{f(ue,Y);break}else a(ue,Y);Y=Y.sibling}Y=b_(ne,ue.mode,Be),Y.return=ue,ue=Y}return w(ue);case Jo:return et=ne._init,se(ue,Y,et(ne._payload),Be)}if(jh(ne))return we(ue,Y,ne,Be);if(kh(ne))return _e(ue,Y,ne,Be);mf(ue,ne)}return typeof ne=="string"&&ne!==""||typeof ne=="number"?(ne=""+ne,Y!==null&&Y.tag===6?(f(ue,Y.sibling),Y=S(Y,ne),Y.return=ue,ue=Y):(f(ue,Y),Y=x_(ne,ue.mode,Be),Y.return=ue,ue=Y),w(ue)):f(ue,Y)}return se}var oc=ow(!0),aw=ow(!1),Xf=ga(null),Yf=null,Hu=null,Gy=null;function qy(){Gy=Hu=Yf=null}function Zy(i){var a=Xf.current;xr(Xf),i._currentValue=a}function ty(i,a,f){for(;i!==null;){var v=i.alternate;if((i.childLanes&a)!==a?(i.childLanes|=a,v!==null&&(v.childLanes|=a)):v!==null&&(v.childLanes&a)!==a&&(v.childLanes|=a),i===f)break;i=i.return}}function tc(i,a){Yf=i,Gy=Hu=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&a&&(si=!0),i.firstContext=null)}function ji(i){var a=i._currentValue;if(Gy!==i)if(i={context:i,memoizedValue:a,next:null},Hu===null){if(Yf===null)throw Error(Xe(308));Hu=i,Yf.dependencies={lanes:0,firstContext:i}}else Hu=Hu.next=i;return a}var xl=null;function Wy(i){xl===null?xl=[i]:xl.push(i)}function lw(i,a,f,v){var S=a.interleaved;return S===null?(f.next=f,Wy(a)):(f.next=S.next,S.next=f),a.interleaved=f,ho(i,v)}function ho(i,a){i.lanes|=a;var f=i.alternate;for(f!==null&&(f.lanes|=a),f=i,i=i.return;i!==null;)i.childLanes|=a,f=i.alternate,f!==null&&(f.childLanes|=a),f=i,i=i.return;return f.tag===3?f.stateNode:null}var ea=!1;function Hy(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function uw(i,a){i=i.updateQueue,a.updateQueue===i&&(a.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function ao(i,a){return{eventTime:i,lane:a,tag:0,payload:null,callback:null,next:null}}function ua(i,a,f){var v=i.updateQueue;if(v===null)return null;if(v=v.shared,Bt&2){var S=v.pending;return S===null?a.next=a:(a.next=S.next,S.next=a),v.pending=a,ho(i,f)}return S=v.interleaved,S===null?(a.next=a,Wy(v)):(a.next=S.next,S.next=a),v.interleaved=a,ho(i,f)}function Cf(i,a,f){if(a=a.updateQueue,a!==null&&(a=a.shared,(f&4194240)!==0)){var v=a.lanes;v&=i.pendingLanes,f|=v,a.lanes=f,Dy(i,f)}}function m1(i,a){var f=i.updateQueue,v=i.alternate;if(v!==null&&(v=v.updateQueue,f===v)){var S=null,C=null;if(f=f.firstBaseUpdate,f!==null){do{var w={eventTime:f.eventTime,lane:f.lane,tag:f.tag,payload:f.payload,callback:f.callback,next:null};C===null?S=C=w:C=C.next=w,f=f.next}while(f!==null);C===null?S=C=a:C=C.next=a}else S=C=a;f={baseState:v.baseState,firstBaseUpdate:S,lastBaseUpdate:C,shared:v.shared,effects:v.effects},i.updateQueue=f;return}i=f.lastBaseUpdate,i===null?f.firstBaseUpdate=a:i.next=a,f.lastBaseUpdate=a}function Kf(i,a,f,v){var S=i.updateQueue;ea=!1;var C=S.firstBaseUpdate,w=S.lastBaseUpdate,c=S.shared.pending;if(c!==null){S.shared.pending=null;var N=c,K=N.next;N.next=null,w===null?C=K:w.next=K,w=N;var fe=i.alternate;fe!==null&&(fe=fe.updateQueue,c=fe.lastBaseUpdate,c!==w&&(c===null?fe.firstBaseUpdate=K:c.next=K,fe.lastBaseUpdate=N))}if(C!==null){var pe=S.baseState;w=0,fe=K=N=null,c=C;do{var ye=c.lane,Ae=c.eventTime;if((v&ye)===ye){fe!==null&&(fe=fe.next={eventTime:Ae,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var we=i,_e=c;switch(ye=a,Ae=f,_e.tag){case 1:if(we=_e.payload,typeof we=="function"){pe=we.call(Ae,pe,ye);break e}pe=we;break e;case 3:we.flags=we.flags&-65537|128;case 0:if(we=_e.payload,ye=typeof we=="function"?we.call(Ae,pe,ye):we,ye==null)break e;pe=Dr({},pe,ye);break e;case 2:ea=!0}}c.callback!==null&&c.lane!==0&&(i.flags|=64,ye=S.effects,ye===null?S.effects=[c]:ye.push(c))}else Ae={eventTime:Ae,lane:ye,tag:c.tag,payload:c.payload,callback:c.callback,next:null},fe===null?(K=fe=Ae,N=pe):fe=fe.next=Ae,w|=ye;if(c=c.next,c===null){if(c=S.shared.pending,c===null)break;ye=c,c=ye.next,ye.next=null,S.lastBaseUpdate=ye,S.shared.pending=null}}while(!0);if(fe===null&&(N=pe),S.baseState=N,S.firstBaseUpdate=K,S.lastBaseUpdate=fe,a=S.shared.interleaved,a!==null){S=a;do w|=S.lane,S=S.next;while(S!==a)}else C===null&&(S.shared.lanes=0);Cl|=w,i.lanes=w,i.memoizedState=pe}}function g1(i,a,f){if(i=a.effects,a.effects=null,i!==null)for(a=0;a<i.length;a++){var v=i[a],S=v.callback;if(S!==null){if(v.callback=null,v=f,typeof S!="function")throw Error(Xe(191,S));S.call(v)}}}var bd={},Is=ga(bd),cd=ga(bd),hd=ga(bd);function bl(i){if(i===bd)throw Error(Xe(174));return i}function Xy(i,a){switch(hr(hd,a),hr(cd,i),hr(Is,bd),i=a.nodeType,i){case 9:case 11:a=(a=a.documentElement)?a.namespaceURI:L_(null,"");break;default:i=i===8?a.parentNode:a,a=i.namespaceURI||null,i=i.tagName,a=L_(a,i)}xr(Is),hr(Is,a)}function ac(){xr(Is),xr(cd),xr(hd)}function cw(i){bl(hd.current);var a=bl(Is.current),f=L_(a,i.type);a!==f&&(hr(cd,i),hr(Is,f))}function Yy(i){cd.current===i&&(xr(Is),xr(cd))}var kr=ga(0);function Qf(i){for(var a=i;a!==null;){if(a.tag===13){var f=a.memoizedState;if(f!==null&&(f=f.dehydrated,f===null||f.data==="$?"||f.data==="$!"))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if(a.flags&128)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var f_=[];function Ky(){for(var i=0;i<f_.length;i++)f_[i]._workInProgressVersionPrimary=null;f_.length=0}var Mf=mo.ReactCurrentDispatcher,m_=mo.ReactCurrentBatchConfig,El=0,Ar=null,on=null,pn=null,Jf=!1,Xh=!1,dd=0,KE=0;function Ln(){throw Error(Xe(321))}function Qy(i,a){if(a===null)return!1;for(var f=0;f<a.length&&f<i.length;f++)if(!as(i[f],a[f]))return!1;return!0}function Jy(i,a,f,v,S,C){if(El=C,Ar=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,Mf.current=i===null||i.memoizedState===null?tC:rC,i=f(v,S),Xh){C=0;do{if(Xh=!1,dd=0,25<=C)throw Error(Xe(301));C+=1,pn=on=null,a.updateQueue=null,Mf.current=nC,i=f(v,S)}while(Xh)}if(Mf.current=em,a=on!==null&&on.next!==null,El=0,pn=on=Ar=null,Jf=!1,a)throw Error(Xe(300));return i}function ev(){var i=dd!==0;return dd=0,i}function Es(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return pn===null?Ar.memoizedState=pn=i:pn=pn.next=i,pn}function Vi(){if(on===null){var i=Ar.alternate;i=i!==null?i.memoizedState:null}else i=on.next;var a=pn===null?Ar.memoizedState:pn.next;if(a!==null)pn=a,on=i;else{if(i===null)throw Error(Xe(310));on=i,i={memoizedState:on.memoizedState,baseState:on.baseState,baseQueue:on.baseQueue,queue:on.queue,next:null},pn===null?Ar.memoizedState=pn=i:pn=pn.next=i}return pn}function pd(i,a){return typeof a=="function"?a(i):a}function g_(i){var a=Vi(),f=a.queue;if(f===null)throw Error(Xe(311));f.lastRenderedReducer=i;var v=on,S=v.baseQueue,C=f.pending;if(C!==null){if(S!==null){var w=S.next;S.next=C.next,C.next=w}v.baseQueue=S=C,f.pending=null}if(S!==null){C=S.next,v=v.baseState;var c=w=null,N=null,K=C;do{var fe=K.lane;if((El&fe)===fe)N!==null&&(N=N.next={lane:0,action:K.action,hasEagerState:K.hasEagerState,eagerState:K.eagerState,next:null}),v=K.hasEagerState?K.eagerState:i(v,K.action);else{var pe={lane:fe,action:K.action,hasEagerState:K.hasEagerState,eagerState:K.eagerState,next:null};N===null?(c=N=pe,w=v):N=N.next=pe,Ar.lanes|=fe,Cl|=fe}K=K.next}while(K!==null&&K!==C);N===null?w=v:N.next=c,as(v,a.memoizedState)||(si=!0),a.memoizedState=v,a.baseState=w,a.baseQueue=N,f.lastRenderedState=v}if(i=f.interleaved,i!==null){S=i;do C=S.lane,Ar.lanes|=C,Cl|=C,S=S.next;while(S!==i)}else S===null&&(f.lanes=0);return[a.memoizedState,f.dispatch]}function __(i){var a=Vi(),f=a.queue;if(f===null)throw Error(Xe(311));f.lastRenderedReducer=i;var v=f.dispatch,S=f.pending,C=a.memoizedState;if(S!==null){f.pending=null;var w=S=S.next;do C=i(C,w.action),w=w.next;while(w!==S);as(C,a.memoizedState)||(si=!0),a.memoizedState=C,a.baseQueue===null&&(a.baseState=C),f.lastRenderedState=C}return[C,v]}function hw(){}function dw(i,a){var f=Ar,v=Vi(),S=a(),C=!as(v.memoizedState,S);if(C&&(v.memoizedState=S,si=!0),v=v.queue,tv(mw.bind(null,f,v,i),[i]),v.getSnapshot!==a||C||pn!==null&&pn.memoizedState.tag&1){if(f.flags|=2048,fd(9,fw.bind(null,f,v,S,a),void 0,null),fn===null)throw Error(Xe(349));El&30||pw(f,a,S)}return S}function pw(i,a,f){i.flags|=16384,i={getSnapshot:a,value:f},a=Ar.updateQueue,a===null?(a={lastEffect:null,stores:null},Ar.updateQueue=a,a.stores=[i]):(f=a.stores,f===null?a.stores=[i]:f.push(i))}function fw(i,a,f,v){a.value=f,a.getSnapshot=v,gw(a)&&_w(i)}function mw(i,a,f){return f(function(){gw(a)&&_w(i)})}function gw(i){var a=i.getSnapshot;i=i.value;try{var f=a();return!as(i,f)}catch{return!0}}function _w(i){var a=ho(i,1);a!==null&&os(a,i,1,-1)}function _1(i){var a=Es();return typeof i=="function"&&(i=i()),a.memoizedState=a.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:pd,lastRenderedState:i},a.queue=i,i=i.dispatch=eC.bind(null,Ar,i),[a.memoizedState,i]}function fd(i,a,f,v){return i={tag:i,create:a,destroy:f,deps:v,next:null},a=Ar.updateQueue,a===null?(a={lastEffect:null,stores:null},Ar.updateQueue=a,a.lastEffect=i.next=i):(f=a.lastEffect,f===null?a.lastEffect=i.next=i:(v=f.next,f.next=i,i.next=v,a.lastEffect=i)),i}function yw(){return Vi().memoizedState}function If(i,a,f,v){var S=Es();Ar.flags|=i,S.memoizedState=fd(1|a,f,void 0,v===void 0?null:v)}function fm(i,a,f,v){var S=Vi();v=v===void 0?null:v;var C=void 0;if(on!==null){var w=on.memoizedState;if(C=w.destroy,v!==null&&Qy(v,w.deps)){S.memoizedState=fd(a,f,C,v);return}}Ar.flags|=i,S.memoizedState=fd(1|a,f,C,v)}function y1(i,a){return If(8390656,8,i,a)}function tv(i,a){return fm(2048,8,i,a)}function vw(i,a){return fm(4,2,i,a)}function xw(i,a){return fm(4,4,i,a)}function bw(i,a){if(typeof a=="function")return i=i(),a(i),function(){a(null)};if(a!=null)return i=i(),a.current=i,function(){a.current=null}}function ww(i,a,f){return f=f!=null?f.concat([i]):null,fm(4,4,bw.bind(null,a,i),f)}function rv(){}function Tw(i,a){var f=Vi();a=a===void 0?null:a;var v=f.memoizedState;return v!==null&&a!==null&&Qy(a,v[1])?v[0]:(f.memoizedState=[i,a],i)}function Sw(i,a){var f=Vi();a=a===void 0?null:a;var v=f.memoizedState;return v!==null&&a!==null&&Qy(a,v[1])?v[0]:(i=i(),f.memoizedState=[i,a],i)}function Pw(i,a,f){return El&21?(as(f,a)||(f=kb(),Ar.lanes|=f,Cl|=f,i.baseState=!0),a):(i.baseState&&(i.baseState=!1,si=!0),i.memoizedState=f)}function QE(i,a){var f=Kt;Kt=f!==0&&4>f?f:4,i(!0);var v=m_.transition;m_.transition={};try{i(!1),a()}finally{Kt=f,m_.transition=v}}function Ew(){return Vi().memoizedState}function JE(i,a,f){var v=ha(i);if(f={lane:v,action:f,hasEagerState:!1,eagerState:null,next:null},Cw(i))Mw(a,f);else if(f=lw(i,a,f,v),f!==null){var S=Zn();os(f,i,v,S),Iw(f,a,v)}}function eC(i,a,f){var v=ha(i),S={lane:v,action:f,hasEagerState:!1,eagerState:null,next:null};if(Cw(i))Mw(a,S);else{var C=i.alternate;if(i.lanes===0&&(C===null||C.lanes===0)&&(C=a.lastRenderedReducer,C!==null))try{var w=a.lastRenderedState,c=C(w,f);if(S.hasEagerState=!0,S.eagerState=c,as(c,w)){var N=a.interleaved;N===null?(S.next=S,Wy(a)):(S.next=N.next,N.next=S),a.interleaved=S;return}}catch{}finally{}f=lw(i,a,S,v),f!==null&&(S=Zn(),os(f,i,v,S),Iw(f,a,v))}}function Cw(i){var a=i.alternate;return i===Ar||a!==null&&a===Ar}function Mw(i,a){Xh=Jf=!0;var f=i.pending;f===null?a.next=a:(a.next=f.next,f.next=a),i.pending=a}function Iw(i,a,f){if(f&4194240){var v=a.lanes;v&=i.pendingLanes,f|=v,a.lanes=f,Dy(i,f)}}var em={readContext:ji,useCallback:Ln,useContext:Ln,useEffect:Ln,useImperativeHandle:Ln,useInsertionEffect:Ln,useLayoutEffect:Ln,useMemo:Ln,useReducer:Ln,useRef:Ln,useState:Ln,useDebugValue:Ln,useDeferredValue:Ln,useTransition:Ln,useMutableSource:Ln,useSyncExternalStore:Ln,useId:Ln,unstable_isNewReconciler:!1},tC={readContext:ji,useCallback:function(i,a){return Es().memoizedState=[i,a===void 0?null:a],i},useContext:ji,useEffect:y1,useImperativeHandle:function(i,a,f){return f=f!=null?f.concat([i]):null,If(4194308,4,bw.bind(null,a,i),f)},useLayoutEffect:function(i,a){return If(4194308,4,i,a)},useInsertionEffect:function(i,a){return If(4,2,i,a)},useMemo:function(i,a){var f=Es();return a=a===void 0?null:a,i=i(),f.memoizedState=[i,a],i},useReducer:function(i,a,f){var v=Es();return a=f!==void 0?f(a):a,v.memoizedState=v.baseState=a,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:a},v.queue=i,i=i.dispatch=JE.bind(null,Ar,i),[v.memoizedState,i]},useRef:function(i){var a=Es();return i={current:i},a.memoizedState=i},useState:_1,useDebugValue:rv,useDeferredValue:function(i){return Es().memoizedState=i},useTransition:function(){var i=_1(!1),a=i[0];return i=QE.bind(null,i[1]),Es().memoizedState=i,[a,i]},useMutableSource:function(){},useSyncExternalStore:function(i,a,f){var v=Ar,S=Es();if(Cr){if(f===void 0)throw Error(Xe(407));f=f()}else{if(f=a(),fn===null)throw Error(Xe(349));El&30||pw(v,a,f)}S.memoizedState=f;var C={value:f,getSnapshot:a};return S.queue=C,y1(mw.bind(null,v,C,i),[i]),v.flags|=2048,fd(9,fw.bind(null,v,C,f,a),void 0,null),f},useId:function(){var i=Es(),a=fn.identifierPrefix;if(Cr){var f=oo,v=so;f=(v&~(1<<32-ss(v)-1)).toString(32)+f,a=":"+a+"R"+f,f=dd++,0<f&&(a+="H"+f.toString(32)),a+=":"}else f=KE++,a=":"+a+"r"+f.toString(32)+":";return i.memoizedState=a},unstable_isNewReconciler:!1},rC={readContext:ji,useCallback:Tw,useContext:ji,useEffect:tv,useImperativeHandle:ww,useInsertionEffect:vw,useLayoutEffect:xw,useMemo:Sw,useReducer:g_,useRef:yw,useState:function(){return g_(pd)},useDebugValue:rv,useDeferredValue:function(i){var a=Vi();return Pw(a,on.memoizedState,i)},useTransition:function(){var i=g_(pd)[0],a=Vi().memoizedState;return[i,a]},useMutableSource:hw,useSyncExternalStore:dw,useId:Ew,unstable_isNewReconciler:!1},nC={readContext:ji,useCallback:Tw,useContext:ji,useEffect:tv,useImperativeHandle:ww,useInsertionEffect:vw,useLayoutEffect:xw,useMemo:Sw,useReducer:__,useRef:yw,useState:function(){return __(pd)},useDebugValue:rv,useDeferredValue:function(i){var a=Vi();return on===null?a.memoizedState=i:Pw(a,on.memoizedState,i)},useTransition:function(){var i=__(pd)[0],a=Vi().memoizedState;return[i,a]},useMutableSource:hw,useSyncExternalStore:dw,useId:Ew,unstable_isNewReconciler:!1};function ts(i,a){if(i&&i.defaultProps){a=Dr({},a),i=i.defaultProps;for(var f in i)a[f]===void 0&&(a[f]=i[f]);return a}return a}function ry(i,a,f,v){a=i.memoizedState,f=f(v,a),f=f==null?a:Dr({},a,f),i.memoizedState=f,i.lanes===0&&(i.updateQueue.baseState=f)}var mm={isMounted:function(i){return(i=i._reactInternals)?kl(i)===i:!1},enqueueSetState:function(i,a,f){i=i._reactInternals;var v=Zn(),S=ha(i),C=ao(v,S);C.payload=a,f!=null&&(C.callback=f),a=ua(i,C,S),a!==null&&(os(a,i,S,v),Cf(a,i,S))},enqueueReplaceState:function(i,a,f){i=i._reactInternals;var v=Zn(),S=ha(i),C=ao(v,S);C.tag=1,C.payload=a,f!=null&&(C.callback=f),a=ua(i,C,S),a!==null&&(os(a,i,S,v),Cf(a,i,S))},enqueueForceUpdate:function(i,a){i=i._reactInternals;var f=Zn(),v=ha(i),S=ao(f,v);S.tag=2,a!=null&&(S.callback=a),a=ua(i,S,v),a!==null&&(os(a,i,v,f),Cf(a,i,v))}};function v1(i,a,f,v,S,C,w){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(v,C,w):a.prototype&&a.prototype.isPureReactComponent?!od(f,v)||!od(S,C):!0}function kw(i,a,f){var v=!1,S=fa,C=a.contextType;return typeof C=="object"&&C!==null?C=ji(C):(S=ai(a)?Sl:On.current,v=a.contextTypes,C=(v=v!=null)?ic(i,S):fa),a=new a(f,C),i.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,a.updater=mm,i.stateNode=a,a._reactInternals=i,v&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=S,i.__reactInternalMemoizedMaskedChildContext=C),a}function x1(i,a,f,v){i=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(f,v),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(f,v),a.state!==i&&mm.enqueueReplaceState(a,a.state,null)}function ny(i,a,f,v){var S=i.stateNode;S.props=f,S.state=i.memoizedState,S.refs={},Hy(i);var C=a.contextType;typeof C=="object"&&C!==null?S.context=ji(C):(C=ai(a)?Sl:On.current,S.context=ic(i,C)),S.state=i.memoizedState,C=a.getDerivedStateFromProps,typeof C=="function"&&(ry(i,a,C,f),S.state=i.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof S.getSnapshotBeforeUpdate=="function"||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(a=S.state,typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount(),a!==S.state&&mm.enqueueReplaceState(S,S.state,null),Kf(i,f,S,v),S.state=i.memoizedState),typeof S.componentDidMount=="function"&&(i.flags|=4194308)}function lc(i,a){try{var f="",v=a;do f+=AP(v),v=v.return;while(v);var S=f}catch(C){S=`
Error generating stack: `+C.message+`
`+C.stack}return{value:i,source:a,stack:S,digest:null}}function y_(i,a,f){return{value:i,source:null,stack:f??null,digest:a??null}}function iy(i,a){try{console.error(a.value)}catch(f){setTimeout(function(){throw f})}}var iC=typeof WeakMap=="function"?WeakMap:Map;function Aw(i,a,f){f=ao(-1,f),f.tag=3,f.payload={element:null};var v=a.value;return f.callback=function(){rm||(rm=!0,fy=v),iy(i,a)},f}function zw(i,a,f){f=ao(-1,f),f.tag=3;var v=i.type.getDerivedStateFromError;if(typeof v=="function"){var S=a.value;f.payload=function(){return v(S)},f.callback=function(){iy(i,a)}}var C=i.stateNode;return C!==null&&typeof C.componentDidCatch=="function"&&(f.callback=function(){iy(i,a),typeof v!="function"&&(ca===null?ca=new Set([this]):ca.add(this));var w=a.stack;this.componentDidCatch(a.value,{componentStack:w!==null?w:""})}),f}function b1(i,a,f){var v=i.pingCache;if(v===null){v=i.pingCache=new iC;var S=new Set;v.set(a,S)}else S=v.get(a),S===void 0&&(S=new Set,v.set(a,S));S.has(f)||(S.add(f),i=yC.bind(null,i,a,f),a.then(i,i))}function w1(i){do{var a;if((a=i.tag===13)&&(a=i.memoizedState,a=a!==null?a.dehydrated!==null:!0),a)return i;i=i.return}while(i!==null);return null}function T1(i,a,f,v,S){return i.mode&1?(i.flags|=65536,i.lanes=S,i):(i===a?i.flags|=65536:(i.flags|=128,f.flags|=131072,f.flags&=-52805,f.tag===1&&(f.alternate===null?f.tag=17:(a=ao(-1,1),a.tag=2,ua(f,a,1))),f.lanes|=1),i)}var sC=mo.ReactCurrentOwner,si=!1;function qn(i,a,f,v){a.child=i===null?aw(a,null,f,v):oc(a,i.child,f,v)}function S1(i,a,f,v,S){f=f.render;var C=a.ref;return tc(a,S),v=Jy(i,a,f,v,C,S),f=ev(),i!==null&&!si?(a.updateQueue=i.updateQueue,a.flags&=-2053,i.lanes&=~S,po(i,a,S)):(Cr&&f&&Vy(a),a.flags|=1,qn(i,a,v,S),a.child)}function P1(i,a,f,v,S){if(i===null){var C=f.type;return typeof C=="function"&&!cv(C)&&C.defaultProps===void 0&&f.compare===null&&f.defaultProps===void 0?(a.tag=15,a.type=C,Dw(i,a,C,v,S)):(i=Df(f.type,null,v,a,a.mode,S),i.ref=a.ref,i.return=a,a.child=i)}if(C=i.child,!(i.lanes&S)){var w=C.memoizedProps;if(f=f.compare,f=f!==null?f:od,f(w,v)&&i.ref===a.ref)return po(i,a,S)}return a.flags|=1,i=da(C,v),i.ref=a.ref,i.return=a,a.child=i}function Dw(i,a,f,v,S){if(i!==null){var C=i.memoizedProps;if(od(C,v)&&i.ref===a.ref)if(si=!1,a.pendingProps=v=C,(i.lanes&S)!==0)i.flags&131072&&(si=!0);else return a.lanes=i.lanes,po(i,a,S)}return sy(i,a,f,v,S)}function Rw(i,a,f){var v=a.pendingProps,S=v.children,C=i!==null?i.memoizedState:null;if(v.mode==="hidden")if(!(a.mode&1))a.memoizedState={baseLanes:0,cachePool:null,transitions:null},hr(Yu,Ti),Ti|=f;else{if(!(f&1073741824))return i=C!==null?C.baseLanes|f:f,a.lanes=a.childLanes=1073741824,a.memoizedState={baseLanes:i,cachePool:null,transitions:null},a.updateQueue=null,hr(Yu,Ti),Ti|=i,null;a.memoizedState={baseLanes:0,cachePool:null,transitions:null},v=C!==null?C.baseLanes:f,hr(Yu,Ti),Ti|=v}else C!==null?(v=C.baseLanes|f,a.memoizedState=null):v=f,hr(Yu,Ti),Ti|=v;return qn(i,a,S,f),a.child}function Lw(i,a){var f=a.ref;(i===null&&f!==null||i!==null&&i.ref!==f)&&(a.flags|=512,a.flags|=2097152)}function sy(i,a,f,v,S){var C=ai(f)?Sl:On.current;return C=ic(a,C),tc(a,S),f=Jy(i,a,f,v,C,S),v=ev(),i!==null&&!si?(a.updateQueue=i.updateQueue,a.flags&=-2053,i.lanes&=~S,po(i,a,S)):(Cr&&v&&Vy(a),a.flags|=1,qn(i,a,f,S),a.child)}function E1(i,a,f,v,S){if(ai(f)){var C=!0;Zf(a)}else C=!1;if(tc(a,S),a.stateNode===null)kf(i,a),kw(a,f,v),ny(a,f,v,S),v=!0;else if(i===null){var w=a.stateNode,c=a.memoizedProps;w.props=c;var N=w.context,K=f.contextType;typeof K=="object"&&K!==null?K=ji(K):(K=ai(f)?Sl:On.current,K=ic(a,K));var fe=f.getDerivedStateFromProps,pe=typeof fe=="function"||typeof w.getSnapshotBeforeUpdate=="function";pe||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(c!==v||N!==K)&&x1(a,w,v,K),ea=!1;var ye=a.memoizedState;w.state=ye,Kf(a,v,w,S),N=a.memoizedState,c!==v||ye!==N||oi.current||ea?(typeof fe=="function"&&(ry(a,f,fe,v),N=a.memoizedState),(c=ea||v1(a,f,c,v,ye,N,K))?(pe||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(a.flags|=4194308)):(typeof w.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=v,a.memoizedState=N),w.props=v,w.state=N,w.context=K,v=c):(typeof w.componentDidMount=="function"&&(a.flags|=4194308),v=!1)}else{w=a.stateNode,uw(i,a),c=a.memoizedProps,K=a.type===a.elementType?c:ts(a.type,c),w.props=K,pe=a.pendingProps,ye=w.context,N=f.contextType,typeof N=="object"&&N!==null?N=ji(N):(N=ai(f)?Sl:On.current,N=ic(a,N));var Ae=f.getDerivedStateFromProps;(fe=typeof Ae=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(c!==pe||ye!==N)&&x1(a,w,v,N),ea=!1,ye=a.memoizedState,w.state=ye,Kf(a,v,w,S);var we=a.memoizedState;c!==pe||ye!==we||oi.current||ea?(typeof Ae=="function"&&(ry(a,f,Ae,v),we=a.memoizedState),(K=ea||v1(a,f,K,v,ye,we,N)||!1)?(fe||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(v,we,N),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(v,we,N)),typeof w.componentDidUpdate=="function"&&(a.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof w.componentDidUpdate!="function"||c===i.memoizedProps&&ye===i.memoizedState||(a.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||c===i.memoizedProps&&ye===i.memoizedState||(a.flags|=1024),a.memoizedProps=v,a.memoizedState=we),w.props=v,w.state=we,w.context=N,v=K):(typeof w.componentDidUpdate!="function"||c===i.memoizedProps&&ye===i.memoizedState||(a.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||c===i.memoizedProps&&ye===i.memoizedState||(a.flags|=1024),v=!1)}return oy(i,a,f,v,C,S)}function oy(i,a,f,v,S,C){Lw(i,a);var w=(a.flags&128)!==0;if(!v&&!w)return S&&h1(a,f,!1),po(i,a,C);v=a.stateNode,sC.current=a;var c=w&&typeof f.getDerivedStateFromError!="function"?null:v.render();return a.flags|=1,i!==null&&w?(a.child=oc(a,i.child,null,C),a.child=oc(a,null,c,C)):qn(i,a,c,C),a.memoizedState=v.state,S&&h1(a,f,!0),a.child}function Fw(i){var a=i.stateNode;a.pendingContext?c1(i,a.pendingContext,a.pendingContext!==a.context):a.context&&c1(i,a.context,!1),Xy(i,a.containerInfo)}function C1(i,a,f,v,S){return sc(),$y(S),a.flags|=256,qn(i,a,f,v),a.child}var ay={dehydrated:null,treeContext:null,retryLane:0};function ly(i){return{baseLanes:i,cachePool:null,transitions:null}}function Bw(i,a,f){var v=a.pendingProps,S=kr.current,C=!1,w=(a.flags&128)!==0,c;if((c=w)||(c=i!==null&&i.memoizedState===null?!1:(S&2)!==0),c?(C=!0,a.flags&=-129):(i===null||i.memoizedState!==null)&&(S|=1),hr(kr,S&1),i===null)return ey(a),i=a.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(a.mode&1?i.data==="$!"?a.lanes=8:a.lanes=1073741824:a.lanes=1,null):(w=v.children,i=v.fallback,C?(v=a.mode,C=a.child,w={mode:"hidden",children:w},!(v&1)&&C!==null?(C.childLanes=0,C.pendingProps=w):C=ym(w,v,0,null),i=Tl(i,v,f,null),C.return=a,i.return=a,C.sibling=i,a.child=C,a.child.memoizedState=ly(f),a.memoizedState=ay,i):nv(a,w));if(S=i.memoizedState,S!==null&&(c=S.dehydrated,c!==null))return oC(i,a,w,v,c,S,f);if(C){C=v.fallback,w=a.mode,S=i.child,c=S.sibling;var N={mode:"hidden",children:v.children};return!(w&1)&&a.child!==S?(v=a.child,v.childLanes=0,v.pendingProps=N,a.deletions=null):(v=da(S,N),v.subtreeFlags=S.subtreeFlags&14680064),c!==null?C=da(c,C):(C=Tl(C,w,f,null),C.flags|=2),C.return=a,v.return=a,v.sibling=C,a.child=v,v=C,C=a.child,w=i.child.memoizedState,w=w===null?ly(f):{baseLanes:w.baseLanes|f,cachePool:null,transitions:w.transitions},C.memoizedState=w,C.childLanes=i.childLanes&~f,a.memoizedState=ay,v}return C=i.child,i=C.sibling,v=da(C,{mode:"visible",children:v.children}),!(a.mode&1)&&(v.lanes=f),v.return=a,v.sibling=null,i!==null&&(f=a.deletions,f===null?(a.deletions=[i],a.flags|=16):f.push(i)),a.child=v,a.memoizedState=null,v}function nv(i,a){return a=ym({mode:"visible",children:a},i.mode,0,null),a.return=i,i.child=a}function gf(i,a,f,v){return v!==null&&$y(v),oc(a,i.child,null,f),i=nv(a,a.pendingProps.children),i.flags|=2,a.memoizedState=null,i}function oC(i,a,f,v,S,C,w){if(f)return a.flags&256?(a.flags&=-257,v=y_(Error(Xe(422))),gf(i,a,w,v)):a.memoizedState!==null?(a.child=i.child,a.flags|=128,null):(C=v.fallback,S=a.mode,v=ym({mode:"visible",children:v.children},S,0,null),C=Tl(C,S,w,null),C.flags|=2,v.return=a,C.return=a,v.sibling=C,a.child=v,a.mode&1&&oc(a,i.child,null,w),a.child.memoizedState=ly(w),a.memoizedState=ay,C);if(!(a.mode&1))return gf(i,a,w,null);if(S.data==="$!"){if(v=S.nextSibling&&S.nextSibling.dataset,v)var c=v.dgst;return v=c,C=Error(Xe(419)),v=y_(C,v,void 0),gf(i,a,w,v)}if(c=(w&i.childLanes)!==0,si||c){if(v=fn,v!==null){switch(w&-w){case 4:S=2;break;case 16:S=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:S=32;break;case 536870912:S=268435456;break;default:S=0}S=S&(v.suspendedLanes|w)?0:S,S!==0&&S!==C.retryLane&&(C.retryLane=S,ho(i,S),os(v,i,S,-1))}return uv(),v=y_(Error(Xe(421))),gf(i,a,w,v)}return S.data==="$?"?(a.flags|=128,a.child=i.child,a=vC.bind(null,i),S._reactRetry=a,null):(i=C.treeContext,Si=la(S.nextSibling),Pi=a,Cr=!0,ns=null,i!==null&&(Fi[Bi++]=so,Fi[Bi++]=oo,Fi[Bi++]=Pl,so=i.id,oo=i.overflow,Pl=a),a=nv(a,v.children),a.flags|=4096,a)}function M1(i,a,f){i.lanes|=a;var v=i.alternate;v!==null&&(v.lanes|=a),ty(i.return,a,f)}function v_(i,a,f,v,S){var C=i.memoizedState;C===null?i.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:v,tail:f,tailMode:S}:(C.isBackwards=a,C.rendering=null,C.renderingStartTime=0,C.last=v,C.tail=f,C.tailMode=S)}function Ow(i,a,f){var v=a.pendingProps,S=v.revealOrder,C=v.tail;if(qn(i,a,v.children,f),v=kr.current,v&2)v=v&1|2,a.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=a.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&M1(i,f,a);else if(i.tag===19)M1(i,f,a);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===a)break e;for(;i.sibling===null;){if(i.return===null||i.return===a)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}v&=1}if(hr(kr,v),!(a.mode&1))a.memoizedState=null;else switch(S){case"forwards":for(f=a.child,S=null;f!==null;)i=f.alternate,i!==null&&Qf(i)===null&&(S=f),f=f.sibling;f=S,f===null?(S=a.child,a.child=null):(S=f.sibling,f.sibling=null),v_(a,!1,S,f,C);break;case"backwards":for(f=null,S=a.child,a.child=null;S!==null;){if(i=S.alternate,i!==null&&Qf(i)===null){a.child=S;break}i=S.sibling,S.sibling=f,f=S,S=i}v_(a,!0,f,null,C);break;case"together":v_(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function kf(i,a){!(a.mode&1)&&i!==null&&(i.alternate=null,a.alternate=null,a.flags|=2)}function po(i,a,f){if(i!==null&&(a.dependencies=i.dependencies),Cl|=a.lanes,!(f&a.childLanes))return null;if(i!==null&&a.child!==i.child)throw Error(Xe(153));if(a.child!==null){for(i=a.child,f=da(i,i.pendingProps),a.child=f,f.return=a;i.sibling!==null;)i=i.sibling,f=f.sibling=da(i,i.pendingProps),f.return=a;f.sibling=null}return a.child}function aC(i,a,f){switch(a.tag){case 3:Fw(a),sc();break;case 5:cw(a);break;case 1:ai(a.type)&&Zf(a);break;case 4:Xy(a,a.stateNode.containerInfo);break;case 10:var v=a.type._context,S=a.memoizedProps.value;hr(Xf,v._currentValue),v._currentValue=S;break;case 13:if(v=a.memoizedState,v!==null)return v.dehydrated!==null?(hr(kr,kr.current&1),a.flags|=128,null):f&a.child.childLanes?Bw(i,a,f):(hr(kr,kr.current&1),i=po(i,a,f),i!==null?i.sibling:null);hr(kr,kr.current&1);break;case 19:if(v=(f&a.childLanes)!==0,i.flags&128){if(v)return Ow(i,a,f);a.flags|=128}if(S=a.memoizedState,S!==null&&(S.rendering=null,S.tail=null,S.lastEffect=null),hr(kr,kr.current),v)break;return null;case 22:case 23:return a.lanes=0,Rw(i,a,f)}return po(i,a,f)}var Nw,uy,jw,Vw;Nw=function(i,a){for(var f=a.child;f!==null;){if(f.tag===5||f.tag===6)i.appendChild(f.stateNode);else if(f.tag!==4&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===a)break;for(;f.sibling===null;){if(f.return===null||f.return===a)return;f=f.return}f.sibling.return=f.return,f=f.sibling}};uy=function(){};jw=function(i,a,f,v){var S=i.memoizedProps;if(S!==v){i=a.stateNode,bl(Is.current);var C=null;switch(f){case"input":S=A_(i,S),v=A_(i,v),C=[];break;case"select":S=Dr({},S,{value:void 0}),v=Dr({},v,{value:void 0}),C=[];break;case"textarea":S=R_(i,S),v=R_(i,v),C=[];break;default:typeof S.onClick!="function"&&typeof v.onClick=="function"&&(i.onclick=Gf)}F_(f,v);var w;f=null;for(K in S)if(!v.hasOwnProperty(K)&&S.hasOwnProperty(K)&&S[K]!=null)if(K==="style"){var c=S[K];for(w in c)c.hasOwnProperty(w)&&(f||(f={}),f[w]="")}else K!=="dangerouslySetInnerHTML"&&K!=="children"&&K!=="suppressContentEditableWarning"&&K!=="suppressHydrationWarning"&&K!=="autoFocus"&&(Jh.hasOwnProperty(K)?C||(C=[]):(C=C||[]).push(K,null));for(K in v){var N=v[K];if(c=S!=null?S[K]:void 0,v.hasOwnProperty(K)&&N!==c&&(N!=null||c!=null))if(K==="style")if(c){for(w in c)!c.hasOwnProperty(w)||N&&N.hasOwnProperty(w)||(f||(f={}),f[w]="");for(w in N)N.hasOwnProperty(w)&&c[w]!==N[w]&&(f||(f={}),f[w]=N[w])}else f||(C||(C=[]),C.push(K,f)),f=N;else K==="dangerouslySetInnerHTML"?(N=N?N.__html:void 0,c=c?c.__html:void 0,N!=null&&c!==N&&(C=C||[]).push(K,N)):K==="children"?typeof N!="string"&&typeof N!="number"||(C=C||[]).push(K,""+N):K!=="suppressContentEditableWarning"&&K!=="suppressHydrationWarning"&&(Jh.hasOwnProperty(K)?(N!=null&&K==="onScroll"&&vr("scroll",i),C||c===N||(C=[])):(C=C||[]).push(K,N))}f&&(C=C||[]).push("style",f);var K=C;(a.updateQueue=K)&&(a.flags|=4)}};Vw=function(i,a,f,v){f!==v&&(a.flags|=4)};function Fh(i,a){if(!Cr)switch(i.tailMode){case"hidden":a=i.tail;for(var f=null;a!==null;)a.alternate!==null&&(f=a),a=a.sibling;f===null?i.tail=null:f.sibling=null;break;case"collapsed":f=i.tail;for(var v=null;f!==null;)f.alternate!==null&&(v=f),f=f.sibling;v===null?a||i.tail===null?i.tail=null:i.tail.sibling=null:v.sibling=null}}function Fn(i){var a=i.alternate!==null&&i.alternate.child===i.child,f=0,v=0;if(a)for(var S=i.child;S!==null;)f|=S.lanes|S.childLanes,v|=S.subtreeFlags&14680064,v|=S.flags&14680064,S.return=i,S=S.sibling;else for(S=i.child;S!==null;)f|=S.lanes|S.childLanes,v|=S.subtreeFlags,v|=S.flags,S.return=i,S=S.sibling;return i.subtreeFlags|=v,i.childLanes=f,a}function lC(i,a,f){var v=a.pendingProps;switch(Uy(a),a.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Fn(a),null;case 1:return ai(a.type)&&qf(),Fn(a),null;case 3:return v=a.stateNode,ac(),xr(oi),xr(On),Ky(),v.pendingContext&&(v.context=v.pendingContext,v.pendingContext=null),(i===null||i.child===null)&&(ff(a)?a.flags|=4:i===null||i.memoizedState.isDehydrated&&!(a.flags&256)||(a.flags|=1024,ns!==null&&(_y(ns),ns=null))),uy(i,a),Fn(a),null;case 5:Yy(a);var S=bl(hd.current);if(f=a.type,i!==null&&a.stateNode!=null)jw(i,a,f,v,S),i.ref!==a.ref&&(a.flags|=512,a.flags|=2097152);else{if(!v){if(a.stateNode===null)throw Error(Xe(166));return Fn(a),null}if(i=bl(Is.current),ff(a)){v=a.stateNode,f=a.type;var C=a.memoizedProps;switch(v[Cs]=a,v[ud]=C,i=(a.mode&1)!==0,f){case"dialog":vr("cancel",v),vr("close",v);break;case"iframe":case"object":case"embed":vr("load",v);break;case"video":case"audio":for(S=0;S<Uh.length;S++)vr(Uh[S],v);break;case"source":vr("error",v);break;case"img":case"image":case"link":vr("error",v),vr("load",v);break;case"details":vr("toggle",v);break;case"input":Bx(v,C),vr("invalid",v);break;case"select":v._wrapperState={wasMultiple:!!C.multiple},vr("invalid",v);break;case"textarea":Nx(v,C),vr("invalid",v)}F_(f,C),S=null;for(var w in C)if(C.hasOwnProperty(w)){var c=C[w];w==="children"?typeof c=="string"?v.textContent!==c&&(C.suppressHydrationWarning!==!0&&pf(v.textContent,c,i),S=["children",c]):typeof c=="number"&&v.textContent!==""+c&&(C.suppressHydrationWarning!==!0&&pf(v.textContent,c,i),S=["children",""+c]):Jh.hasOwnProperty(w)&&c!=null&&w==="onScroll"&&vr("scroll",v)}switch(f){case"input":sf(v),Ox(v,C,!0);break;case"textarea":sf(v),jx(v);break;case"select":case"option":break;default:typeof C.onClick=="function"&&(v.onclick=Gf)}v=S,a.updateQueue=v,v!==null&&(a.flags|=4)}else{w=S.nodeType===9?S:S.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=mb(f)),i==="http://www.w3.org/1999/xhtml"?f==="script"?(i=w.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof v.is=="string"?i=w.createElement(f,{is:v.is}):(i=w.createElement(f),f==="select"&&(w=i,v.multiple?w.multiple=!0:v.size&&(w.size=v.size))):i=w.createElementNS(i,f),i[Cs]=a,i[ud]=v,Nw(i,a,!1,!1),a.stateNode=i;e:{switch(w=B_(f,v),f){case"dialog":vr("cancel",i),vr("close",i),S=v;break;case"iframe":case"object":case"embed":vr("load",i),S=v;break;case"video":case"audio":for(S=0;S<Uh.length;S++)vr(Uh[S],i);S=v;break;case"source":vr("error",i),S=v;break;case"img":case"image":case"link":vr("error",i),vr("load",i),S=v;break;case"details":vr("toggle",i),S=v;break;case"input":Bx(i,v),S=A_(i,v),vr("invalid",i);break;case"option":S=v;break;case"select":i._wrapperState={wasMultiple:!!v.multiple},S=Dr({},v,{value:void 0}),vr("invalid",i);break;case"textarea":Nx(i,v),S=R_(i,v),vr("invalid",i);break;default:S=v}F_(f,S),c=S;for(C in c)if(c.hasOwnProperty(C)){var N=c[C];C==="style"?yb(i,N):C==="dangerouslySetInnerHTML"?(N=N?N.__html:void 0,N!=null&&gb(i,N)):C==="children"?typeof N=="string"?(f!=="textarea"||N!=="")&&ed(i,N):typeof N=="number"&&ed(i,""+N):C!=="suppressContentEditableWarning"&&C!=="suppressHydrationWarning"&&C!=="autoFocus"&&(Jh.hasOwnProperty(C)?N!=null&&C==="onScroll"&&vr("scroll",i):N!=null&&Cy(i,C,N,w))}switch(f){case"input":sf(i),Ox(i,v,!1);break;case"textarea":sf(i),jx(i);break;case"option":v.value!=null&&i.setAttribute("value",""+pa(v.value));break;case"select":i.multiple=!!v.multiple,C=v.value,C!=null?Ku(i,!!v.multiple,C,!1):v.defaultValue!=null&&Ku(i,!!v.multiple,v.defaultValue,!0);break;default:typeof S.onClick=="function"&&(i.onclick=Gf)}switch(f){case"button":case"input":case"select":case"textarea":v=!!v.autoFocus;break e;case"img":v=!0;break e;default:v=!1}}v&&(a.flags|=4)}a.ref!==null&&(a.flags|=512,a.flags|=2097152)}return Fn(a),null;case 6:if(i&&a.stateNode!=null)Vw(i,a,i.memoizedProps,v);else{if(typeof v!="string"&&a.stateNode===null)throw Error(Xe(166));if(f=bl(hd.current),bl(Is.current),ff(a)){if(v=a.stateNode,f=a.memoizedProps,v[Cs]=a,(C=v.nodeValue!==f)&&(i=Pi,i!==null))switch(i.tag){case 3:pf(v.nodeValue,f,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&pf(v.nodeValue,f,(i.mode&1)!==0)}C&&(a.flags|=4)}else v=(f.nodeType===9?f:f.ownerDocument).createTextNode(v),v[Cs]=a,a.stateNode=v}return Fn(a),null;case 13:if(xr(kr),v=a.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(Cr&&Si!==null&&a.mode&1&&!(a.flags&128))sw(),sc(),a.flags|=98560,C=!1;else if(C=ff(a),v!==null&&v.dehydrated!==null){if(i===null){if(!C)throw Error(Xe(318));if(C=a.memoizedState,C=C!==null?C.dehydrated:null,!C)throw Error(Xe(317));C[Cs]=a}else sc(),!(a.flags&128)&&(a.memoizedState=null),a.flags|=4;Fn(a),C=!1}else ns!==null&&(_y(ns),ns=null),C=!0;if(!C)return a.flags&65536?a:null}return a.flags&128?(a.lanes=f,a):(v=v!==null,v!==(i!==null&&i.memoizedState!==null)&&v&&(a.child.flags|=8192,a.mode&1&&(i===null||kr.current&1?an===0&&(an=3):uv())),a.updateQueue!==null&&(a.flags|=4),Fn(a),null);case 4:return ac(),uy(i,a),i===null&&ad(a.stateNode.containerInfo),Fn(a),null;case 10:return Zy(a.type._context),Fn(a),null;case 17:return ai(a.type)&&qf(),Fn(a),null;case 19:if(xr(kr),C=a.memoizedState,C===null)return Fn(a),null;if(v=(a.flags&128)!==0,w=C.rendering,w===null)if(v)Fh(C,!1);else{if(an!==0||i!==null&&i.flags&128)for(i=a.child;i!==null;){if(w=Qf(i),w!==null){for(a.flags|=128,Fh(C,!1),v=w.updateQueue,v!==null&&(a.updateQueue=v,a.flags|=4),a.subtreeFlags=0,v=f,f=a.child;f!==null;)C=f,i=v,C.flags&=14680066,w=C.alternate,w===null?(C.childLanes=0,C.lanes=i,C.child=null,C.subtreeFlags=0,C.memoizedProps=null,C.memoizedState=null,C.updateQueue=null,C.dependencies=null,C.stateNode=null):(C.childLanes=w.childLanes,C.lanes=w.lanes,C.child=w.child,C.subtreeFlags=0,C.deletions=null,C.memoizedProps=w.memoizedProps,C.memoizedState=w.memoizedState,C.updateQueue=w.updateQueue,C.type=w.type,i=w.dependencies,C.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),f=f.sibling;return hr(kr,kr.current&1|2),a.child}i=i.sibling}C.tail!==null&&Gr()>uc&&(a.flags|=128,v=!0,Fh(C,!1),a.lanes=4194304)}else{if(!v)if(i=Qf(w),i!==null){if(a.flags|=128,v=!0,f=i.updateQueue,f!==null&&(a.updateQueue=f,a.flags|=4),Fh(C,!0),C.tail===null&&C.tailMode==="hidden"&&!w.alternate&&!Cr)return Fn(a),null}else 2*Gr()-C.renderingStartTime>uc&&f!==1073741824&&(a.flags|=128,v=!0,Fh(C,!1),a.lanes=4194304);C.isBackwards?(w.sibling=a.child,a.child=w):(f=C.last,f!==null?f.sibling=w:a.child=w,C.last=w)}return C.tail!==null?(a=C.tail,C.rendering=a,C.tail=a.sibling,C.renderingStartTime=Gr(),a.sibling=null,f=kr.current,hr(kr,v?f&1|2:f&1),a):(Fn(a),null);case 22:case 23:return lv(),v=a.memoizedState!==null,i!==null&&i.memoizedState!==null!==v&&(a.flags|=8192),v&&a.mode&1?Ti&1073741824&&(Fn(a),a.subtreeFlags&6&&(a.flags|=8192)):Fn(a),null;case 24:return null;case 25:return null}throw Error(Xe(156,a.tag))}function uC(i,a){switch(Uy(a),a.tag){case 1:return ai(a.type)&&qf(),i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 3:return ac(),xr(oi),xr(On),Ky(),i=a.flags,i&65536&&!(i&128)?(a.flags=i&-65537|128,a):null;case 5:return Yy(a),null;case 13:if(xr(kr),i=a.memoizedState,i!==null&&i.dehydrated!==null){if(a.alternate===null)throw Error(Xe(340));sc()}return i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 19:return xr(kr),null;case 4:return ac(),null;case 10:return Zy(a.type._context),null;case 22:case 23:return lv(),null;case 24:return null;default:return null}}var _f=!1,Bn=!1,cC=typeof WeakSet=="function"?WeakSet:Set,ht=null;function Xu(i,a){var f=i.ref;if(f!==null)if(typeof f=="function")try{f(null)}catch(v){Nr(i,a,v)}else f.current=null}function cy(i,a,f){try{f()}catch(v){Nr(i,a,v)}}var I1=!1;function hC(i,a){if(W_=Vf,i=Zb(),jy(i)){if("selectionStart"in i)var f={start:i.selectionStart,end:i.selectionEnd};else e:{f=(f=i.ownerDocument)&&f.defaultView||window;var v=f.getSelection&&f.getSelection();if(v&&v.rangeCount!==0){f=v.anchorNode;var S=v.anchorOffset,C=v.focusNode;v=v.focusOffset;try{f.nodeType,C.nodeType}catch{f=null;break e}var w=0,c=-1,N=-1,K=0,fe=0,pe=i,ye=null;t:for(;;){for(var Ae;pe!==f||S!==0&&pe.nodeType!==3||(c=w+S),pe!==C||v!==0&&pe.nodeType!==3||(N=w+v),pe.nodeType===3&&(w+=pe.nodeValue.length),(Ae=pe.firstChild)!==null;)ye=pe,pe=Ae;for(;;){if(pe===i)break t;if(ye===f&&++K===S&&(c=w),ye===C&&++fe===v&&(N=w),(Ae=pe.nextSibling)!==null)break;pe=ye,ye=pe.parentNode}pe=Ae}f=c===-1||N===-1?null:{start:c,end:N}}else f=null}f=f||{start:0,end:0}}else f=null;for(H_={focusedElem:i,selectionRange:f},Vf=!1,ht=a;ht!==null;)if(a=ht,i=a.child,(a.subtreeFlags&1028)!==0&&i!==null)i.return=a,ht=i;else for(;ht!==null;){a=ht;try{var we=a.alternate;if(a.flags&1024)switch(a.tag){case 0:case 11:case 15:break;case 1:if(we!==null){var _e=we.memoizedProps,se=we.memoizedState,ue=a.stateNode,Y=ue.getSnapshotBeforeUpdate(a.elementType===a.type?_e:ts(a.type,_e),se);ue.__reactInternalSnapshotBeforeUpdate=Y}break;case 3:var ne=a.stateNode.containerInfo;ne.nodeType===1?ne.textContent="":ne.nodeType===9&&ne.documentElement&&ne.removeChild(ne.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Xe(163))}}catch(Be){Nr(a,a.return,Be)}if(i=a.sibling,i!==null){i.return=a.return,ht=i;break}ht=a.return}return we=I1,I1=!1,we}function Yh(i,a,f){var v=a.updateQueue;if(v=v!==null?v.lastEffect:null,v!==null){var S=v=v.next;do{if((S.tag&i)===i){var C=S.destroy;S.destroy=void 0,C!==void 0&&cy(a,f,C)}S=S.next}while(S!==v)}}function gm(i,a){if(a=a.updateQueue,a=a!==null?a.lastEffect:null,a!==null){var f=a=a.next;do{if((f.tag&i)===i){var v=f.create;f.destroy=v()}f=f.next}while(f!==a)}}function hy(i){var a=i.ref;if(a!==null){var f=i.stateNode;switch(i.tag){case 5:i=f;break;default:i=f}typeof a=="function"?a(i):a.current=i}}function Uw(i){var a=i.alternate;a!==null&&(i.alternate=null,Uw(a)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(a=i.stateNode,a!==null&&(delete a[Cs],delete a[ud],delete a[K_],delete a[WE],delete a[HE])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function $w(i){return i.tag===5||i.tag===3||i.tag===4}function k1(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||$w(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function dy(i,a,f){var v=i.tag;if(v===5||v===6)i=i.stateNode,a?f.nodeType===8?f.parentNode.insertBefore(i,a):f.insertBefore(i,a):(f.nodeType===8?(a=f.parentNode,a.insertBefore(i,f)):(a=f,a.appendChild(i)),f=f._reactRootContainer,f!=null||a.onclick!==null||(a.onclick=Gf));else if(v!==4&&(i=i.child,i!==null))for(dy(i,a,f),i=i.sibling;i!==null;)dy(i,a,f),i=i.sibling}function py(i,a,f){var v=i.tag;if(v===5||v===6)i=i.stateNode,a?f.insertBefore(i,a):f.appendChild(i);else if(v!==4&&(i=i.child,i!==null))for(py(i,a,f),i=i.sibling;i!==null;)py(i,a,f),i=i.sibling}var Pn=null,rs=!1;function Qo(i,a,f){for(f=f.child;f!==null;)Gw(i,a,f),f=f.sibling}function Gw(i,a,f){if(Ms&&typeof Ms.onCommitFiberUnmount=="function")try{Ms.onCommitFiberUnmount(lm,f)}catch{}switch(f.tag){case 5:Bn||Xu(f,a);case 6:var v=Pn,S=rs;Pn=null,Qo(i,a,f),Pn=v,rs=S,Pn!==null&&(rs?(i=Pn,f=f.stateNode,i.nodeType===8?i.parentNode.removeChild(f):i.removeChild(f)):Pn.removeChild(f.stateNode));break;case 18:Pn!==null&&(rs?(i=Pn,f=f.stateNode,i.nodeType===8?d_(i.parentNode,f):i.nodeType===1&&d_(i,f),id(i)):d_(Pn,f.stateNode));break;case 4:v=Pn,S=rs,Pn=f.stateNode.containerInfo,rs=!0,Qo(i,a,f),Pn=v,rs=S;break;case 0:case 11:case 14:case 15:if(!Bn&&(v=f.updateQueue,v!==null&&(v=v.lastEffect,v!==null))){S=v=v.next;do{var C=S,w=C.destroy;C=C.tag,w!==void 0&&(C&2||C&4)&&cy(f,a,w),S=S.next}while(S!==v)}Qo(i,a,f);break;case 1:if(!Bn&&(Xu(f,a),v=f.stateNode,typeof v.componentWillUnmount=="function"))try{v.props=f.memoizedProps,v.state=f.memoizedState,v.componentWillUnmount()}catch(c){Nr(f,a,c)}Qo(i,a,f);break;case 21:Qo(i,a,f);break;case 22:f.mode&1?(Bn=(v=Bn)||f.memoizedState!==null,Qo(i,a,f),Bn=v):Qo(i,a,f);break;default:Qo(i,a,f)}}function A1(i){var a=i.updateQueue;if(a!==null){i.updateQueue=null;var f=i.stateNode;f===null&&(f=i.stateNode=new cC),a.forEach(function(v){var S=xC.bind(null,i,v);f.has(v)||(f.add(v),v.then(S,S))})}}function es(i,a){var f=a.deletions;if(f!==null)for(var v=0;v<f.length;v++){var S=f[v];try{var C=i,w=a,c=w;e:for(;c!==null;){switch(c.tag){case 5:Pn=c.stateNode,rs=!1;break e;case 3:Pn=c.stateNode.containerInfo,rs=!0;break e;case 4:Pn=c.stateNode.containerInfo,rs=!0;break e}c=c.return}if(Pn===null)throw Error(Xe(160));Gw(C,w,S),Pn=null,rs=!1;var N=S.alternate;N!==null&&(N.return=null),S.return=null}catch(K){Nr(S,a,K)}}if(a.subtreeFlags&12854)for(a=a.child;a!==null;)qw(a,i),a=a.sibling}function qw(i,a){var f=i.alternate,v=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(es(a,i),Ps(i),v&4){try{Yh(3,i,i.return),gm(3,i)}catch(_e){Nr(i,i.return,_e)}try{Yh(5,i,i.return)}catch(_e){Nr(i,i.return,_e)}}break;case 1:es(a,i),Ps(i),v&512&&f!==null&&Xu(f,f.return);break;case 5:if(es(a,i),Ps(i),v&512&&f!==null&&Xu(f,f.return),i.flags&32){var S=i.stateNode;try{ed(S,"")}catch(_e){Nr(i,i.return,_e)}}if(v&4&&(S=i.stateNode,S!=null)){var C=i.memoizedProps,w=f!==null?f.memoizedProps:C,c=i.type,N=i.updateQueue;if(i.updateQueue=null,N!==null)try{c==="input"&&C.type==="radio"&&C.name!=null&&pb(S,C),B_(c,w);var K=B_(c,C);for(w=0;w<N.length;w+=2){var fe=N[w],pe=N[w+1];fe==="style"?yb(S,pe):fe==="dangerouslySetInnerHTML"?gb(S,pe):fe==="children"?ed(S,pe):Cy(S,fe,pe,K)}switch(c){case"input":z_(S,C);break;case"textarea":fb(S,C);break;case"select":var ye=S._wrapperState.wasMultiple;S._wrapperState.wasMultiple=!!C.multiple;var Ae=C.value;Ae!=null?Ku(S,!!C.multiple,Ae,!1):ye!==!!C.multiple&&(C.defaultValue!=null?Ku(S,!!C.multiple,C.defaultValue,!0):Ku(S,!!C.multiple,C.multiple?[]:"",!1))}S[ud]=C}catch(_e){Nr(i,i.return,_e)}}break;case 6:if(es(a,i),Ps(i),v&4){if(i.stateNode===null)throw Error(Xe(162));S=i.stateNode,C=i.memoizedProps;try{S.nodeValue=C}catch(_e){Nr(i,i.return,_e)}}break;case 3:if(es(a,i),Ps(i),v&4&&f!==null&&f.memoizedState.isDehydrated)try{id(a.containerInfo)}catch(_e){Nr(i,i.return,_e)}break;case 4:es(a,i),Ps(i);break;case 13:es(a,i),Ps(i),S=i.child,S.flags&8192&&(C=S.memoizedState!==null,S.stateNode.isHidden=C,!C||S.alternate!==null&&S.alternate.memoizedState!==null||(ov=Gr())),v&4&&A1(i);break;case 22:if(fe=f!==null&&f.memoizedState!==null,i.mode&1?(Bn=(K=Bn)||fe,es(a,i),Bn=K):es(a,i),Ps(i),v&8192){if(K=i.memoizedState!==null,(i.stateNode.isHidden=K)&&!fe&&i.mode&1)for(ht=i,fe=i.child;fe!==null;){for(pe=ht=fe;ht!==null;){switch(ye=ht,Ae=ye.child,ye.tag){case 0:case 11:case 14:case 15:Yh(4,ye,ye.return);break;case 1:Xu(ye,ye.return);var we=ye.stateNode;if(typeof we.componentWillUnmount=="function"){v=ye,f=ye.return;try{a=v,we.props=a.memoizedProps,we.state=a.memoizedState,we.componentWillUnmount()}catch(_e){Nr(v,f,_e)}}break;case 5:Xu(ye,ye.return);break;case 22:if(ye.memoizedState!==null){D1(pe);continue}}Ae!==null?(Ae.return=ye,ht=Ae):D1(pe)}fe=fe.sibling}e:for(fe=null,pe=i;;){if(pe.tag===5){if(fe===null){fe=pe;try{S=pe.stateNode,K?(C=S.style,typeof C.setProperty=="function"?C.setProperty("display","none","important"):C.display="none"):(c=pe.stateNode,N=pe.memoizedProps.style,w=N!=null&&N.hasOwnProperty("display")?N.display:null,c.style.display=_b("display",w))}catch(_e){Nr(i,i.return,_e)}}}else if(pe.tag===6){if(fe===null)try{pe.stateNode.nodeValue=K?"":pe.memoizedProps}catch(_e){Nr(i,i.return,_e)}}else if((pe.tag!==22&&pe.tag!==23||pe.memoizedState===null||pe===i)&&pe.child!==null){pe.child.return=pe,pe=pe.child;continue}if(pe===i)break e;for(;pe.sibling===null;){if(pe.return===null||pe.return===i)break e;fe===pe&&(fe=null),pe=pe.return}fe===pe&&(fe=null),pe.sibling.return=pe.return,pe=pe.sibling}}break;case 19:es(a,i),Ps(i),v&4&&A1(i);break;case 21:break;default:es(a,i),Ps(i)}}function Ps(i){var a=i.flags;if(a&2){try{e:{for(var f=i.return;f!==null;){if($w(f)){var v=f;break e}f=f.return}throw Error(Xe(160))}switch(v.tag){case 5:var S=v.stateNode;v.flags&32&&(ed(S,""),v.flags&=-33);var C=k1(i);py(i,C,S);break;case 3:case 4:var w=v.stateNode.containerInfo,c=k1(i);dy(i,c,w);break;default:throw Error(Xe(161))}}catch(N){Nr(i,i.return,N)}i.flags&=-3}a&4096&&(i.flags&=-4097)}function dC(i,a,f){ht=i,Zw(i)}function Zw(i,a,f){for(var v=(i.mode&1)!==0;ht!==null;){var S=ht,C=S.child;if(S.tag===22&&v){var w=S.memoizedState!==null||_f;if(!w){var c=S.alternate,N=c!==null&&c.memoizedState!==null||Bn;c=_f;var K=Bn;if(_f=w,(Bn=N)&&!K)for(ht=S;ht!==null;)w=ht,N=w.child,w.tag===22&&w.memoizedState!==null?R1(S):N!==null?(N.return=w,ht=N):R1(S);for(;C!==null;)ht=C,Zw(C),C=C.sibling;ht=S,_f=c,Bn=K}z1(i)}else S.subtreeFlags&8772&&C!==null?(C.return=S,ht=C):z1(i)}}function z1(i){for(;ht!==null;){var a=ht;if(a.flags&8772){var f=a.alternate;try{if(a.flags&8772)switch(a.tag){case 0:case 11:case 15:Bn||gm(5,a);break;case 1:var v=a.stateNode;if(a.flags&4&&!Bn)if(f===null)v.componentDidMount();else{var S=a.elementType===a.type?f.memoizedProps:ts(a.type,f.memoizedProps);v.componentDidUpdate(S,f.memoizedState,v.__reactInternalSnapshotBeforeUpdate)}var C=a.updateQueue;C!==null&&g1(a,C,v);break;case 3:var w=a.updateQueue;if(w!==null){if(f=null,a.child!==null)switch(a.child.tag){case 5:f=a.child.stateNode;break;case 1:f=a.child.stateNode}g1(a,w,f)}break;case 5:var c=a.stateNode;if(f===null&&a.flags&4){f=c;var N=a.memoizedProps;switch(a.type){case"button":case"input":case"select":case"textarea":N.autoFocus&&f.focus();break;case"img":N.src&&(f.src=N.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(a.memoizedState===null){var K=a.alternate;if(K!==null){var fe=K.memoizedState;if(fe!==null){var pe=fe.dehydrated;pe!==null&&id(pe)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Xe(163))}Bn||a.flags&512&&hy(a)}catch(ye){Nr(a,a.return,ye)}}if(a===i){ht=null;break}if(f=a.sibling,f!==null){f.return=a.return,ht=f;break}ht=a.return}}function D1(i){for(;ht!==null;){var a=ht;if(a===i){ht=null;break}var f=a.sibling;if(f!==null){f.return=a.return,ht=f;break}ht=a.return}}function R1(i){for(;ht!==null;){var a=ht;try{switch(a.tag){case 0:case 11:case 15:var f=a.return;try{gm(4,a)}catch(N){Nr(a,f,N)}break;case 1:var v=a.stateNode;if(typeof v.componentDidMount=="function"){var S=a.return;try{v.componentDidMount()}catch(N){Nr(a,S,N)}}var C=a.return;try{hy(a)}catch(N){Nr(a,C,N)}break;case 5:var w=a.return;try{hy(a)}catch(N){Nr(a,w,N)}}}catch(N){Nr(a,a.return,N)}if(a===i){ht=null;break}var c=a.sibling;if(c!==null){c.return=a.return,ht=c;break}ht=a.return}}var pC=Math.ceil,tm=mo.ReactCurrentDispatcher,iv=mo.ReactCurrentOwner,Ni=mo.ReactCurrentBatchConfig,Bt=0,fn=null,Jr=null,En=0,Ti=0,Yu=ga(0),an=0,md=null,Cl=0,_m=0,sv=0,Kh=null,ii=null,ov=0,uc=1/0,no=null,rm=!1,fy=null,ca=null,yf=!1,ia=null,nm=0,Qh=0,my=null,Af=-1,zf=0;function Zn(){return Bt&6?Gr():Af!==-1?Af:Af=Gr()}function ha(i){return i.mode&1?Bt&2&&En!==0?En&-En:YE.transition!==null?(zf===0&&(zf=kb()),zf):(i=Kt,i!==0||(i=window.event,i=i===void 0?16:Bb(i.type)),i):1}function os(i,a,f,v){if(50<Qh)throw Qh=0,my=null,Error(Xe(185));yd(i,f,v),(!(Bt&2)||i!==fn)&&(i===fn&&(!(Bt&2)&&(_m|=f),an===4&&ra(i,En)),li(i,v),f===1&&Bt===0&&!(a.mode&1)&&(uc=Gr()+500,pm&&_a()))}function li(i,a){var f=i.callbackNode;YP(i,a);var v=jf(i,i===fn?En:0);if(v===0)f!==null&&$x(f),i.callbackNode=null,i.callbackPriority=0;else if(a=v&-v,i.callbackPriority!==a){if(f!=null&&$x(f),a===1)i.tag===0?XE(L1.bind(null,i)):rw(L1.bind(null,i)),qE(function(){!(Bt&6)&&_a()}),f=null;else{switch(Ab(v)){case 1:f=zy;break;case 4:f=Mb;break;case 16:f=Nf;break;case 536870912:f=Ib;break;default:f=Nf}f=e2(f,Ww.bind(null,i))}i.callbackPriority=a,i.callbackNode=f}}function Ww(i,a){if(Af=-1,zf=0,Bt&6)throw Error(Xe(327));var f=i.callbackNode;if(rc()&&i.callbackNode!==f)return null;var v=jf(i,i===fn?En:0);if(v===0)return null;if(v&30||v&i.expiredLanes||a)a=im(i,v);else{a=v;var S=Bt;Bt|=2;var C=Xw();(fn!==i||En!==a)&&(no=null,uc=Gr()+500,wl(i,a));do try{gC();break}catch(c){Hw(i,c)}while(!0);qy(),tm.current=C,Bt=S,Jr!==null?a=0:(fn=null,En=0,a=an)}if(a!==0){if(a===2&&(S=U_(i),S!==0&&(v=S,a=gy(i,S))),a===1)throw f=md,wl(i,0),ra(i,v),li(i,Gr()),f;if(a===6)ra(i,v);else{if(S=i.current.alternate,!(v&30)&&!fC(S)&&(a=im(i,v),a===2&&(C=U_(i),C!==0&&(v=C,a=gy(i,C))),a===1))throw f=md,wl(i,0),ra(i,v),li(i,Gr()),f;switch(i.finishedWork=S,i.finishedLanes=v,a){case 0:case 1:throw Error(Xe(345));case 2:yl(i,ii,no);break;case 3:if(ra(i,v),(v&130023424)===v&&(a=ov+500-Gr(),10<a)){if(jf(i,0)!==0)break;if(S=i.suspendedLanes,(S&v)!==v){Zn(),i.pingedLanes|=i.suspendedLanes&S;break}i.timeoutHandle=Y_(yl.bind(null,i,ii,no),a);break}yl(i,ii,no);break;case 4:if(ra(i,v),(v&4194240)===v)break;for(a=i.eventTimes,S=-1;0<v;){var w=31-ss(v);C=1<<w,w=a[w],w>S&&(S=w),v&=~C}if(v=S,v=Gr()-v,v=(120>v?120:480>v?480:1080>v?1080:1920>v?1920:3e3>v?3e3:4320>v?4320:1960*pC(v/1960))-v,10<v){i.timeoutHandle=Y_(yl.bind(null,i,ii,no),v);break}yl(i,ii,no);break;case 5:yl(i,ii,no);break;default:throw Error(Xe(329))}}}return li(i,Gr()),i.callbackNode===f?Ww.bind(null,i):null}function gy(i,a){var f=Kh;return i.current.memoizedState.isDehydrated&&(wl(i,a).flags|=256),i=im(i,a),i!==2&&(a=ii,ii=f,a!==null&&_y(a)),i}function _y(i){ii===null?ii=i:ii.push.apply(ii,i)}function fC(i){for(var a=i;;){if(a.flags&16384){var f=a.updateQueue;if(f!==null&&(f=f.stores,f!==null))for(var v=0;v<f.length;v++){var S=f[v],C=S.getSnapshot;S=S.value;try{if(!as(C(),S))return!1}catch{return!1}}}if(f=a.child,a.subtreeFlags&16384&&f!==null)f.return=a,a=f;else{if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function ra(i,a){for(a&=~sv,a&=~_m,i.suspendedLanes|=a,i.pingedLanes&=~a,i=i.expirationTimes;0<a;){var f=31-ss(a),v=1<<f;i[f]=-1,a&=~v}}function L1(i){if(Bt&6)throw Error(Xe(327));rc();var a=jf(i,0);if(!(a&1))return li(i,Gr()),null;var f=im(i,a);if(i.tag!==0&&f===2){var v=U_(i);v!==0&&(a=v,f=gy(i,v))}if(f===1)throw f=md,wl(i,0),ra(i,a),li(i,Gr()),f;if(f===6)throw Error(Xe(345));return i.finishedWork=i.current.alternate,i.finishedLanes=a,yl(i,ii,no),li(i,Gr()),null}function av(i,a){var f=Bt;Bt|=1;try{return i(a)}finally{Bt=f,Bt===0&&(uc=Gr()+500,pm&&_a())}}function Ml(i){ia!==null&&ia.tag===0&&!(Bt&6)&&rc();var a=Bt;Bt|=1;var f=Ni.transition,v=Kt;try{if(Ni.transition=null,Kt=1,i)return i()}finally{Kt=v,Ni.transition=f,Bt=a,!(Bt&6)&&_a()}}function lv(){Ti=Yu.current,xr(Yu)}function wl(i,a){i.finishedWork=null,i.finishedLanes=0;var f=i.timeoutHandle;if(f!==-1&&(i.timeoutHandle=-1,GE(f)),Jr!==null)for(f=Jr.return;f!==null;){var v=f;switch(Uy(v),v.tag){case 1:v=v.type.childContextTypes,v!=null&&qf();break;case 3:ac(),xr(oi),xr(On),Ky();break;case 5:Yy(v);break;case 4:ac();break;case 13:xr(kr);break;case 19:xr(kr);break;case 10:Zy(v.type._context);break;case 22:case 23:lv()}f=f.return}if(fn=i,Jr=i=da(i.current,null),En=Ti=a,an=0,md=null,sv=_m=Cl=0,ii=Kh=null,xl!==null){for(a=0;a<xl.length;a++)if(f=xl[a],v=f.interleaved,v!==null){f.interleaved=null;var S=v.next,C=f.pending;if(C!==null){var w=C.next;C.next=S,v.next=w}f.pending=v}xl=null}return i}function Hw(i,a){do{var f=Jr;try{if(qy(),Mf.current=em,Jf){for(var v=Ar.memoizedState;v!==null;){var S=v.queue;S!==null&&(S.pending=null),v=v.next}Jf=!1}if(El=0,pn=on=Ar=null,Xh=!1,dd=0,iv.current=null,f===null||f.return===null){an=1,md=a,Jr=null;break}e:{var C=i,w=f.return,c=f,N=a;if(a=En,c.flags|=32768,N!==null&&typeof N=="object"&&typeof N.then=="function"){var K=N,fe=c,pe=fe.tag;if(!(fe.mode&1)&&(pe===0||pe===11||pe===15)){var ye=fe.alternate;ye?(fe.updateQueue=ye.updateQueue,fe.memoizedState=ye.memoizedState,fe.lanes=ye.lanes):(fe.updateQueue=null,fe.memoizedState=null)}var Ae=w1(w);if(Ae!==null){Ae.flags&=-257,T1(Ae,w,c,C,a),Ae.mode&1&&b1(C,K,a),a=Ae,N=K;var we=a.updateQueue;if(we===null){var _e=new Set;_e.add(N),a.updateQueue=_e}else we.add(N);break e}else{if(!(a&1)){b1(C,K,a),uv();break e}N=Error(Xe(426))}}else if(Cr&&c.mode&1){var se=w1(w);if(se!==null){!(se.flags&65536)&&(se.flags|=256),T1(se,w,c,C,a),$y(lc(N,c));break e}}C=N=lc(N,c),an!==4&&(an=2),Kh===null?Kh=[C]:Kh.push(C),C=w;do{switch(C.tag){case 3:C.flags|=65536,a&=-a,C.lanes|=a;var ue=Aw(C,N,a);m1(C,ue);break e;case 1:c=N;var Y=C.type,ne=C.stateNode;if(!(C.flags&128)&&(typeof Y.getDerivedStateFromError=="function"||ne!==null&&typeof ne.componentDidCatch=="function"&&(ca===null||!ca.has(ne)))){C.flags|=65536,a&=-a,C.lanes|=a;var Be=zw(C,c,a);m1(C,Be);break e}}C=C.return}while(C!==null)}Kw(f)}catch(qe){a=qe,Jr===f&&f!==null&&(Jr=f=f.return);continue}break}while(!0)}function Xw(){var i=tm.current;return tm.current=em,i===null?em:i}function uv(){(an===0||an===3||an===2)&&(an=4),fn===null||!(Cl&268435455)&&!(_m&268435455)||ra(fn,En)}function im(i,a){var f=Bt;Bt|=2;var v=Xw();(fn!==i||En!==a)&&(no=null,wl(i,a));do try{mC();break}catch(S){Hw(i,S)}while(!0);if(qy(),Bt=f,tm.current=v,Jr!==null)throw Error(Xe(261));return fn=null,En=0,an}function mC(){for(;Jr!==null;)Yw(Jr)}function gC(){for(;Jr!==null&&!VP();)Yw(Jr)}function Yw(i){var a=Jw(i.alternate,i,Ti);i.memoizedProps=i.pendingProps,a===null?Kw(i):Jr=a,iv.current=null}function Kw(i){var a=i;do{var f=a.alternate;if(i=a.return,a.flags&32768){if(f=uC(f,a),f!==null){f.flags&=32767,Jr=f;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{an=6,Jr=null;return}}else if(f=lC(f,a,Ti),f!==null){Jr=f;return}if(a=a.sibling,a!==null){Jr=a;return}Jr=a=i}while(a!==null);an===0&&(an=5)}function yl(i,a,f){var v=Kt,S=Ni.transition;try{Ni.transition=null,Kt=1,_C(i,a,f,v)}finally{Ni.transition=S,Kt=v}return null}function _C(i,a,f,v){do rc();while(ia!==null);if(Bt&6)throw Error(Xe(327));f=i.finishedWork;var S=i.finishedLanes;if(f===null)return null;if(i.finishedWork=null,i.finishedLanes=0,f===i.current)throw Error(Xe(177));i.callbackNode=null,i.callbackPriority=0;var C=f.lanes|f.childLanes;if(KP(i,C),i===fn&&(Jr=fn=null,En=0),!(f.subtreeFlags&2064)&&!(f.flags&2064)||yf||(yf=!0,e2(Nf,function(){return rc(),null})),C=(f.flags&15990)!==0,f.subtreeFlags&15990||C){C=Ni.transition,Ni.transition=null;var w=Kt;Kt=1;var c=Bt;Bt|=4,iv.current=null,hC(i,f),qw(f,i),BE(H_),Vf=!!W_,H_=W_=null,i.current=f,dC(f),UP(),Bt=c,Kt=w,Ni.transition=C}else i.current=f;if(yf&&(yf=!1,ia=i,nm=S),C=i.pendingLanes,C===0&&(ca=null),qP(f.stateNode),li(i,Gr()),a!==null)for(v=i.onRecoverableError,f=0;f<a.length;f++)S=a[f],v(S.value,{componentStack:S.stack,digest:S.digest});if(rm)throw rm=!1,i=fy,fy=null,i;return nm&1&&i.tag!==0&&rc(),C=i.pendingLanes,C&1?i===my?Qh++:(Qh=0,my=i):Qh=0,_a(),null}function rc(){if(ia!==null){var i=Ab(nm),a=Ni.transition,f=Kt;try{if(Ni.transition=null,Kt=16>i?16:i,ia===null)var v=!1;else{if(i=ia,ia=null,nm=0,Bt&6)throw Error(Xe(331));var S=Bt;for(Bt|=4,ht=i.current;ht!==null;){var C=ht,w=C.child;if(ht.flags&16){var c=C.deletions;if(c!==null){for(var N=0;N<c.length;N++){var K=c[N];for(ht=K;ht!==null;){var fe=ht;switch(fe.tag){case 0:case 11:case 15:Yh(8,fe,C)}var pe=fe.child;if(pe!==null)pe.return=fe,ht=pe;else for(;ht!==null;){fe=ht;var ye=fe.sibling,Ae=fe.return;if(Uw(fe),fe===K){ht=null;break}if(ye!==null){ye.return=Ae,ht=ye;break}ht=Ae}}}var we=C.alternate;if(we!==null){var _e=we.child;if(_e!==null){we.child=null;do{var se=_e.sibling;_e.sibling=null,_e=se}while(_e!==null)}}ht=C}}if(C.subtreeFlags&2064&&w!==null)w.return=C,ht=w;else e:for(;ht!==null;){if(C=ht,C.flags&2048)switch(C.tag){case 0:case 11:case 15:Yh(9,C,C.return)}var ue=C.sibling;if(ue!==null){ue.return=C.return,ht=ue;break e}ht=C.return}}var Y=i.current;for(ht=Y;ht!==null;){w=ht;var ne=w.child;if(w.subtreeFlags&2064&&ne!==null)ne.return=w,ht=ne;else e:for(w=Y;ht!==null;){if(c=ht,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:gm(9,c)}}catch(qe){Nr(c,c.return,qe)}if(c===w){ht=null;break e}var Be=c.sibling;if(Be!==null){Be.return=c.return,ht=Be;break e}ht=c.return}}if(Bt=S,_a(),Ms&&typeof Ms.onPostCommitFiberRoot=="function")try{Ms.onPostCommitFiberRoot(lm,i)}catch{}v=!0}return v}finally{Kt=f,Ni.transition=a}}return!1}function F1(i,a,f){a=lc(f,a),a=Aw(i,a,1),i=ua(i,a,1),a=Zn(),i!==null&&(yd(i,1,a),li(i,a))}function Nr(i,a,f){if(i.tag===3)F1(i,i,f);else for(;a!==null;){if(a.tag===3){F1(a,i,f);break}else if(a.tag===1){var v=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof v.componentDidCatch=="function"&&(ca===null||!ca.has(v))){i=lc(f,i),i=zw(a,i,1),a=ua(a,i,1),i=Zn(),a!==null&&(yd(a,1,i),li(a,i));break}}a=a.return}}function yC(i,a,f){var v=i.pingCache;v!==null&&v.delete(a),a=Zn(),i.pingedLanes|=i.suspendedLanes&f,fn===i&&(En&f)===f&&(an===4||an===3&&(En&130023424)===En&&500>Gr()-ov?wl(i,0):sv|=f),li(i,a)}function Qw(i,a){a===0&&(i.mode&1?(a=lf,lf<<=1,!(lf&130023424)&&(lf=4194304)):a=1);var f=Zn();i=ho(i,a),i!==null&&(yd(i,a,f),li(i,f))}function vC(i){var a=i.memoizedState,f=0;a!==null&&(f=a.retryLane),Qw(i,f)}function xC(i,a){var f=0;switch(i.tag){case 13:var v=i.stateNode,S=i.memoizedState;S!==null&&(f=S.retryLane);break;case 19:v=i.stateNode;break;default:throw Error(Xe(314))}v!==null&&v.delete(a),Qw(i,f)}var Jw;Jw=function(i,a,f){if(i!==null)if(i.memoizedProps!==a.pendingProps||oi.current)si=!0;else{if(!(i.lanes&f)&&!(a.flags&128))return si=!1,aC(i,a,f);si=!!(i.flags&131072)}else si=!1,Cr&&a.flags&1048576&&nw(a,Hf,a.index);switch(a.lanes=0,a.tag){case 2:var v=a.type;kf(i,a),i=a.pendingProps;var S=ic(a,On.current);tc(a,f),S=Jy(null,a,v,i,S,f);var C=ev();return a.flags|=1,typeof S=="object"&&S!==null&&typeof S.render=="function"&&S.$$typeof===void 0?(a.tag=1,a.memoizedState=null,a.updateQueue=null,ai(v)?(C=!0,Zf(a)):C=!1,a.memoizedState=S.state!==null&&S.state!==void 0?S.state:null,Hy(a),S.updater=mm,a.stateNode=S,S._reactInternals=a,ny(a,v,i,f),a=oy(null,a,v,!0,C,f)):(a.tag=0,Cr&&C&&Vy(a),qn(null,a,S,f),a=a.child),a;case 16:v=a.elementType;e:{switch(kf(i,a),i=a.pendingProps,S=v._init,v=S(v._payload),a.type=v,S=a.tag=wC(v),i=ts(v,i),S){case 0:a=sy(null,a,v,i,f);break e;case 1:a=E1(null,a,v,i,f);break e;case 11:a=S1(null,a,v,i,f);break e;case 14:a=P1(null,a,v,ts(v.type,i),f);break e}throw Error(Xe(306,v,""))}return a;case 0:return v=a.type,S=a.pendingProps,S=a.elementType===v?S:ts(v,S),sy(i,a,v,S,f);case 1:return v=a.type,S=a.pendingProps,S=a.elementType===v?S:ts(v,S),E1(i,a,v,S,f);case 3:e:{if(Fw(a),i===null)throw Error(Xe(387));v=a.pendingProps,C=a.memoizedState,S=C.element,uw(i,a),Kf(a,v,null,f);var w=a.memoizedState;if(v=w.element,C.isDehydrated)if(C={element:v,isDehydrated:!1,cache:w.cache,pendingSuspenseBoundaries:w.pendingSuspenseBoundaries,transitions:w.transitions},a.updateQueue.baseState=C,a.memoizedState=C,a.flags&256){S=lc(Error(Xe(423)),a),a=C1(i,a,v,f,S);break e}else if(v!==S){S=lc(Error(Xe(424)),a),a=C1(i,a,v,f,S);break e}else for(Si=la(a.stateNode.containerInfo.firstChild),Pi=a,Cr=!0,ns=null,f=aw(a,null,v,f),a.child=f;f;)f.flags=f.flags&-3|4096,f=f.sibling;else{if(sc(),v===S){a=po(i,a,f);break e}qn(i,a,v,f)}a=a.child}return a;case 5:return cw(a),i===null&&ey(a),v=a.type,S=a.pendingProps,C=i!==null?i.memoizedProps:null,w=S.children,X_(v,S)?w=null:C!==null&&X_(v,C)&&(a.flags|=32),Lw(i,a),qn(i,a,w,f),a.child;case 6:return i===null&&ey(a),null;case 13:return Bw(i,a,f);case 4:return Xy(a,a.stateNode.containerInfo),v=a.pendingProps,i===null?a.child=oc(a,null,v,f):qn(i,a,v,f),a.child;case 11:return v=a.type,S=a.pendingProps,S=a.elementType===v?S:ts(v,S),S1(i,a,v,S,f);case 7:return qn(i,a,a.pendingProps,f),a.child;case 8:return qn(i,a,a.pendingProps.children,f),a.child;case 12:return qn(i,a,a.pendingProps.children,f),a.child;case 10:e:{if(v=a.type._context,S=a.pendingProps,C=a.memoizedProps,w=S.value,hr(Xf,v._currentValue),v._currentValue=w,C!==null)if(as(C.value,w)){if(C.children===S.children&&!oi.current){a=po(i,a,f);break e}}else for(C=a.child,C!==null&&(C.return=a);C!==null;){var c=C.dependencies;if(c!==null){w=C.child;for(var N=c.firstContext;N!==null;){if(N.context===v){if(C.tag===1){N=ao(-1,f&-f),N.tag=2;var K=C.updateQueue;if(K!==null){K=K.shared;var fe=K.pending;fe===null?N.next=N:(N.next=fe.next,fe.next=N),K.pending=N}}C.lanes|=f,N=C.alternate,N!==null&&(N.lanes|=f),ty(C.return,f,a),c.lanes|=f;break}N=N.next}}else if(C.tag===10)w=C.type===a.type?null:C.child;else if(C.tag===18){if(w=C.return,w===null)throw Error(Xe(341));w.lanes|=f,c=w.alternate,c!==null&&(c.lanes|=f),ty(w,f,a),w=C.sibling}else w=C.child;if(w!==null)w.return=C;else for(w=C;w!==null;){if(w===a){w=null;break}if(C=w.sibling,C!==null){C.return=w.return,w=C;break}w=w.return}C=w}qn(i,a,S.children,f),a=a.child}return a;case 9:return S=a.type,v=a.pendingProps.children,tc(a,f),S=ji(S),v=v(S),a.flags|=1,qn(i,a,v,f),a.child;case 14:return v=a.type,S=ts(v,a.pendingProps),S=ts(v.type,S),P1(i,a,v,S,f);case 15:return Dw(i,a,a.type,a.pendingProps,f);case 17:return v=a.type,S=a.pendingProps,S=a.elementType===v?S:ts(v,S),kf(i,a),a.tag=1,ai(v)?(i=!0,Zf(a)):i=!1,tc(a,f),kw(a,v,S),ny(a,v,S,f),oy(null,a,v,!0,i,f);case 19:return Ow(i,a,f);case 22:return Rw(i,a,f)}throw Error(Xe(156,a.tag))};function e2(i,a){return Cb(i,a)}function bC(i,a,f,v){this.tag=i,this.key=f,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=v,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Oi(i,a,f,v){return new bC(i,a,f,v)}function cv(i){return i=i.prototype,!(!i||!i.isReactComponent)}function wC(i){if(typeof i=="function")return cv(i)?1:0;if(i!=null){if(i=i.$$typeof,i===Iy)return 11;if(i===ky)return 14}return 2}function da(i,a){var f=i.alternate;return f===null?(f=Oi(i.tag,a,i.key,i.mode),f.elementType=i.elementType,f.type=i.type,f.stateNode=i.stateNode,f.alternate=i,i.alternate=f):(f.pendingProps=a,f.type=i.type,f.flags=0,f.subtreeFlags=0,f.deletions=null),f.flags=i.flags&14680064,f.childLanes=i.childLanes,f.lanes=i.lanes,f.child=i.child,f.memoizedProps=i.memoizedProps,f.memoizedState=i.memoizedState,f.updateQueue=i.updateQueue,a=i.dependencies,f.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},f.sibling=i.sibling,f.index=i.index,f.ref=i.ref,f}function Df(i,a,f,v,S,C){var w=2;if(v=i,typeof i=="function")cv(i)&&(w=1);else if(typeof i=="string")w=5;else e:switch(i){case ju:return Tl(f.children,S,C,a);case My:w=8,S|=8;break;case C_:return i=Oi(12,f,a,S|2),i.elementType=C_,i.lanes=C,i;case M_:return i=Oi(13,f,a,S),i.elementType=M_,i.lanes=C,i;case I_:return i=Oi(19,f,a,S),i.elementType=I_,i.lanes=C,i;case cb:return ym(f,S,C,a);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case lb:w=10;break e;case ub:w=9;break e;case Iy:w=11;break e;case ky:w=14;break e;case Jo:w=16,v=null;break e}throw Error(Xe(130,i==null?i:typeof i,""))}return a=Oi(w,f,a,S),a.elementType=i,a.type=v,a.lanes=C,a}function Tl(i,a,f,v){return i=Oi(7,i,v,a),i.lanes=f,i}function ym(i,a,f,v){return i=Oi(22,i,v,a),i.elementType=cb,i.lanes=f,i.stateNode={isHidden:!1},i}function x_(i,a,f){return i=Oi(6,i,null,a),i.lanes=f,i}function b_(i,a,f){return a=Oi(4,i.children!==null?i.children:[],i.key,a),a.lanes=f,a.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},a}function TC(i,a,f,v,S){this.tag=a,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=t_(0),this.expirationTimes=t_(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=t_(0),this.identifierPrefix=v,this.onRecoverableError=S,this.mutableSourceEagerHydrationData=null}function hv(i,a,f,v,S,C,w,c,N){return i=new TC(i,a,f,c,N),a===1?(a=1,C===!0&&(a|=8)):a=0,C=Oi(3,null,null,a),i.current=C,C.stateNode=i,C.memoizedState={element:v,isDehydrated:f,cache:null,transitions:null,pendingSuspenseBoundaries:null},Hy(C),i}function SC(i,a,f){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Nu,key:v==null?null:""+v,children:i,containerInfo:a,implementation:f}}function t2(i){if(!i)return fa;i=i._reactInternals;e:{if(kl(i)!==i||i.tag!==1)throw Error(Xe(170));var a=i;do{switch(a.tag){case 3:a=a.stateNode.context;break e;case 1:if(ai(a.type)){a=a.stateNode.__reactInternalMemoizedMergedChildContext;break e}}a=a.return}while(a!==null);throw Error(Xe(171))}if(i.tag===1){var f=i.type;if(ai(f))return tw(i,f,a)}return a}function r2(i,a,f,v,S,C,w,c,N){return i=hv(f,v,!0,i,S,C,w,c,N),i.context=t2(null),f=i.current,v=Zn(),S=ha(f),C=ao(v,S),C.callback=a??null,ua(f,C,S),i.current.lanes=S,yd(i,S,v),li(i,v),i}function vm(i,a,f,v){var S=a.current,C=Zn(),w=ha(S);return f=t2(f),a.context===null?a.context=f:a.pendingContext=f,a=ao(C,w),a.payload={element:i},v=v===void 0?null:v,v!==null&&(a.callback=v),i=ua(S,a,w),i!==null&&(os(i,S,w,C),Cf(i,S,w)),w}function sm(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function B1(i,a){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var f=i.retryLane;i.retryLane=f!==0&&f<a?f:a}}function dv(i,a){B1(i,a),(i=i.alternate)&&B1(i,a)}function PC(){return null}var n2=typeof reportError=="function"?reportError:function(i){console.error(i)};function pv(i){this._internalRoot=i}xm.prototype.render=pv.prototype.render=function(i){var a=this._internalRoot;if(a===null)throw Error(Xe(409));vm(i,a,null,null)};xm.prototype.unmount=pv.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var a=i.containerInfo;Ml(function(){vm(null,i,null,null)}),a[co]=null}};function xm(i){this._internalRoot=i}xm.prototype.unstable_scheduleHydration=function(i){if(i){var a=Rb();i={blockedOn:null,target:i,priority:a};for(var f=0;f<ta.length&&a!==0&&a<ta[f].priority;f++);ta.splice(f,0,i),f===0&&Fb(i)}};function fv(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function bm(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function O1(){}function EC(i,a,f,v,S){if(S){if(typeof v=="function"){var C=v;v=function(){var K=sm(w);C.call(K)}}var w=r2(a,v,i,0,null,!1,!1,"",O1);return i._reactRootContainer=w,i[co]=w.current,ad(i.nodeType===8?i.parentNode:i),Ml(),w}for(;S=i.lastChild;)i.removeChild(S);if(typeof v=="function"){var c=v;v=function(){var K=sm(N);c.call(K)}}var N=hv(i,0,!1,null,null,!1,!1,"",O1);return i._reactRootContainer=N,i[co]=N.current,ad(i.nodeType===8?i.parentNode:i),Ml(function(){vm(a,N,f,v)}),N}function wm(i,a,f,v,S){var C=f._reactRootContainer;if(C){var w=C;if(typeof S=="function"){var c=S;S=function(){var N=sm(w);c.call(N)}}vm(a,w,i,S)}else w=EC(f,a,i,S,v);return sm(w)}zb=function(i){switch(i.tag){case 3:var a=i.stateNode;if(a.current.memoizedState.isDehydrated){var f=Vh(a.pendingLanes);f!==0&&(Dy(a,f|1),li(a,Gr()),!(Bt&6)&&(uc=Gr()+500,_a()))}break;case 13:Ml(function(){var v=ho(i,1);if(v!==null){var S=Zn();os(v,i,1,S)}}),dv(i,1)}};Ry=function(i){if(i.tag===13){var a=ho(i,134217728);if(a!==null){var f=Zn();os(a,i,134217728,f)}dv(i,134217728)}};Db=function(i){if(i.tag===13){var a=ha(i),f=ho(i,a);if(f!==null){var v=Zn();os(f,i,a,v)}dv(i,a)}};Rb=function(){return Kt};Lb=function(i,a){var f=Kt;try{return Kt=i,a()}finally{Kt=f}};N_=function(i,a,f){switch(a){case"input":if(z_(i,f),a=f.name,f.type==="radio"&&a!=null){for(f=i;f.parentNode;)f=f.parentNode;for(f=f.querySelectorAll("input[name="+JSON.stringify(""+a)+'][type="radio"]'),a=0;a<f.length;a++){var v=f[a];if(v!==i&&v.form===i.form){var S=dm(v);if(!S)throw Error(Xe(90));db(v),z_(v,S)}}}break;case"textarea":fb(i,f);break;case"select":a=f.value,a!=null&&Ku(i,!!f.multiple,a,!1)}};bb=av;wb=Ml;var CC={usingClientEntryPoint:!1,Events:[xd,Gu,dm,vb,xb,av]},Bh={findFiberByHostInstance:vl,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},MC={bundleType:Bh.bundleType,version:Bh.version,rendererPackageName:Bh.rendererPackageName,rendererConfig:Bh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:mo.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=Pb(i),i===null?null:i.stateNode},findFiberByHostInstance:Bh.findFiberByHostInstance||PC,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vf.isDisabled&&vf.supportsFiber)try{lm=vf.inject(MC),Ms=vf}catch{}}Ci.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=CC;Ci.createPortal=function(i,a){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!fv(a))throw Error(Xe(200));return SC(i,a,null,f)};Ci.createRoot=function(i,a){if(!fv(i))throw Error(Xe(299));var f=!1,v="",S=n2;return a!=null&&(a.unstable_strictMode===!0&&(f=!0),a.identifierPrefix!==void 0&&(v=a.identifierPrefix),a.onRecoverableError!==void 0&&(S=a.onRecoverableError)),a=hv(i,1,!1,null,null,f,!1,v,S),i[co]=a.current,ad(i.nodeType===8?i.parentNode:i),new pv(a)};Ci.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var a=i._reactInternals;if(a===void 0)throw typeof i.render=="function"?Error(Xe(188)):(i=Object.keys(i).join(","),Error(Xe(268,i)));return i=Pb(a),i=i===null?null:i.stateNode,i};Ci.flushSync=function(i){return Ml(i)};Ci.hydrate=function(i,a,f){if(!bm(a))throw Error(Xe(200));return wm(null,i,a,!0,f)};Ci.hydrateRoot=function(i,a,f){if(!fv(i))throw Error(Xe(405));var v=f!=null&&f.hydratedSources||null,S=!1,C="",w=n2;if(f!=null&&(f.unstable_strictMode===!0&&(S=!0),f.identifierPrefix!==void 0&&(C=f.identifierPrefix),f.onRecoverableError!==void 0&&(w=f.onRecoverableError)),a=r2(a,null,i,1,f??null,S,!1,C,w),i[co]=a.current,ad(i),v)for(i=0;i<v.length;i++)f=v[i],S=f._getVersion,S=S(f._source),a.mutableSourceEagerHydrationData==null?a.mutableSourceEagerHydrationData=[f,S]:a.mutableSourceEagerHydrationData.push(f,S);return new xm(a)};Ci.render=function(i,a,f){if(!bm(a))throw Error(Xe(200));return wm(null,i,a,!1,f)};Ci.unmountComponentAtNode=function(i){if(!bm(i))throw Error(Xe(40));return i._reactRootContainer?(Ml(function(){wm(null,null,i,!1,function(){i._reactRootContainer=null,i[co]=null})}),!0):!1};Ci.unstable_batchedUpdates=av;Ci.unstable_renderSubtreeIntoContainer=function(i,a,f,v){if(!bm(f))throw Error(Xe(200));if(i==null||i._reactInternals===void 0)throw Error(Xe(38));return wm(i,a,f,!1,v)};Ci.version="18.3.1-next-f1338f8080-20240426";function i2(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i2)}catch(i){console.error(i)}}i2(),ib.exports=Ci;var IC=ib.exports,N1=IC;P_.createRoot=N1.createRoot,P_.hydrateRoot=N1.hydrateRoot;/**
 * react-router v7.12.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var j1="popstate";function kC(i={}){function a(v,S){let{pathname:C,search:w,hash:c}=v.location;return yy("",{pathname:C,search:w,hash:c},S.state&&S.state.usr||null,S.state&&S.state.key||"default")}function f(v,S){return typeof S=="string"?S:gd(S)}return zC(a,f,null,i)}function zr(i,a){if(i===!1||i===null||typeof i>"u")throw new Error(a)}function Ui(i,a){if(!i){typeof console<"u"&&console.warn(a);try{throw new Error(a)}catch{}}}function AC(){return Math.random().toString(36).substring(2,10)}function V1(i,a){return{usr:i.state,key:i.key,idx:a}}function yy(i,a,f=null,v){return{pathname:typeof i=="string"?i:i.pathname,search:"",hash:"",...typeof a=="string"?pc(a):a,state:f,key:a&&a.key||v||AC()}}function gd({pathname:i="/",search:a="",hash:f=""}){return a&&a!=="?"&&(i+=a.charAt(0)==="?"?a:"?"+a),f&&f!=="#"&&(i+=f.charAt(0)==="#"?f:"#"+f),i}function pc(i){let a={};if(i){let f=i.indexOf("#");f>=0&&(a.hash=i.substring(f),i=i.substring(0,f));let v=i.indexOf("?");v>=0&&(a.search=i.substring(v),i=i.substring(0,v)),i&&(a.pathname=i)}return a}function zC(i,a,f,v={}){let{window:S=document.defaultView,v5Compat:C=!1}=v,w=S.history,c="POP",N=null,K=fe();K==null&&(K=0,w.replaceState({...w.state,idx:K},""));function fe(){return(w.state||{idx:null}).idx}function pe(){c="POP";let se=fe(),ue=se==null?null:se-K;K=se,N&&N({action:c,location:_e.location,delta:ue})}function ye(se,ue){c="PUSH";let Y=yy(_e.location,se,ue);K=fe()+1;let ne=V1(Y,K),Be=_e.createHref(Y);try{w.pushState(ne,"",Be)}catch(qe){if(qe instanceof DOMException&&qe.name==="DataCloneError")throw qe;S.location.assign(Be)}C&&N&&N({action:c,location:_e.location,delta:1})}function Ae(se,ue){c="REPLACE";let Y=yy(_e.location,se,ue);K=fe();let ne=V1(Y,K),Be=_e.createHref(Y);w.replaceState(ne,"",Be),C&&N&&N({action:c,location:_e.location,delta:0})}function we(se){return DC(se)}let _e={get action(){return c},get location(){return i(S,w)},listen(se){if(N)throw new Error("A history only accepts one active listener");return S.addEventListener(j1,pe),N=se,()=>{S.removeEventListener(j1,pe),N=null}},createHref(se){return a(S,se)},createURL:we,encodeLocation(se){let ue=we(se);return{pathname:ue.pathname,search:ue.search,hash:ue.hash}},push:ye,replace:Ae,go(se){return w.go(se)}};return _e}function DC(i,a=!1){let f="http://localhost";typeof window<"u"&&(f=window.location.origin!=="null"?window.location.origin:window.location.href),zr(f,"No window.location.(origin|href) available to create URL");let v=typeof i=="string"?i:gd(i);return v=v.replace(/ $/,"%20"),!a&&v.startsWith("//")&&(v=f+v),new URL(v,f)}function s2(i,a,f="/"){return RC(i,a,f,!1)}function RC(i,a,f,v){let S=typeof a=="string"?pc(a):a,C=fo(S.pathname||"/",f);if(C==null)return null;let w=o2(i);LC(w);let c=null;for(let N=0;c==null&&N<w.length;++N){let K=ZC(C);c=GC(w[N],K,v)}return c}function o2(i,a=[],f=[],v="",S=!1){let C=(w,c,N=S,K)=>{let fe={relativePath:K===void 0?w.path||"":K,caseSensitive:w.caseSensitive===!0,childrenIndex:c,route:w};if(fe.relativePath.startsWith("/")){if(!fe.relativePath.startsWith(v)&&N)return;zr(fe.relativePath.startsWith(v),`Absolute route path "${fe.relativePath}" nested under path "${v}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),fe.relativePath=fe.relativePath.slice(v.length)}let pe=lo([v,fe.relativePath]),ye=f.concat(fe);w.children&&w.children.length>0&&(zr(w.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${pe}".`),o2(w.children,a,ye,pe,N)),!(w.path==null&&!w.index)&&a.push({path:pe,score:UC(pe,w.index),routesMeta:ye})};return i.forEach((w,c)=>{var N;if(w.path===""||!((N=w.path)!=null&&N.includes("?")))C(w,c);else for(let K of a2(w.path))C(w,c,!0,K)}),a}function a2(i){let a=i.split("/");if(a.length===0)return[];let[f,...v]=a,S=f.endsWith("?"),C=f.replace(/\?$/,"");if(v.length===0)return S?[C,""]:[C];let w=a2(v.join("/")),c=[];return c.push(...w.map(N=>N===""?C:[C,N].join("/"))),S&&c.push(...w),c.map(N=>i.startsWith("/")&&N===""?"/":N)}function LC(i){i.sort((a,f)=>a.score!==f.score?f.score-a.score:$C(a.routesMeta.map(v=>v.childrenIndex),f.routesMeta.map(v=>v.childrenIndex)))}var FC=/^:[\w-]+$/,BC=3,OC=2,NC=1,jC=10,VC=-2,U1=i=>i==="*";function UC(i,a){let f=i.split("/"),v=f.length;return f.some(U1)&&(v+=VC),a&&(v+=OC),f.filter(S=>!U1(S)).reduce((S,C)=>S+(FC.test(C)?BC:C===""?NC:jC),v)}function $C(i,a){return i.length===a.length&&i.slice(0,-1).every((v,S)=>v===a[S])?i[i.length-1]-a[a.length-1]:0}function GC(i,a,f=!1){let{routesMeta:v}=i,S={},C="/",w=[];for(let c=0;c<v.length;++c){let N=v[c],K=c===v.length-1,fe=C==="/"?a:a.slice(C.length)||"/",pe=om({path:N.relativePath,caseSensitive:N.caseSensitive,end:K},fe),ye=N.route;if(!pe&&K&&f&&!v[v.length-1].route.index&&(pe=om({path:N.relativePath,caseSensitive:N.caseSensitive,end:!1},fe)),!pe)return null;Object.assign(S,pe.params),w.push({params:S,pathname:lo([C,pe.pathname]),pathnameBase:YC(lo([C,pe.pathnameBase])),route:ye}),pe.pathnameBase!=="/"&&(C=lo([C,pe.pathnameBase]))}return w}function om(i,a){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[f,v]=qC(i.path,i.caseSensitive,i.end),S=a.match(f);if(!S)return null;let C=S[0],w=C.replace(/(.)\/+$/,"$1"),c=S.slice(1);return{params:v.reduce((K,{paramName:fe,isOptional:pe},ye)=>{if(fe==="*"){let we=c[ye]||"";w=C.slice(0,C.length-we.length).replace(/(.)\/+$/,"$1")}const Ae=c[ye];return pe&&!Ae?K[fe]=void 0:K[fe]=(Ae||"").replace(/%2F/g,"/"),K},{}),pathname:C,pathnameBase:w,pattern:i}}function qC(i,a=!1,f=!0){Ui(i==="*"||!i.endsWith("*")||i.endsWith("/*"),`Route path "${i}" will be treated as if it were "${i.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${i.replace(/\*$/,"/*")}".`);let v=[],S="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(w,c,N)=>(v.push({paramName:c,isOptional:N!=null}),N?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return i.endsWith("*")?(v.push({paramName:"*"}),S+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):f?S+="\\/*$":i!==""&&i!=="/"&&(S+="(?:(?=\\/|$))"),[new RegExp(S,a?void 0:"i"),v]}function ZC(i){try{return i.split("/").map(a=>decodeURIComponent(a).replace(/\//g,"%2F")).join("/")}catch(a){return Ui(!1,`The URL path "${i}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${a}).`),i}}function fo(i,a){if(a==="/")return i;if(!i.toLowerCase().startsWith(a.toLowerCase()))return null;let f=a.endsWith("/")?a.length-1:a.length,v=i.charAt(f);return v&&v!=="/"?null:i.slice(f)||"/"}var l2=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,WC=i=>l2.test(i);function HC(i,a="/"){let{pathname:f,search:v="",hash:S=""}=typeof i=="string"?pc(i):i,C;if(f)if(WC(f))C=f;else{if(f.includes("//")){let w=f;f=f.replace(/\/\/+/g,"/"),Ui(!1,`Pathnames cannot have embedded double slashes - normalizing ${w} -> ${f}`)}f.startsWith("/")?C=$1(f.substring(1),"/"):C=$1(f,a)}else C=a;return{pathname:C,search:KC(v),hash:QC(S)}}function $1(i,a){let f=a.replace(/\/+$/,"").split("/");return i.split("/").forEach(S=>{S===".."?f.length>1&&f.pop():S!=="."&&f.push(S)}),f.length>1?f.join("/"):"/"}function w_(i,a,f,v){return`Cannot include a '${i}' character in a manually specified \`to.${a}\` field [${JSON.stringify(v)}].  Please separate it out to the \`to.${f}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function XC(i){return i.filter((a,f)=>f===0||a.route.path&&a.route.path.length>0)}function u2(i){let a=XC(i);return a.map((f,v)=>v===a.length-1?f.pathname:f.pathnameBase)}function c2(i,a,f,v=!1){let S;typeof i=="string"?S=pc(i):(S={...i},zr(!S.pathname||!S.pathname.includes("?"),w_("?","pathname","search",S)),zr(!S.pathname||!S.pathname.includes("#"),w_("#","pathname","hash",S)),zr(!S.search||!S.search.includes("#"),w_("#","search","hash",S)));let C=i===""||S.pathname==="",w=C?"/":S.pathname,c;if(w==null)c=f;else{let pe=a.length-1;if(!v&&w.startsWith("..")){let ye=w.split("/");for(;ye[0]==="..";)ye.shift(),pe-=1;S.pathname=ye.join("/")}c=pe>=0?a[pe]:"/"}let N=HC(S,c),K=w&&w!=="/"&&w.endsWith("/"),fe=(C||w===".")&&f.endsWith("/");return!N.pathname.endsWith("/")&&(K||fe)&&(N.pathname+="/"),N}var lo=i=>i.join("/").replace(/\/\/+/g,"/"),YC=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),KC=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,QC=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i,JC=class{constructor(i,a,f,v=!1){this.status=i,this.statusText=a||"",this.internal=v,f instanceof Error?(this.data=f.toString(),this.error=f):this.data=f}};function eM(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}function tM(i){return i.map(a=>a.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var h2=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function d2(i,a){let f=i;if(typeof f!="string"||!l2.test(f))return{absoluteURL:void 0,isExternal:!1,to:f};let v=f,S=!1;if(h2)try{let C=new URL(window.location.href),w=f.startsWith("//")?new URL(C.protocol+f):new URL(f),c=fo(w.pathname,a);w.origin===C.origin&&c!=null?f=c+w.search+w.hash:S=!0}catch{Ui(!1,`<Link to="${f}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:v,isExternal:S,to:f}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var p2=["POST","PUT","PATCH","DELETE"];new Set(p2);var rM=["GET",...p2];new Set(rM);var fc=Re.createContext(null);fc.displayName="DataRouter";var Tm=Re.createContext(null);Tm.displayName="DataRouterState";var nM=Re.createContext(!1),f2=Re.createContext({isTransitioning:!1});f2.displayName="ViewTransition";var iM=Re.createContext(new Map);iM.displayName="Fetchers";var sM=Re.createContext(null);sM.displayName="Await";var $i=Re.createContext(null);$i.displayName="Navigation";var wd=Re.createContext(null);wd.displayName="Location";var ks=Re.createContext({outlet:null,matches:[],isDataRoute:!1});ks.displayName="Route";var mv=Re.createContext(null);mv.displayName="RouteError";var m2="REACT_ROUTER_ERROR",oM="REDIRECT",aM="ROUTE_ERROR_RESPONSE";function lM(i){if(i.startsWith(`${m2}:${oM}:{`))try{let a=JSON.parse(i.slice(28));if(typeof a=="object"&&a&&typeof a.status=="number"&&typeof a.statusText=="string"&&typeof a.location=="string"&&typeof a.reloadDocument=="boolean"&&typeof a.replace=="boolean")return a}catch{}}function uM(i){if(i.startsWith(`${m2}:${aM}:{`))try{let a=JSON.parse(i.slice(40));if(typeof a=="object"&&a&&typeof a.status=="number"&&typeof a.statusText=="string")return new JC(a.status,a.statusText,a.data)}catch{}}function cM(i,{relative:a}={}){zr(Td(),"useHref() may be used only in the context of a <Router> component.");let{basename:f,navigator:v}=Re.useContext($i),{hash:S,pathname:C,search:w}=Pd(i,{relative:a}),c=C;return f!=="/"&&(c=C==="/"?f:lo([f,C])),v.createHref({pathname:c,search:w,hash:S})}function Td(){return Re.useContext(wd)!=null}function go(){return zr(Td(),"useLocation() may be used only in the context of a <Router> component."),Re.useContext(wd).location}var g2="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function _2(i){Re.useContext($i).static||Re.useLayoutEffect(i)}function Sd(){let{isDataRoute:i}=Re.useContext(ks);return i?TM():hM()}function hM(){zr(Td(),"useNavigate() may be used only in the context of a <Router> component.");let i=Re.useContext(fc),{basename:a,navigator:f}=Re.useContext($i),{matches:v}=Re.useContext(ks),{pathname:S}=go(),C=JSON.stringify(u2(v)),w=Re.useRef(!1);return _2(()=>{w.current=!0}),Re.useCallback((N,K={})=>{if(Ui(w.current,g2),!w.current)return;if(typeof N=="number"){f.go(N);return}let fe=c2(N,JSON.parse(C),S,K.relative==="path");i==null&&a!=="/"&&(fe.pathname=fe.pathname==="/"?a:lo([a,fe.pathname])),(K.replace?f.replace:f.push)(fe,K.state,K)},[a,f,C,S,i])}Re.createContext(null);function y2(){let{matches:i}=Re.useContext(ks),a=i[i.length-1];return a?a.params:{}}function Pd(i,{relative:a}={}){let{matches:f}=Re.useContext(ks),{pathname:v}=go(),S=JSON.stringify(u2(f));return Re.useMemo(()=>c2(i,JSON.parse(S),v,a==="path"),[i,S,v,a])}function dM(i,a){return v2(i,a)}function v2(i,a,f,v,S){var Y;zr(Td(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:C}=Re.useContext($i),{matches:w}=Re.useContext(ks),c=w[w.length-1],N=c?c.params:{},K=c?c.pathname:"/",fe=c?c.pathnameBase:"/",pe=c&&c.route;{let ne=pe&&pe.path||"";b2(K,!pe||ne.endsWith("*")||ne.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${K}" (under <Route path="${ne}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${ne}"> to <Route path="${ne==="/"?"*":`${ne}/*`}">.`)}let ye=go(),Ae;if(a){let ne=typeof a=="string"?pc(a):a;zr(fe==="/"||((Y=ne.pathname)==null?void 0:Y.startsWith(fe)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${fe}" but pathname "${ne.pathname}" was given in the \`location\` prop.`),Ae=ne}else Ae=ye;let we=Ae.pathname||"/",_e=we;if(fe!=="/"){let ne=fe.replace(/^\//,"").split("/");_e="/"+we.replace(/^\//,"").split("/").slice(ne.length).join("/")}let se=s2(i,{pathname:_e});Ui(pe||se!=null,`No routes matched location "${Ae.pathname}${Ae.search}${Ae.hash}" `),Ui(se==null||se[se.length-1].route.element!==void 0||se[se.length-1].route.Component!==void 0||se[se.length-1].route.lazy!==void 0,`Matched leaf route at location "${Ae.pathname}${Ae.search}${Ae.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let ue=_M(se&&se.map(ne=>Object.assign({},ne,{params:Object.assign({},N,ne.params),pathname:lo([fe,C.encodeLocation?C.encodeLocation(ne.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:ne.pathname]),pathnameBase:ne.pathnameBase==="/"?fe:lo([fe,C.encodeLocation?C.encodeLocation(ne.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:ne.pathnameBase])})),w,f,v,S);return a&&ue?Re.createElement(wd.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...Ae},navigationType:"POP"}},ue):ue}function pM(){let i=wM(),a=eM(i)?`${i.status} ${i.statusText}`:i instanceof Error?i.message:JSON.stringify(i),f=i instanceof Error?i.stack:null,v="rgba(200,200,200, 0.5)",S={padding:"0.5rem",backgroundColor:v},C={padding:"2px 4px",backgroundColor:v},w=null;return console.error("Error handled by React Router default ErrorBoundary:",i),w=Re.createElement(Re.Fragment,null,Re.createElement("p",null," Hey developer "),Re.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Re.createElement("code",{style:C},"ErrorBoundary")," or"," ",Re.createElement("code",{style:C},"errorElement")," prop on your route.")),Re.createElement(Re.Fragment,null,Re.createElement("h2",null,"Unexpected Application Error!"),Re.createElement("h3",{style:{fontStyle:"italic"}},a),f?Re.createElement("pre",{style:S},f):null,w)}var fM=Re.createElement(pM,null),x2=class extends Re.Component{constructor(i){super(i),this.state={location:i.location,revalidation:i.revalidation,error:i.error}}static getDerivedStateFromError(i){return{error:i}}static getDerivedStateFromProps(i,a){return a.location!==i.location||a.revalidation!=="idle"&&i.revalidation==="idle"?{error:i.error,location:i.location,revalidation:i.revalidation}:{error:i.error!==void 0?i.error:a.error,location:a.location,revalidation:i.revalidation||a.revalidation}}componentDidCatch(i,a){this.props.onError?this.props.onError(i,a):console.error("React Router caught the following error during render",i)}render(){let i=this.state.error;if(this.context&&typeof i=="object"&&i&&"digest"in i&&typeof i.digest=="string"){const f=uM(i.digest);f&&(i=f)}let a=i!==void 0?Re.createElement(ks.Provider,{value:this.props.routeContext},Re.createElement(mv.Provider,{value:i,children:this.props.component})):this.props.children;return this.context?Re.createElement(mM,{error:i},a):a}};x2.contextType=nM;var T_=new WeakMap;function mM({children:i,error:a}){let{basename:f}=Re.useContext($i);if(typeof a=="object"&&a&&"digest"in a&&typeof a.digest=="string"){let v=lM(a.digest);if(v){let S=T_.get(a);if(S)throw S;let C=d2(v.location,f);if(h2&&!T_.get(a))if(C.isExternal||v.reloadDocument)window.location.href=C.absoluteURL||C.to;else{const w=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(C.to,{replace:v.replace}));throw T_.set(a,w),w}return Re.createElement("meta",{httpEquiv:"refresh",content:`0;url=${C.absoluteURL||C.to}`})}}return i}function gM({routeContext:i,match:a,children:f}){let v=Re.useContext(fc);return v&&v.static&&v.staticContext&&(a.route.errorElement||a.route.ErrorBoundary)&&(v.staticContext._deepestRenderedBoundaryId=a.route.id),Re.createElement(ks.Provider,{value:i},f)}function _M(i,a=[],f=null,v=null,S=null){if(i==null){if(!f)return null;if(f.errors)i=f.matches;else if(a.length===0&&!f.initialized&&f.matches.length>0)i=f.matches;else return null}let C=i,w=f==null?void 0:f.errors;if(w!=null){let fe=C.findIndex(pe=>pe.route.id&&(w==null?void 0:w[pe.route.id])!==void 0);zr(fe>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(w).join(",")}`),C=C.slice(0,Math.min(C.length,fe+1))}let c=!1,N=-1;if(f)for(let fe=0;fe<C.length;fe++){let pe=C[fe];if((pe.route.HydrateFallback||pe.route.hydrateFallbackElement)&&(N=fe),pe.route.id){let{loaderData:ye,errors:Ae}=f,we=pe.route.loader&&!ye.hasOwnProperty(pe.route.id)&&(!Ae||Ae[pe.route.id]===void 0);if(pe.route.lazy||we){c=!0,N>=0?C=C.slice(0,N+1):C=[C[0]];break}}}let K=f&&v?(fe,pe)=>{var ye,Ae;v(fe,{location:f.location,params:((Ae=(ye=f.matches)==null?void 0:ye[0])==null?void 0:Ae.params)??{},unstable_pattern:tM(f.matches),errorInfo:pe})}:void 0;return C.reduceRight((fe,pe,ye)=>{let Ae,we=!1,_e=null,se=null;f&&(Ae=w&&pe.route.id?w[pe.route.id]:void 0,_e=pe.route.errorElement||fM,c&&(N<0&&ye===0?(b2("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),we=!0,se=null):N===ye&&(we=!0,se=pe.route.hydrateFallbackElement||null)));let ue=a.concat(C.slice(0,ye+1)),Y=()=>{let ne;return Ae?ne=_e:we?ne=se:pe.route.Component?ne=Re.createElement(pe.route.Component,null):pe.route.element?ne=pe.route.element:ne=fe,Re.createElement(gM,{match:pe,routeContext:{outlet:fe,matches:ue,isDataRoute:f!=null},children:ne})};return f&&(pe.route.ErrorBoundary||pe.route.errorElement||ye===0)?Re.createElement(x2,{location:f.location,revalidation:f.revalidation,component:_e,error:Ae,children:Y(),routeContext:{outlet:null,matches:ue,isDataRoute:!0},onError:K}):Y()},null)}function gv(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function yM(i){let a=Re.useContext(fc);return zr(a,gv(i)),a}function vM(i){let a=Re.useContext(Tm);return zr(a,gv(i)),a}function xM(i){let a=Re.useContext(ks);return zr(a,gv(i)),a}function _v(i){let a=xM(i),f=a.matches[a.matches.length-1];return zr(f.route.id,`${i} can only be used on routes that contain a unique "id"`),f.route.id}function bM(){return _v("useRouteId")}function wM(){var v;let i=Re.useContext(mv),a=vM("useRouteError"),f=_v("useRouteError");return i!==void 0?i:(v=a.errors)==null?void 0:v[f]}function TM(){let{router:i}=yM("useNavigate"),a=_v("useNavigate"),f=Re.useRef(!1);return _2(()=>{f.current=!0}),Re.useCallback(async(S,C={})=>{Ui(f.current,g2),f.current&&(typeof S=="number"?await i.navigate(S):await i.navigate(S,{fromRouteId:a,...C}))},[i,a])}var G1={};function b2(i,a,f){!a&&!G1[i]&&(G1[i]=!0,Ui(!1,f))}Re.memo(SM);function SM({routes:i,future:a,state:f,onError:v}){return v2(i,void 0,f,v,a)}function $h(i){zr(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function PM({basename:i="/",children:a=null,location:f,navigationType:v="POP",navigator:S,static:C=!1,unstable_useTransitions:w}){zr(!Td(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let c=i.replace(/^\/*/,"/"),N=Re.useMemo(()=>({basename:c,navigator:S,static:C,unstable_useTransitions:w,future:{}}),[c,S,C,w]);typeof f=="string"&&(f=pc(f));let{pathname:K="/",search:fe="",hash:pe="",state:ye=null,key:Ae="default"}=f,we=Re.useMemo(()=>{let _e=fo(K,c);return _e==null?null:{location:{pathname:_e,search:fe,hash:pe,state:ye,key:Ae},navigationType:v}},[c,K,fe,pe,ye,Ae,v]);return Ui(we!=null,`<Router basename="${c}"> is not able to match the URL "${K}${fe}${pe}" because it does not start with the basename, so the <Router> won't render anything.`),we==null?null:Re.createElement($i.Provider,{value:N},Re.createElement(wd.Provider,{children:a,value:we}))}function EM({children:i,location:a}){return dM(vy(i),a)}function vy(i,a=[]){let f=[];return Re.Children.forEach(i,(v,S)=>{if(!Re.isValidElement(v))return;let C=[...a,S];if(v.type===Re.Fragment){f.push.apply(f,vy(v.props.children,C));return}zr(v.type===$h,`[${typeof v.type=="string"?v.type:v.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),zr(!v.props.index||!v.props.children,"An index route cannot have child routes.");let w={id:v.props.id||C.join("-"),caseSensitive:v.props.caseSensitive,element:v.props.element,Component:v.props.Component,index:v.props.index,path:v.props.path,middleware:v.props.middleware,loader:v.props.loader,action:v.props.action,hydrateFallbackElement:v.props.hydrateFallbackElement,HydrateFallback:v.props.HydrateFallback,errorElement:v.props.errorElement,ErrorBoundary:v.props.ErrorBoundary,hasErrorBoundary:v.props.hasErrorBoundary===!0||v.props.ErrorBoundary!=null||v.props.errorElement!=null,shouldRevalidate:v.props.shouldRevalidate,handle:v.props.handle,lazy:v.props.lazy};v.props.children&&(w.children=vy(v.props.children,C)),f.push(w)}),f}var Rf="get",Lf="application/x-www-form-urlencoded";function Sm(i){return typeof HTMLElement<"u"&&i instanceof HTMLElement}function CM(i){return Sm(i)&&i.tagName.toLowerCase()==="button"}function MM(i){return Sm(i)&&i.tagName.toLowerCase()==="form"}function IM(i){return Sm(i)&&i.tagName.toLowerCase()==="input"}function kM(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}function AM(i,a){return i.button===0&&(!a||a==="_self")&&!kM(i)}function xy(i=""){return new URLSearchParams(typeof i=="string"||Array.isArray(i)||i instanceof URLSearchParams?i:Object.keys(i).reduce((a,f)=>{let v=i[f];return a.concat(Array.isArray(v)?v.map(S=>[f,S]):[[f,v]])},[]))}function zM(i,a){let f=xy(i);return a&&a.forEach((v,S)=>{f.has(S)||a.getAll(S).forEach(C=>{f.append(S,C)})}),f}var xf=null;function DM(){if(xf===null)try{new FormData(document.createElement("form"),0),xf=!1}catch{xf=!0}return xf}var RM=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function S_(i){return i!=null&&!RM.has(i)?(Ui(!1,`"${i}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Lf}"`),null):i}function LM(i,a){let f,v,S,C,w;if(MM(i)){let c=i.getAttribute("action");v=c?fo(c,a):null,f=i.getAttribute("method")||Rf,S=S_(i.getAttribute("enctype"))||Lf,C=new FormData(i)}else if(CM(i)||IM(i)&&(i.type==="submit"||i.type==="image")){let c=i.form;if(c==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let N=i.getAttribute("formaction")||c.getAttribute("action");if(v=N?fo(N,a):null,f=i.getAttribute("formmethod")||c.getAttribute("method")||Rf,S=S_(i.getAttribute("formenctype"))||S_(c.getAttribute("enctype"))||Lf,C=new FormData(c,i),!DM()){let{name:K,type:fe,value:pe}=i;if(fe==="image"){let ye=K?`${K}.`:"";C.append(`${ye}x`,"0"),C.append(`${ye}y`,"0")}else K&&C.append(K,pe)}}else{if(Sm(i))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');f=Rf,v=null,S=Lf,w=i}return C&&S==="text/plain"&&(w=C,C=void 0),{action:v,method:f.toLowerCase(),encType:S,formData:C,body:w}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function yv(i,a){if(i===!1||i===null||typeof i>"u")throw new Error(a)}function FM(i,a,f,v){let S=typeof i=="string"?new URL(i,typeof window>"u"?"server://singlefetch/":window.location.origin):i;return f?S.pathname.endsWith("/")?S.pathname=`${S.pathname}_.${v}`:S.pathname=`${S.pathname}.${v}`:S.pathname==="/"?S.pathname=`_root.${v}`:a&&fo(S.pathname,a)==="/"?S.pathname=`${a.replace(/\/$/,"")}/_root.${v}`:S.pathname=`${S.pathname.replace(/\/$/,"")}.${v}`,S}async function BM(i,a){if(i.id in a)return a[i.id];try{let f=await import(i.module);return a[i.id]=f,f}catch(f){return console.error(`Error loading route module \`${i.module}\`, reloading page...`),console.error(f),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function OM(i){return i==null?!1:i.href==null?i.rel==="preload"&&typeof i.imageSrcSet=="string"&&typeof i.imageSizes=="string":typeof i.rel=="string"&&typeof i.href=="string"}async function NM(i,a,f){let v=await Promise.all(i.map(async S=>{let C=a.routes[S.route.id];if(C){let w=await BM(C,f);return w.links?w.links():[]}return[]}));return $M(v.flat(1).filter(OM).filter(S=>S.rel==="stylesheet"||S.rel==="preload").map(S=>S.rel==="stylesheet"?{...S,rel:"prefetch",as:"style"}:{...S,rel:"prefetch"}))}function q1(i,a,f,v,S,C){let w=(N,K)=>f[K]?N.route.id!==f[K].route.id:!0,c=(N,K)=>{var fe;return f[K].pathname!==N.pathname||((fe=f[K].route.path)==null?void 0:fe.endsWith("*"))&&f[K].params["*"]!==N.params["*"]};return C==="assets"?a.filter((N,K)=>w(N,K)||c(N,K)):C==="data"?a.filter((N,K)=>{var pe;let fe=v.routes[N.route.id];if(!fe||!fe.hasLoader)return!1;if(w(N,K)||c(N,K))return!0;if(N.route.shouldRevalidate){let ye=N.route.shouldRevalidate({currentUrl:new URL(S.pathname+S.search+S.hash,window.origin),currentParams:((pe=f[0])==null?void 0:pe.params)||{},nextUrl:new URL(i,window.origin),nextParams:N.params,defaultShouldRevalidate:!0});if(typeof ye=="boolean")return ye}return!0}):[]}function jM(i,a,{includeHydrateFallback:f}={}){return VM(i.map(v=>{let S=a.routes[v.route.id];if(!S)return[];let C=[S.module];return S.clientActionModule&&(C=C.concat(S.clientActionModule)),S.clientLoaderModule&&(C=C.concat(S.clientLoaderModule)),f&&S.hydrateFallbackModule&&(C=C.concat(S.hydrateFallbackModule)),S.imports&&(C=C.concat(S.imports)),C}).flat(1))}function VM(i){return[...new Set(i)]}function UM(i){let a={},f=Object.keys(i).sort();for(let v of f)a[v]=i[v];return a}function $M(i,a){let f=new Set;return new Set(a),i.reduce((v,S)=>{let C=JSON.stringify(UM(S));return f.has(C)||(f.add(C),v.push({key:C,link:S})),v},[])}function w2(){let i=Re.useContext(fc);return yv(i,"You must render this element inside a <DataRouterContext.Provider> element"),i}function GM(){let i=Re.useContext(Tm);return yv(i,"You must render this element inside a <DataRouterStateContext.Provider> element"),i}var vv=Re.createContext(void 0);vv.displayName="FrameworkContext";function T2(){let i=Re.useContext(vv);return yv(i,"You must render this element inside a <HydratedRouter> element"),i}function qM(i,a){let f=Re.useContext(vv),[v,S]=Re.useState(!1),[C,w]=Re.useState(!1),{onFocus:c,onBlur:N,onMouseEnter:K,onMouseLeave:fe,onTouchStart:pe}=a,ye=Re.useRef(null);Re.useEffect(()=>{if(i==="render"&&w(!0),i==="viewport"){let _e=ue=>{ue.forEach(Y=>{w(Y.isIntersecting)})},se=new IntersectionObserver(_e,{threshold:.5});return ye.current&&se.observe(ye.current),()=>{se.disconnect()}}},[i]),Re.useEffect(()=>{if(v){let _e=setTimeout(()=>{w(!0)},100);return()=>{clearTimeout(_e)}}},[v]);let Ae=()=>{S(!0)},we=()=>{S(!1),w(!1)};return f?i!=="intent"?[C,ye,{}]:[C,ye,{onFocus:Oh(c,Ae),onBlur:Oh(N,we),onMouseEnter:Oh(K,Ae),onMouseLeave:Oh(fe,we),onTouchStart:Oh(pe,Ae)}]:[!1,ye,{}]}function Oh(i,a){return f=>{i&&i(f),f.defaultPrevented||a(f)}}function ZM({page:i,...a}){let{router:f}=w2(),v=Re.useMemo(()=>s2(f.routes,i,f.basename),[f.routes,i,f.basename]);return v?Re.createElement(HM,{page:i,matches:v,...a}):null}function WM(i){let{manifest:a,routeModules:f}=T2(),[v,S]=Re.useState([]);return Re.useEffect(()=>{let C=!1;return NM(i,a,f).then(w=>{C||S(w)}),()=>{C=!0}},[i,a,f]),v}function HM({page:i,matches:a,...f}){let v=go(),{future:S,manifest:C,routeModules:w}=T2(),{basename:c}=w2(),{loaderData:N,matches:K}=GM(),fe=Re.useMemo(()=>q1(i,a,K,C,v,"data"),[i,a,K,C,v]),pe=Re.useMemo(()=>q1(i,a,K,C,v,"assets"),[i,a,K,C,v]),ye=Re.useMemo(()=>{if(i===v.pathname+v.search+v.hash)return[];let _e=new Set,se=!1;if(a.forEach(Y=>{var Be;let ne=C.routes[Y.route.id];!ne||!ne.hasLoader||(!fe.some(qe=>qe.route.id===Y.route.id)&&Y.route.id in N&&((Be=w[Y.route.id])!=null&&Be.shouldRevalidate)||ne.hasClientLoader?se=!0:_e.add(Y.route.id))}),_e.size===0)return[];let ue=FM(i,c,S.unstable_trailingSlashAwareDataRequests,"data");return se&&_e.size>0&&ue.searchParams.set("_routes",a.filter(Y=>_e.has(Y.route.id)).map(Y=>Y.route.id).join(",")),[ue.pathname+ue.search]},[c,S.unstable_trailingSlashAwareDataRequests,N,v,C,fe,a,i,w]),Ae=Re.useMemo(()=>jM(pe,C),[pe,C]),we=WM(pe);return Re.createElement(Re.Fragment,null,ye.map(_e=>Re.createElement("link",{key:_e,rel:"prefetch",as:"fetch",href:_e,...f})),Ae.map(_e=>Re.createElement("link",{key:_e,rel:"modulepreload",href:_e,...f})),we.map(({key:_e,link:se})=>Re.createElement("link",{key:_e,nonce:f.nonce,...se})))}function XM(...i){return a=>{i.forEach(f=>{typeof f=="function"?f(a):f!=null&&(f.current=a)})}}var YM=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{YM&&(window.__reactRouterVersion="7.12.0")}catch{}function KM({basename:i,children:a,unstable_useTransitions:f,window:v}){let S=Re.useRef();S.current==null&&(S.current=kC({window:v,v5Compat:!0}));let C=S.current,[w,c]=Re.useState({action:C.action,location:C.location}),N=Re.useCallback(K=>{f===!1?c(K):Re.startTransition(()=>c(K))},[f]);return Re.useLayoutEffect(()=>C.listen(N),[C,N]),Re.createElement(PM,{basename:i,children:a,location:w.location,navigationType:w.action,navigator:C,unstable_useTransitions:f})}var S2=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ed=Re.forwardRef(function({onClick:a,discover:f="render",prefetch:v="none",relative:S,reloadDocument:C,replace:w,state:c,target:N,to:K,preventScrollReset:fe,viewTransition:pe,unstable_defaultShouldRevalidate:ye,...Ae},we){let{basename:_e,unstable_useTransitions:se}=Re.useContext($i),ue=typeof K=="string"&&S2.test(K),Y=d2(K,_e);K=Y.to;let ne=cM(K,{relative:S}),[Be,qe,et]=qM(v,Ae),We=tI(K,{replace:w,state:c,target:N,preventScrollReset:fe,relative:S,viewTransition:pe,unstable_defaultShouldRevalidate:ye,unstable_useTransitions:se});function Ke(at){a&&a(at),at.defaultPrevented||We(at)}let _t=Re.createElement("a",{...Ae,...et,href:Y.absoluteURL||ne,onClick:Y.isExternal||C?a:Ke,ref:XM(we,qe),target:N,"data-discover":!ue&&f==="render"?"true":void 0});return Be&&!ue?Re.createElement(Re.Fragment,null,_t,Re.createElement(ZM,{page:ne})):_t});Ed.displayName="Link";var QM=Re.forwardRef(function({"aria-current":a="page",caseSensitive:f=!1,className:v="",end:S=!1,style:C,to:w,viewTransition:c,children:N,...K},fe){let pe=Pd(w,{relative:K.relative}),ye=go(),Ae=Re.useContext(Tm),{navigator:we,basename:_e}=Re.useContext($i),se=Ae!=null&&aI(pe)&&c===!0,ue=we.encodeLocation?we.encodeLocation(pe).pathname:pe.pathname,Y=ye.pathname,ne=Ae&&Ae.navigation&&Ae.navigation.location?Ae.navigation.location.pathname:null;f||(Y=Y.toLowerCase(),ne=ne?ne.toLowerCase():null,ue=ue.toLowerCase()),ne&&_e&&(ne=fo(ne,_e)||ne);const Be=ue!=="/"&&ue.endsWith("/")?ue.length-1:ue.length;let qe=Y===ue||!S&&Y.startsWith(ue)&&Y.charAt(Be)==="/",et=ne!=null&&(ne===ue||!S&&ne.startsWith(ue)&&ne.charAt(ue.length)==="/"),We={isActive:qe,isPending:et,isTransitioning:se},Ke=qe?a:void 0,_t;typeof v=="function"?_t=v(We):_t=[v,qe?"active":null,et?"pending":null,se?"transitioning":null].filter(Boolean).join(" ");let at=typeof C=="function"?C(We):C;return Re.createElement(Ed,{...K,"aria-current":Ke,className:_t,ref:fe,style:at,to:w,viewTransition:c},typeof N=="function"?N(We):N)});QM.displayName="NavLink";var JM=Re.forwardRef(({discover:i="render",fetcherKey:a,navigate:f,reloadDocument:v,replace:S,state:C,method:w=Rf,action:c,onSubmit:N,relative:K,preventScrollReset:fe,viewTransition:pe,unstable_defaultShouldRevalidate:ye,...Ae},we)=>{let{unstable_useTransitions:_e}=Re.useContext($i),se=sI(),ue=oI(c,{relative:K}),Y=w.toLowerCase()==="get"?"get":"post",ne=typeof c=="string"&&S2.test(c),Be=qe=>{if(N&&N(qe),qe.defaultPrevented)return;qe.preventDefault();let et=qe.nativeEvent.submitter,We=(et==null?void 0:et.getAttribute("formmethod"))||w,Ke=()=>se(et||qe.currentTarget,{fetcherKey:a,method:We,navigate:f,replace:S,state:C,relative:K,preventScrollReset:fe,viewTransition:pe,unstable_defaultShouldRevalidate:ye});_e&&f!==!1?Re.startTransition(()=>Ke()):Ke()};return Re.createElement("form",{ref:we,method:Y,action:ue,onSubmit:v?N:Be,...Ae,"data-discover":!ne&&i==="render"?"true":void 0})});JM.displayName="Form";function eI(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function P2(i){let a=Re.useContext(fc);return zr(a,eI(i)),a}function tI(i,{target:a,replace:f,state:v,preventScrollReset:S,relative:C,viewTransition:w,unstable_defaultShouldRevalidate:c,unstable_useTransitions:N}={}){let K=Sd(),fe=go(),pe=Pd(i,{relative:C});return Re.useCallback(ye=>{if(AM(ye,a)){ye.preventDefault();let Ae=f!==void 0?f:gd(fe)===gd(pe),we=()=>K(i,{replace:Ae,state:v,preventScrollReset:S,relative:C,viewTransition:w,unstable_defaultShouldRevalidate:c});N?Re.startTransition(()=>we()):we()}},[fe,K,pe,f,v,a,i,S,C,w,c,N])}function rI(i){Ui(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let a=Re.useRef(xy(i)),f=Re.useRef(!1),v=go(),S=Re.useMemo(()=>zM(v.search,f.current?null:a.current),[v.search]),C=Sd(),w=Re.useCallback((c,N)=>{const K=xy(typeof c=="function"?c(new URLSearchParams(S)):c);f.current=!0,C("?"+K,N)},[C,S]);return[S,w]}var nI=0,iI=()=>`__${String(++nI)}__`;function sI(){let{router:i}=P2("useSubmit"),{basename:a}=Re.useContext($i),f=bM(),v=i.fetch,S=i.navigate;return Re.useCallback(async(C,w={})=>{let{action:c,method:N,encType:K,formData:fe,body:pe}=LM(C,a);if(w.navigate===!1){let ye=w.fetcherKey||iI();await v(ye,f,w.action||c,{unstable_defaultShouldRevalidate:w.unstable_defaultShouldRevalidate,preventScrollReset:w.preventScrollReset,formData:fe,body:pe,formMethod:w.method||N,formEncType:w.encType||K,flushSync:w.flushSync})}else await S(w.action||c,{unstable_defaultShouldRevalidate:w.unstable_defaultShouldRevalidate,preventScrollReset:w.preventScrollReset,formData:fe,body:pe,formMethod:w.method||N,formEncType:w.encType||K,replace:w.replace,state:w.state,fromRouteId:f,flushSync:w.flushSync,viewTransition:w.viewTransition})},[v,S,a,f])}function oI(i,{relative:a}={}){let{basename:f}=Re.useContext($i),v=Re.useContext(ks);zr(v,"useFormAction must be used inside a RouteContext");let[S]=v.matches.slice(-1),C={...Pd(i||".",{relative:a})},w=go();if(i==null){C.search=w.search;let c=new URLSearchParams(C.search),N=c.getAll("index");if(N.some(fe=>fe==="")){c.delete("index"),N.filter(pe=>pe).forEach(pe=>c.append("index",pe));let fe=c.toString();C.search=fe?`?${fe}`:""}}return(!i||i===".")&&S.route.index&&(C.search=C.search?C.search.replace(/^\?/,"?index&"):"?index"),f!=="/"&&(C.pathname=C.pathname==="/"?f:lo([f,C.pathname])),gd(C)}function aI(i,{relative:a}={}){let f=Re.useContext(f2);zr(f!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:v}=P2("useViewTransitionState"),S=Pd(i,{relative:a});if(!f.isTransitioning)return!1;let C=fo(f.currentLocation.pathname,v)||f.currentLocation.pathname,w=fo(f.nextLocation.pathname,v)||f.nextLocation.pathname;return om(S.pathname,w)!=null||om(S.pathname,C)!=null}function lI({maps:i,loading:a}){return a?de.jsxs("div",{className:"flex flex-col items-center justify-center h-screen gap-6 bg-white",children:[de.jsx("div",{className:"w-16 h-16 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"}),de.jsx("p",{className:"text-xl font-semibold text-gray-800",children:"Loading maps..."})]}):de.jsx("div",{className:"flex-1 overflow-y-auto p-8 bg-white",children:de.jsxs("div",{className:"max-w-6xl mx-auto",children:[de.jsxs("div",{className:"mb-8",children:[de.jsx("h1",{className:"text-4xl font-bold text-gray-800 mb-3",children:"Vector Tiles Maps"}),de.jsx("p",{className:"text-gray-600 text-lg",children:"Select a map to view its layers and configurations"})]}),de.jsx("div",{className:"bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden",children:de.jsx("div",{className:"divide-y divide-gray-200",children:i.map(f=>{var v;return de.jsx(Ed,{to:`/map/${f.name}`,className:"block hover:bg-blue-50 transition-colors",children:de.jsxs("div",{className:"px-6 py-4 flex items-center justify-between",children:[de.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[de.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0",children:de.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"currentColor",viewBox:"0 0 20 20",children:de.jsx("path",{d:"M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"})})}),de.jsxs("div",{className:"flex-1 min-w-0",children:[de.jsx("h2",{className:"text-lg font-bold text-gray-800 truncate",children:f.name}),de.jsx("p",{className:"text-sm text-gray-600 truncate",children:f.attribution||"OpenHistoricalMap"})]})]}),de.jsxs("div",{className:"flex items-center gap-6 flex-shrink-0",children:[de.jsxs("div",{className:"text-right",children:[de.jsx("div",{className:"text-sm text-gray-500",children:"Layers"}),de.jsx("div",{className:"text-lg font-bold text-blue-600",children:((v=f.layers)==null?void 0:v.length)||0})]}),de.jsxs("div",{className:"text-right",children:[de.jsx("div",{className:"text-sm text-gray-500",children:"Zoom"}),de.jsxs("div",{className:"text-sm font-semibold text-gray-700",children:[f.minzoom||0," - ",f.maxzoom||20]})]}),de.jsx("div",{className:"text-blue-600",children:de.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:de.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})]})},f.name)})})})]})})}const uI=()=>"production",E2=uI(),cI={api:{capabilitiesBaseUrl:"https://vtiles.staging.openhistoricalmap.org/capabilities",layersInfoUrl:"http://planet-staging.openhistoricalmap.org.s3.amazonaws.com/vtiles_layers_info.json",languagesGeojsonUrl:"http://planet-staging.openhistoricalmap.org.s3.amazonaws.com/vtiles_languages.geojson",mapStyleUrl:"https://www.staging.openhistoricalmap.org/map-styles/historical/historical.json"},links:{openHistoricalMap:"https://staging.openhistoricalmap.org",vectorTiles:"https://vtiles.staging.openhistoricalmap.org",github:{base:"https://github.com/OpenHistoricalMap/ohm-deploy",branch:"staging",tegolaConfigPath:"images/tiler-server"}}},hI={api:{capabilitiesBaseUrl:"https://vtiles.staging.openhistoricalmap.org/capabilities",layersInfoUrl:"https://s3.amazonaws.com/planet.openhistoricalmap.org/vtiles_layers_info.json",languagesGeojsonUrl:"https://planet.openhistoricalmap.org.s3.amazonaws.com/vtiles_languages.geojson",mapStyleUrl:"https://www.openhistoricalmap.org/map-styles/historical/historical.json"},links:{openHistoricalMap:"https://openhistoricalmap.org",vectorTiles:"https://vtiles.openhistoricalmap.org",github:{base:"https://github.com/OpenHistoricalMap/ohm-deploy",branch:"main",tegolaConfigPath:"images/tiler-server"}}},gl=E2==="production"?hI:cI,dI={app:{name:"Vector Tiles Schema",organization:"OpenHistoricalMap"}},is={...dI,api:{...gl.api,getMapCapabilitiesUrl:i=>`${gl.api.capabilitiesBaseUrl}/${i}.json`},links:{...gl.links,github:{...gl.links.github,getTegolaConfigUrl:i=>`${gl.links.github.base}/blob/${gl.links.github.branch}/${gl.links.github.tegolaConfigPath}/${i}`}},environment:E2};function Pm(){const a=go().pathname==="/locales-map";return de.jsx("header",{className:"bg-white border-b border-gray-200 shadow-sm z-50",children:de.jsx("div",{className:"max-w-7xl mx-auto px-6 py-4",children:de.jsxs("div",{className:"flex items-center justify-between",children:[de.jsxs("div",{className:"flex items-center gap-3",children:[de.jsx("div",{className:"w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center",children:de.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:de.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})})}),de.jsxs("div",{children:[de.jsx("h1",{className:"text-xl font-semibold text-gray-900 tracking-tight",children:"Vector Tiles Schema"}),de.jsx("p",{className:"text-xs text-gray-500 font-medium",children:"OpenHistoricalMap"})]})]}),de.jsxs("div",{className:"hidden md:flex items-center gap-6 text-sm text-gray-600",children:[de.jsx("a",{href:is.links.openHistoricalMap,target:"_blank",rel:"noopener noreferrer",className:"hover:text-indigo-600 transition-colors",children:"OpenHistoricalMap"}),de.jsx("span",{className:"text-gray-300",children:"|"}),de.jsx("a",{href:is.links.vectorTiles,target:"_blank",rel:"noopener noreferrer",className:"hover:text-indigo-600 transition-colors",children:"Vector Tiles"}),de.jsx("span",{className:"text-gray-300",children:"|"}),de.jsxs(Ed,{to:"/locales-map",className:`hover:text-indigo-600 transition-colors flex items-center gap-1 ${a?"text-indigo-600 font-medium":""}`,children:[de.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:de.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})}),"Locales Map"]})]})]})})})}function C2({layer:i,layersInfo:a}){if(!i)return de.jsx("div",{className:"flex-1 overflow-y-auto bg-white flex items-center justify-center",children:de.jsx("div",{className:"text-center",children:de.jsx("p",{className:"text-gray-500",children:"Select a layer from the sidebar"})})});a[i.name];const f=S=>{const C=(S||"unknown").toLowerCase().replace("multi","");return C==="point"?"bg-orange-100 text-orange-800":C==="linestring"||C==="line"?"bg-purple-100 text-purple-800":C==="polygon"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"},v=S=>{if(!S)return"unknown";let C=S.replace("multi","");return C.toLowerCase()==="line"&&(C="linestring"),C};return de.jsx("div",{className:"h-full bg-white",children:de.jsxs("div",{className:"max-w-5xl mx-auto px-8 py-6",children:[de.jsxs("div",{className:"mb-6 pb-6 border-b border-gray-200",children:[de.jsx("div",{className:"flex items-start justify-between mb-3",children:de.jsxs("div",{className:"flex-1",children:[de.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:i.name}),de.jsx("p",{className:"text-gray-600 leading-relaxed",children:i.description})]})}),de.jsxs("div",{className:"flex flex-wrap gap-3 items-center mt-4",children:[de.jsx("span",{className:`px-2.5 py-1 rounded text-xs font-semibold uppercase border ${f(i.geometryType)}`,children:v(i.geometryType)}),de.jsxs("span",{className:"text-sm text-gray-500",children:["Map: ",de.jsx("span",{className:"font-medium text-gray-700",children:i.map})]}),de.jsxs("span",{className:"text-sm text-gray-500",children:["Zoom: ",de.jsxs("span",{className:"font-medium text-gray-700",children:["z",i.minzoom,"-",i.maxzoom]})]}),i.filtersPerZoomLevel&&i.filtersPerZoomLevel.length>0&&de.jsxs("span",{className:"text-sm text-gray-500",children:[i.filtersPerZoomLevel.length," configurations"]}),i.tegolaConfig&&de.jsxs("a",{href:is.links.github.getTegolaConfigUrl(i.tegolaConfig),target:"_blank",rel:"noopener noreferrer",className:"px-2.5 py-1 text-xs font-medium text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded border border-blue-300 transition-colors flex items-center gap-1.5",children:[de.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:de.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),"View in GitHub"]})]})]}),de.jsxs("div",{className:"space-y-6",children:[i.details&&i.details.length>0&&de.jsxs("div",{className:"mb-6",children:[de.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Details"}),de.jsx("ul",{className:"space-y-1.5",children:i.details.map((S,C)=>{const w=c=>{const N=/(https?:\/\/[^\s\)]+)/g,K=[];let fe=0,pe;for(N.lastIndex=0;(pe=N.exec(c))!==null;)pe.index>fe&&K.push({type:"text",content:c.substring(fe,pe.index)}),K.push({type:"url",content:pe[0]}),fe=pe.index+pe[0].length;return fe<c.length&&K.push({type:"text",content:c.substring(fe)}),K.length===0?c:K.map((ye,Ae)=>ye.type==="url"?de.jsx("a",{href:ye.content,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline",children:ye.content},Ae):de.jsx("span",{children:ye.content},Ae))};return de.jsxs("li",{className:"flex items-start gap-2 text-gray-700 text-sm",children:[de.jsx("span",{className:"text-gray-400 mt-1.5",children:""}),de.jsx("span",{className:"flex-1",children:w(S)})]},C)})})]}),i.fields&&Object.keys(i.fields).length>0&&(()=>{const S=Object.entries(i.fields),C=S.filter(([c])=>!c.startsWith("name_")),w=S.filter(([c])=>c.startsWith("name_"));return de.jsxs("div",{className:"mb-6",children:[de.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-3",children:["Fields (",Object.keys(i.fields).length,")"]}),de.jsx("div",{className:"border border-gray-200 rounded-lg bg-white",children:de.jsx("div",{className:"max-h-96 overflow-y-auto p-4",children:de.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:[C.map(([c,N])=>de.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded border border-gray-200",children:[de.jsx("code",{className:"text-sm font-medium text-gray-800",children:c}),de.jsx("span",{className:"px-2 py-0.5 bg-gray-200 text-gray-700 rounded text-xs font-medium",children:N})]},c)),w.length>0&&de.jsxs(de.Fragment,{children:[de.jsx("div",{className:"col-span-full my-3",children:de.jsxs("div",{className:"flex items-center gap-3",children:[de.jsx("div",{className:"flex-1 border-t border-gray-300"}),de.jsxs("span",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide",children:["Locale Fields (",w.length,")"]}),de.jsx("div",{className:"flex-1 border-t border-gray-300"})]})}),w.map(([c,N])=>de.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded border border-gray-200",children:[de.jsx("code",{className:"text-sm font-medium text-gray-800",children:c}),de.jsx("span",{className:"px-2 py-0.5 bg-gray-200 text-gray-700 rounded text-xs font-medium",children:N})]},c))]})]})})})]})})(),i.filtersPerZoomLevel&&i.filtersPerZoomLevel.length>0&&de.jsxs("div",{className:"mb-6",children:[de.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Zoom Level Configurations And Filters"}),de.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:de.jsx("div",{className:"overflow-x-auto -mx-0.5",children:de.jsxs("table",{className:"w-full text-sm min-w-full",children:[de.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:de.jsxs("tr",{children:[de.jsx("th",{className:"px-3 py-2.5 text-left font-semibold text-gray-700 text-xs whitespace-nowrap",children:"Zoom"}),de.jsx("th",{className:"px-3 py-2.5 text-left font-semibold text-gray-700 text-xs whitespace-nowrap",children:"Filter"}),de.jsx("th",{className:"px-3 py-2.5 text-left font-semibold text-gray-700 text-xs whitespace-nowrap",children:"Tolerance"}),de.jsx("th",{className:"px-3 py-2.5 text-left font-semibold text-gray-700 text-xs whitespace-nowrap",children:"View"})]})}),de.jsx("tbody",{className:"divide-y divide-gray-200",children:i.filtersPerZoomLevel.map((S,C)=>de.jsxs("tr",{className:"hover:bg-gray-50",children:[de.jsx("td",{className:"px-3 py-2.5 whitespace-nowrap",children:de.jsx("span",{className:"inline-flex items-center px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs font-semibold",children:S.zoom_level})}),de.jsx("td",{className:"px-3 py-2.5",children:S.filter?de.jsx("span",{className:"inline-block text-xs font-mono text-gray-700 cursor-help",title:S.filter,children:S.filter}):de.jsx("span",{className:"text-gray-400 text-xs",children:"-"})}),de.jsx("td",{className:"px-3 py-2.5 whitespace-nowrap",children:S.tolerance?de.jsx("span",{className:"text-xs text-gray-700",children:S.tolerance}):de.jsx("span",{className:"text-gray-400 text-xs",children:"-"})}),de.jsx("td",{className:"px-3 py-2.5 whitespace-nowrap",children:de.jsx("code",{className:"text-xs text-gray-700 font-mono",children:S.view_name})})]},C))})]})})})]}),i.tiles&&i.tiles.length>0&&de.jsxs("div",{className:"mb-6",children:[de.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Tiles URL"}),de.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded p-3 overflow-x-auto",children:de.jsx("code",{className:"text-sm font-mono text-gray-800 break-all",children:i.tiles[0]})})]})]})]})})}function pI({allLayers:i,layersInfo:a,maps:f}){const{mapName:v}=y2(),S=Sd(),[C,w]=rI(),[c,N]=Re.useState(null),K=f.find(we=>we.name===v),fe=i.filter(we=>we.map===v);Re.useEffect(()=>{if(fe.length===0)return;const we=C.get("layer");if(we){const se=fe.find(ue=>ue.name===we);if(se){N(se);return}}const _e=fe[0];N(_e),w({layer:_e.name},{replace:!0})},[fe,C,w]);const pe=we=>{N(we),w({layer:we.name})},ye=we=>{const _e=(we||"unknown").toLowerCase().replace("multi","");return _e==="point"?"bg-orange-100 text-orange-700 border-orange-300":_e==="linestring"||_e==="line"?"bg-purple-100 text-purple-700 border-purple-300":_e==="polygon"?"bg-blue-100 text-blue-700 border-blue-300":"bg-gray-100 text-gray-700 border-gray-300"},Ae=we=>{if(!we)return"?";let _e=we.replace("multi","");return _e.toLowerCase()==="line"&&(_e="linestring"),_e};return K?de.jsxs("div",{className:"flex flex-col h-screen overflow-hidden bg-white",children:[de.jsx(Pm,{}),de.jsxs("div",{className:"flex-1 overflow-hidden flex",children:[de.jsxs("div",{className:"w-80 bg-white shadow-xl border-r border-gray-200 flex flex-col",children:[de.jsxs("div",{className:"p-4 border-b border-gray-200 bg-white",children:[de.jsxs("button",{onClick:()=>S("/"),className:"mb-3 flex items-center gap-2 text-blue-600 hover:text-blue-700 font-semibold text-sm",children:[de.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:de.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Back to Maps"]}),de.jsxs("div",{children:[de.jsx("h1",{className:"text-xl font-bold text-gray-800",children:K.name}),de.jsx("p",{className:"text-sm text-gray-600",children:K.attribution||"OpenHistoricalMap"}),de.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[fe.length," layers"]})]})]}),de.jsx("div",{className:"flex-1 overflow-y-auto",children:de.jsx("div",{className:"divide-y divide-gray-200",children:fe.map(we=>de.jsxs("button",{onClick:()=>pe(we),className:`w-full px-4 py-3 text-left hover:bg-gray-50 transition-colors relative ${(c==null?void 0:c.id)===we.id?"bg-blue-50 border-l-4 border-l-blue-600":""}`,children:[de.jsx("span",{className:`absolute top-2 right-2 px-1 py-0.5 rounded text-[9px] font-semibold uppercase border ${ye(we.geometryType)}`,children:Ae(we.geometryType)}),de.jsx("div",{className:"flex items-center gap-3",children:de.jsxs("div",{className:"flex-1 min-w-0 pr-12",children:[de.jsx("div",{className:"text-sm font-semibold text-gray-800 truncate",children:we.name}),de.jsxs("div",{className:"flex items-center gap-2 mt-1 flex-wrap",children:[de.jsxs("span",{className:"text-xs text-gray-500",children:["z",we.minzoom,"-",we.maxzoom]}),we.fields&&Object.keys(we.fields).length>0&&de.jsxs("span",{className:"text-xs text-gray-500",children:[Object.keys(we.fields).length," fields"]})]})]})})]},we.id))})})]}),de.jsx("div",{className:"flex-1 overflow-y-auto",children:de.jsx(C2,{layer:c,layersInfo:a})})]})]}):de.jsxs("div",{className:"flex flex-col items-center justify-center h-screen gap-4",children:[de.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Map not found"}),de.jsx("button",{onClick:()=>S("/"),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Back to Maps"})]})}function fI({allLayers:i,layersInfo:a}){const{mapName:f,layerName:v}=y2(),S=Sd(),C=i.find(c=>c.map===f&&c.name===v),w=()=>{const c=window.location.href;navigator.clipboard.writeText(c),alert(`Link copied to clipboard!
${c}`)};return C?de.jsxs("div",{className:"flex flex-col h-screen overflow-hidden bg-white",children:[de.jsx(Pm,{}),de.jsxs("div",{className:"flex-1 overflow-hidden",children:[de.jsx("div",{className:"bg-white border-b border-gray-200 px-8 py-4",children:de.jsxs("div",{className:"max-w-6xl mx-auto flex items-center justify-between",children:[de.jsxs("div",{className:"flex items-center gap-4",children:[de.jsx("button",{onClick:()=>S("/"),className:"text-gray-600 hover:text-blue-600 font-semibold text-sm",children:"Maps"}),de.jsx("span",{className:"text-gray-400",children:"/"}),de.jsx(Ed,{to:`/map/${f}`,className:"text-gray-600 hover:text-blue-600 font-semibold text-sm",children:f}),de.jsx("span",{className:"text-gray-400",children:"/"}),de.jsx("span",{className:"text-gray-800 font-semibold text-sm",children:v})]}),de.jsxs("button",{onClick:w,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-semibold",children:[de.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:de.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})}),"Share Link"]})]})}),de.jsx(C2,{layer:C,layersInfo:a})]})]}):de.jsxs("div",{className:"flex flex-col items-center justify-center h-screen gap-4",children:[de.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Layer not found"}),de.jsx("button",{onClick:()=>S(`/map/${f}`),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Back to Layers"})]})}var M2={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.16.0/LICENSE.txt
 */(function(i,a){(function(f,v){i.exports=v()})(rP,function(){var f={},v={};function S(w,c,N){if(v[w]=N,w==="index"){var K="var sharedModule = {}; ("+v.shared+")(sharedModule); ("+v.worker+")(sharedModule);",fe={};return v.shared(fe),v.index(f,fe),typeof window<"u"&&f.setWorkerUrl(window.URL.createObjectURL(new Blob([K],{type:"text/javascript"}))),f}}S("shared",["exports"],function(w){function c(n,e,r,o){return new(r||(r=Promise))(function(u,d){function p(T){try{x(o.next(T))}catch(E){d(E)}}function _(T){try{x(o.throw(T))}catch(E){d(E)}}function x(T){var E;T.done?u(T.value):(E=T.value,E instanceof r?E:new r(function(I){I(E)})).then(p,_)}x((o=o.apply(n,e||[])).next())})}function N(n,e){this.x=n,this.y=e}function K(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var fe,pe;typeof SuppressedError=="function"&&SuppressedError,N.prototype={clone(){return new N(this.x,this.y)},add(n){return this.clone()._add(n)},sub(n){return this.clone()._sub(n)},multByPoint(n){return this.clone()._multByPoint(n)},divByPoint(n){return this.clone()._divByPoint(n)},mult(n){return this.clone()._mult(n)},div(n){return this.clone()._div(n)},rotate(n){return this.clone()._rotate(n)},rotateAround(n,e){return this.clone()._rotateAround(n,e)},matMult(n){return this.clone()._matMult(n)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(n){return this.x===n.x&&this.y===n.y},dist(n){return Math.sqrt(this.distSqr(n))},distSqr(n){const e=n.x-this.x,r=n.y-this.y;return e*e+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith(n){return this.angleWithSep(n.x,n.y)},angleWithSep(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult(n){const e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add(n){return this.x+=n.x,this.y+=n.y,this},_sub(n){return this.x-=n.x,this.y-=n.y,this},_mult(n){return this.x*=n,this.y*=n,this},_div(n){return this.x/=n,this.y/=n,this},_multByPoint(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint(n){return this.x/=n.x,this.y/=n.y,this},_unit(){return this._div(this.mag()),this},_perp(){const n=this.y;return this.y=this.x,this.x=-n,this},_rotate(n){const e=Math.cos(n),r=Math.sin(n),o=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=o,this},_rotateAround(n,e){const r=Math.cos(n),o=Math.sin(n),u=e.y+o*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-o*(this.y-e.y),this.y=u,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:N},N.convert=function(n){if(n instanceof N)return n;if(Array.isArray(n))return new N(+n[0],+n[1]);if(n.x!==void 0&&n.y!==void 0)return new N(+n.x,+n.y);throw new Error("Expected [x, y] or {x, y} point format")};var ye=function(){if(pe)return fe;function n(e,r,o,u){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(u-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=o,this.p2y=u}return pe=1,fe=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,u=0;u<8;u++){var d=this.sampleCurveX(o)-e;if(Math.abs(d)<r)return o;var p=this.sampleCurveDerivativeX(o);if(Math.abs(p)<1e-6)break;o-=d/p}var _=0,x=1;for(o=e,u=0;u<20&&(d=this.sampleCurveX(o),!(Math.abs(d-e)<r));u++)e>d?_=o:x=o,o=.5*(x-_)+_;return o},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},fe}(),Ae=K(ye);let we,_e;function se(){return we==null&&(we=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),we}function ue(){if(_e==null&&(_e=!1,se())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let o=0;o<5*5;o++){const u=4*o;e.fillStyle=`rgb(${u},${u+1},${u+2})`,e.fillRect(o%5,Math.floor(o/5),1,1)}const r=e.getImageData(0,0,5,5).data;for(let o=0;o<5*5*4;o++)if(o%4!=3&&r[o]!==o){_e=!0;break}}}return _e||!1}var Y=1e-6,ne=typeof Float32Array<"u"?Float32Array:Array;function Be(){var n=new ne(9);return ne!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function qe(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function et(){var n=new ne(3);return ne!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function We(n){var e=n[0],r=n[1],o=n[2];return Math.sqrt(e*e+r*r+o*o)}function Ke(n,e,r){var o=new ne(3);return o[0]=n,o[1]=e,o[2]=r,o}function _t(n,e,r){return n[0]=e[0]+r[0],n[1]=e[1]+r[1],n[2]=e[2]+r[2],n}function at(n,e,r){return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n}function Qt(n,e,r){var o=e[0],u=e[1],d=e[2],p=r[0],_=r[1],x=r[2];return n[0]=u*x-d*_,n[1]=d*p-o*x,n[2]=o*_-u*p,n}var br,jr=We;function Xn(n,e,r){var o=e[0],u=e[1],d=e[2],p=e[3];return n[0]=r[0]*o+r[4]*u+r[8]*d+r[12]*p,n[1]=r[1]*o+r[5]*u+r[9]*d+r[13]*p,n[2]=r[2]*o+r[6]*u+r[10]*d+r[14]*p,n[3]=r[3]*o+r[7]*u+r[11]*d+r[15]*p,n}function Gi(){var n=new ne(4);return ne!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function ls(n,e,r,o){var u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",d=Math.PI/360;e*=d,o*=d,r*=d;var p=Math.sin(e),_=Math.cos(e),x=Math.sin(r),T=Math.cos(r),E=Math.sin(o),I=Math.cos(o);switch(u){case"xyz":n[0]=p*T*I+_*x*E,n[1]=_*x*I-p*T*E,n[2]=_*T*E+p*x*I,n[3]=_*T*I-p*x*E;break;case"xzy":n[0]=p*T*I-_*x*E,n[1]=_*x*I-p*T*E,n[2]=_*T*E+p*x*I,n[3]=_*T*I+p*x*E;break;case"yxz":n[0]=p*T*I+_*x*E,n[1]=_*x*I-p*T*E,n[2]=_*T*E-p*x*I,n[3]=_*T*I+p*x*E;break;case"yzx":n[0]=p*T*I+_*x*E,n[1]=_*x*I+p*T*E,n[2]=_*T*E-p*x*I,n[3]=_*T*I-p*x*E;break;case"zxy":n[0]=p*T*I-_*x*E,n[1]=_*x*I+p*T*E,n[2]=_*T*E+p*x*I,n[3]=_*T*I-p*x*E;break;case"zyx":n[0]=p*T*I-_*x*E,n[1]=_*x*I+p*T*E,n[2]=_*T*E-p*x*I,n[3]=_*T*I+p*x*E;break;default:throw new Error("Unknown angle order "+u)}return n}function en(){var n=new ne(2);return ne!=Float32Array&&(n[0]=0,n[1]=0),n}function ot(n,e){var r=new ne(2);return r[0]=n,r[1]=e,r}et(),br=new ne(4),ne!=Float32Array&&(br[0]=0,br[1]=0,br[2]=0,br[3]=0),et(),Ke(1,0,0),Ke(0,1,0),Gi(),Gi(),Be(),en();const st=8192;function vt(n,e,r){return e*(st/(n.tileSize*Math.pow(2,r-n.tileID.overscaledZ)))}function Lt(n,e){return(n%e+e)%e}function rr(n,e,r){return n*(1-r)+e*r}function Ii(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,r=e*n;return 4*(n<.5?r:3*(n-e)+r-.75)}function mn(n,e,r,o){const u=new Ae(n,e,r,o);return d=>u.solve(d)}const Rr=mn(.25,.1,.25,1);function Vr(n,e,r){return Math.min(r,Math.max(e,n))}function Mn(n,e,r){const o=r-e,u=((n-e)%o+o)%o+e;return u===e?r:u}function gn(n,...e){for(const r of e)for(const o in r)n[o]=r[o];return n}let As=1;function ui(n,e,r){const o={};for(const u in n)o[u]=e.call(this,n[u],u,n);return o}function ya(n,e,r){const o={};for(const u in n)e.call(this,n[u],u,n)&&(o[u]=n[u]);return o}function ci(n){return Array.isArray(n)?n.map(ci):typeof n=="object"&&n?ui(n,ci):n}const va={};function qr(n){va[n]||(typeof console<"u"&&console.warn(n),va[n]=!0)}function Yn(n,e,r){return(r.y-n.y)*(e.x-n.x)>(e.y-n.y)*(r.x-n.x)}function ki(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let dr=null;function us(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const zs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function _o(n,e,r,o,u){return c(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const d=new VideoFrame(n,{timestamp:0});try{const p=d==null?void 0:d.format;if(!p||!p.startsWith("BGR")&&!p.startsWith("RGB"))throw new Error(`Unrecognized format ${p}`);const _=p.startsWith("BGR"),x=new Uint8ClampedArray(o*u*4);if(yield d.copyTo(x,function(T,E,I,A,z){const L=4*Math.max(-E,0),F=(Math.max(0,I)-I)*A*4+L,O=4*A,$=Math.max(0,E),J=Math.max(0,I);return{rect:{x:$,y:J,width:Math.min(T.width,E+A)-$,height:Math.min(T.height,I+z)-J},layout:[{offset:F,stride:O}]}}(n,e,r,o,u)),_)for(let T=0;T<x.length;T+=4){const E=x[T];x[T]=x[T+2],x[T+2]=E}return x}finally{d.close()}})}let cs,hi;function yo(n,e,r,o){return n.addEventListener(e,r,o),{unsubscribe:()=>{n.removeEventListener(e,r,o)}}}function vo(n){return n*Math.PI/180}function In(n){return n/Math.PI*180}const xe={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},V={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},j="AbortError";class q extends Error{constructor(e=j){super(e instanceof Error?e.message:e),this.name=j,e instanceof Error&&e.stack&&(this.stack=e.stack)}}function le(n){return n.name===j}const he={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Te(n){return he.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const ve="global-dispatcher";class me extends Error{constructor(e,r,o,u){super(`AJAXError: ${r} (${e}): ${o}`),this.status=e,this.statusText=r,this.url=o,this.body=u}}const Ie=()=>ki(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ve=function(n,e){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const o=Te(n.url);if(o)return o(n,e);if(ki(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:ve},e)}if(!(/^file:/.test(r=n.url)||/^file:/.test(Ie())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(o,u){return c(this,void 0,void 0,function*(){const d=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:Ie(),signal:u.signal});let p,_;o.type!=="json"||d.headers.has("Accept")||d.headers.set("Accept","application/json");try{p=yield fetch(d)}catch(T){throw le(T)?T:new me(0,T.message,o.url,new Blob)}if(!p.ok){const T=yield p.blob();throw new me(p.status,p.statusText,o.url,T)}_=o.type==="arrayBuffer"||o.type==="image"?p.arrayBuffer():o.type==="json"?p.json():p.text();const x=yield _;return u.signal.throwIfAborted(),{data:x,cacheControl:p.headers.get("Cache-Control"),expires:p.headers.get("Expires")}})}(n,e);if(ki(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:ve},e)}var r;return function(o,u){return new Promise((d,p)=>{var _;const x=new XMLHttpRequest;x.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(x.responseType="arraybuffer");for(const T in o.headers)x.setRequestHeader(T,o.headers[T]);o.type==="json"&&(x.responseType="text",!((_=o.headers)===null||_===void 0)&&_.Accept||x.setRequestHeader("Accept","application/json")),x.withCredentials=o.credentials==="include",x.onerror=()=>{p(new Error(x.statusText))},x.onload=()=>{if(!u.signal.aborted)if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let T=x.response;if(o.type==="json")try{T=JSON.parse(x.response)}catch(E){return void p(E)}d({data:T,cacheControl:x.getResponseHeader("Cache-Control"),expires:x.getResponseHeader("Expires")})}else{const T=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});p(new me(x.status,x.statusText,o.url,T))}},u.signal.addEventListener("abort",()=>{x.abort(),p(new q(u.signal.reason))}),x.send(o.body)})}(n,e)};function Fe(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const e=new URL(n),r=window.location;return e.protocol===r.protocol&&e.host===r.host}function tt(n,e,r){r[n]&&r[n].indexOf(e)!==-1||(r[n]=r[n]||[],r[n].push(e))}function lt(n,e,r){if(r&&r[n]){const o=r[n].indexOf(e);o!==-1&&r[n].splice(o,1)}}class ft{constructor(e,r={}){gn(this,r),this.type=e}}class jt extends ft{constructor(e,r={}){super("error",gn({error:e},r))}}class zt{on(e,r){return this._listeners=this._listeners||{},tt(e,r,this._listeners),{unsubscribe:()=>{this.off(e,r)}}}off(e,r){return lt(e,r,this._listeners),lt(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},tt(e,r,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,r){typeof e=="string"&&(e=new ft(e,r||{}));const o=e.type;if(this.listens(o)){e.target=this;const u=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const _ of u)_.call(this,e);const d=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const _ of d)lt(o,_,this._oneTimeListeners),_.call(this,e);const p=this._eventedParent;p&&(gn(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof jt&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var Pe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const Ut=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function tn(n,e){const r={};for(const o in n)o!=="ref"&&(r[o]=n[o]);return Ut.forEach(o=>{o in e&&(r[o]=e[o])}),r}function mt(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(!mt(n[r],e[r]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const r in n)if(!mt(n[r],e[r]))return!1;return!0}return n===e}function Ot(n,e){n.push(e)}function rn(n,e,r){Ot(r,{command:"addSource",args:[n,e[n]]})}function Jt(n,e,r){Ot(e,{command:"removeSource",args:[n]}),r[n]=!0}function pr(n,e,r,o){Jt(n,r,o),rn(n,e,r)}function $t(n,e,r){let o;for(o in n[r])if(Object.prototype.hasOwnProperty.call(n[r],o)&&o!=="data"&&!mt(n[r][o],e[r][o]))return!1;for(o in e[r])if(Object.prototype.hasOwnProperty.call(e[r],o)&&o!=="data"&&!mt(n[r][o],e[r][o]))return!1;return!0}function Lr(n,e,r,o,u,d){n=n||{},e=e||{};for(const p in n)Object.prototype.hasOwnProperty.call(n,p)&&(mt(n[p],e[p])||r.push({command:d,args:[o,p,e[p],u]}));for(const p in e)Object.prototype.hasOwnProperty.call(e,p)&&!Object.prototype.hasOwnProperty.call(n,p)&&(mt(n[p],e[p])||r.push({command:d,args:[o,p,e[p],u]}))}function xa(n){return n.id}function ba(n,e){return n[e.id]=e,n}class Ue{constructor(e,r,o,u){this.message=(e?`${e}: `:"")+o,u&&(this.identifier=u),r!=null&&r.__line__&&(this.line=r.__line__)}}function _n(n,...e){for(const r of e)for(const o in r)n[o]=r[o];return n}class yn extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Al{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[o,u]of r)this.bindings[o]=u}concat(e){return new Al(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Kn={kind:"null"},Qe={kind:"number"},wt={kind:"string"},Tt={kind:"boolean"},Nn={kind:"color"},zl={kind:"projectionDefinition"},qi={kind:"object"},xt={kind:"value"},wa={kind:"collator"},Ta={kind:"formatted"},Dl={kind:"padding"},xo={kind:"colorArray"},Sa={kind:"numberArray"},bo={kind:"resolvedImage"},Pa={kind:"variableAnchorOffsetCollection"};function vn(n,e){return{kind:"array",itemType:n,N:e}}function Nt(n){if(n.kind==="array"){const e=Nt(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const Rl=[Kn,Qe,wt,Tt,Nn,zl,Ta,qi,vn(xt),Dl,Sa,xo,bo,Pa];function wo(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!wo(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const r of Rl)if(!wo(r,e))return null}}return`Expected ${Nt(n)} but found ${Nt(e)} instead.`}function Ea(n,e){return e.some(r=>r.kind===n.kind)}function Ds(n,e){return e.some(r=>r==="null"?n===null:r==="array"?Array.isArray(n):r==="object"?n&&!Array.isArray(n)&&typeof n=="object":r===typeof n)}function di(n,e){return n.kind==="array"&&e.kind==="array"?n.itemType.kind===e.itemType.kind&&typeof n.N=="number":n.kind===e.kind}const Cd=.96422,Rs=.82521,Ll=4/29,fr=6/29,Md=3*fr*fr,Id=fr*fr*fr,Ca=Math.PI/180,kd=180/Math.PI;function Ad(n){return(n%=360)<0&&(n+=360),n}function zd([n,e,r,o]){let u,d;const p=mc((.2225045*(n=Fl(n))+.7168786*(e=Fl(e))+.0606169*(r=Fl(r)))/1);n===e&&e===r?u=d=p:(u=mc((.4360747*n+.3850649*e+.1430804*r)/Cd),d=mc((.0139322*n+.0971045*e+.7141733*r)/Rs));const _=116*p-16;return[_<0?0:_,500*(u-p),200*(p-d),o]}function Fl(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function mc(n){return n>Id?Math.pow(n,1/3):n/Md+Ll}function gc([n,e,r,o]){let u=(n+16)/116,d=isNaN(e)?u:u+e/500,p=isNaN(r)?u:u-r/200;return u=1*yc(u),d=Cd*yc(d),p=Rs*yc(p),[_c(3.1338561*d-1.6168667*u-.4906146*p),_c(-.9787684*d+1.9161415*u+.033454*p),_c(.0719453*d-.2289914*u+1.4052427*p),o]}function _c(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function yc(n){return n>fr?n*n*n:Md*(n-Ll)}const Em=Object.hasOwn||function(n,e){return Object.prototype.hasOwnProperty.call(n,e)};function Ma(n,e){return Em(n,e)?n[e]:void 0}function Bl(n){return parseInt(n.padEnd(2,n),16)/255}function Dd(n,e){return To(e?n/100:n,0,1)}function To(n,e,r){return Math.min(Math.max(e,n),r)}function vc(n){return!n.some(Number.isNaN)}const Ia={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function hs(n,e,r){return n+r*(e-n)}function So(n,e,r){return n.map((o,u)=>hs(o,e[u],r))}class St{constructor(e,r,o,u=1,d=!0){this.r=e,this.g=r,this.b=o,this.a=u,d||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[e,r,o,u]))}static parse(e){if(e instanceof St)return e;if(typeof e!="string")return;const r=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const u=Ma(Ia,o);if(u){const[p,_,x]=u;return[p/255,_/255,x/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const p=o.length<6?1:2;let _=1;return[Bl(o.slice(_,_+=p)),Bl(o.slice(_,_+=p)),Bl(o.slice(_,_+=p)),Bl(o.slice(_,_+p)||"ff")]}if(o.startsWith("rgb")){const p=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[_,x,T,E,I,A,z,L,F,O,$,J]=p,G=[E||" ",z||" ",O].join("");if(G==="  "||G==="  /"||G===",,"||G===",,,"){const Z=[T,A,F].join(""),te=Z==="%%%"?100:Z===""?255:0;if(te){const oe=[To(+x/te,0,1),To(+I/te,0,1),To(+L/te,0,1),$?Dd(+$,J):1];if(vc(oe))return oe}}return}}const d=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(d){const[p,_,x,T,E,I,A,z,L]=d,F=[x||" ",E||" ",A].join("");if(F==="  "||F==="  /"||F===",,"||F===",,,"){const O=[+_,To(+T,0,100),To(+I,0,100),z?Dd(+z,L):1];if(vc(O))return function([$,J,G,Z]){function te(oe){const be=(oe+$/30)%12,Le=J*Math.min(G,1-G);return G-Le*Math.max(-1,Math.min(be-3,9-be,1))}return $=Ad($),J/=100,G/=100,[te(0),te(8),te(4),Z]}(O)}}}(e);return r?new St(...r,!1):void 0}get rgb(){const{r:e,g:r,b:o,a:u}=this,d=u||1/0;return this.overwriteGetter("rgb",[e/d,r/d,o/d,u])}get hcl(){return this.overwriteGetter("hcl",function(e){const[r,o,u,d]=zd(e),p=Math.sqrt(o*o+u*u);return[Math.round(1e4*p)?Ad(Math.atan2(u,o)*kd):NaN,p,r,d]}(this.rgb))}get lab(){return this.overwriteGetter("lab",zd(this.rgb))}overwriteGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}toString(){const[e,r,o,u]=this.rgb;return`rgba(${[e,r,o].map(d=>Math.round(255*d)).join(",")},${u})`}static interpolate(e,r,o,u="rgb"){switch(u){case"rgb":{const[d,p,_,x]=So(e.rgb,r.rgb,o);return new St(d,p,_,x,!1)}case"hcl":{const[d,p,_,x]=e.hcl,[T,E,I,A]=r.hcl;let z,L;if(isNaN(d)||isNaN(T))isNaN(d)?isNaN(T)?z=NaN:(z=T,_!==1&&_!==0||(L=E)):(z=d,I!==1&&I!==0||(L=p));else{let G=T-d;T>d&&G>180?G-=360:T<d&&d-T>180&&(G+=360),z=d+o*G}const[F,O,$,J]=function([G,Z,te,oe]){return G=isNaN(G)?0:G*Ca,gc([te,Math.cos(G)*Z,Math.sin(G)*Z,oe])}([z,L??hs(p,E,o),hs(_,I,o),hs(x,A,o)]);return new St(F,O,$,J,!1)}case"lab":{const[d,p,_,x]=gc(So(e.lab,r.lab,o));return new St(d,p,_,x,!1)}}}}St.black=new St(0,0,0,1),St.white=new St(1,1,1,1),St.transparent=new St(0,0,0,0),St.red=new St(1,0,0,1);class xc{constructor(e,r,o){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Cm=["bottom","center","top"];class bc{constructor(e,r,o,u,d,p){this.text=e,this.image=r,this.scale=o,this.fontStack=u,this.textColor=d,this.verticalAlign=p}}class kn{constructor(e){this.sections=e}static fromString(e){return new kn([new bc(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof kn?e:kn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class ln{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ln)return e;if(typeof e=="number")return new ln([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new ln(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,r,o){return new ln(So(e.values,r.values,o))}}class lr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof lr)return e;if(typeof e=="number")return new lr([e]);if(Array.isArray(e)){for(const r of e)if(typeof r!="number")return;return new lr(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,r,o){return new lr(So(e.values,r.values,o))}}class pt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof pt)return e;if(typeof e=="string"){const o=St.parse(e);return o?new pt([o]):void 0}if(!Array.isArray(e))return;const r=[];for(const o of e){if(typeof o!="string")return;const u=St.parse(o);if(!u)return;r.push(u)}return new pt(r)}toString(){return JSON.stringify(this.values)}static interpolate(e,r,o,u="rgb"){const d=[];if(e.values.length!=r.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${r.values.length}), cannot interpolate.`);for(let p=0;p<e.values.length;p++)d.push(St.interpolate(e.values[p],r.values[p],o,u));return new pt(d)}}class Gt extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const ds=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class xn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof xn)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let r=0;r<e.length;r+=2){const o=e[r],u=e[r+1];if(typeof o!="string"||!ds.has(o)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new xn(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,r,o){const u=e.values,d=r.values;if(u.length!==d.length)throw new Gt(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${r.toString()}`);const p=[];for(let _=0;_<u.length;_+=2){if(u[_]!==d[_])throw new Gt(`Cannot interpolate values containing mismatched anchors. from[${_}]: ${u[_]}, to[${_}]: ${d[_]}`);p.push(u[_]);const[x,T]=u[_+1],[E,I]=d[_+1];p.push([hs(x,E,o),hs(T,I,o)])}return new xn(p)}}class jn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new jn({name:e,available:!1}):null}}class bn{constructor(e,r,o){this.from=e,this.to=r,this.transition=o}static interpolate(e,r,o){return new bn(e,r,o)}static parse(e){return e instanceof bn?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new bn(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new bn(e.from,e.to,e.transition):typeof e=="string"?new bn(e,e,1):void 0}}function Po(n,e,r,o){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[n,e,r,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[n,e,r,o]:[n,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ps(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof bn||n instanceof St||n instanceof xc||n instanceof kn||n instanceof ln||n instanceof lr||n instanceof pt||n instanceof xn||n instanceof jn)return!0;if(Array.isArray(n)){for(const e of n)if(!ps(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!ps(n[e]))return!1;return!0}return!1}function wr(n){if(n===null)return Kn;if(typeof n=="string")return wt;if(typeof n=="boolean")return Tt;if(typeof n=="number")return Qe;if(n instanceof St)return Nn;if(n instanceof bn)return zl;if(n instanceof xc)return wa;if(n instanceof kn)return Ta;if(n instanceof ln)return Dl;if(n instanceof lr)return Sa;if(n instanceof pt)return xo;if(n instanceof xn)return Pa;if(n instanceof jn)return bo;if(Array.isArray(n)){const e=n.length;let r;for(const o of n){const u=wr(o);if(r){if(r===u)continue;r=xt;break}r=u}return vn(r||xt,e)}return qi}function Ls(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof St||n instanceof bn||n instanceof kn||n instanceof ln||n instanceof lr||n instanceof pt||n instanceof xn||n instanceof jn?n.toString():JSON.stringify(n)}class Ai{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ps(e[1]))return r.error("invalid value");const o=e[1];let u=wr(o);const d=r.expectedType;return u.kind!=="array"||u.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(u=d),new Ai(u,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Ol={string:wt,number:Qe,boolean:Tt,object:qi};class An{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let o,u=1;const d=e[0];if(d==="array"){let _,x;if(e.length>2){const T=e[1];if(typeof T!="string"||!(T in Ol)||T==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);_=Ol[T],u++}else _=xt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);x=e[2],u++}o=vn(_,x)}else{if(!Ol[d])throw new Error(`Types doesn't contain name = ${d}`);o=Ol[d]}const p=[];for(;u<e.length;u++){const _=r.parse(e[u],u,xt);if(!_)return null;p.push(_)}return new An(o,p)}evaluate(e){for(let r=0;r<this.args.length;r++){const o=this.args[r].evaluate(e);if(!wo(this.type,wr(o)))return o;if(r===this.args.length-1)throw new Gt(`Expected value to be of type ${Nt(this.type)}, but found ${Nt(wr(o))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Fs={"to-boolean":Tt,"to-color":Nn,"to-number":Qe,"to-string":wt};class Zi{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const o=e[0];if(!Fs[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return r.error("Expected one argument.");const u=Fs[o],d=[];for(let p=1;p<e.length;p++){const _=r.parse(e[p],p,xt);if(!_)return null;d.push(_)}return new Zi(u,d)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let r,o;for(const u of this.args){if(r=u.evaluate(e),o=null,r instanceof St)return r;if(typeof r=="string"){const d=e.parseColor(r);if(d)return d}else if(Array.isArray(r)&&(o=r.length<3||r.length>4?`Invalid rgba value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Po(r[0],r[1],r[2],r[3]),!o))return new St(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Gt(o||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const o of this.args){r=o.evaluate(e);const u=ln.parse(r);if(u)return u}throw new Gt(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"numberArray":{let r;for(const o of this.args){r=o.evaluate(e);const u=lr.parse(r);if(u)return u}throw new Gt(`Could not parse numberArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"colorArray":{let r;for(const o of this.args){r=o.evaluate(e);const u=pt.parse(r);if(u)return u}throw new Gt(`Could not parse colorArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const o of this.args){r=o.evaluate(e);const u=xn.parse(r);if(u)return u}throw new Gt(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const o of this.args){if(r=o.evaluate(e),r===null)return 0;const u=Number(r);if(!isNaN(u))return u}throw new Gt(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return kn.fromString(Ls(this.args[0].evaluate(e)));case"resolvedImage":return jn.fromString(Ls(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return Ls(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Rd=["Unknown","Point","LineString","Polygon"];class wc{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Rd[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache.get(e);return r||(r=St.parse(e),this._parseColorCache.set(e,r)),r}}class Bs{constructor(e,r,o=[],u,d=new Al,p=[]){this.registry=e,this.path=o,this.key=o.map(_=>`[${_}]`).join(""),this.scope=d,this.errors=p,this.expectedType=u,this._isConstant=r}parse(e,r,o,u,d={}){return r?this.concat(r,o,u)._parse(e,d):this._parse(e,d)}_parse(e,r){function o(u,d,p){return p==="assert"?new An(d,[u]):p==="coerce"?new Zi(d,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const d=this.registry[u];if(d){let p=d.parse(e,this);if(!p)return null;if(this.expectedType){const _=this.expectedType,x=p.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||x.kind!=="value"){if(_.kind==="projectionDefinition"&&["string","array"].includes(x.kind)||["color","formatted","resolvedImage"].includes(_.kind)&&["value","string"].includes(x.kind)||["padding","numberArray"].includes(_.kind)&&["value","number","array"].includes(x.kind)||_.kind==="colorArray"&&["value","string","array"].includes(x.kind)||_.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(x.kind))p=o(p,_,r.typeAnnotation||"coerce");else if(this.checkSubtype(_,x))return null}else p=o(p,_,r.typeAnnotation||"assert")}if(!(p instanceof Ai)&&p.type.kind!=="resolvedImage"&&this._isConstant(p)){const _=new wc;try{p=new Ai(p.type,p.evaluate(_))}catch(x){return this.error(x.message),null}}return p}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,o){const u=typeof e=="number"?this.path.concat(e):this.path,d=o?this.scope.concat(o):this.scope;return new Bs(this.registry,this._isConstant,u,r||null,d,this.errors)}error(e,...r){const o=`${this.key}${r.map(u=>`[${u}]`).join("")}`;this.errors.push(new yn(o,e))}checkSubtype(e,r){const o=wo(e,r);return o&&this.error(o),o}}class qt{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let d=1;d<e.length-1;d+=2){const p=e[d];if(typeof p!="string")return r.error(`Expected string, but found ${typeof p} instead.`,d);if(/[^a-zA-Z0-9_]/.test(p))return r.error("Variable names must contain only alphanumeric characters or '_'.",d);const _=r.parse(e[d+1],d+1);if(!_)return null;o.push([p,_])}const u=r.parse(e[e.length-1],e.length-1,r.expectedType,o);return u?new qt(o,u):null}outputDefined(){return this.result.outputDefined()}}class Eo{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const o=e[1];return r.scope.has(o)?new Eo(o,r.scope.get(o)):r.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Mt{constructor(e,r,o){this.type=e,this.index=r,this.input=o}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,Qe),u=r.parse(e[2],2,vn(r.expectedType||xt));return o&&u?new Mt(u.type.itemType,o,u):null}evaluate(e){const r=this.index.evaluate(e),o=this.input.evaluate(e);if(r<0)throw new Gt(`Array index out of bounds: ${r} < 0.`);if(r>=o.length)throw new Gt(`Array index out of bounds: ${r} > ${o.length-1}.`);if(r!==Math.floor(r))throw new Gt(`Array index must be an integer, but found ${r} instead.`);return o[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class bt{constructor(e,r){this.type=Tt,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,xt),u=r.parse(e[2],2,xt);return o&&u?Ea(o.type,[Tt,wt,Qe,Kn,xt])?new bt(o,u):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Nt(o.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!Ds(r,["boolean","string","number","null"]))throw new Gt(`Expected first argument to be of type boolean, string, number or null, but found ${Nt(wr(r))} instead.`);if(!Ds(o,["string","array"]))throw new Gt(`Expected second argument to be of type array or string, but found ${Nt(wr(o))} instead.`);return o.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Co{constructor(e,r,o){this.type=Qe,this.needle=e,this.haystack=r,this.fromIndex=o}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,xt),u=r.parse(e[2],2,xt);if(!o||!u)return null;if(!Ea(o.type,[Tt,wt,Qe,Kn,xt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Nt(o.type)} instead`);if(e.length===4){const d=r.parse(e[3],3,Qe);return d?new Co(o,u,d):null}return new Co(o,u)}evaluate(e){const r=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Ds(r,["boolean","string","number","null"]))throw new Gt(`Expected first argument to be of type boolean, string, number or null, but found ${Nt(wr(r))} instead.`);let u;if(this.fromIndex&&(u=this.fromIndex.evaluate(e)),Ds(o,["string"])){const d=o.indexOf(r,u);return d===-1?-1:[...o.slice(0,d)].length}if(Ds(o,["array"]))return o.indexOf(r,u);throw new Gt(`Expected second argument to be of type array or string, but found ${Nt(wr(o))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class It{constructor(e,r,o,u,d,p){this.inputType=e,this.type=r,this.input=o,this.cases=u,this.outputs=d,this.otherwise=p}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let o,u;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);const d={},p=[];for(let T=2;T<e.length-1;T+=2){let E=e[T];const I=e[T+1];Array.isArray(E)||(E=[E]);const A=r.concat(T);if(E.length===0)return A.error("Expected at least one branch label.");for(const L of E){if(typeof L!="number"&&typeof L!="string")return A.error("Branch labels must be numbers or strings.");if(typeof L=="number"&&Math.abs(L)>Number.MAX_SAFE_INTEGER)return A.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof L=="number"&&Math.floor(L)!==L)return A.error("Numeric branch labels must be integer values.");if(o){if(A.checkSubtype(o,wr(L)))return null}else o=wr(L);if(d[String(L)]!==void 0)return A.error("Branch labels must be unique.");d[String(L)]=p.length}const z=r.parse(I,T,u);if(!z)return null;u=u||z.type,p.push(z)}const _=r.parse(e[1],1,xt);if(!_)return null;const x=r.parse(e[e.length-1],e.length-1,u);return x?_.type.kind!=="value"&&r.concat(1).checkSubtype(o,_.type)?null:new It(o,u,_,d,p,x):null}evaluate(e){const r=this.input.evaluate(e);return(wr(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class ka{constructor(e,r,o){this.type=e,this.branches=r,this.otherwise=o}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let o;r.expectedType&&r.expectedType.kind!=="value"&&(o=r.expectedType);const u=[];for(let p=1;p<e.length-1;p+=2){const _=r.parse(e[p],p,Tt);if(!_)return null;const x=r.parse(e[p+1],p+1,o);if(!x)return null;u.push([_,x]),o=o||x.type}const d=r.parse(e[e.length-1],e.length-1,o);if(!d)return null;if(!o)throw new Error("Can't infer output type");return new ka(o,u,d)}evaluate(e){for(const[r,o]of this.branches)if(r.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,o]of this.branches)e(r),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class Qn{constructor(e,r,o,u){this.type=e,this.input=r,this.beginIndex=o,this.endIndex=u}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,xt),u=r.parse(e[2],2,Qe);if(!o||!u)return null;if(!Ea(o.type,[vn(xt),wt,xt]))return r.error(`Expected first argument to be of type array or string, but found ${Nt(o.type)} instead`);if(e.length===4){const d=r.parse(e[3],3,Qe);return d?new Qn(o.type,o,u,d):null}return new Qn(o.type,o,u)}evaluate(e){const r=this.input.evaluate(e),o=this.beginIndex.evaluate(e);let u;if(this.endIndex&&(u=this.endIndex.evaluate(e)),Ds(r,["string"]))return[...r].slice(o,u).join("");if(Ds(r,["array"]))return r.slice(o,u);throw new Gt(`Expected first argument to be of type array or string, but found ${Nt(wr(r))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Mo(n,e){const r=n.length-1;let o,u,d=0,p=r,_=0;for(;d<=p;)if(_=Math.floor((d+p)/2),o=n[_],u=n[_+1],o<=e){if(_===r||e<u)return _;d=_+1}else{if(!(o>e))throw new Gt("Input is not a number.");p=_-1}return 0}class fs{constructor(e,r,o){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[u,d]of o)this.labels.push(u),this.outputs.push(d)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const o=r.parse(e[1],1,Qe);if(!o)return null;const u=[];let d=null;r.expectedType&&r.expectedType.kind!=="value"&&(d=r.expectedType);for(let p=1;p<e.length;p+=2){const _=p===1?-1/0:e[p],x=e[p+1],T=p,E=p+1;if(typeof _!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(u.length&&u[u.length-1][0]>=_)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const I=r.parse(x,E,d);if(!I)return null;d=d||I.type,u.push([_,I])}return new fs(d,o,u)}evaluate(e){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return o[0].evaluate(e);const d=r.length;return u>=r[d-1]?o[d-1].evaluate(e):o[Mo(r,u)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Ld(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Aa,Tc,Mm=function(){if(Tc)return Aa;function n(e,r,o,u){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(u-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=o,this.p2y=u}return Tc=1,Aa=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,u=0;u<8;u++){var d=this.sampleCurveX(o)-e;if(Math.abs(d)<r)return o;var p=this.sampleCurveDerivativeX(o);if(Math.abs(p)<1e-6)break;o-=d/p}var _=0,x=1;for(o=e,u=0;u<20&&(d=this.sampleCurveX(o),!(Math.abs(d-e)<r));u++)e>d?_=o:x=o,o=.5*(x-_)+_;return o},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},Aa}(),Fd=Ld(Mm);class wn{constructor(e,r,o,u,d){this.type=e,this.operator=r,this.interpolation=o,this.input=u,this.labels=[],this.outputs=[];for(const[p,_]of d)this.labels.push(p),this.outputs.push(_)}static interpolationFactor(e,r,o,u){let d=0;if(e.name==="exponential")d=zi(r,e.base,o,u);else if(e.name==="linear")d=zi(r,1,o,u);else if(e.name==="cubic-bezier"){const p=e.controlPoints;d=new Fd(p[0],p[1],p[2],p[3]).solve(zi(r,1,o,u))}return d}static parse(e,r){let[o,u,d,...p]=e;if(!Array.isArray(u)||u.length===0)return r.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const T=u[1];if(typeof T!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:T}}else{if(u[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const T=u.slice(1);if(T.length!==4||T.some(E=>typeof E!="number"||E<0||E>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:T}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(d=r.parse(d,2,Qe),!d)return null;const _=[];let x=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||r.expectedType==xo?r.expectedType&&r.expectedType.kind!=="value"&&(x=r.expectedType):x=Nn;for(let T=0;T<p.length;T+=2){const E=p[T],I=p[T+1],A=T+3,z=T+4;if(typeof E!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(_.length&&_[_.length-1][0]>=E)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',A);const L=r.parse(I,z,x);if(!L)return null;x=x||L.type,_.push([E,L])}return di(x,Qe)||di(x,zl)||di(x,Nn)||di(x,Dl)||di(x,Sa)||di(x,xo)||di(x,Pa)||di(x,vn(Qe))?new wn(x,o,u,d,_):r.error(`Type ${Nt(x)} is not interpolatable.`)}evaluate(e){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return o[0].evaluate(e);const d=r.length;if(u>=r[d-1])return o[d-1].evaluate(e);const p=Mo(r,u),_=wn.interpolationFactor(this.interpolation,u,r[p],r[p+1]),x=o[p].evaluate(e),T=o[p+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return hs(x,T,_);case"color":return St.interpolate(x,T,_);case"padding":return ln.interpolate(x,T,_);case"colorArray":return pt.interpolate(x,T,_);case"numberArray":return lr.interpolate(x,T,_);case"variableAnchorOffsetCollection":return xn.interpolate(x,T,_);case"array":return So(x,T,_);case"projectionDefinition":return bn.interpolate(x,T,_)}case"interpolate-hcl":switch(this.type.kind){case"color":return St.interpolate(x,T,_,"hcl");case"colorArray":return pt.interpolate(x,T,_,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return St.interpolate(x,T,_,"lab");case"colorArray":return pt.interpolate(x,T,_,"lab")}}}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function zi(n,e,r,o){const u=o-r,d=n-r;return u===0?0:e===1?d/u:(Math.pow(e,d)-1)/(Math.pow(e,u)-1)}const nr={color:St.interpolate,number:hs,padding:ln.interpolate,numberArray:lr.interpolate,colorArray:pt.interpolate,variableAnchorOffsetCollection:xn.interpolate,array:So};class Os{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let o=null;const u=r.expectedType;u&&u.kind!=="value"&&(o=u);const d=[];for(const _ of e.slice(1)){const x=r.parse(_,1+d.length,o,void 0,{typeAnnotation:"omit"});if(!x)return null;o=o||x.type,d.push(x)}if(!o)throw new Error("No output type");const p=u&&d.some(_=>wo(u,_.type));return new Os(p?xt:o,d)}evaluate(e){let r,o=null,u=0;for(const d of this.args)if(u++,o=d.evaluate(e),o&&o instanceof jn&&!o.available&&(r||(r=o.name),o=null,u===this.args.length&&(o=r)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function Sc(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function za(n,e,r,o){return o.compare(e,r)===0}function mr(n,e,r){const o=n!=="=="&&n!=="!=";return class I2{constructor(d,p,_){this.type=Tt,this.lhs=d,this.rhs=p,this.collator=_,this.hasUntypedArgument=d.type.kind==="value"||p.type.kind==="value"}static parse(d,p){if(d.length!==3&&d.length!==4)return p.error("Expected two or three arguments.");const _=d[0];let x=p.parse(d[1],1,xt);if(!x)return null;if(!Sc(_,x.type))return p.concat(1).error(`"${_}" comparisons are not supported for type '${Nt(x.type)}'.`);let T=p.parse(d[2],2,xt);if(!T)return null;if(!Sc(_,T.type))return p.concat(2).error(`"${_}" comparisons are not supported for type '${Nt(T.type)}'.`);if(x.type.kind!==T.type.kind&&x.type.kind!=="value"&&T.type.kind!=="value")return p.error(`Cannot compare types '${Nt(x.type)}' and '${Nt(T.type)}'.`);o&&(x.type.kind==="value"&&T.type.kind!=="value"?x=new An(T.type,[x]):x.type.kind!=="value"&&T.type.kind==="value"&&(T=new An(x.type,[T])));let E=null;if(d.length===4){if(x.type.kind!=="string"&&T.type.kind!=="string"&&x.type.kind!=="value"&&T.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(E=p.parse(d[3],3,wa),!E)return null}return new I2(x,T,E)}evaluate(d){const p=this.lhs.evaluate(d),_=this.rhs.evaluate(d);if(o&&this.hasUntypedArgument){const x=wr(p),T=wr(_);if(x.kind!==T.kind||x.kind!=="string"&&x.kind!=="number")throw new Gt(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${x.kind}, ${T.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const x=wr(p),T=wr(_);if(x.kind!=="string"||T.kind!=="string")return e(d,p,_)}return this.collator?r(d,p,_,this.collator.evaluate(d)):e(d,p,_)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}}}const Bd=mr("==",function(n,e,r){return e===r},za),Pc=mr("!=",function(n,e,r){return e!==r},function(n,e,r,o){return!za(0,e,r,o)}),Od=mr("<",function(n,e,r){return e<r},function(n,e,r,o){return o.compare(e,r)<0}),Im=mr(">",function(n,e,r){return e>r},function(n,e,r,o){return o.compare(e,r)>0}),Io=mr("<=",function(n,e,r){return e<=r},function(n,e,r,o){return o.compare(e,r)<=0}),Nl=mr(">=",function(n,e,r){return e>=r},function(n,e,r,o){return o.compare(e,r)>=0});class ko{constructor(e,r,o){this.type=wa,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return r.error("Collator options argument must be an object.");const u=r.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Tt);if(!u)return null;const d=r.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Tt);if(!d)return null;let p=null;return o.locale&&(p=r.parse(o.locale,1,wt),!p)?null:new ko(u,d,p)}evaluate(e){return new xc(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class Ec{constructor(e,r,o,u,d){this.type=wt,this.number=e,this.locale=r,this.currency=o,this.minFractionDigits=u,this.maxFractionDigits=d}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const o=r.parse(e[1],1,Qe);if(!o)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return r.error("NumberFormat options argument must be an object.");let d=null;if(u.locale&&(d=r.parse(u.locale,1,wt),!d))return null;let p=null;if(u.currency&&(p=r.parse(u.currency,1,wt),!p))return null;let _=null;if(u["min-fraction-digits"]&&(_=r.parse(u["min-fraction-digits"],1,Qe),!_))return null;let x=null;return u["max-fraction-digits"]&&(x=r.parse(u["max-fraction-digits"],1,Qe),!x)?null:new Ec(o,d,p,_,x)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Da{constructor(e){this.type=Ta,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return r.error("First argument must be an image or text section.");const u=[];let d=!1;for(let p=1;p<=e.length-1;++p){const _=e[p];if(d&&typeof _=="object"&&!Array.isArray(_)){d=!1;let x=null;if(_["font-scale"]&&(x=r.parse(_["font-scale"],1,Qe),!x))return null;let T=null;if(_["text-font"]&&(T=r.parse(_["text-font"],1,vn(wt)),!T))return null;let E=null;if(_["text-color"]&&(E=r.parse(_["text-color"],1,Nn),!E))return null;let I=null;if(_["vertical-align"]){if(typeof _["vertical-align"]=="string"&&!Cm.includes(_["vertical-align"]))return r.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${_["vertical-align"]}' instead.`);if(I=r.parse(_["vertical-align"],1,wt),!I)return null}const A=u[u.length-1];A.scale=x,A.font=T,A.textColor=E,A.verticalAlign=I}else{const x=r.parse(e[p],1,xt);if(!x)return null;const T=x.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,u.push({content:x,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Da(u)}evaluate(e){return new kn(this.sections.map(r=>{const o=r.content.evaluate(e);return wr(o)===bo?new bc("",o,null,null,null,r.verticalAlign?r.verticalAlign.evaluate(e):null):new bc(Ls(o),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null,r.verticalAlign?r.verticalAlign.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor),r.verticalAlign&&e(r.verticalAlign)}outputDefined(){return!1}}class Ao{constructor(e){this.type=bo,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const o=r.parse(e[1],1,wt);return o?new Ao(o):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),o=jn.fromString(r);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(r)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class zo{constructor(e){this.type=Qe,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=r.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Nt(o.type)} instead.`):new zo(o):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new Gt(`Expected value to be of type string or array, but found ${Nt(wr(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Fr=8192;function Nd(n,e){const r=(180+n[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(r*u*Fr),Math.round(o*u*Fr)]}function Do(n,e){const r=Math.pow(2,e.z);return[(u=(n[0]/Fr+e.x)/r,360*u-180),(o=(n[1]/Fr+e.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,u}function Ra(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function Ns(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function km(n,e,r){const o=n[0]-e[0],u=n[1]-e[1],d=n[0]-r[0],p=n[1]-r[1];return o*p-d*u==0&&o*d<=0&&u*p<=0}function jl(n,e,r,o){return(u=[o[0]-r[0],o[1]-r[1]])[0]*(d=[e[0]-n[0],e[1]-n[1]])[1]-u[1]*d[0]!=0&&!(!Cc(n,e,r,o)||!Cc(r,o,n,e));var u,d}function Am(n,e,r){for(const o of r)for(let u=0;u<o.length-1;++u)if(jl(n,e,o[u],o[u+1]))return!0;return!1}function Ro(n,e,r=!1){let o=!1;for(const _ of e)for(let x=0;x<_.length-1;x++){if(km(n,_[x],_[x+1]))return r;(d=_[x])[1]>(u=n)[1]!=(p=_[x+1])[1]>u[1]&&u[0]<(p[0]-d[0])*(u[1]-d[1])/(p[1]-d[1])+d[0]&&(o=!o)}var u,d,p;return o}function Vl(n,e){for(const r of e)if(Ro(n,r))return!0;return!1}function jd(n,e){for(const r of n)if(!Ro(r,e))return!1;for(let r=0;r<n.length-1;++r)if(Am(n[r],n[r+1],e))return!1;return!0}function Vd(n,e){for(const r of e)if(jd(n,r))return!0;return!1}function Cc(n,e,r,o){const u=o[0]-r[0],d=o[1]-r[1],p=(n[0]-r[0])*d-u*(n[1]-r[1]),_=(e[0]-r[0])*d-u*(e[1]-r[1]);return p>0&&_<0||p<0&&_>0}function Mc(n,e,r){const o=[];for(let u=0;u<n.length;u++){const d=[];for(let p=0;p<n[u].length;p++){const _=Nd(n[u][p],r);Ra(e,_),d.push(_)}o.push(d)}return o}function Ic(n,e,r){const o=[];for(let u=0;u<n.length;u++){const d=Mc(n[u],e,r);o.push(d)}return o}function Ud(n,e,r,o){if(n[0]<r[0]||n[0]>r[2]){const u=.5*o;let d=n[0]-r[0]>u?-o:r[0]-n[0]>u?o:0;d===0&&(d=n[0]-r[2]>u?-o:r[2]-n[0]>u?o:0),n[0]+=d}Ra(e,n)}function $d(n,e,r,o){const u=Math.pow(2,o.z)*Fr,d=[o.x*Fr,o.y*Fr],p=[];for(const _ of n)for(const x of _){const T=[x.x+d[0],x.y+d[1]];Ud(T,e,r,u),p.push(T)}return p}function Gd(n,e,r,o){const u=Math.pow(2,o.z)*Fr,d=[o.x*Fr,o.y*Fr],p=[];for(const x of n){const T=[];for(const E of x){const I=[E.x+d[0],E.y+d[1]];Ra(e,I),T.push(I)}p.push(T)}if(e[2]-e[0]<=u/2){(_=e)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const x of p)for(const T of x)Ud(T,e,r,u)}var _;return p}class js{constructor(e,r){this.type=Tt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ps(e[1])){const o=e[1];if(o.type==="FeatureCollection"){const u=[];for(const d of o.features){const{type:p,coordinates:_}=d.geometry;p==="Polygon"&&u.push(_),p==="MultiPolygon"&&u.push(..._)}if(u.length)return new js(o,{type:"MultiPolygon",coordinates:u})}else if(o.type==="Feature"){const u=o.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new js(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new js(o,o)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,o){const u=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(o.type==="Polygon"){const _=Mc(o.coordinates,d,p),x=$d(r.geometry(),u,d,p);if(!Ns(u,d))return!1;for(const T of x)if(!Ro(T,_))return!1}if(o.type==="MultiPolygon"){const _=Ic(o.coordinates,d,p),x=$d(r.geometry(),u,d,p);if(!Ns(u,d))return!1;for(const T of x)if(!Vl(T,_))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,o){const u=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(o.type==="Polygon"){const _=Mc(o.coordinates,d,p),x=Gd(r.geometry(),u,d,p);if(!Ns(u,d))return!1;for(const T of x)if(!jd(T,_))return!1}if(o.type==="MultiPolygon"){const _=Ic(o.coordinates,d,p),x=Gd(r.geometry(),u,d,p);if(!Ns(u,d))return!1;for(const T of x)if(!Vd(T,_))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let qd=class{constructor(n=[],e=(r,o)=>r<o?-1:r>o?1:0){if(this.data=n,this.length=this.data.length,this.compare=e,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:e,compare:r}=this,o=e[n];for(;n>0;){const u=n-1>>1,d=e[u];if(r(o,d)>=0)break;e[n]=d,n=u}e[n]=o}_down(n){const{data:e,compare:r}=this,o=this.length>>1,u=e[n];for(;n<o;){let d=1+(n<<1);const p=d+1;if(p<this.length&&r(e[p],e[d])<0&&(d=p),r(e[d],u)>=0)break;e[n]=e[d],n=d}e[n]=u}};function kc(n,e,r=0,o=n.length-1,u=Zd){for(;o>r;){if(o-r>600){const x=o-r+1,T=e-r+1,E=Math.log(x),I=.5*Math.exp(2*E/3),A=.5*Math.sqrt(E*I*(x-I)/x)*(T-x/2<0?-1:1);kc(n,e,Math.max(r,Math.floor(e-T*I/x+A)),Math.min(o,Math.floor(e+(x-T)*I/x+A)),u)}const d=n[e];let p=r,_=o;for(Lo(n,r,e),u(n[o],d)>0&&Lo(n,r,o);p<_;){for(Lo(n,p,_),p++,_--;u(n[p],d)<0;)p++;for(;u(n[_],d)>0;)_--}u(n[r],d)===0?Lo(n,r,_):(_++,Lo(n,_,o)),_<=e&&(r=_+1),e<=_&&(o=_-1)}}function Lo(n,e,r){const o=n[e];n[e]=n[r],n[r]=o}function Zd(n,e){return n<e?-1:n>e?1:0}function Ul(n,e){if(n.length<=1)return[n];const r=[];let o,u;for(const d of n){const p=Dm(d);p!==0&&(d.area=Math.abs(p),u===void 0&&(u=p<0),u===p<0?(o&&r.push(o),o=[d]):o.push(d))}if(o&&r.push(o),e>1)for(let d=0;d<r.length;d++)r[d].length<=e||(kc(r[d],e,1,r[d].length-1,zm),r[d]=r[d].slice(0,e));return r}function zm(n,e){return e.area-n.area}function Dm(n){let e=0;for(let r,o,u=0,d=n.length,p=d-1;u<d;p=u++)r=n[u],o=n[p],e+=(o.x-r.x)*(r.y+o.y);return e}const Wd=1/298.257223563,La=Wd*(2-Wd),Hd=Math.PI/180;class Ac{constructor(e){const r=6378.137*Hd*1e3,o=Math.cos(e*Hd),u=1/(1-La*(1-o*o)),d=Math.sqrt(u);this.kx=r*d*o,this.ky=r*d*u*(1-La)}distance(e,r){const o=this.wrap(e[0]-r[0])*this.kx,u=(e[1]-r[1])*this.ky;return Math.sqrt(o*o+u*u)}pointOnLine(e,r){let o,u,d,p,_=1/0;for(let x=0;x<e.length-1;x++){let T=e[x][0],E=e[x][1],I=this.wrap(e[x+1][0]-T)*this.kx,A=(e[x+1][1]-E)*this.ky,z=0;I===0&&A===0||(z=(this.wrap(r[0]-T)*this.kx*I+(r[1]-E)*this.ky*A)/(I*I+A*A),z>1?(T=e[x+1][0],E=e[x+1][1]):z>0&&(T+=I/this.kx*z,E+=A/this.ky*z)),I=this.wrap(r[0]-T)*this.kx,A=(r[1]-E)*this.ky;const L=I*I+A*A;L<_&&(_=L,o=T,u=E,d=x,p=z)}return{point:[o,u],index:d,t:Math.max(0,Math.min(1,p))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function Xd(n,e){return e[0]-n[0]}function $l(n){return n[1]-n[0]+1}function pi(n,e){return n[1]>=n[0]&&n[1]<e}function Gl(n,e){if(n[0]>n[1])return[null,null];const r=$l(n);if(e){if(r===2)return[n,null];const u=Math.floor(r/2);return[[n[0],n[0]+u],[n[0]+u,n[1]]]}if(r===1)return[n,null];const o=Math.floor(r/2)-1;return[[n[0],n[0]+o],[n[0]+o+1,n[1]]]}function zc(n,e){if(!pi(e,n.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let o=e[0];o<=e[1];++o)Ra(r,n[o]);return r}function Dc(n){const e=[1/0,1/0,-1/0,-1/0];for(const r of n)for(const o of r)Ra(e,o);return e}function Rc(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function ql(n,e,r){if(!Rc(n)||!Rc(e))return NaN;let o=0,u=0;return n[2]<e[0]&&(o=e[0]-n[2]),n[0]>e[2]&&(o=n[0]-e[2]),n[1]>e[3]&&(u=n[1]-e[3]),n[3]<e[1]&&(u=e[1]-n[3]),r.distance([0,0],[o,u])}function Vs(n,e,r){const o=r.pointOnLine(e,n);return r.distance(n,o.point)}function Lc(n,e,r,o,u){const d=Math.min(Vs(n,[r,o],u),Vs(e,[r,o],u)),p=Math.min(Vs(r,[n,e],u),Vs(o,[n,e],u));return Math.min(d,p)}function Rm(n,e,r,o,u){if(!pi(e,n.length)||!pi(o,r.length))return 1/0;let d=1/0;for(let p=e[0];p<e[1];++p){const _=n[p],x=n[p+1];for(let T=o[0];T<o[1];++T){const E=r[T],I=r[T+1];if(jl(_,x,E,I))return 0;d=Math.min(d,Lc(_,x,E,I,u))}}return d}function Yd(n,e,r,o,u){if(!pi(e,n.length)||!pi(o,r.length))return NaN;let d=1/0;for(let p=e[0];p<=e[1];++p)for(let _=o[0];_<=o[1];++_)if(d=Math.min(d,u.distance(n[p],r[_])),d===0)return d;return d}function Lm(n,e,r){if(Ro(n,e,!0))return 0;let o=1/0;for(const u of e){const d=u[0],p=u[u.length-1];if(d!==p&&(o=Math.min(o,Vs(n,[p,d],r)),o===0))return o;const _=r.pointOnLine(u,n);if(o=Math.min(o,r.distance(n,_.point)),o===0)return o}return o}function Fm(n,e,r,o){if(!pi(e,n.length))return NaN;for(let d=e[0];d<=e[1];++d)if(Ro(n[d],r,!0))return 0;let u=1/0;for(let d=e[0];d<e[1];++d){const p=n[d],_=n[d+1];for(const x of r)for(let T=0,E=x.length,I=E-1;T<E;I=T++){const A=x[I],z=x[T];if(jl(p,_,A,z))return 0;u=Math.min(u,Lc(p,_,A,z,o))}}return u}function Kd(n,e){for(const r of n)for(const o of r)if(Ro(o,e,!0))return!0;return!1}function Bm(n,e,r,o=1/0){const u=Dc(n),d=Dc(e);if(o!==1/0&&ql(u,d,r)>=o)return o;if(Ns(u,d)){if(Kd(n,e))return 0}else if(Kd(e,n))return 0;let p=1/0;for(const _ of n)for(let x=0,T=_.length,E=T-1;x<T;E=x++){const I=_[E],A=_[x];for(const z of e)for(let L=0,F=z.length,O=F-1;L<F;O=L++){const $=z[O],J=z[L];if(jl(I,A,$,J))return 0;p=Math.min(p,Lc(I,A,$,J,r))}}return p}function Dt(n,e,r,o,u,d){if(!d)return;const p=ql(zc(o,d),u,r);p<e&&n.push([p,d,[0,0]])}function Zl(n,e,r,o,u,d,p){if(!d||!p)return;const _=ql(zc(o,d),zc(u,p),r);_<e&&n.push([_,d,p])}function Wl(n,e,r,o,u=1/0){let d=Math.min(o.distance(n[0],r[0][0]),u);if(d===0)return d;const p=new qd([[0,[0,n.length-1],[0,0]]],Xd),_=Dc(r);for(;p.length>0;){const x=p.pop();if(x[0]>=d)continue;const T=x[1],E=e?50:100;if($l(T)<=E){if(!pi(T,n.length))return NaN;if(e){const I=Fm(n,T,r,o);if(isNaN(I)||I===0)return I;d=Math.min(d,I)}else for(let I=T[0];I<=T[1];++I){const A=Lm(n[I],r,o);if(d=Math.min(d,A),d===0)return 0}}else{const I=Gl(T,e);Dt(p,d,o,n,_,I[0]),Dt(p,d,o,n,_,I[1])}}return d}function Hl(n,e,r,o,u,d=1/0){let p=Math.min(d,u.distance(n[0],r[0]));if(p===0)return p;const _=new qd([[0,[0,n.length-1],[0,r.length-1]]],Xd);for(;_.length>0;){const x=_.pop();if(x[0]>=p)continue;const T=x[1],E=x[2],I=e?50:100,A=o?50:100;if($l(T)<=I&&$l(E)<=A){if(!pi(T,n.length)&&pi(E,r.length))return NaN;let z;if(e&&o)z=Rm(n,T,r,E,u),p=Math.min(p,z);else if(e&&!o){const L=n.slice(T[0],T[1]+1);for(let F=E[0];F<=E[1];++F)if(z=Vs(r[F],L,u),p=Math.min(p,z),p===0)return p}else if(!e&&o){const L=r.slice(E[0],E[1]+1);for(let F=T[0];F<=T[1];++F)if(z=Vs(n[F],L,u),p=Math.min(p,z),p===0)return p}else z=Yd(n,T,r,E,u),p=Math.min(p,z)}else{const z=Gl(T,e),L=Gl(E,o);Zl(_,p,u,n,r,z[0],L[0]),Zl(_,p,u,n,r,z[0],L[1]),Zl(_,p,u,n,r,z[1],L[0]),Zl(_,p,u,n,r,z[1],L[1])}}return p}function Fc(n){return n.type==="MultiPolygon"?n.coordinates.map(e=>({type:"Polygon",coordinates:e})):n.type==="MultiLineString"?n.coordinates.map(e=>({type:"LineString",coordinates:e})):n.type==="MultiPoint"?n.coordinates.map(e=>({type:"Point",coordinates:e})):[n]}class Us{constructor(e,r){this.type=Qe,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ps(e[1])){const o=e[1];if(o.type==="FeatureCollection")return new Us(o,o.features.map(u=>Fc(u.geometry)).flat());if(o.type==="Feature")return new Us(o,Fc(o.geometry));if("type"in o&&"coordinates"in o)return new Us(o,Fc(o))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,o){const u=r.geometry(),d=u.flat().map(x=>Do([x.x,x.y],r.canonical));if(u.length===0)return NaN;const p=new Ac(d[0][1]);let _=1/0;for(const x of o){switch(x.type){case"Point":_=Math.min(_,Hl(d,!1,[x.coordinates],!1,p,_));break;case"LineString":_=Math.min(_,Hl(d,!1,x.coordinates,!0,p,_));break;case"Polygon":_=Math.min(_,Wl(d,!1,x.coordinates,p,_))}if(_===0)return _}return _}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,o){const u=r.geometry(),d=u.flat().map(x=>Do([x.x,x.y],r.canonical));if(u.length===0)return NaN;const p=new Ac(d[0][1]);let _=1/0;for(const x of o){switch(x.type){case"Point":_=Math.min(_,Hl(d,!0,[x.coordinates],!1,p,_));break;case"LineString":_=Math.min(_,Hl(d,!0,x.coordinates,!0,p,_));break;case"Polygon":_=Math.min(_,Wl(d,!0,x.coordinates,p,_))}if(_===0)return _}return _}(e,this.geometries);if(e.geometryType()==="Polygon")return function(r,o){const u=r.geometry();if(u.length===0||u[0].length===0)return NaN;const d=Ul(u,0).map(x=>x.map(T=>T.map(E=>Do([E.x,E.y],r.canonical)))),p=new Ac(d[0][0][0][1]);let _=1/0;for(const x of o)for(const T of d){switch(x.type){case"Point":_=Math.min(_,Wl([x.coordinates],!1,T,p,_));break;case"LineString":_=Math.min(_,Wl(x.coordinates,!0,T,p,_));break;case"Polygon":_=Math.min(_,Bm(T,x.coordinates,p,_))}if(_===0)return _}return _}(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Fa{constructor(e){this.type=xt,this.key=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=e[1];return o==null?r.error("Global state property must be defined."):typeof o!="string"?r.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new Fa(o)}evaluate(e){var r;const o=(r=e.globals)===null||r===void 0?void 0:r.globalState;return o&&Object.keys(o).length!==0?Ma(o,this.key):null}eachChild(){}outputDefined(){return!1}}const Fo={"==":Bd,"!=":Pc,">":Im,"<":Od,">=":Nl,"<=":Io,array:An,at:Mt,boolean:An,case:ka,coalesce:Os,collator:ko,format:Da,image:Ao,in:bt,"index-of":Co,interpolate:wn,"interpolate-hcl":wn,"interpolate-lab":wn,length:zo,let:qt,literal:Ai,match:It,number:An,"number-format":Ec,object:An,slice:Qn,step:fs,string:An,"to-boolean":Zi,"to-color":Zi,"to-number":Zi,"to-string":Zi,var:Eo,within:js,distance:Us,"global-state":Fa};class Jn{constructor(e,r,o,u){this.name=e,this.type=r,this._evaluate=o,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const o=e[0],u=Jn.definitions[o];if(!u)return r.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(u)?u[0]:u.type,p=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,_=p.filter(([T])=>!Array.isArray(T)||T.length===e.length-1);let x=null;for(const[T,E]of _){x=new Bs(r.registry,Xl,r.path,null,r.scope);const I=[];let A=!1;for(let z=1;z<e.length;z++){const L=e[z],F=Array.isArray(T)?T[z-1]:T.type,O=x.parse(L,1+I.length,F);if(!O){A=!0;break}I.push(O)}if(!A)if(Array.isArray(T)&&T.length!==I.length)x.error(`Expected ${T.length} arguments, but found ${I.length} instead.`);else{for(let z=0;z<I.length;z++){const L=Array.isArray(T)?T[z]:T.type,F=I[z];x.concat(z+1).checkSubtype(L,F.type)}if(x.errors.length===0)return new Jn(o,d,E,I)}}if(_.length===1)r.errors.push(...x.errors);else{const T=(_.length?_:p).map(([I])=>{return A=I,Array.isArray(A)?`(${A.map(Nt).join(", ")})`:`(${Nt(A.type)}...)`;var A}).join(" | "),E=[];for(let I=1;I<e.length;I++){const A=r.parse(e[I],1+E.length);if(!A)return null;E.push(Nt(A.type))}r.error(`Expected arguments of type ${T}, but found (${E.join(", ")}) instead.`)}return null}static register(e,r){Jn.definitions=r;for(const o in r)e[o]=Jn}}function Qd(n,[e,r,o,u]){e=e.evaluate(n),r=r.evaluate(n),o=o.evaluate(n);const d=u?u.evaluate(n):1,p=Po(e,r,o,d);if(p)throw new Gt(p);return new St(e/255,r/255,o/255,d,!1)}function Jd(n,e){return n in e}function Bc(n,e){const r=e[n];return r===void 0?null:r}function $s(n){return{type:n}}function Xl(n){if(n instanceof Eo)return Xl(n.boundExpression);if(n instanceof Jn&&n.name==="error"||n instanceof ko||n instanceof js||n instanceof Us||n instanceof Fa)return!1;const e=n instanceof Zi||n instanceof An;let r=!0;return n.eachChild(o=>{r=e?r&&Xl(o):r&&o instanceof Ai}),!!r&&Yl(n)&&Kl(n,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Yl(n){if(n instanceof Jn&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof js||n instanceof Us)return!1;let e=!0;return n.eachChild(r=>{e&&!Yl(r)&&(e=!1)}),e}function Ba(n){if(n instanceof Jn&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(r=>{e&&!Ba(r)&&(e=!1)}),e}function Kl(n,e){if(n instanceof Jn&&e.indexOf(n.name)>=0)return!1;let r=!0;return n.eachChild(o=>{r&&!Kl(o,e)&&(r=!1)}),r}function ep(n){return{result:"success",value:n}}function Bo(n){return{result:"error",value:n}}function Oo(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function tp(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Oc(n){return!!n.expression&&n.expression.interpolated}function Pt(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function Ql(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&wr(n)===qi}function Om(n){return n}function rp(n,e){const r=n.stops&&typeof n.stops[0][0]=="object",o=r||!(r||n.property!==void 0),u=n.type||(Oc(e)?"exponential":"interval"),d=function(E){switch(E.type){case"color":return St.parse;case"padding":return ln.parse;case"numberArray":return lr.parse;case"colorArray":return pt.parse;default:return null}}(e);if(d&&((n=_n({},n)).stops&&(n.stops=n.stops.map(E=>[E[0],d(E[1])])),n.default=d(n.default?n.default:e.default)),n.colorSpace&&(p=n.colorSpace)!=="rgb"&&p!=="hcl"&&p!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var p;const _=function(E){switch(E){case"exponential":return np;case"interval":return jm;case"categorical":return Nm;case"identity":return Vm;default:throw new Error(`Unknown function type "${E}"`)}}(u);let x,T;if(u==="categorical"){x=Object.create(null);for(const E of n.stops)x[E[0]]=E[1];T=typeof n.stops[0][0]}if(r){const E={},I=[];for(let L=0;L<n.stops.length;L++){const F=n.stops[L],O=F[0].zoom;E[O]===void 0&&(E[O]={zoom:O,type:n.type,property:n.property,default:n.default,stops:[]},I.push(O)),E[O].stops.push([F[0].value,F[1]])}const A=[];for(const L of I)A.push([E[L].zoom,rp(E[L],e)]);const z={name:"linear"};return{kind:"composite",interpolationType:z,interpolationFactor:wn.interpolationFactor.bind(void 0,z),zoomStops:A.map(L=>L[0]),evaluate:({zoom:L},F)=>np({stops:A,base:n.base},e,L).evaluate(L,F)}}if(o){const E=u==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:wn.interpolationFactor.bind(void 0,E),zoomStops:n.stops.map(I=>I[0]),evaluate:({zoom:I})=>_(n,e,I,x,T)}}return{kind:"source",evaluate(E,I){const A=I&&I.properties?I.properties[n.property]:void 0;return A===void 0?Oa(n.default,e.default):_(n,e,A,x,T)}}}function Oa(n,e,r){return n!==void 0?n:e!==void 0?e:r!==void 0?r:void 0}function Nm(n,e,r,o,u){return Oa(typeof r===u?o[r]:void 0,n.default,e.default)}function jm(n,e,r){if(Pt(r)!=="number")return Oa(n.default,e.default);const o=n.stops.length;if(o===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[o-1][0])return n.stops[o-1][1];const u=Mo(n.stops.map(d=>d[0]),r);return n.stops[u][1]}function np(n,e,r){const o=n.base!==void 0?n.base:1;if(Pt(r)!=="number")return Oa(n.default,e.default);const u=n.stops.length;if(u===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[u-1][0])return n.stops[u-1][1];const d=Mo(n.stops.map(E=>E[0]),r),p=function(E,I,A,z){const L=z-A,F=E-A;return L===0?0:I===1?F/L:(Math.pow(I,F)-1)/(Math.pow(I,L)-1)}(r,o,n.stops[d][0],n.stops[d+1][0]),_=n.stops[d][1],x=n.stops[d+1][1],T=nr[e.type]||Om;return typeof _.evaluate=="function"?{evaluate(...E){const I=_.evaluate.apply(void 0,E),A=x.evaluate.apply(void 0,E);if(I!==void 0&&A!==void 0)return T(I,A,p,n.colorSpace)}}:T(_,x,p,n.colorSpace)}function Vm(n,e,r){switch(e.type){case"color":r=St.parse(r);break;case"formatted":r=kn.fromString(r.toString());break;case"resolvedImage":r=jn.fromString(r.toString());break;case"padding":r=ln.parse(r);break;case"colorArray":r=pt.parse(r);break;case"numberArray":r=lr.parse(r);break;default:Pt(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return Oa(r,n.default,e.default)}Jn.register(Fo,{error:[{kind:"error"},[wt],(n,[e])=>{throw new Gt(e.evaluate(n))}],typeof:[wt,[xt],(n,[e])=>Nt(wr(e.evaluate(n)))],"to-rgba":[vn(Qe,4),[Nn],(n,[e])=>{const[r,o,u,d]=e.evaluate(n).rgb;return[255*r,255*o,255*u,d]}],rgb:[Nn,[Qe,Qe,Qe],Qd],rgba:[Nn,[Qe,Qe,Qe,Qe],Qd],has:{type:Tt,overloads:[[[wt],(n,[e])=>Jd(e.evaluate(n),n.properties())],[[wt,qi],(n,[e,r])=>Jd(e.evaluate(n),r.evaluate(n))]]},get:{type:xt,overloads:[[[wt],(n,[e])=>Bc(e.evaluate(n),n.properties())],[[wt,qi],(n,[e,r])=>Bc(e.evaluate(n),r.evaluate(n))]]},"feature-state":[xt,[wt],(n,[e])=>Bc(e.evaluate(n),n.featureState||{})],properties:[qi,[],n=>n.properties()],"geometry-type":[wt,[],n=>n.geometryType()],id:[xt,[],n=>n.id()],zoom:[Qe,[],n=>n.globals.zoom],"heatmap-density":[Qe,[],n=>n.globals.heatmapDensity||0],elevation:[Qe,[],n=>n.globals.elevation||0],"line-progress":[Qe,[],n=>n.globals.lineProgress||0],accumulated:[xt,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Qe,$s(Qe),(n,e)=>{let r=0;for(const o of e)r+=o.evaluate(n);return r}],"*":[Qe,$s(Qe),(n,e)=>{let r=1;for(const o of e)r*=o.evaluate(n);return r}],"-":{type:Qe,overloads:[[[Qe,Qe],(n,[e,r])=>e.evaluate(n)-r.evaluate(n)],[[Qe],(n,[e])=>-e.evaluate(n)]]},"/":[Qe,[Qe,Qe],(n,[e,r])=>e.evaluate(n)/r.evaluate(n)],"%":[Qe,[Qe,Qe],(n,[e,r])=>e.evaluate(n)%r.evaluate(n)],ln2:[Qe,[],()=>Math.LN2],pi:[Qe,[],()=>Math.PI],e:[Qe,[],()=>Math.E],"^":[Qe,[Qe,Qe],(n,[e,r])=>Math.pow(e.evaluate(n),r.evaluate(n))],sqrt:[Qe,[Qe],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[Qe,[Qe],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[Qe,[Qe],(n,[e])=>Math.log(e.evaluate(n))],log2:[Qe,[Qe],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[Qe,[Qe],(n,[e])=>Math.sin(e.evaluate(n))],cos:[Qe,[Qe],(n,[e])=>Math.cos(e.evaluate(n))],tan:[Qe,[Qe],(n,[e])=>Math.tan(e.evaluate(n))],asin:[Qe,[Qe],(n,[e])=>Math.asin(e.evaluate(n))],acos:[Qe,[Qe],(n,[e])=>Math.acos(e.evaluate(n))],atan:[Qe,[Qe],(n,[e])=>Math.atan(e.evaluate(n))],min:[Qe,$s(Qe),(n,e)=>Math.min(...e.map(r=>r.evaluate(n)))],max:[Qe,$s(Qe),(n,e)=>Math.max(...e.map(r=>r.evaluate(n)))],abs:[Qe,[Qe],(n,[e])=>Math.abs(e.evaluate(n))],round:[Qe,[Qe],(n,[e])=>{const r=e.evaluate(n);return r<0?-Math.round(-r):Math.round(r)}],floor:[Qe,[Qe],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[Qe,[Qe],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Tt,[wt,xt],(n,[e,r])=>n.properties()[e.value]===r.value],"filter-id-==":[Tt,[xt],(n,[e])=>n.id()===e.value],"filter-type-==":[Tt,[wt],(n,[e])=>n.geometryType()===e.value],"filter-<":[Tt,[wt,xt],(n,[e,r])=>{const o=n.properties()[e.value],u=r.value;return typeof o==typeof u&&o<u}],"filter-id-<":[Tt,[xt],(n,[e])=>{const r=n.id(),o=e.value;return typeof r==typeof o&&r<o}],"filter->":[Tt,[wt,xt],(n,[e,r])=>{const o=n.properties()[e.value],u=r.value;return typeof o==typeof u&&o>u}],"filter-id->":[Tt,[xt],(n,[e])=>{const r=n.id(),o=e.value;return typeof r==typeof o&&r>o}],"filter-<=":[Tt,[wt,xt],(n,[e,r])=>{const o=n.properties()[e.value],u=r.value;return typeof o==typeof u&&o<=u}],"filter-id-<=":[Tt,[xt],(n,[e])=>{const r=n.id(),o=e.value;return typeof r==typeof o&&r<=o}],"filter->=":[Tt,[wt,xt],(n,[e,r])=>{const o=n.properties()[e.value],u=r.value;return typeof o==typeof u&&o>=u}],"filter-id->=":[Tt,[xt],(n,[e])=>{const r=n.id(),o=e.value;return typeof r==typeof o&&r>=o}],"filter-has":[Tt,[xt],(n,[e])=>e.value in n.properties()],"filter-has-id":[Tt,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Tt,[vn(wt)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Tt,[vn(xt)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Tt,[wt,vn(xt)],(n,[e,r])=>r.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Tt,[wt,vn(xt)],(n,[e,r])=>function(o,u,d,p){for(;d<=p;){const _=d+p>>1;if(u[_]===o)return!0;u[_]>o?p=_-1:d=_+1}return!1}(n.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Tt,overloads:[[[Tt,Tt],(n,[e,r])=>e.evaluate(n)&&r.evaluate(n)],[$s(Tt),(n,e)=>{for(const r of e)if(!r.evaluate(n))return!1;return!0}]]},any:{type:Tt,overloads:[[[Tt,Tt],(n,[e,r])=>e.evaluate(n)||r.evaluate(n)],[$s(Tt),(n,e)=>{for(const r of e)if(r.evaluate(n))return!0;return!1}]]},"!":[Tt,[Tt],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Tt,[wt],(n,[e])=>{const r=n.globals&&n.globals.isSupportedScript;return!r||r(e.evaluate(n))}],upcase:[wt,[wt],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[wt,[wt],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[wt,$s(xt),(n,e)=>e.map(r=>Ls(r.evaluate(n))).join("")],"resolved-locale":[wt,[wa],(n,[e])=>e.evaluate(n).resolvedLocale()]});class Nc{constructor(e,r,o){this.expression=e,this._warningHistory={},this._evaluator=new wc,this._defaultValue=r?function(u){if(u.type==="color"&&Ql(u.default))return new St(0,0,0,0);switch(u.type){case"color":return St.parse(u.default)||null;case"padding":return ln.parse(u.default)||null;case"numberArray":return lr.parse(u.default)||null;case"colorArray":return pt.parse(u.default)||null;case"variableAnchorOffsetCollection":return xn.parse(u.default)||null;case"projectionDefinition":return bn.parse(u.default)||null;default:return u.default===void 0?null:u.default}}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null,this._globalState=o}evaluateWithoutErrorHandling(e,r,o,u,d,p){return this._globalState&&(e=Gs(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=o,this._evaluator.canonical=u,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=p,this.expression.evaluate(this._evaluator)}evaluate(e,r,o,u,d,p){this._globalState&&(e=Gs(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=o||null,this._evaluator.canonical=u,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=p||null;try{const _=this.expression.evaluate(this._evaluator);if(_==null||typeof _=="number"&&_!=_)return this._defaultValue;if(this._enumValues&&!(_ in this._enumValues))throw new Gt(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(_)} instead.`);return _}catch(_){return this._warningHistory[_.message]||(this._warningHistory[_.message]=!0,typeof console<"u"&&console.warn(_.message)),this._defaultValue}}}function No(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Fo}function Na(n,e,r){const o=new Bs(Fo,Xl,[],e?function(d){const p={color:Nn,string:wt,number:Qe,enum:wt,boolean:Tt,formatted:Ta,padding:Dl,numberArray:Sa,colorArray:xo,projectionDefinition:zl,resolvedImage:bo,variableAnchorOffsetCollection:Pa};return d.type==="array"?vn(p[d.value]||xt,d.length):p[d.type]}(e):void 0),u=o.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?ep(new Nc(u,e,r)):Bo(o.errors)}class Jl{constructor(e,r,o){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!Ba(r.expression),this.globalStateRefs=ms(r.expression),this._globalState=o}evaluateWithoutErrorHandling(e,r,o,u,d,p){return this._globalState&&(e=Gs(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,r,o,u,d,p)}evaluate(e,r,o,u,d,p){return this._globalState&&(e=Gs(e,this._globalState)),this._styleExpression.evaluate(e,r,o,u,d,p)}}class jc{constructor(e,r,o,u,d){this.kind=e,this.zoomStops=o,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Ba(r.expression),this.globalStateRefs=ms(r.expression),this.interpolationType=u,this._globalState=d}evaluateWithoutErrorHandling(e,r,o,u,d,p){return this._globalState&&(e=Gs(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,r,o,u,d,p)}evaluate(e,r,o,u,d,p){return this._globalState&&(e=Gs(e,this._globalState)),this._styleExpression.evaluate(e,r,o,u,d,p)}interpolationFactor(e,r,o){return this.interpolationType?wn.interpolationFactor(this.interpolationType,e,r,o):0}}function Vc(n,e,r){const o=Na(n,e,r);if(o.result==="error")return o;const u=o.value.expression,d=Yl(u);if(!d&&!Oo(e))return Bo([new yn("","data expressions not supported")]);const p=Kl(u,["zoom"]);if(!p&&!tp(e))return Bo([new yn("","zoom expressions not supported")]);const _=tu(u);return _||p?_ instanceof yn?Bo([_]):_ instanceof wn&&!Oc(e)?Bo([new yn("",'"interpolate" expressions cannot be used with this property')]):ep(_?new jc(d?"camera":"composite",o.value,_.labels,_ instanceof wn?_.interpolation:void 0,r):new Jl(d?"constant":"source",o.value,r)):Bo([new yn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class eu{constructor(e,r){this._parameters=e,this._specification=r,_n(this,rp(this._parameters,this._specification))}static deserialize(e){return new eu(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function tu(n){let e=null;if(n instanceof qt)e=tu(n.result);else if(n instanceof Os){for(const r of n.args)if(e=tu(r),e)break}else(n instanceof fs||n instanceof wn)&&n.input instanceof Jn&&n.input.name==="zoom"&&(e=n);return e instanceof yn||n.eachChild(r=>{const o=tu(r);o instanceof yn?e=o:!e&&o?e=new yn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new yn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function ms(n,e=new Set){return n instanceof Fa&&e.add(n.key),n.eachChild(r=>{ms(r,e)}),e}function Gs(n,e){const{zoom:r,heatmapDensity:o,elevation:u,lineProgress:d,isSupportedScript:p,accumulated:_}=n??{};return{zoom:r,heatmapDensity:o,elevation:u,lineProgress:d,isSupportedScript:p,accumulated:_,globalState:e}}function Uc(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!Uc(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Um={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ja(n,e){if(n==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Uc(n)||(n=Va(n));const r=Na(n,Um,e);if(r.result==="error")throw new Error(r.value.map(o=>`${o.key}: ${o.message}`).join(", "));return{filter:(o,u,d)=>r.value.evaluate(o,u,{},d),needGeometry:ip(n),getGlobalStateRefs:()=>ms(r.value.expression)}}function $m(n,e){return n<e?-1:n>e?1:0}function ip(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(ip(n[e]))return!0;return!1}function Va(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?ru(n[1],n[2],"=="):e==="!="?Ua(ru(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ru(n[1],n[2],e):e==="any"?(r=n.slice(1),["any"].concat(r.map(Va))):e==="all"?["all"].concat(n.slice(1).map(Va)):e==="none"?["all"].concat(n.slice(1).map(Va).map(Ua)):e==="in"?sp(n[1],n.slice(2)):e==="!in"?Ua(sp(n[1],n.slice(2))):e==="has"?op(n[1]):e!=="!has"||Ua(op(n[1]));var r}function ru(n,e,r){switch(n){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,n,e]}}function sp(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",n,["literal",e.sort($m)]]:["filter-in-small",n,["literal",e]]}}function op(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Ua(n){return["!",n]}function nu(n){const e=typeof n;if(e==="number"||e==="boolean"||e==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let u="[";for(const d of n)u+=`${nu(d)},`;return`${u}]`}const r=Object.keys(n).sort();let o="{";for(let u=0;u<r.length;u++)o+=`${JSON.stringify(r[u])}:${nu(n[r[u]])},`;return`${o}}`}function ap(n){let e="";for(const r of Ut)e+=`/${nu(n[r])}`;return e}function lp(n){const e=n.value;return e?[new Ue(n.key,e,"constants have been deprecated as of v8")]:[]}function Tr(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function qs(n){if(Array.isArray(n))return n.map(qs);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const r in n)e[r]=qs(n[r]);return e}return Tr(n)}function Vn(n){const e=n.key,r=n.value,o=n.valueSpec||{},u=n.objectElementValidators||{},d=n.style,p=n.styleSpec,_=n.validateSpec;let x=[];const T=Pt(r);if(T!=="object")return[new Ue(e,r,`object expected, ${T} found`)];for(const E in r){const I=E.split(".")[0],A=Ma(o,I)||o["*"];let z;if(Ma(u,I))z=u[I];else if(Ma(o,I)){if(r[E]===void 0)continue;z=_}else if(u["*"])z=u["*"];else{if(!o["*"]){x.push(new Ue(e,r[E],`unknown property "${E}"`));continue}z=_}x=x.concat(z({key:(e&&`${e}.`)+E,value:r[E],valueSpec:A,style:d,styleSpec:p,object:r,objectKey:E,validateSpec:_},r))}for(const E in o)u[E]||o[E].required&&o[E].default===void 0&&r[E]===void 0&&x.push(new Ue(e,r,`missing required property "${E}"`));return x}function iu(n){const e=n.value,r=n.valueSpec,o=n.style,u=n.styleSpec,d=n.key,p=n.arrayElementValidator||n.validateSpec;if(Pt(e)!=="array")return[new Ue(d,e,`array expected, ${Pt(e)} found`)];if(r.length&&e.length!==r.length)return[new Ue(d,e,`array length ${r.length} expected, length ${e.length} found`)];let _={type:r.value,values:r.values};u.$version<7&&(_.function=r.function),Pt(r.value)==="object"&&(_=r.value);let x=[];for(let T=0;T<e.length;T++)x=x.concat(p({array:e,arrayIndex:T,value:e[T],valueSpec:_,validateSpec:n.validateSpec,style:o,styleSpec:u,key:`${d}[${T}]`}));return x}function $a(n){const e=n.key,r=n.value,o=n.valueSpec;let u=Pt(r);return u==="number"&&r!=r&&(u="NaN"),u!=="number"?[new Ue(e,r,`number expected, ${u} found`)]:"minimum"in o&&r<o.minimum?[new Ue(e,r,`${r} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&r>o.maximum?[new Ue(e,r,`${r} is greater than the maximum value ${o.maximum}`)]:[]}function su(n){const e=n.valueSpec,r=Tr(n.value.type);let o,u,d,p={};const _=r!=="categorical"&&n.value.property===void 0,x=!_,T=Pt(n.value.stops)==="array"&&Pt(n.value.stops[0])==="array"&&Pt(n.value.stops[0][0])==="object",E=Vn({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(z){if(r==="identity")return[new Ue(z.key,z.value,'identity function may not have a "stops" property')];let L=[];const F=z.value;return L=L.concat(iu({key:z.key,value:F,valueSpec:z.valueSpec,validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:I})),Pt(F)==="array"&&F.length===0&&L.push(new Ue(z.key,F,"array must have at least one stop")),L},default:function(z){return z.validateSpec({key:z.key,value:z.value,valueSpec:e,validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec})}}});return r==="identity"&&_&&E.push(new Ue(n.key,n.value,'missing required property "property"')),r==="identity"||n.value.stops||E.push(new Ue(n.key,n.value,'missing required property "stops"')),r==="exponential"&&n.valueSpec.expression&&!Oc(n.valueSpec)&&E.push(new Ue(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(x&&!Oo(n.valueSpec)?E.push(new Ue(n.key,n.value,"property functions not supported")):_&&!tp(n.valueSpec)&&E.push(new Ue(n.key,n.value,"zoom functions not supported"))),r!=="categorical"&&!T||n.value.property!==void 0||E.push(new Ue(n.key,n.value,'"property" property is required')),E;function I(z){let L=[];const F=z.value,O=z.key;if(Pt(F)!=="array")return[new Ue(O,F,`array expected, ${Pt(F)} found`)];if(F.length!==2)return[new Ue(O,F,`array length 2 expected, length ${F.length} found`)];if(T){if(Pt(F[0])!=="object")return[new Ue(O,F,`object expected, ${Pt(F[0])} found`)];if(F[0].zoom===void 0)return[new Ue(O,F,"object stop key must have zoom")];if(F[0].value===void 0)return[new Ue(O,F,"object stop key must have value")];if(d&&d>Tr(F[0].zoom))return[new Ue(O,F[0].zoom,"stop zoom values must appear in ascending order")];Tr(F[0].zoom)!==d&&(d=Tr(F[0].zoom),u=void 0,p={}),L=L.concat(Vn({key:`${O}[0]`,value:F[0],valueSpec:{zoom:{}},validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec,objectElementValidators:{zoom:$a,value:A}}))}else L=L.concat(A({key:`${O}[0]`,value:F[0],validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec},F));return No(qs(F[1]))?L.concat([new Ue(`${O}[1]`,F[1],"expressions are not allowed in function stops.")]):L.concat(z.validateSpec({key:`${O}[1]`,value:F[1],valueSpec:e,validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec}))}function A(z,L){const F=Pt(z.value),O=Tr(z.value),$=z.value!==null?z.value:L;if(o){if(F!==o)return[new Ue(z.key,$,`${F} stop domain type must match previous stop domain type ${o}`)]}else o=F;if(F!=="number"&&F!=="string"&&F!=="boolean")return[new Ue(z.key,$,"stop domain value must be a number, string, or boolean")];if(F!=="number"&&r!=="categorical"){let J=`number expected, ${F} found`;return Oo(e)&&r===void 0&&(J+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ue(z.key,$,J)]}return r!=="categorical"||F!=="number"||isFinite(O)&&Math.floor(O)===O?r!=="categorical"&&F==="number"&&u!==void 0&&O<u?[new Ue(z.key,$,"stop domain values must appear in ascending order")]:(u=O,r==="categorical"&&O in p?[new Ue(z.key,$,"stop domain values must be unique")]:(p[O]=!0,[])):[new Ue(z.key,$,`integer expected, found ${O}`)]}}function gs(n){const e=(n.expressionContext==="property"?Vc:Na)(qs(n.value),n.valueSpec);if(e.result==="error")return e.value.map(o=>new Ue(`${n.key}${o.key}`,n.value,o.message));const r=e.value.expression||e.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!r.outputDefined())return[new Ue(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!Ba(r))return[new Ue(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!Ba(r))return[new Ue(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!Kl(r,["zoom","feature-state"]))return[new Ue(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!Yl(r))return[new Ue(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ga(n){const e=n.key,r=n.value,o=Pt(r);return o!=="string"?[new Ue(e,r,`color expected, ${o} found`)]:St.parse(String(r))?[]:[new Ue(e,r,`color expected, "${r}" found`)]}function Zs(n){const e=n.key,r=n.value,o=n.valueSpec,u=[];return Array.isArray(o.values)?o.values.indexOf(Tr(r))===-1&&u.push(new Ue(e,r,`expected one of [${o.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(o.values).indexOf(Tr(r))===-1&&u.push(new Ue(e,r,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(r)} found`)),u}function jo(n){return Uc(qs(n.value))?gs(_n({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):up(n)}function up(n){const e=n.value,r=n.key;if(Pt(e)!=="array")return[new Ue(r,e,`array expected, ${Pt(e)} found`)];const o=n.styleSpec;let u,d=[];if(e.length<1)return[new Ue(r,e,"filter array must have at least 1 element")];switch(d=d.concat(Zs({key:`${r}[0]`,value:e[0],valueSpec:o.filter_operator,style:n.style,styleSpec:n.styleSpec})),Tr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Tr(e[1])==="$type"&&d.push(new Ue(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&d.push(new Ue(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=Pt(e[1]),u!=="string"&&d.push(new Ue(`${r}[1]`,e[1],`string expected, ${u} found`)));for(let p=2;p<e.length;p++)u=Pt(e[p]),Tr(e[1])==="$type"?d=d.concat(Zs({key:`${r}[${p}]`,value:e[p],valueSpec:o.geometry_type,style:n.style,styleSpec:n.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&d.push(new Ue(`${r}[${p}]`,e[p],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)d=d.concat(up({key:`${r}[${p}]`,value:e[p],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":u=Pt(e[1]),e.length!==2?d.push(new Ue(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="string"&&d.push(new Ue(`${r}[1]`,e[1],`string expected, ${u} found`))}return d}function cp(n,e){const r=n.key,o=n.validateSpec,u=n.style,d=n.styleSpec,p=n.value,_=n.objectKey,x=d[`${e}_${n.layerType}`];if(!x)return[];const T=_.match(/^(.*)-transition$/);if(e==="paint"&&T&&x[T[1]]&&x[T[1]].transition)return o({key:r,value:p,valueSpec:d.transition,style:u,styleSpec:d});const E=n.valueSpec||x[_];if(!E)return[new Ue(r,p,`unknown property "${_}"`)];let I;if(Pt(p)==="string"&&Oo(E)&&!E.tokens&&(I=/^{([^}]+)}$/.exec(p)))return[new Ue(r,p,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(I[1])} }\`.`)];const A=[];return n.layerType==="symbol"&&_==="text-font"&&Ql(qs(p))&&Tr(p.type)==="identity"&&A.push(new Ue(r,p,'"text-font" does not support identity functions')),A.concat(o({key:n.key,value:p,valueSpec:E,style:u,styleSpec:d,expressionContext:"property",propertyType:e,propertyKey:_}))}function hp(n){return cp(n,"paint")}function dp(n){return cp(n,"layout")}function pp(n){let e=[];const r=n.value,o=n.key,u=n.style,d=n.styleSpec;if(Pt(r)!=="object")return[new Ue(o,r,`object expected, ${Pt(r)} found`)];r.type||r.ref||e.push(new Ue(o,r,'either "type" or "ref" is required'));let p=Tr(r.type);const _=Tr(r.ref);if(r.id){const x=Tr(r.id);for(let T=0;T<n.arrayIndex;T++){const E=u.layers[T];Tr(E.id)===x&&e.push(new Ue(o,r.id,`duplicate layer id "${r.id}", previously used at line ${E.id.__line__}`))}}if("ref"in r){let x;["type","source","source-layer","filter","layout"].forEach(T=>{T in r&&e.push(new Ue(o,r[T],`"${T}" is prohibited for ref layers`))}),u.layers.forEach(T=>{Tr(T.id)===_&&(x=T)}),x?x.ref?e.push(new Ue(o,r.ref,"ref cannot reference another ref layer")):p=Tr(x.type):e.push(new Ue(o,r.ref,`ref layer "${_}" not found`))}else if(p!=="background")if(r.source){const x=u.sources&&u.sources[r.source],T=x&&Tr(x.type);x?T==="vector"&&p==="raster"?e.push(new Ue(o,r.source,`layer "${r.id}" requires a raster source`)):T!=="raster-dem"&&p==="hillshade"||T!=="raster-dem"&&p==="color-relief"?e.push(new Ue(o,r.source,`layer "${r.id}" requires a raster-dem source`)):T==="raster"&&p!=="raster"?e.push(new Ue(o,r.source,`layer "${r.id}" requires a vector source`)):T!=="vector"||r["source-layer"]?T==="raster-dem"&&p!=="hillshade"&&p!=="color-relief"?e.push(new Ue(o,r.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):p!=="line"||!r.paint||!r.paint["line-gradient"]||T==="geojson"&&x.lineMetrics||e.push(new Ue(o,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ue(o,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Ue(o,r.source,`source "${r.source}" not found`))}else e.push(new Ue(o,r,'missing required property "source"'));return e=e.concat(Vn({key:o,value:r,valueSpec:d.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${o}.type`,value:r.type,valueSpec:d.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:r,objectKey:"type"}),filter:jo,layout:x=>Vn({layer:r,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":T=>dp(_n({layerType:p},T))}}),paint:x=>Vn({layer:r,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":T=>hp(_n({layerType:p},T))}})}})),e}function _s(n){const e=n.value,r=n.key,o=Pt(e);return o!=="string"?[new Ue(r,e,`string expected, ${o} found`)]:[]}const $c={promoteId:function({key:n,value:e}){if(Pt(e)==="string")return _s({key:n,value:e});{const r=[];for(const o in e)r.push(..._s({key:`${n}.${o}`,value:e[o]}));return r}}};function Gc(n){const e=n.value,r=n.key,o=n.styleSpec,u=n.style,d=n.validateSpec;if(!e.type)return[new Ue(r,e,'"type" is required')];const p=Tr(e.type);let _;switch(p){case"vector":case"raster":return _=Vn({key:r,value:e,valueSpec:o[`source_${p.replace("-","_")}`],style:n.style,styleSpec:o,objectElementValidators:$c,validateSpec:d}),_;case"raster-dem":return _=function(x){var T;const E=(T=x.sourceName)!==null&&T!==void 0?T:"",I=x.value,A=x.styleSpec,z=A.source_raster_dem,L=x.style;let F=[];const O=Pt(I);if(I===void 0)return F;if(O!=="object")return F.push(new Ue("source_raster_dem",I,`object expected, ${O} found`)),F;const $=Tr(I.encoding)==="custom",J=["redFactor","greenFactor","blueFactor","baseShift"],G=x.value.encoding?`"${x.value.encoding}"`:"Default";for(const Z in I)!$&&J.includes(Z)?F.push(new Ue(Z,I[Z],`In "${E}": "${Z}" is only valid when "encoding" is set to "custom". ${G} encoding found`)):z[Z]?F=F.concat(x.validateSpec({key:Z,value:I[Z],valueSpec:z[Z],validateSpec:x.validateSpec,style:L,styleSpec:A})):F.push(new Ue(Z,I[Z],`unknown property "${Z}"`));return F}({sourceName:r,value:e,style:n.style,styleSpec:o,validateSpec:d}),_;case"geojson":if(_=Vn({key:r,value:e,valueSpec:o.source_geojson,style:u,styleSpec:o,validateSpec:d,objectElementValidators:$c}),e.cluster)for(const x in e.clusterProperties){const[T,E]=e.clusterProperties[x],I=typeof T=="string"?[T,["accumulated"],["get",x]]:T;_.push(...gs({key:`${r}.${x}.map`,value:E,expressionContext:"cluster-map"})),_.push(...gs({key:`${r}.${x}.reduce`,value:I,expressionContext:"cluster-reduce"}))}return _;case"video":return Vn({key:r,value:e,valueSpec:o.source_video,style:u,validateSpec:d,styleSpec:o});case"image":return Vn({key:r,value:e,valueSpec:o.source_image,style:u,validateSpec:d,styleSpec:o});case"canvas":return[new Ue(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Zs({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function qa(n){const e=n.value,r=n.styleSpec,o=r.light,u=n.style;let d=[];const p=Pt(e);if(e===void 0)return d;if(p!=="object")return d=d.concat([new Ue("light",e,`object expected, ${p} found`)]),d;for(const _ in e){const x=_.match(/^(.*)-transition$/);d=d.concat(x&&o[x[1]]&&o[x[1]].transition?n.validateSpec({key:_,value:e[_],valueSpec:r.transition,validateSpec:n.validateSpec,style:u,styleSpec:r}):o[_]?n.validateSpec({key:_,value:e[_],valueSpec:o[_],validateSpec:n.validateSpec,style:u,styleSpec:r}):[new Ue(_,e[_],`unknown property "${_}"`)])}return d}function fp(n){const e=n.value,r=n.styleSpec,o=r.sky,u=n.style,d=Pt(e);if(e===void 0)return[];if(d!=="object")return[new Ue("sky",e,`object expected, ${d} found`)];let p=[];for(const _ in e)p=p.concat(o[_]?n.validateSpec({key:_,value:e[_],valueSpec:o[_],style:u,styleSpec:r}):[new Ue(_,e[_],`unknown property "${_}"`)]);return p}function qc(n){const e=n.value,r=n.styleSpec,o=r.terrain,u=n.style;let d=[];const p=Pt(e);if(e===void 0)return d;if(p!=="object")return d=d.concat([new Ue("terrain",e,`object expected, ${p} found`)]),d;for(const _ in e)d=d.concat(o[_]?n.validateSpec({key:_,value:e[_],valueSpec:o[_],validateSpec:n.validateSpec,style:u,styleSpec:r}):[new Ue(_,e[_],`unknown property "${_}"`)]);return d}function Zc(n){let e=[];const r=n.value,o=n.key;if(Array.isArray(r)){const u=[],d=[];for(const p in r)r[p].id&&u.includes(r[p].id)&&e.push(new Ue(o,r,`all the sprites' ids must be unique, but ${r[p].id} is duplicated`)),u.push(r[p].id),r[p].url&&d.includes(r[p].url)&&e.push(new Ue(o,r,`all the sprites' URLs must be unique, but ${r[p].url} is duplicated`)),d.push(r[p].url),e=e.concat(Vn({key:`${o}[${p}]`,value:r[p],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return e}return _s({key:o,value:r})}function mp(n){return!!n&&n.constructor===Object}function Wc(n){return mp(n.value)?[]:[new Ue(n.key,n.value,`object expected, ${Pt(n.value)} found`)]}const Hc={"*":()=>[],array:iu,boolean:function(n){const e=n.value,r=n.key,o=Pt(e);return o!=="boolean"?[new Ue(r,e,`boolean expected, ${o} found`)]:[]},number:$a,color:Ga,constants:lp,enum:Zs,filter:jo,function:su,layer:pp,object:Vn,source:Gc,light:qa,sky:fp,terrain:qc,projection:function(n){const e=n.value,r=n.styleSpec,o=r.projection,u=n.style,d=Pt(e);if(e===void 0)return[];if(d!=="object")return[new Ue("projection",e,`object expected, ${d} found`)];let p=[];for(const _ in e)p=p.concat(o[_]?n.validateSpec({key:_,value:e[_],valueSpec:o[_],style:u,styleSpec:r}):[new Ue(_,e[_],`unknown property "${_}"`)]);return p},projectionDefinition:function(n){const e=n.key;let r=n.value;r=r instanceof String?r.valueOf():r;const o=Pt(r);return o!=="array"||function(u){return Array.isArray(u)&&u.length===3&&typeof u[0]=="string"&&typeof u[1]=="string"&&typeof u[2]=="number"}(r)||function(u){return!!["interpolate","step","literal"].includes(u[0])}(r)?["array","string"].includes(o)?[]:[new Ue(e,r,`projection expected, invalid type "${o}" found`)]:[new Ue(e,r,`projection expected, invalid array ${JSON.stringify(r)} found`)]},string:_s,formatted:function(n){return _s(n).length===0?[]:gs(n)},resolvedImage:function(n){return _s(n).length===0?[]:gs(n)},padding:function(n){const e=n.key,r=n.value;if(Pt(r)==="array"){if(r.length<1||r.length>4)return[new Ue(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const o={type:"number"};let u=[];for(let d=0;d<r.length;d++)u=u.concat(n.validateSpec({key:`${e}[${d}]`,value:r[d],validateSpec:n.validateSpec,valueSpec:o}));return u}return $a({key:e,value:r,valueSpec:{}})},numberArray:function(n){const e=n.key,r=n.value;if(Pt(r)==="array"){const o={type:"number"};if(r.length<1)return[new Ue(e,r,"array length at least 1 expected, length 0 found")];let u=[];for(let d=0;d<r.length;d++)u=u.concat(n.validateSpec({key:`${e}[${d}]`,value:r[d],validateSpec:n.validateSpec,valueSpec:o}));return u}return $a({key:e,value:r,valueSpec:{}})},colorArray:function(n){const e=n.key,r=n.value;if(Pt(r)==="array"){if(r.length<1)return[new Ue(e,r,"array length at least 1 expected, length 0 found")];let o=[];for(let u=0;u<r.length;u++)o=o.concat(Ga({key:`${e}[${u}]`,value:r[u]}));return o}return Ga({key:e,value:r})},variableAnchorOffsetCollection:function(n){const e=n.key,r=n.value,o=Pt(r),u=n.styleSpec;if(o!=="array"||r.length<1||r.length%2!=0)return[new Ue(e,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let d=[];for(let p=0;p<r.length;p+=2)d=d.concat(Zs({key:`${e}[${p}]`,value:r[p],valueSpec:u.layout_symbol["text-anchor"]})),d=d.concat(iu({key:`${e}[${p+1}]`,value:r[p+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:u}));return d},sprite:Zc,state:Wc,fontFaces:function(n){const e=n.key,r=n.value,o=n.validateSpec,u=n.styleSpec,d=n.style;if(!mp(r))return[new Ue(e,r,`object expected, ${Pt(r)} found`)];const p=[];for(const _ in r){const x=r[_],T=Pt(x);if(T==="string")p.push(..._s({key:`${e}.${_}`,value:x}));else if(T==="array"){const E={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[I,A]of x.entries())p.push(...Vn({key:`${e}.${_}[${I}]`,value:A,valueSpec:E,styleSpec:u,style:d,validateSpec:o}))}else p.push(new Ue(`${e}.${_}`,x,`string or array expected, ${T} found`))}return p}};function ys(n){const e=n.value,r=n.valueSpec,o=n.styleSpec;return n.validateSpec=ys,r.expression&&Ql(Tr(e))?su(n):r.expression&&No(qs(e))?gs(n):r.type&&Hc[r.type]?Hc[r.type](n):Vn(_n({},n,{valueSpec:r.type?o[r.type]:r}))}function gp(n){const e=n.value,r=n.key,o=_s(n);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new Ue(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new Ue(r,e,'"glyphs" url must include a "{range}" token'))),o}function ei(n,e=Pe){let r=[];return r=r.concat(ys({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,validateSpec:ys,objectElementValidators:{glyphs:gp,"*":()=>[]}})),n.constants&&(r=r.concat(lp({key:"constants",value:n.constants}))),_p(r)}function fi(n){return function(e){return n(Object.assign({},e,{validateSpec:ys}))}}function _p(n){return[].concat(n).sort((e,r)=>e.line-r.line)}function mi(n){return function(...e){return _p(n.apply(this,e))}}ei.source=mi(fi(Gc)),ei.sprite=mi(fi(Zc)),ei.glyphs=mi(fi(gp)),ei.light=mi(fi(qa)),ei.sky=mi(fi(fp)),ei.terrain=mi(fi(qc)),ei.state=mi(fi(Wc)),ei.layer=mi(fi(pp)),ei.filter=mi(fi(jo)),ei.paintProperty=mi(fi(hp)),ei.layoutProperty=mi(fi(dp));const Gm={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class Za{constructor(e,r){this._globalState=r,this.setValue(e)}evaluate(){var e;return(e=this._literalValue)!==null&&e!==void 0?e:this._compiledValue.evaluate({})}setValue(e){if(e==null||e==="visible"||e==="none")return this._literalValue=e==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const r=Na(e,Gm,this._globalState);if(r.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(r.value.map(o=>`${o.key}: ${o.message}`).join(", "));this._literalValue=void 0,this._compiledValue=r.value,this._globalStateRefs=ms(r.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const Wa=Pe,Zr=ei,Ha=Zr.light,yp=Zr.sky,qm=Zr.paintProperty,Zm=Zr.layoutProperty;function Vo(n,e){let r=!1;if(e&&e.length)for(const o of e)n.fire(new jt(new Error(o.message))),r=!0;return r}class Uo{constructor(e,r,o){const u=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const p=new Int32Array(this.arrayBuffer);e=p[0],this.d=(r=p[1])+2*(o=p[2]);for(let x=0;x<this.d*this.d;x++){const T=p[3+x],E=p[3+x+1];u.push(T===E?null:p.subarray(T,E))}const _=p[3+u.length+1];this.keys=p.subarray(p[3+u.length],_),this.bboxes=p.subarray(_),this.insert=this._insertReadonly}else{this.d=r+2*o;for(let p=0;p<this.d*this.d;p++)u.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=o,this.scale=r/e,this.uid=0;const d=o/r*e;this.min=-d,this.max=e+d}insert(e,r,o,u,d){this._forEachCell(r,o,u,d,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(d)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,o,u,d,p){this.cells[d].push(p)}query(e,r,o,u,d){const p=this.min,_=this.max;if(e<=p&&r<=p&&_<=o&&_<=u&&!d)return Array.prototype.slice.call(this.keys);{const x=[];return this._forEachCell(e,r,o,u,this._queryCell,x,{},d),x}}_queryCell(e,r,o,u,d,p,_,x){const T=this.cells[d];if(T!==null){const E=this.keys,I=this.bboxes;for(let A=0;A<T.length;A++){const z=T[A];if(_[z]===void 0){const L=4*z;(x?x(I[L+0],I[L+1],I[L+2],I[L+3]):e<=I[L+2]&&r<=I[L+3]&&o>=I[L+0]&&u>=I[L+1])?(_[z]=!0,p.push(E[z])):_[z]=!1}}}}_forEachCell(e,r,o,u,d,p,_,x){const T=this._convertToCellCoord(e),E=this._convertToCellCoord(r),I=this._convertToCellCoord(o),A=this._convertToCellCoord(u);for(let z=T;z<=I;z++)for(let L=E;L<=A;L++){const F=this.d*L+z;if((!x||x(this._convertFromCellCoord(z),this._convertFromCellCoord(L),this._convertFromCellCoord(z+1),this._convertFromCellCoord(L+1)))&&d.call(this,e,r,o,u,F,p,_,x))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let o=0;for(let p=0;p<this.cells.length;p++)o+=this.cells[p].length;const u=new Int32Array(r+o+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let d=r;for(let p=0;p<e.length;p++){const _=e[p];u[3+p]=d,u.set(_,d),d+=_.length}return u[3+e.length]=d,u.set(this.keys,d),d+=this.keys.length,u[3+e.length+1]=d,u.set(this.bboxes,d),d+=this.bboxes.length,u.buffer}static serialize(e,r){const o=e.toArrayBuffer();return r&&r.push(o),{buffer:o}}static deserialize(e){return new Uo(e.buffer)}}const gi={};function nt(n,e,r={}){if(gi[n])throw new Error(`${n} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:n,writeable:!1}),gi[n]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}nt("Object",Object),nt("Set",Set),nt("TransferableGridIndex",Uo),nt("Color",St),nt("Error",Error),nt("AJAXError",me),nt("ResolvedImage",jn),nt("StylePropertyFunction",eu),nt("StyleExpression",Nc,{omit:["_evaluator"]}),nt("ZoomDependentExpression",jc),nt("ZoomConstantExpression",Jl),nt("CompoundExpression",Jn,{omit:["_evaluate"]});for(const n in Fo)Fo[n]._classRegistryKey||nt(`Expression_${n}`,Fo[n]);function ou(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Xc(n){return n.$name||n.constructor._classRegistryKey}function $o(n){return!function(e){if(e===null||typeof e!="object")return!1;const r=Xc(e);return!(!r||r==="Object")}(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||ou(n)||us(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function Xa(n,e){if($o(n))return(ou(n)||us(n))&&e&&e.push(n),ArrayBuffer.isView(n)&&e&&e.push(n.buffer),n instanceof ImageData&&e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const d=[];for(const p of n)d.push(Xa(p,e));return d}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const r=Xc(n);if(!r)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!gi[r])throw new Error(`${r} is not registered.`);const{klass:o}=gi[r],u=o.serialize?o.serialize(n,e):{};if(o.serialize){if(e&&u===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const d in n){if(!n.hasOwnProperty(d)||gi[r].omit.indexOf(d)>=0)continue;const p=n[d];u[d]=gi[r].shallow.indexOf(d)>=0?p:Xa(p,e)}n instanceof Error&&(u.message=n.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(u.$name=r),u}function Ya(n){if($o(n))return n;if(Array.isArray(n))return n.map(Ya);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const e=Xc(n)||"Object";if(!gi[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=gi[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(n);const o=Object.create(r.prototype);for(const u of Object.keys(n)){if(u==="$name")continue;const d=n[u];o[u]=gi[e].shallow.indexOf(u)>=0?d:Ya(d)}return o}class Yc{constructor(){this.first=!0}update(e,r){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}function Ka(n){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(n))}function Kc(n){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(n))}function vp(n){return/\s/u.test(String.fromCodePoint(n))}function Go(n){for(const e of n)if(Kc(e.codePointAt(0)))return!0;return!1}function Wm(n){for(const e of n)if(!xp(e.codePointAt(0)))return!1;return!0}function au(n){const e=n.map(r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}}).filter(r=>r);return new RegExp(e.join("|"),"u")}const lu=au(["Arab","Dupl","Mong","Ougr","Syrc"]);function xp(n){return!lu.test(String.fromCodePoint(n))}function Qc(n){return!(Kc(n)||(e=n,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(e))));var e}const bp=au(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Jc(n){return bp.test(String.fromCodePoint(n))}function eh(n,e){return!(!e&&Jc(n)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(n)))}function wp(n){for(const e of n)if(Jc(e.codePointAt(0)))return!0;return!1}const vs=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){if(vs.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(n,e){return c(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(n.pluginStatus!=="loading")return this.setState(n),n;const r=n.pluginURL,o=new Promise(d=>{this.loadScriptResolve=d});e(r);const u=new Promise(d=>setTimeout(()=>d(),this.TIMEOUT));if(yield Promise.race([o,u]),this.isParsed()){const d={pluginStatus:"loaded",pluginURL:r};return this.setState(d),d}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${r}`)})}};class Vt{constructor(e,r){this.isSupportedScript=Hm,this.zoom=e,r?(this.now=r.now||0,this.fadeDuration=r.fadeDuration||0,this.zoomHistory=r.zoomHistory||new Yc,this.transition=r.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Yc,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*r}}}function Hm(n){return function(e,r){for(const o of e)if(!eh(o.codePointAt(0),r))return!1;return!0}(n,vs.getRTLTextPluginStatus()==="loaded")}const Qa="-transition";class uu{constructor(e,r,o){this.property=e,this.value=r,this.expression=function(u,d,p){if(Ql(u))return new eu(u,d);if(No(u)){const _=Vc(u,d,p);if(_.result==="error")throw new Error(_.value.map(x=>`${x.key}: ${x.message}`).join(", "));return _.value}{let _=u;return d.type==="color"&&typeof u=="string"?_=St.parse(u):d.type!=="padding"||typeof u!="number"&&!Array.isArray(u)?d.type!=="numberArray"||typeof u!="number"&&!Array.isArray(u)?d.type!=="colorArray"||typeof u!="string"&&!Array.isArray(u)?d.type==="variableAnchorOffsetCollection"&&Array.isArray(u)?_=xn.parse(u):d.type==="projectionDefinition"&&typeof u=="string"&&(_=bn.parse(u)):_=pt.parse(u):_=lr.parse(u):_=ln.parse(u),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>_}}}(r===void 0?e.specification.default:r,e.specification,o)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,r,o){return this.property.possiblyEvaluate(this,e,r,o)}}class cu{constructor(e,r){this.property=e,this.value=new uu(e,void 0,r)}transitioned(e,r){return new Tp(this.property,this.value,r,gn({},e.transition,this.transition),e.now)}untransitioned(){return new Tp(this.property,this.value,null,{},0)}}class th{constructor(e,r){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=r}getValue(e){return ci(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new cu(this._values[e].property,this._globalState)),this._values[e].value=new uu(this._values[e].property,r===null?void 0:ci(r),this._globalState)}getTransition(e){return ci(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new cu(this._values[e].property,this._globalState)),this._values[e].transition=ci(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(e[r]=o);const u=this.getTransition(r);u!==void 0&&(e[`${r}${Qa}`]=u)}return e}transitioned(e,r){const o=new Sp(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].transitioned(e,r._values[u]);return o}untransitioned(){const e=new Sp(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Tp{constructor(e,r,o,u,d){this.property=e,this.value=r,this.begin=d+u.delay||0,this.end=this.begin+u.duration||0,e.specification.transition&&(u.delay||u.duration)&&(this.prior=o)}possiblyEvaluate(e,r,o){const u=e.now||0,d=this.value.possiblyEvaluate(e,r,o),p=this.prior;if(p){if(u>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(u<this.begin)return p.possiblyEvaluate(e,r,o);{const _=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,r,o),d,Ii(_))}}return d}}class Sp{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,o){const u=new Ja(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].possiblyEvaluate(e,r,o);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Pp{constructor(e,r){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=r}hasValue(e){return this._values[e].value!==void 0}getValue(e){return ci(this._values[e].value)}setValue(e,r){this._values[e]=new uu(this._values[e].property,r===null?void 0:ci(r),this._globalState)}serialize(){const e={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(e[r]=o)}return e}possiblyEvaluate(e,r,o){const u=new Ja(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].possiblyEvaluate(e,r,o);return u}}class _i{constructor(e,r,o){this.property=e,this.value=r,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,o,u){return this.property.evaluate(this.value,this.parameters,e,r,o,u)}}class Ja{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ut{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,o){const u=nr[this.specification.type];return u?u(e,r,o):e}}class dt{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,o,u){return new _i(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},o,u)}:e.expression,r)}interpolate(e,r,o){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new _i(this,{kind:"constant",value:void 0},e.parameters);const u=nr[this.specification.type];if(u){const d=u(e.value.value,r.value.value,o);return new _i(this,{kind:"constant",value:d},e.parameters)}return e}evaluate(e,r,o,u,d,p){return e.kind==="constant"?e.value:e.evaluate(r,o,u,d,p)}}class el extends dt{possiblyEvaluate(e,r,o,u){if(e.value===void 0)return new _i(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const d=e.expression.evaluate(r,null,{},o,u),p=e.property.specification.type==="resolvedImage"&&typeof d!="string"?d.name:d,_=this._calculate(p,p,p,r);return new _i(this,{kind:"constant",value:_},r)}if(e.expression.kind==="camera"){const d=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new _i(this,{kind:"constant",value:d},r)}return new _i(this,e.expression,r)}evaluate(e,r,o,u,d,p){if(e.kind==="source"){const _=e.evaluate(r,o,u,d,p);return this._calculate(_,_,_,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},o,u),e.evaluate({zoom:Math.floor(r.zoom)},o,u),e.evaluate({zoom:Math.floor(r.zoom)+1},o,u),r):e.value}_calculate(e,r,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:o,to:r}}interpolate(e){return e}}class hu{constructor(e){this.specification=e}possiblyEvaluate(e,r,o,u){if(e.value!==void 0){if(e.expression.kind==="constant"){const d=e.expression.evaluate(r,null,{},o,u);return this._calculate(d,d,d,r)}return this._calculate(e.expression.evaluate(new Vt(Math.floor(r.zoom-1),r)),e.expression.evaluate(new Vt(Math.floor(r.zoom),r)),e.expression.evaluate(new Vt(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:o,to:r}}interpolate(e){return e}}class du{constructor(e){this.specification=e}possiblyEvaluate(e,r,o,u){return!!e.expression.evaluate(r,null,{},o,u)}interpolate(){return!1}}class Tn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const o=e[r];o.specification.overridable&&this.overridableProperties.push(r);const u=this.defaultPropertyValues[r]=new uu(o,void 0,void 0),d=this.defaultTransitionablePropertyValues[r]=new cu(o,void 0);this.defaultTransitioningPropertyValues[r]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=u.possiblyEvaluate({})}}}nt("DataDrivenProperty",dt),nt("DataConstantProperty",ut),nt("CrossFadedDataDrivenProperty",el),nt("CrossFadedProperty",hu),nt("ColorRampProperty",du);class ti extends zt{constructor(e,r,o){if(super(),this.id=e.id,this.type=e.type,this._globalState=o,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},this._visibilityExpression=function(u,d){return new Za(u,d)}(this.visibility,o),e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=ja(e.filter,o)),r.layout&&(this._unevaluatedLayout=new Pp(r.layout,o)),r.paint)){this._transitionablePaint=new th(r.paint,o);for(const u in e.paint)this.setPaintProperty(u,e.paint[u],{validate:!1});for(const u in e.layout)this.setLayoutProperty(u,e.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ja(r.paint)}}setFilter(e){this.filter=e,this._featureFilter=ja(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;for(const r of this._visibilityExpression.getGlobalStateRefs())e.add(r);if(this._unevaluatedLayout)for(const r in this._unevaluatedLayout._values){const o=this._unevaluatedLayout._values[r];for(const u of o.getGlobalStateRefs())e.add(u)}for(const r of this._featureFilter.getGlobalStateRefs())e.add(r);return e}getPaintAffectingGlobalStateRefs(){var e;const r=new globalThis.Map;if(this._transitionablePaint)for(const o in this._transitionablePaint._values){const u=this._transitionablePaint._values[o].value;for(const d of u.getGlobalStateRefs()){const p=(e=r.get(d))!==null&&e!==void 0?e:[];p.push({name:o,value:u.value}),r.set(d,p)}}return r}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(e,r,o={}){if(r==null||!this._validate(Zm,`layers.${this.id}.layout.${e}`,e,r,o))return e==="visibility"?(this.visibility=r,this._visibilityExpression.setValue(r),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(e,r)}getPaintProperty(e){return e.endsWith(Qa)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,o={}){if(r!=null&&this._validate(qm,`layers.${this.id}.paint.${e}`,e,r,o))return!1;if(e.endsWith(Qa))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const u=this._transitionablePaint._values[e],d=u.property.specification["property-type"]==="cross-faded-data-driven",p=u.value.isDataDriven(),_=u.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const x=this._transitionablePaint._values[e].value;return x.isDataDriven()||p||d||this._handleOverridablePaintPropertyUpdate(e,_,x)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,o){return!1}isHidden(e=this.minzoom,r=!1){return!!(this.minzoom&&e<(r?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),ya(e,(r,o)=>!(r===void 0||o==="layout"&&!Object.keys(r).length||o==="paint"&&!Object.keys(r).length))}_validate(e,r,o,u,d={}){return(!d||d.validate!==!1)&&Vo(this,e.call(Zr,{key:r,layerType:this.type,objectKey:o,value:u,styleSpec:Pe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof _i&&Oo(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}let rh;var Ep={get paint(){return rh=rh||new Tn({"raster-opacity":new ut(Pe.paint_raster["raster-opacity"]),"raster-hue-rotate":new ut(Pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ut(Pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ut(Pe.paint_raster["raster-brightness-max"]),"raster-saturation":new ut(Pe.paint_raster["raster-saturation"]),"raster-contrast":new ut(Pe.paint_raster["raster-contrast"]),"raster-resampling":new ut(Pe.paint_raster["raster-resampling"]),"raster-fade-duration":new ut(Pe.paint_raster["raster-fade-duration"])})}};class Xm extends ti{constructor(e,r){super(e,Ep,r)}}const Ym={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class tl{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ur{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Sr(n,e=1){let r=0,o=0;return{members:n.map(u=>{const d=Ym[u.type].BYTES_PER_ELEMENT,p=r=Ws(r,Math.max(e,d)),_=u.components||1;return o=Math.max(o,d),r+=d*_,{name:u.name,type:u.type,components:_,offset:p}}),size:Ws(r,Math.max(o,e)),alignment:e}}function Ws(n,e){return Math.ceil(n/e)*e}class rl extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const u=2*e;return this.int16[u+0]=r,this.int16[u+1]=o,e}}rl.prototype.bytesPerElement=4,nt("StructArrayLayout2i4",rl);class pu extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,o)}emplace(e,r,o,u){const d=3*e;return this.int16[d+0]=r,this.int16[d+1]=o,this.int16[d+2]=u,e}}pu.prototype.bytesPerElement=6,nt("StructArrayLayout3i6",pu);class nh extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,o,u)}emplace(e,r,o,u,d){const p=4*e;return this.int16[p+0]=r,this.int16[p+1]=o,this.int16[p+2]=u,this.int16[p+3]=d,e}}nh.prototype.bytesPerElement=8,nt("StructArrayLayout4i8",nh);class fu extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,u,d,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,o,u,d,p)}emplace(e,r,o,u,d,p,_){const x=6*e;return this.int16[x+0]=r,this.int16[x+1]=o,this.int16[x+2]=u,this.int16[x+3]=d,this.int16[x+4]=p,this.int16[x+5]=_,e}}fu.prototype.bytesPerElement=12,nt("StructArrayLayout2i4i12",fu);class ih extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,u,d,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,o,u,d,p)}emplace(e,r,o,u,d,p,_){const x=4*e,T=8*e;return this.int16[x+0]=r,this.int16[x+1]=o,this.uint8[T+4]=u,this.uint8[T+5]=d,this.uint8[T+6]=p,this.uint8[T+7]=_,e}}ih.prototype.bytesPerElement=8,nt("StructArrayLayout2i4ub8",ih);class nl extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const u=2*e;return this.float32[u+0]=r,this.float32[u+1]=o,e}}nl.prototype.bytesPerElement=8,nt("StructArrayLayout2f8",nl);class Wi extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,u,d,p,_,x,T,E){const I=this.length;return this.resize(I+1),this.emplace(I,e,r,o,u,d,p,_,x,T,E)}emplace(e,r,o,u,d,p,_,x,T,E,I){const A=10*e;return this.uint16[A+0]=r,this.uint16[A+1]=o,this.uint16[A+2]=u,this.uint16[A+3]=d,this.uint16[A+4]=p,this.uint16[A+5]=_,this.uint16[A+6]=x,this.uint16[A+7]=T,this.uint16[A+8]=E,this.uint16[A+9]=I,e}}Wi.prototype.bytesPerElement=20,nt("StructArrayLayout10ui20",Wi);class mu extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,u,d,p,_,x){const T=this.length;return this.resize(T+1),this.emplace(T,e,r,o,u,d,p,_,x)}emplace(e,r,o,u,d,p,_,x,T){const E=8*e;return this.uint16[E+0]=r,this.uint16[E+1]=o,this.uint16[E+2]=u,this.uint16[E+3]=d,this.uint16[E+4]=p,this.uint16[E+5]=_,this.uint16[E+6]=x,this.uint16[E+7]=T,e}}mu.prototype.bytesPerElement=16,nt("StructArrayLayout8ui16",mu);class il extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,u,d,p,_,x,T,E,I,A){const z=this.length;return this.resize(z+1),this.emplace(z,e,r,o,u,d,p,_,x,T,E,I,A)}emplace(e,r,o,u,d,p,_,x,T,E,I,A,z){const L=12*e;return this.int16[L+0]=r,this.int16[L+1]=o,this.int16[L+2]=u,this.int16[L+3]=d,this.uint16[L+4]=p,this.uint16[L+5]=_,this.uint16[L+6]=x,this.uint16[L+7]=T,this.int16[L+8]=E,this.int16[L+9]=I,this.int16[L+10]=A,this.int16[L+11]=z,e}}il.prototype.bytesPerElement=24,nt("StructArrayLayout4i4ui4i24",il);class gu extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,o)}emplace(e,r,o,u){const d=3*e;return this.float32[d+0]=r,this.float32[d+1]=o,this.float32[d+2]=u,e}}gu.prototype.bytesPerElement=12,nt("StructArrayLayout3f12",gu);class sl extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}sl.prototype.bytesPerElement=4,nt("StructArrayLayout1ul4",sl);class sh extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,u,d,p,_,x,T){const E=this.length;return this.resize(E+1),this.emplace(E,e,r,o,u,d,p,_,x,T)}emplace(e,r,o,u,d,p,_,x,T,E){const I=10*e,A=5*e;return this.int16[I+0]=r,this.int16[I+1]=o,this.int16[I+2]=u,this.int16[I+3]=d,this.int16[I+4]=p,this.int16[I+5]=_,this.uint32[A+3]=x,this.uint16[I+8]=T,this.uint16[I+9]=E,e}}sh.prototype.bytesPerElement=20,nt("StructArrayLayout6i1ul2ui20",sh);class qo extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,u,d,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,o,u,d,p)}emplace(e,r,o,u,d,p,_){const x=6*e;return this.int16[x+0]=r,this.int16[x+1]=o,this.int16[x+2]=u,this.int16[x+3]=d,this.int16[x+4]=p,this.int16[x+5]=_,e}}qo.prototype.bytesPerElement=12,nt("StructArrayLayout2i2i2i12",qo);class Hs extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,u,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,o,u,d)}emplace(e,r,o,u,d,p){const _=4*e,x=8*e;return this.float32[_+0]=r,this.float32[_+1]=o,this.float32[_+2]=u,this.int16[x+6]=d,this.int16[x+7]=p,e}}Hs.prototype.bytesPerElement=16,nt("StructArrayLayout2f1f2i16",Hs);class oh extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,u,d,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,o,u,d,p)}emplace(e,r,o,u,d,p,_){const x=16*e,T=4*e,E=8*e;return this.uint8[x+0]=r,this.uint8[x+1]=o,this.float32[T+1]=u,this.float32[T+2]=d,this.int16[E+6]=p,this.int16[E+7]=_,e}}oh.prototype.bytesPerElement=16,nt("StructArrayLayout2ub2f2i16",oh);class ol extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,o)}emplace(e,r,o,u){const d=3*e;return this.uint16[d+0]=r,this.uint16[d+1]=o,this.uint16[d+2]=u,e}}ol.prototype.bytesPerElement=6,nt("StructArrayLayout3ui6",ol);class Xs extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,u,d,p,_,x,T,E,I,A,z,L,F,O,$){const J=this.length;return this.resize(J+1),this.emplace(J,e,r,o,u,d,p,_,x,T,E,I,A,z,L,F,O,$)}emplace(e,r,o,u,d,p,_,x,T,E,I,A,z,L,F,O,$,J){const G=24*e,Z=12*e,te=48*e;return this.int16[G+0]=r,this.int16[G+1]=o,this.uint16[G+2]=u,this.uint16[G+3]=d,this.uint32[Z+2]=p,this.uint32[Z+3]=_,this.uint32[Z+4]=x,this.uint16[G+10]=T,this.uint16[G+11]=E,this.uint16[G+12]=I,this.float32[Z+7]=A,this.float32[Z+8]=z,this.uint8[te+36]=L,this.uint8[te+37]=F,this.uint8[te+38]=O,this.uint32[Z+10]=$,this.int16[G+22]=J,e}}Xs.prototype.bytesPerElement=48,nt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Xs);class ah extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,u,d,p,_,x,T,E,I,A,z,L,F,O,$,J,G,Z,te,oe,be,Le,ze,Oe,Ze,je){const De=this.length;return this.resize(De+1),this.emplace(De,e,r,o,u,d,p,_,x,T,E,I,A,z,L,F,O,$,J,G,Z,te,oe,be,Le,ze,Oe,Ze,je)}emplace(e,r,o,u,d,p,_,x,T,E,I,A,z,L,F,O,$,J,G,Z,te,oe,be,Le,ze,Oe,Ze,je,De){const Me=32*e,rt=16*e;return this.int16[Me+0]=r,this.int16[Me+1]=o,this.int16[Me+2]=u,this.int16[Me+3]=d,this.int16[Me+4]=p,this.int16[Me+5]=_,this.int16[Me+6]=x,this.int16[Me+7]=T,this.uint16[Me+8]=E,this.uint16[Me+9]=I,this.uint16[Me+10]=A,this.uint16[Me+11]=z,this.uint16[Me+12]=L,this.uint16[Me+13]=F,this.uint16[Me+14]=O,this.uint16[Me+15]=$,this.uint16[Me+16]=J,this.uint16[Me+17]=G,this.uint16[Me+18]=Z,this.uint16[Me+19]=te,this.uint16[Me+20]=oe,this.uint16[Me+21]=be,this.uint16[Me+22]=Le,this.uint32[rt+12]=ze,this.float32[rt+13]=Oe,this.float32[rt+14]=Ze,this.uint16[Me+30]=je,this.uint16[Me+31]=De,e}}ah.prototype.bytesPerElement=64,nt("StructArrayLayout8i15ui1ul2f2ui64",ah);class _u extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}_u.prototype.bytesPerElement=4,nt("StructArrayLayout1f4",_u);class yu extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,o)}emplace(e,r,o,u){const d=3*e;return this.uint16[6*e+0]=r,this.float32[d+1]=o,this.float32[d+2]=u,e}}yu.prototype.bytesPerElement=12,nt("StructArrayLayout1ui2f12",yu);class lh extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,o)}emplace(e,r,o,u){const d=4*e;return this.uint32[2*e+0]=r,this.uint16[d+2]=o,this.uint16[d+3]=u,e}}lh.prototype.bytesPerElement=8,nt("StructArrayLayout1ul2ui8",lh);class m extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const u=2*e;return this.uint16[u+0]=r,this.uint16[u+1]=o,e}}m.prototype.bytesPerElement=4,nt("StructArrayLayout2ui4",m);class t extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}t.prototype.bytesPerElement=2,nt("StructArrayLayout1ui2",t);class s extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,o,u)}emplace(e,r,o,u,d){const p=4*e;return this.float32[p+0]=r,this.float32[p+1]=o,this.float32[p+2]=u,this.float32[p+3]=d,e}}s.prototype.bytesPerElement=16,nt("StructArrayLayout4f16",s);class l extends tl{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new N(this.anchorPointX,this.anchorPointY)}}l.prototype.size=20;class h extends sh{get(e){return new l(this,e)}}nt("CollisionBoxArray",h);class g extends tl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}g.prototype.size=48;class y extends Xs{get(e){return new g(this,e)}}nt("PlacedSymbolArray",y);class b extends tl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}b.prototype.size=64;class P extends ah{get(e){return new b(this,e)}}nt("SymbolInstanceArray",P);class M extends _u{getoffsetX(e){return this.float32[1*e+0]}}nt("GlyphOffsetArray",M);class k extends pu{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}nt("SymbolLineVertexArray",k);class R extends tl{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}R.prototype.size=12;class D extends yu{get(e){return new R(this,e)}}nt("TextAnchorOffsetArray",D);class B extends tl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}B.prototype.size=8;class U extends lh{get(e){return new B(this,e)}}nt("FeatureIndexArray",U);class W extends rl{}class X extends rl{}class H extends rl{}class ee extends fu{}class ae extends ih{}class Q extends nl{}class ie extends Wi{}class ce extends mu{}class re extends il{}class ge extends gu{}class ke extends sl{}class Se extends qo{}class Ee extends oh{}class Ce extends ol{}class $e extends m{}const Ge=Sr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ne}=Ge;class He{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,r,o,u){const d=this.segments[this.segments.length-1];return e>He.MAX_VERTEX_ARRAY_LENGTH&&qr(`Max vertices per segment is ${He.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${He.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!d||d.vertexLength+e>He.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==u?this.createNewSegment(r,o,u):d}createNewSegment(e,r,o){const u={vertexOffset:e.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(u.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(u),u}getOrCreateLatestSegment(e,r,o){return this.prepareSegment(0,e,r,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,o,u){return new He([{vertexOffset:e,primitiveOffset:r,vertexLength:o,primitiveLength:u,vaos:{},sortKey:0}])}}function gt(n,e){return 256*(n=Vr(Math.floor(n),0,255))+Vr(Math.floor(e),0,255)}He.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,nt("SegmentVector",He);const Ft=Sr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),er=Sr([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Zt,ir,Wt,gr={exports:{}},sr={exports:{}},Wr={exports:{}},Mr=function(){if(Wt)return gr.exports;Wt=1;var n=(Zt||(Zt=1,sr.exports=function(r,o){var u,d,p,_,x,T,E,I;for(d=r.length-(u=3&r.length),p=o,x=3432918353,T=461845907,I=0;I<d;)E=255&r.charCodeAt(I)|(255&r.charCodeAt(++I))<<8|(255&r.charCodeAt(++I))<<16|(255&r.charCodeAt(++I))<<24,++I,p=27492+(65535&(_=5*(65535&(p=(p^=E=(65535&(E=(E=(65535&E)*x+(((E>>>16)*x&65535)<<16)&4294967295)<<15|E>>>17))*T+(((E>>>16)*T&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(E=0,u){case 3:E^=(255&r.charCodeAt(I+2))<<16;case 2:E^=(255&r.charCodeAt(I+1))<<8;case 1:p^=E=(65535&(E=(E=(65535&(E^=255&r.charCodeAt(I)))*x+(((E>>>16)*x&65535)<<16)&4294967295)<<15|E>>>17))*T+(((E>>>16)*T&65535)<<16)&4294967295}return p^=r.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}),sr.exports),e=(ir||(ir=1,Wr.exports=function(r,o){for(var u,d=r.length,p=o^d,_=0;d>=4;)u=1540483477*(65535&(u=255&r.charCodeAt(_)|(255&r.charCodeAt(++_))<<8|(255&r.charCodeAt(++_))<<16|(255&r.charCodeAt(++_))<<24))+((1540483477*(u>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),d-=4,++_;switch(d){case 3:p^=(255&r.charCodeAt(_+2))<<16;case 2:p^=(255&r.charCodeAt(_+1))<<8;case 1:p=1540483477*(65535&(p^=255&r.charCodeAt(_)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}),Wr.exports);return gr.exports=n,gr.exports.murmur3=n,gr.exports.murmur2=e,gr.exports}(),Pr=K(Mr);class nn{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,o,u){this.ids.push(xs(e)),this.positions.push(r,o,u)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=xs(e);let o=0,u=this.ids.length-1;for(;o<u;){const p=o+u>>1;this.ids[p]>=r?u=p:o=p+1}const d=[];for(;this.ids[o]===r;)d.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return d}static serialize(e,r){const o=new Float64Array(e.ids),u=new Uint32Array(e.positions);return Hi(o,u,0,o.length-1),r&&r.push(o.buffer,u.buffer),{ids:o,positions:u}}static deserialize(e){const r=new nn;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function xs(n){const e=+n;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Pr(String(n))}function Hi(n,e,r,o){for(;r<o;){const u=n[r+o>>1];let d=r-1,p=o+1;for(;;){do d++;while(n[d]<u);do p--;while(n[p]>u);if(d>=p)break;Di(n,d,p),Di(e,3*d,3*p),Di(e,3*d+1,3*p+1),Di(e,3*d+2,3*p+2)}p-r<o-p?(Hi(n,e,r,p),r=p+1):(Hi(n,e,p+1,o),o=p)}}function Di(n,e,r){const o=n[e];n[e]=n[r],n[r]=o}nt("FeaturePositionMap",nn);class zn{constructor(e,r){this.gl=e.gl,this.location=r}}class Ys extends zn{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class al extends zn{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Ks extends zn{constructor(e,r){super(e,r),this.current=St.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const ri=new Float32Array(16);function Ri(n){return[gt(255*n.r,255*n.g),gt(255*n.b,255*n.a)]}class yi{constructor(e,r,o){this.value=e,this.uniformNames=r.map(u=>`u_${u}`),this.type=o}setUniform(e,r,o){e.set(o.constantOr(this.value))}getBinding(e,r,o){return this.type==="color"?new Ks(e,r):new Ys(e,r)}}class vi{constructor(e,r){this.uniformNames=r.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,r){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,r.y,r.height,r.width]}setUniform(e,r,o,u){let d=null;u==="u_pattern_to"?d=this.patternTo:u==="u_pattern_from"?d=this.patternFrom:u==="u_dasharray_to"?d=this.dashTo:u==="u_dasharray_from"?d=this.dashFrom:u==="u_pixel_ratio_to"?d=this.pixelRatioTo:u==="u_pixel_ratio_from"&&(d=this.pixelRatioFrom),d!==null&&e.set(d)}getBinding(e,r,o){return o.substr(0,9)==="u_pattern"||o.substr(0,12)==="u_dasharray_"?new al(e,r):new Ys(e,r)}}class Xt{constructor(e,r,o,u){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=r.map(d=>({name:`a_${d}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,r,o){const u=this.paintVertexArray.length,d=this.expression.evaluate(new Vt(0,o),r,{},o.canonical,[],o.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(u,e,d)}updatePaintArray(e,r,o,u,d){const p=this.expression.evaluate(new Vt(0,d),o,u);this._setPaintValue(e,r,p)}_setPaintValue(e,r,o){if(this.type==="color"){const u=Ri(o);for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,u[0],u[1])}else{for(let u=e;u<r;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ht{constructor(e,r,o,u,d,p){this.expression=e,this.uniformNames=r.map(_=>`u_${_}_t`),this.type=o,this.useIntegerZoom=u,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=r.map(_=>({name:`a_${_}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,r,o){const u=this.expression.evaluate(new Vt(this.zoom,o),r,{},o.canonical,[],o.formattedSection),d=this.expression.evaluate(new Vt(this.zoom+1,o),r,{},o.canonical,[],o.formattedSection),p=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(p,e,u,d)}updatePaintArray(e,r,o,u,d){const p=this.expression.evaluate(new Vt(this.zoom,d),o,u),_=this.expression.evaluate(new Vt(this.zoom+1,d),o,u);this._setPaintValue(e,r,p,_)}_setPaintValue(e,r,o,u){if(this.type==="color"){const d=Ri(o),p=Ri(u);for(let _=e;_<r;_++)this.paintVertexArray.emplace(_,d[0],d[1],p[0],p[1])}else{for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,o,u);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const o=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,u=Vr(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(u)}getBinding(e,r,o){return new Ys(e,r)}}class Ur{constructor(e,r,o,u,d,p){this.expression=e,this.type=r,this.useIntegerZoom=o,this.zoom=u,this.layerId=p,this.zoomInPaintVertexArray=new d,this.zoomOutPaintVertexArray=new d}populatePaintArray(e,r,o){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,this.getPositionIds(r),o)}updatePaintArray(e,r,o,u,d){this._setPaintValues(e,r,this.getPositionIds(o),d)}_setPaintValues(e,r,o,u){const d=this.getPositions(u);if(!d||!o)return;const p=d[o.min],_=d[o.mid],x=d[o.max];if(p&&_&&x)for(let T=e;T<r;T++)this.emplace(this.zoomInPaintVertexArray,T,_,p),this.emplace(this.zoomOutPaintVertexArray,T,_,x)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const r=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,r,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,r,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class $r extends Ur{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return Ft.members}emplace(e,r,o,u){e.emplace(r,o.tlbr[0],o.tlbr[1],o.tlbr[2],o.tlbr[3],u.tlbr[0],u.tlbr[1],u.tlbr[2],u.tlbr[3],o.pixelRatio,u.pixelRatio)}}class Cp extends Ur{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return er.members}emplace(e,r,o,u){e.emplace(r,0,o.y,o.height,o.width,0,u.y,u.height,u.width)}}class Mp{constructor(e,r,o){this.binders={},this._buffers=[];const u=[];for(const d in e.paint._values){if(!o(d))continue;const p=e.paint.get(d);if(!(p instanceof _i&&Oo(p.property.specification)))continue;const _=Km(d,e.type),x=p.value,T=p.property.specification.type,E=p.property.useIntegerZoom,I=p.property.specification["property-type"],A=I==="cross-faded"||I==="cross-faded-data-driven";if(x.kind==="constant")this.binders[d]=A?new vi(x.value,_):new yi(x.value,_,T),u.push(`/u_${d}`);else if(x.kind==="source"||A){const z=Ip(d,T,"source");this.binders[d]=A?d==="line-dasharray"?new Cp(x,T,E,r,z,e.id):new $r(x,T,E,r,z,e.id):new Xt(x,_,T,z),u.push(`/a_${d}`)}else{const z=Ip(d,T,"composite");this.binders[d]=new Ht(x,_,T,E,r,z),u.push(`/z_${d}`)}}this.cacheKey=u.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof Xt||r instanceof Ht?r.maxValue:0}populatePaintArrays(e,r,o){for(const u in this.binders){const d=this.binders[u];(d instanceof Xt||d instanceof Ht||d instanceof Ur)&&d.populatePaintArray(e,r,o)}}setConstantPatternPositions(e,r){for(const o in this.binders){const u=this.binders[o];u instanceof vi&&u.setConstantPatternPositions(e,r)}}setConstantDashPositions(e,r){for(const o in this.binders){const u=this.binders[o];u instanceof vi&&u.setConstantDashPositions(e,r)}}updatePaintArrays(e,r,o,u,d){let p=!1;for(const _ in e){const x=r.getPositions(_);for(const T of x){const E=o.feature(T.index);for(const I in this.binders){const A=this.binders[I];if((A instanceof Xt||A instanceof Ht||A instanceof Ur)&&A.expression.isStateDependent===!0){const z=u.paint.get(I);A.expression=z.value,A.updatePaintArray(T.start,T.end,E,e[_],d),p=!0}}}}return p}defines(){const e=[];for(const r in this.binders){const o=this.binders[r];(o instanceof yi||o instanceof vi)&&e.push(...o.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof Xt||o instanceof Ht)for(let u=0;u<o.paintVertexAttributes.length;u++)e.push(o.paintVertexAttributes[u].name);else if(o instanceof Ur){const u=o.getVertexAttributes();for(const d of u)e.push(d.name)}}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof yi||o instanceof vi||o instanceof Ht)for(const u of o.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const o=[];for(const u in this.binders){const d=this.binders[u];if(d instanceof yi||d instanceof vi||d instanceof Ht){for(const p of d.uniformNames)if(r[p]){const _=d.getBinding(e,r[p],p);o.push({name:p,property:u,binding:_})}}}return o}setUniforms(e,r,o,u){for(const{name:d,property:p,binding:_}of r)this.binders[p].setUniform(_,u,o.get(p),d)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const o=this.binders[r];if(e&&o instanceof Ur){const u=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(o instanceof Xt||o instanceof Ht)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const r in this.binders){const o=this.binders[r];(o instanceof Xt||o instanceof Ht||o instanceof Ur)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof Xt||r instanceof Ht||r instanceof Ur)&&r.destroy()}}}class Qs{constructor(e,r,o=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new Mp(u,r,o);this.needsUpload=!1,this._featureMap=new nn,this._bufferOffset=0}populatePaintArrays(e,r,o,u){for(const d in this.programConfigurations)this.programConfigurations[d].populatePaintArrays(e,r,u);r.id!==void 0&&this._featureMap.add(r.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,o,u){for(const d of o)this.needsUpload=this.programConfigurations[d.id].updatePaintArrays(e,this._featureMap,r,d,u)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Km(n,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}function Ip(n,e,r){const o={color:{source:nl,composite:s},number:{source:_u,composite:nl}},u=function(d){return{"line-pattern":{source:ie,composite:ie},"fill-pattern":{source:ie,composite:ie},"fill-extrusion-pattern":{source:ie,composite:ie},"line-dasharray":{source:ce,composite:ce}}[d]}(n);return u&&u[r]||o[e][r]}nt("ConstantBinder",yi),nt("CrossFadedConstantBinder",vi),nt("SourceExpressionBinder",Xt),nt("CrossFadedPatternBinder",$r),nt("CrossFadedDasharrayBinder",Cp),nt("CompositeExpressionBinder",Ht),nt("ProgramConfiguration",Mp,{omit:["_buffers"]}),nt("ProgramConfigurationSet",Qs);const uh=Math.pow(2,14)-1,bs=-uh-1;function ws(n){const e=st/n.extent,r=n.loadGeometry();for(let o=0;o<r.length;o++){const u=r[o];for(let d=0;d<u.length;d++){const p=u[d],_=Math.round(p.x*e),x=Math.round(p.y*e);p.x=Vr(_,bs,uh),p.y=Vr(x,bs,uh),(_<p.x||_>p.x+1||x<p.y||x>p.y+1)&&qr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Ts(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?ws(n):[]}}const ch=-32768;function hh(n,e,r,o,u){n.emplaceBack(ch+8*e+o,ch+8*r+u)}class vu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new X,this.indexArray=new Ce,this.segments=new He,this.programConfigurations=new Qs(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){const u=this.layers[0],d=[];let p=null,_=!1,x=u.type==="heatmap";if(u.type==="circle"){const E=u;p=E.layout.get("circle-sort-key"),_=!p.isConstant(),x=x||E.paint.get("circle-pitch-alignment")==="map"}const T=x?r.subdivisionGranularity.circle:1;for(const{feature:E,id:I,index:A,sourceLayerIndex:z}of e){const L=this.layers[0]._featureFilter.needGeometry,F=Ts(E,L);if(!this.layers[0]._featureFilter.filter(new Vt(this.zoom),F,o))continue;const O=_?p.evaluate(F,{},o):void 0,$={id:I,properties:E.properties,type:E.type,sourceLayerIndex:z,index:A,geometry:L?F.geometry:ws(E),patterns:{},sortKey:O};d.push($)}_&&d.sort((E,I)=>E.sortKey-I.sortKey);for(const E of d){const{geometry:I,index:A,sourceLayerIndex:z}=E,L=e[A].feature;this.addFeature(E,I,A,o,T),r.featureIndex.insert(L,I,A,z,this.index)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ne),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,o,u,d=1){let p;switch(d){case 1:p=[0,7];break;case 3:p=[0,2,5,7];break;case 5:p=[0,1,3,4,6,7];break;case 7:p=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${d}; valid values are 1, 3, 5, 7.`)}const _=p.length;for(const x of r)for(const T of x){const E=T.x,I=T.y;if(E<0||E>=st||I<0||I>=st)continue;const A=this.segments.prepareSegment(_*_,this.layoutVertexArray,this.indexArray,e.sortKey),z=A.vertexLength;for(let L=0;L<_;L++)for(let F=0;F<_;F++)hh(this.layoutVertexArray,E,I,p[F],p[L]);for(let L=0;L<_-1;L++)for(let F=0;F<_-1;F++){const O=z+L*_+F,$=z+(L+1)*_+F;this.indexArray.emplaceBack(O,$+1,O+1),this.indexArray.emplaceBack(O,$,$+1)}A.vertexLength+=_*_,A.primitiveLength+=(_-1)*(_-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:{},canonical:u})}}function xu(n,e){for(let r=0;r<n.length;r++)if(bu(e,n[r]))return!0;for(let r=0;r<e.length;r++)if(bu(n,e[r]))return!0;return!!Qm(n,e)}function kp(n,e,r){return!!bu(n,e)||!!Jm(e,n,r)}function xv(n,e){if(n.length===1)return wv(e,n[0]);for(let r=0;r<e.length;r++){const o=e[r];for(let u=0;u<o.length;u++)if(bu(n,o[u]))return!0}for(let r=0;r<n.length;r++)if(wv(e,n[r]))return!0;for(let r=0;r<e.length;r++)if(Qm(n,e[r]))return!0;return!1}function k2(n,e,r){if(n.length>1){if(Qm(n,e))return!0;for(let o=0;o<e.length;o++)if(Jm(e[o],n,r))return!0}for(let o=0;o<n.length;o++)if(Jm(n[o],e,r))return!0;return!1}function Qm(n,e){if(n.length===0||e.length===0)return!1;for(let r=0;r<n.length-1;r++){const o=n[r],u=n[r+1];for(let d=0;d<e.length-1;d++)if(A2(o,u,e[d],e[d+1]))return!0}return!1}function A2(n,e,r,o){return Yn(n,r,o)!==Yn(e,r,o)&&Yn(n,e,r)!==Yn(n,e,o)}function Jm(n,e,r){const o=r*r;if(e.length===1)return n.distSqr(e[0])<o;for(let u=1;u<e.length;u++)if(bv(n,e[u-1],e[u])<o)return!0;return!1}function bv(n,e,r){const o=e.distSqr(r);if(o===0)return n.distSqr(e);const u=((n.x-e.x)*(r.x-e.x)+(n.y-e.y)*(r.y-e.y))/o;return n.distSqr(u<0?e:u>1?r:r.sub(e)._mult(u)._add(e))}function wv(n,e){let r,o,u,d=!1;for(let p=0;p<n.length;p++){r=n[p];for(let _=0,x=r.length-1;_<r.length;x=_++)o=r[_],u=r[x],o.y>e.y!=u.y>e.y&&e.x<(u.x-o.x)*(e.y-o.y)/(u.y-o.y)+o.x&&(d=!d)}return d}function bu(n,e){let r=!1;for(let o=0,u=n.length-1;o<n.length;u=o++){const d=n[o],p=n[u];d.y>e.y!=p.y>e.y&&e.x<(p.x-d.x)*(e.y-d.y)/(p.y-d.y)+d.x&&(r=!r)}return r}function z2(n,e,r){const o=r[0],u=r[2];if(n.x<o.x&&e.x<o.x||n.x>u.x&&e.x>u.x||n.y<o.y&&e.y<o.y||n.y>u.y&&e.y>u.y)return!1;const d=Yn(n,e,r[0]);return d!==Yn(n,e,r[1])||d!==Yn(n,e,r[2])||d!==Yn(n,e,r[3])}function wu(n,e,r){const o=e.paint.get(n).value;return o.kind==="constant"?o.value:r.programConfigurations.get(e.id).getMaxValue(n)}function Ap(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function zp(n,e,r,o,u){if(!e[0]&&!e[1])return n;const d=N.convert(e)._mult(u);r==="viewport"&&d._rotate(-o);const p=[];for(let _=0;_<n.length;_++)p.push(n[_].sub(d));return p}function D2(n){const e=[];for(let r=0;r<n.length;r++){const o=n[r],u=e.at(-1);(r===0||u&&!o.equals(u))&&e.push(o)}return e}function R2({queryGeometry:n,size:e},r){return kp(n,r,e)}function L2({queryGeometry:n,size:e,transform:r,unwrappedTileID:o,getElevation:u},d){return kp(n,d,e*(r.projectTileCoordinates(d.x,d.y,o,u).signedDistanceFromCamera/r.cameraToCenterDistance))}function F2({queryGeometry:n,size:e,transform:r,unwrappedTileID:o,getElevation:u},d){const p=r.projectTileCoordinates(d.x,d.y,o,u).signedDistanceFromCamera,_=e*(r.cameraToCenterDistance/p);return kp(n,eg(d,r,o,u),_)}function B2({queryGeometry:n,size:e,transform:r,unwrappedTileID:o,getElevation:u},d){return kp(n,eg(d,r,o,u),e)}function Tv({queryGeometry:n,size:e,transform:r,unwrappedTileID:o,getElevation:u,pitchAlignment:d="map",pitchScale:p="map"},_){const x=d==="map"?p==="map"?R2:L2:p==="map"?F2:B2,T={queryGeometry:n,size:e,transform:r,unwrappedTileID:o,getElevation:u};for(const E of _)for(const I of E)if(x(T,I))return!0;return!1}function eg(n,e,r,o){const u=e.projectTileCoordinates(n.x,n.y,r,o).point;return new N((.5*u.x+.5)*e.width,(.5*-u.y+.5)*e.height)}let Sv,Pv;nt("CircleBucket",vu,{omit:["layers"]});var O2={get paint(){return Pv=Pv||new Tn({"circle-radius":new dt(Pe.paint_circle["circle-radius"]),"circle-color":new dt(Pe.paint_circle["circle-color"]),"circle-blur":new dt(Pe.paint_circle["circle-blur"]),"circle-opacity":new dt(Pe.paint_circle["circle-opacity"]),"circle-translate":new ut(Pe.paint_circle["circle-translate"]),"circle-translate-anchor":new ut(Pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ut(Pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ut(Pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new dt(Pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new dt(Pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new dt(Pe.paint_circle["circle-stroke-opacity"])})},get layout(){return Sv=Sv||new Tn({"circle-sort-key":new dt(Pe.layout_circle["circle-sort-key"])})}};class N2 extends ti{constructor(e,r){super(e,O2,r)}createBucket(e){return new vu(e)}queryRadius(e){const r=e;return wu("circle-radius",this,r)+wu("circle-stroke-width",this,r)+Ap(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:o,geometry:u,transform:d,pixelsToTileUnits:p,unwrappedTileID:_,getElevation:x}){const T=zp(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-d.bearingInRadians,p),E=this.paint.get("circle-radius").evaluate(r,o)+this.paint.get("circle-stroke-width").evaluate(r,o),I=this.paint.get("circle-pitch-scale"),A=this.paint.get("circle-pitch-alignment");let z,L;return A==="map"?(z=T,L=E*p):(z=function(F,O,$,J){return F.map(G=>eg(G,O,$,J))}(T,d,_,x),L=E),Tv({queryGeometry:z,size:L,transform:d,unwrappedTileID:_,getElevation:x,pitchAlignment:A,pitchScale:I},u)}}class Ev extends vu{}let Cv;nt("HeatmapBucket",Ev,{omit:["layers"]});var j2={get paint(){return Cv=Cv||new Tn({"heatmap-radius":new dt(Pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new dt(Pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ut(Pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new du(Pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ut(Pe.paint_heatmap["heatmap-opacity"])})}};function tg(n,{width:e,height:r},o,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*r*o)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${e*r*o}`)}else u=new Uint8Array(e*r*o);return n.width=e,n.height=r,n.data=u,n}function Mv(n,{width:e,height:r},o){if(e===n.width&&r===n.height)return;const u=tg({},{width:e,height:r},o);rg(n,u,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,e),height:Math.min(n.height,r)},o),n.width=e,n.height=r,n.data=u.data}function rg(n,e,r,o,u,d){if(u.width===0||u.height===0)return e;if(u.width>n.width||u.height>n.height||r.x>n.width-u.width||r.y>n.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||o.x>e.width-u.width||o.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const p=n.data,_=e.data;if(p===_)throw new Error("srcData equals dstData, so image is already copied");for(let x=0;x<u.height;x++){const T=((r.y+x)*n.width+r.x)*d,E=((o.y+x)*e.width+o.x)*d;for(let I=0;I<u.width*d;I++)_[E+I]=p[T+I]}return e}class dh{constructor(e,r){tg(this,e,1,r)}resize(e){Mv(this,e,1)}clone(){return new dh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,o,u,d){rg(e,r,o,u,d,1)}}class Un{constructor(e,r){tg(this,e,4,r)}resize(e){Mv(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Un({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,o,u,d){rg(e,r,o,u,d,4)}setPixel(e,r,o){const u=4*(e*this.width+r);this.data[u+0]=Math.round(255*o.r/o.a),this.data[u+1]=Math.round(255*o.g/o.a),this.data[u+2]=Math.round(255*o.b/o.a),this.data[u+3]=Math.round(255*o.a)}}function Iv(n){const e={},r=n.resolution||256,o=n.clips?n.clips.length:1,u=n.image||new Un({width:r,height:o});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const d=(p,_,x)=>{e[n.evaluationKey]=x;const T=n.expression.evaluate(e);u.setPixel(p/4/r,_/4,T)};if(n.clips)for(let p=0,_=0;p<o;++p,_+=4*r)for(let x=0,T=0;x<r;x++,T+=4){const E=x/(r-1),{start:I,end:A}=n.clips[p];d(_,T,I*(1-E)+A*E)}else for(let p=0,_=0;p<r;p++,_+=4)d(0,_,p/(r-1));return u}nt("AlphaImage",dh),nt("RGBAImage",Un);const ng="big-fb";class V2 extends ti{createBucket(e){return new Ev(e)}constructor(e,r){super(e,j2,r),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Iv({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(ng)&&this.heatmapFbos.delete(ng)}queryRadius(e){return wu("heatmap-radius",this,e)}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:o,geometry:u,transform:d,pixelsToTileUnits:p,unwrappedTileID:_,getElevation:x}){return Tv({queryGeometry:e,size:this.paint.get("heatmap-radius").evaluate(r,o)*p,transform:d,unwrappedTileID:_,getElevation:x},u)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let kv;var U2={get paint(){return kv=kv||new Tn({"hillshade-illumination-direction":new ut(Pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new ut(Pe.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new ut(Pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ut(Pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ut(Pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ut(Pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ut(Pe.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new ut(Pe.paint_hillshade["hillshade-method"])})}};class $2 extends ti{constructor(e,r){super(e,U2,r),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,r=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,u=this.paint.get("hillshade-shadow-color").values;const d=Math.max(e.length,r.length,o.length,u.length);e=e.concat(Array(d-e.length).fill(e.at(-1))),r=r.concat(Array(d-r.length).fill(r.at(-1))),o=o.concat(Array(d-o.length).fill(o.at(-1))),u=u.concat(Array(d-u.length).fill(u.at(-1)));const p=r.map(vo);return{directionRadians:e.map(vo),altitudeRadians:p,shadowColor:u,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let Av;var G2={get paint(){return Av=Av||new Tn({"color-relief-opacity":new ut(Pe["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new du(Pe["paint_color-relief"]["color-relief-color"])})}};class ig{constructor(e,r,o,u){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(r,u)}update(e,r,o){const{width:u,height:d}=e,p=!(this.size&&this.size[0]===u&&this.size[1]===d||o),{context:_}=this,{gl:x}=_;if(this.useMipmap=!!(r&&r.useMipmap),x.bindTexture(x.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!r||r.premultiply!==!1)),p)this.size=[u,d],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||us(e)?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,e):x.texImage2D(x.TEXTURE_2D,0,this.format,u,d,0,this.format,x.UNSIGNED_BYTE,e.data);else{const{x:T,y:E}=o||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||us(e)?x.texSubImage2D(x.TEXTURE_2D,0,T,E,x.RGBA,x.UNSIGNED_BYTE,e):x.texSubImage2D(x.TEXTURE_2D,0,T,E,u,d,x.RGBA,x.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&x.generateMipmap(x.TEXTURE_2D),_.pixelStoreUnpackFlipY.setDefault(),_.pixelStoreUnpack.setDefault(),_.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,r,o){const{context:u}=this,{gl:d}=u;d.bindTexture(d.TEXTURE_2D,this.texture),o!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=d.LINEAR),e!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,o||e),this.filter=e),r!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,r),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class zv{constructor(e,r,o,u=1,d=1,p=1,_=0){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void qr(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const x=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=u,this.greenFactor=d,this.blueFactor=p,this.baseShift=_;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let T=0;T<x;T++)this.data[this._idx(-1,T)]=this.data[this._idx(0,T)],this.data[this._idx(x,T)]=this.data[this._idx(x-1,T)],this.data[this._idx(T,-1)]=this.data[this._idx(T,0)],this.data[this._idx(T,x)]=this.data[this._idx(T,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let T=0;T<x;T++)for(let E=0;E<x;E++){const I=this.get(T,E);I>this.max&&(this.max=I),I<this.min&&(this.min=I)}}get(e,r){const o=new Uint8Array(this.data.buffer),u=4*this._idx(e,r);return this.unpack(o[u],o[u+1],o[u+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${e}, y: ${r}, dim: ${this.dim}`);return(r+1)*this.stride+(e+1)}unpack(e,r,o){return e*this.redFactor+r*this.greenFactor+o*this.blueFactor-this.baseShift}pack(e){return Dv(e,this.getUnpackVector())}getPixels(){return new Un({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=r*this.dim,d=r*this.dim+this.dim,p=o*this.dim,_=o*this.dim+this.dim;switch(r){case-1:u=d-1;break;case 1:d=u+1}switch(o){case-1:p=_-1;break;case 1:_=p+1}const x=-r*this.dim,T=-o*this.dim;for(let E=p;E<_;E++)for(let I=u;I<d;I++)this.data[this._idx(I,E)]=e.data[this._idx(I+x,E+T)]}}function Dv(n,e){const r=e[0],o=e[1],u=e[2],d=e[3],p=Math.min(r,o,u),_=Math.round((n+d)/p);return{r:Math.floor(_*p/r)%256,g:Math.floor(_*p/o)%256,b:Math.floor(_*p/u)%256}}nt("DEMData",zv);class q2 extends ti{constructor(e,r){super(e,G2,r)}_createColorRamp(e){const r={elevationStops:[],colorStops:[]},o=this._transitionablePaint._values["color-relief-color"].value.expression;if(o instanceof Jl&&o._styleExpression.expression instanceof wn){this.colorRampExpression=o;const p=o._styleExpression.expression;r.elevationStops=p.labels,r.colorStops=[];for(const _ of r.elevationStops)r.colorStops.push(p.evaluate({globals:{elevation:_}}))}if(r.elevationStops.length<1&&(r.elevationStops=[0],r.colorStops=[St.transparent]),r.elevationStops.length<2&&(r.elevationStops.push(r.elevationStops[0]+1),r.colorStops.push(r.colorStops[0])),r.elevationStops.length<=e)return r;const u={elevationStops:[],colorStops:[]},d=(r.elevationStops.length-1)/(e-1);for(let p=0;p<r.elevationStops.length-.5;p+=d)u.elevationStops.push(r.elevationStops[Math.round(p)]),u.colorStops.push(r.colorStops[Math.round(p)]);return qr(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${e}, provided: ${r.elevationStops.length}`),u}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,r,o){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const u=this._createColorRamp(r),d=new Un({width:u.colorStops.length,height:1}),p=new Un({width:u.colorStops.length,height:1});for(let _=0;_<u.elevationStops.length;_++){const x=Dv(u.elevationStops[_],o);p.setPixel(0,_,new St(x.r/255,x.g/255,x.b/255,1)),d.setPixel(0,_,u.colorStops[_])}return this.colorRampTextures={elevationTexture:new ig(e,p,e.gl.RGBA),colorTexture:new ig(e,d,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const Z2=Sr([{name:"a_pos",components:2,type:"Int16"}],4),{members:W2}=Z2;function Dp(n,e,r){const o=r.patternDependencies;let u=!1;for(const d of e){const p=d.paint.get(`${n}-pattern`);p.isConstant()||(u=!0);const _=p.constantOr(null);_&&(u=!0,o[_.to]=!0,o[_.from]=!0)}return u}function sg(n,e,r,o,u){const{zoom:d}=o,p=u.patternDependencies;for(const _ of e){const x=_.paint.get(`${n}-pattern`).value;if(x.kind!=="constant"){let T=x.evaluate({zoom:d-1},r,{},u.availableImages),E=x.evaluate({zoom:d},r,{},u.availableImages),I=x.evaluate({zoom:d+1},r,{},u.availableImages);T=T&&T.name?T.name:T,E=E&&E.name?E.name:E,I=I&&I.name?I.name:I,p[T]=!0,p[E]=!0,p[I]=!0,r.patterns[_.id]={min:T,mid:E,max:I}}}return r}function Rv(n,e,r,o,u){let d;if(u===function(p,_,x,T){let E=0;for(let I=_,A=x-T;I<x;I+=T)E+=(p[A]-p[I])*(p[I+1]+p[A+1]),A=I;return E}(n,e,r,o)>0)for(let p=e;p<r;p+=o)d=Ov(p/o|0,n[p],n[p+1],d);else for(let p=r-o;p>=e;p-=o)d=Ov(p/o|0,n[p],n[p+1],d);return d&&Tu(d,d.next)&&(gh(d),d=d.next),d}function ll(n,e){if(!n)return n;e||(e=n);let r,o=n;do if(r=!1,o.steiner||!Tu(o,o.next)&&Ir(o.prev,o,o.next)!==0)o=o.next;else{if(gh(o),o=e=o.prev,o===o.next)break;r=!0}while(r||o!==e);return e}function ph(n,e,r,o,u,d,p){if(!n)return;!p&&d&&function(x,T,E,I){let A=x;do A.z===0&&(A.z=og(A.x,A.y,T,E,I)),A.prevZ=A.prev,A.nextZ=A.next,A=A.next;while(A!==x);A.prevZ.nextZ=null,A.prevZ=null,function(z){let L,F=1;do{let O,$=z;z=null;let J=null;for(L=0;$;){L++;let G=$,Z=0;for(let oe=0;oe<F&&(Z++,G=G.nextZ,G);oe++);let te=F;for(;Z>0||te>0&&G;)Z!==0&&(te===0||!G||$.z<=G.z)?(O=$,$=$.nextZ,Z--):(O=G,G=G.nextZ,te--),J?J.nextZ=O:z=O,O.prevZ=J,J=O;$=G}J.nextZ=null,F*=2}while(L>1)}(A)}(n,o,u,d);let _=n;for(;n.prev!==n.next;){const x=n.prev,T=n.next;if(d?X2(n,o,u,d):H2(n))e.push(x.i,n.i,T.i),gh(n),n=T.next,_=T.next;else if((n=T)===_){p?p===1?ph(n=Y2(ll(n),e),e,r,o,u,d,2):p===2&&K2(n,e,r,o,u,d):ph(ll(n),e,r,o,u,d,1);break}}}function H2(n){const e=n.prev,r=n,o=n.next;if(Ir(e,r,o)>=0)return!1;const u=e.x,d=r.x,p=o.x,_=e.y,x=r.y,T=o.y,E=Math.min(u,d,p),I=Math.min(_,x,T),A=Math.max(u,d,p),z=Math.max(_,x,T);let L=o.next;for(;L!==e;){if(L.x>=E&&L.x<=A&&L.y>=I&&L.y<=z&&fh(u,_,d,x,p,T,L.x,L.y)&&Ir(L.prev,L,L.next)>=0)return!1;L=L.next}return!0}function X2(n,e,r,o){const u=n.prev,d=n,p=n.next;if(Ir(u,d,p)>=0)return!1;const _=u.x,x=d.x,T=p.x,E=u.y,I=d.y,A=p.y,z=Math.min(_,x,T),L=Math.min(E,I,A),F=Math.max(_,x,T),O=Math.max(E,I,A),$=og(z,L,e,r,o),J=og(F,O,e,r,o);let G=n.prevZ,Z=n.nextZ;for(;G&&G.z>=$&&Z&&Z.z<=J;){if(G.x>=z&&G.x<=F&&G.y>=L&&G.y<=O&&G!==u&&G!==p&&fh(_,E,x,I,T,A,G.x,G.y)&&Ir(G.prev,G,G.next)>=0||(G=G.prevZ,Z.x>=z&&Z.x<=F&&Z.y>=L&&Z.y<=O&&Z!==u&&Z!==p&&fh(_,E,x,I,T,A,Z.x,Z.y)&&Ir(Z.prev,Z,Z.next)>=0))return!1;Z=Z.nextZ}for(;G&&G.z>=$;){if(G.x>=z&&G.x<=F&&G.y>=L&&G.y<=O&&G!==u&&G!==p&&fh(_,E,x,I,T,A,G.x,G.y)&&Ir(G.prev,G,G.next)>=0)return!1;G=G.prevZ}for(;Z&&Z.z<=J;){if(Z.x>=z&&Z.x<=F&&Z.y>=L&&Z.y<=O&&Z!==u&&Z!==p&&fh(_,E,x,I,T,A,Z.x,Z.y)&&Ir(Z.prev,Z,Z.next)>=0)return!1;Z=Z.nextZ}return!0}function Y2(n,e){let r=n;do{const o=r.prev,u=r.next.next;!Tu(o,u)&&Fv(o,r,r.next,u)&&mh(o,u)&&mh(u,o)&&(e.push(o.i,r.i,u.i),gh(r),gh(r.next),r=n=u),r=r.next}while(r!==n);return ll(r)}function K2(n,e,r,o,u,d){let p=n;do{let _=p.next.next;for(;_!==p.prev;){if(p.i!==_.i&&rT(p,_)){let x=Bv(p,_);return p=ll(p,p.next),x=ll(x,x.next),ph(p,e,r,o,u,d,0),void ph(x,e,r,o,u,d,0)}_=_.next}p=p.next}while(p!==n)}function Q2(n,e){let r=n.x-e.x;return r===0&&(r=n.y-e.y,r===0)&&(r=(n.next.y-n.y)/(n.next.x-n.x)-(e.next.y-e.y)/(e.next.x-e.x)),r}function J2(n,e){const r=function(u,d){let p=d;const _=u.x,x=u.y;let T,E=-1/0;if(Tu(u,p))return p;do{if(Tu(u,p.next))return p.next;if(x<=p.y&&x>=p.next.y&&p.next.y!==p.y){const F=p.x+(x-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(F<=_&&F>E&&(E=F,T=p.x<p.next.x?p:p.next,F===_))return T}p=p.next}while(p!==d);if(!T)return null;const I=T,A=T.x,z=T.y;let L=1/0;p=T;do{if(_>=p.x&&p.x>=A&&_!==p.x&&Lv(x<z?_:E,x,A,z,x<z?E:_,x,p.x,p.y)){const F=Math.abs(x-p.y)/(_-p.x);mh(p,u)&&(F<L||F===L&&(p.x>T.x||p.x===T.x&&eT(T,p)))&&(T=p,L=F)}p=p.next}while(p!==I);return T}(n,e);if(!r)return e;const o=Bv(r,n);return ll(o,o.next),ll(r,r.next)}function eT(n,e){return Ir(n.prev,n,e.prev)<0&&Ir(e.next,n,n.next)<0}function og(n,e,r,o,u){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*u|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function tT(n){let e=n,r=n;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==n);return r}function Lv(n,e,r,o,u,d,p,_){return(u-p)*(e-_)>=(n-p)*(d-_)&&(n-p)*(o-_)>=(r-p)*(e-_)&&(r-p)*(d-_)>=(u-p)*(o-_)}function fh(n,e,r,o,u,d,p,_){return!(n===p&&e===_)&&Lv(n,e,r,o,u,d,p,_)}function rT(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(r,o){let u=r;do{if(u.i!==r.i&&u.next.i!==r.i&&u.i!==o.i&&u.next.i!==o.i&&Fv(u,u.next,r,o))return!0;u=u.next}while(u!==r);return!1}(n,e)&&(mh(n,e)&&mh(e,n)&&function(r,o){let u=r,d=!1;const p=(r.x+o.x)/2,_=(r.y+o.y)/2;do u.y>_!=u.next.y>_&&u.next.y!==u.y&&p<(u.next.x-u.x)*(_-u.y)/(u.next.y-u.y)+u.x&&(d=!d),u=u.next;while(u!==r);return d}(n,e)&&(Ir(n.prev,n,e.prev)||Ir(n,e.prev,e))||Tu(n,e)&&Ir(n.prev,n,n.next)>0&&Ir(e.prev,e,e.next)>0)}function Ir(n,e,r){return(e.y-n.y)*(r.x-e.x)-(e.x-n.x)*(r.y-e.y)}function Tu(n,e){return n.x===e.x&&n.y===e.y}function Fv(n,e,r,o){const u=Lp(Ir(n,e,r)),d=Lp(Ir(n,e,o)),p=Lp(Ir(r,o,n)),_=Lp(Ir(r,o,e));return u!==d&&p!==_||!(u!==0||!Rp(n,r,e))||!(d!==0||!Rp(n,o,e))||!(p!==0||!Rp(r,n,o))||!(_!==0||!Rp(r,e,o))}function Rp(n,e,r){return e.x<=Math.max(n.x,r.x)&&e.x>=Math.min(n.x,r.x)&&e.y<=Math.max(n.y,r.y)&&e.y>=Math.min(n.y,r.y)}function Lp(n){return n>0?1:n<0?-1:0}function mh(n,e){return Ir(n.prev,n,n.next)<0?Ir(n,e,n.next)>=0&&Ir(n,n.prev,e)>=0:Ir(n,e,n.prev)<0||Ir(n,n.next,e)<0}function Bv(n,e){const r=ag(n.i,n.x,n.y),o=ag(e.i,e.x,e.y),u=n.next,d=e.prev;return n.next=e,e.prev=n,r.next=u,u.prev=r,o.next=r,r.prev=o,d.next=o,o.prev=d,o}function Ov(n,e,r,o){const u=ag(n,e,r);return o?(u.next=o.next,u.prev=o,o.next.prev=u,o.next=u):(u.prev=u,u.next=u),u}function gh(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function ag(n,e,r){return{i:n,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Su{constructor(e,r){if(r>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=r}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class Fp{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}Fp.noSubdivision=new Fp({fill:new Su(0,0),line:new Su(0,0),tile:new Su(0,0),stencil:new Su(0,0),circle:1}),nt("SubdivisionGranularityExpression",Su),nt("SubdivisionGranularitySetting",Fp);const Pu=-32768,_h=32767;class nT{constructor(e,r){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=st/e,this._canonical=r}_getKey(e,r){return(e+=32768)<<16|r+32768}_vertexToIndex(e,r){if(e<-32768||r<-32768||e>32767||r>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(e),u=0|Math.round(r),d=this._getKey(o,u);if(this._vertexDictionary.has(d))return this._vertexDictionary.get(d);const p=this._vertexBuffer.length/2;return this._vertexDictionary.set(d,p),this._vertexBuffer.push(o,u),p}_subdivideTrianglesScanline(e){if(this._granularity<2)return function(u,d){const p=[];for(let _=0;_<d.length;_+=3){const x=d[_],T=d[_+1],E=d[_+2],I=u[2*x],A=u[2*x+1];(u[2*T]-I)*(u[2*E+1]-A)-(u[2*T+1]-A)*(u[2*E]-I)>0?(p.push(x),p.push(E),p.push(T)):(p.push(x),p.push(T),p.push(E))}return p}(this._vertexBuffer,e);const r=[],o=e.length;for(let u=0;u<o;u+=3){const d=[e[u+0],e[u+1],e[u+2]],p=[this._vertexBuffer[2*e[u+0]+0],this._vertexBuffer[2*e[u+0]+1],this._vertexBuffer[2*e[u+1]+0],this._vertexBuffer[2*e[u+1]+1],this._vertexBuffer[2*e[u+2]+0],this._vertexBuffer[2*e[u+2]+1]];let _=1/0,x=1/0,T=-1/0,E=-1/0;for(let F=0;F<3;F++){const O=p[2*F],$=p[2*F+1];_=Math.min(_,O),T=Math.max(T,O),x=Math.min(x,$),E=Math.max(E,$)}if(_===T||x===E)continue;const I=Math.floor(_/this._granularityCellSize),A=Math.ceil(T/this._granularityCellSize),z=Math.floor(x/this._granularityCellSize),L=Math.ceil(E/this._granularityCellSize);if(I!==A||z!==L)for(let F=z;F<L;F++){const O=this._scanlineGenerateVertexRingForCellRow(F,p,d);iT(this._vertexBuffer,O,r)}else r.push(...d)}return r}_scanlineGenerateVertexRingForCellRow(e,r,o){const u=e*this._granularityCellSize,d=u+this._granularityCellSize,p=[];for(let _=0;_<3;_++){const x=r[2*_],T=r[2*_+1],E=r[2*(_+1)%6],I=r[(2*(_+1)+1)%6],A=r[2*(_+2)%6],z=r[(2*(_+2)+1)%6],L=E-x,F=I-T,O=L===0,$=F===0,J=(u-T)/F,G=(d-T)/F,Z=Math.min(J,G),te=Math.max(J,G);if(!$&&(Z>=1||te<=0)||$&&(T<u||T>d)){I>=u&&I<=d&&p.push(o[(_+1)%3]);continue}!$&&Z>0&&p.push(this._vertexToIndex(x+L*Z,T+F*Z));const oe=x+L*Math.max(Z,0),be=x+L*Math.min(te,1);O||this._generateIntraEdgeVertices(p,x,T,E,I,oe,be),!$&&te<1&&p.push(this._vertexToIndex(x+L*te,T+F*te)),($||I>=u&&I<=d)&&p.push(o[(_+1)%3]),!$&&(I<=u||I>=d)&&this._generateInterEdgeVertices(p,x,T,E,I,A,z,be,u,d)}return p}_generateIntraEdgeVertices(e,r,o,u,d,p,_){const x=u-r,T=d-o,E=T===0,I=E?Math.min(r,u):Math.min(p,_),A=E?Math.max(r,u):Math.max(p,_),z=Math.floor(I/this._granularityCellSize)+1,L=Math.ceil(A/this._granularityCellSize)-1;if(E?r<u:p<_)for(let F=z;F<=L;F++){const O=F*this._granularityCellSize;e.push(this._vertexToIndex(O,o+T*(O-r)/x))}else for(let F=L;F>=z;F--){const O=F*this._granularityCellSize;e.push(this._vertexToIndex(O,o+T*(O-r)/x))}}_generateInterEdgeVertices(e,r,o,u,d,p,_,x,T,E){const I=d-o,A=p-u,z=_-d,L=(T-d)/z,F=(E-d)/z,O=Math.min(L,F),$=Math.max(L,F),J=u+A*O;let G=Math.floor(Math.min(J,x)/this._granularityCellSize)+1,Z=Math.ceil(Math.max(J,x)/this._granularityCellSize)-1,te=x<J;const oe=z===0;if(oe&&(_===T||_===E))return;if(oe||O>=1||$<=0){const Le=o-_,ze=p+(r-p)*Math.min((T-_)/Le,(E-_)/Le);G=Math.floor(Math.min(ze,x)/this._granularityCellSize)+1,Z=Math.ceil(Math.max(ze,x)/this._granularityCellSize)-1,te=x<ze}const be=I>0?E:T;if(te)for(let Le=G;Le<=Z;Le++)e.push(this._vertexToIndex(Le*this._granularityCellSize,be));else for(let Le=Z;Le>=G;Le--)e.push(this._vertexToIndex(Le*this._granularityCellSize,be))}_generateOutline(e){const r=[];for(const o of e){const u=ul(o,this._granularity,!0),d=this._pointArrayToIndices(u),p=[];for(let _=1;_<d.length;_++)p.push(d[_-1]),p.push(d[_]);r.push(p)}return r}_handlePoles(e){let r=!1,o=!1;this._canonical&&(this._canonical.y===0&&(r=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(r||o)&&this._fillPoles(e,r,o)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let r=0;r<e.length;r+=2){const o=e[r+1];o===Pu&&(e[r+1]=-32767),o===_h&&(e[r+1]=32766)}}_generatePoleQuad(e,r,o,u,d,p){u>d!=(p===Pu)?(e.push(r),e.push(o),e.push(this._vertexToIndex(u,p)),e.push(o),e.push(this._vertexToIndex(d,p)),e.push(this._vertexToIndex(u,p))):(e.push(o),e.push(r),e.push(this._vertexToIndex(u,p)),e.push(this._vertexToIndex(d,p)),e.push(o),e.push(this._vertexToIndex(u,p)))}_fillPoles(e,r,o){const u=this._vertexBuffer,d=st,p=e.length;for(let _=2;_<p;_+=3){const x=e[_-2],T=e[_-1],E=e[_],I=u[2*x],A=u[2*x+1],z=u[2*T],L=u[2*T+1],F=u[2*E],O=u[2*E+1];r&&(A===0&&L===0&&this._generatePoleQuad(e,x,T,I,z,Pu),L===0&&O===0&&this._generatePoleQuad(e,T,E,z,F,Pu),O===0&&A===0&&this._generatePoleQuad(e,E,x,F,I,Pu)),o&&(A===d&&L===d&&this._generatePoleQuad(e,x,T,I,z,_h),L===d&&O===d&&this._generatePoleQuad(e,T,E,z,F,_h),O===d&&A===d&&this._generatePoleQuad(e,E,x,F,I,_h))}}_initializeVertices(e){for(let r=0;r<e.length;r+=2)this._vertexToIndex(e[r],e[r+1])}subdividePolygonInternal(e,r){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:u}=function(_){const x=[],T=[];for(const E of _)if(E.length!==0){E!==_[0]&&x.push(T.length/2);for(let I=0;I<E.length;I++)T.push(E[I].x),T.push(E[I].y)}return{flattened:T,holeIndices:x}}(e);let d;this._initializeVertices(o);try{const _=function(T,E,I=2){const A=E&&E.length,z=A?E[0]*I:T.length;let L=Rv(T,0,z,I,!0);const F=[];if(!L||L.next===L.prev)return F;let O,$,J;if(A&&(L=function(G,Z,te,oe){const be=[];for(let Le=0,ze=Z.length;Le<ze;Le++){const Oe=Rv(G,Z[Le]*oe,Le<ze-1?Z[Le+1]*oe:G.length,oe,!1);Oe===Oe.next&&(Oe.steiner=!0),be.push(tT(Oe))}be.sort(Q2);for(let Le=0;Le<be.length;Le++)te=J2(be[Le],te);return te}(T,E,L,I)),T.length>80*I){O=T[0],$=T[1];let G=O,Z=$;for(let te=I;te<z;te+=I){const oe=T[te],be=T[te+1];oe<O&&(O=oe),be<$&&($=be),oe>G&&(G=oe),be>Z&&(Z=be)}J=Math.max(G-O,Z-$),J=J!==0?32767/J:0}return ph(L,F,I,O,$,J,0),F}(o,u),x=this._convertIndices(o,_);d=this._subdivideTrianglesScanline(x)}catch(_){console.error(_)}let p=[];return r&&(p=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(d),{verticesFlattened:this._vertexBuffer,indicesTriangles:d,indicesLineList:p}}_convertIndices(e,r){const o=[];for(let u=0;u<r.length;u++)o.push(this._vertexToIndex(e[2*r[u]],e[2*r[u]+1]));return o}_pointArrayToIndices(e){const r=[];for(let o=0;o<e.length;o++){const u=e[o];r.push(this._vertexToIndex(u.x,u.y))}return r}}function Nv(n,e,r,o=!0){return new nT(r,e).subdividePolygonInternal(n,o)}function ul(n,e,r=!1){if(!n||n.length<1)return[];if(n.length<2)return[];const o=n[0],u=n[n.length-1],d=r&&(o.x!==u.x||o.y!==u.y);if(e<2)return d?[...n,n[0]]:[...n];const p=Math.floor(st/e),_=[];_.push(new N(n[0].x,n[0].y));const x=n.length,T=d?x:x-1;for(let E=0;E<T;E++){const I=n[E],A=E<x-1?n[E+1]:n[0],z=I.x,L=I.y,F=A.x,O=A.y,$=z!==F,J=L!==O;if(!$&&!J)continue;const G=F-z,Z=O-L,te=Math.abs(G),oe=Math.abs(Z);let be=z,Le=L;for(;;){const Oe=G>0?(Math.floor(be/p)+1)*p:(Math.ceil(be/p)-1)*p,Ze=Z>0?(Math.floor(Le/p)+1)*p:(Math.ceil(Le/p)-1)*p,je=Math.abs(be-Oe),De=Math.abs(Le-Ze),Me=Math.abs(be-F),rt=Math.abs(Le-O),Je=$?je/te:Number.POSITIVE_INFINITY,it=J?De/oe:Number.POSITIVE_INFINITY;if((Me<=je||!$)&&(rt<=De||!J))break;if(Je<it&&$||!J){be=Oe,Le+=Z*Je;const Ye=new N(be,Math.round(Le));_[_.length-1].x===Ye.x&&_[_.length-1].y===Ye.y||_.push(Ye)}else{be+=G*it,Le=Ze;const Ye=new N(Math.round(be),Le);_[_.length-1].x===Ye.x&&_[_.length-1].y===Ye.y||_.push(Ye)}}const ze=new N(F,O);_[_.length-1].x===ze.x&&_[_.length-1].y===ze.y||_.push(ze)}return _}function iT(n,e,r){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,u=n[2*e[0]];for(let x=1;x<e.length;x++){const T=n[2*e[x]];T<u&&(u=T,o=x)}const d=e.length;let p=o,_=(p+1)%d;for(;;){const x=p-1>=0?p-1:d-1,T=(_+1)%d,E=n[2*e[x]],I=n[2*e[T]],A=n[2*e[p]],z=n[2*e[p]+1],L=n[2*e[_]+1];let F=!1;if(E<I)F=!0;else if(E>I)F=!1;else{const O=L-z,$=-(n[2*e[_]]-A),J=z<L?1:-1;((E-A)*O+(n[2*e[x]+1]-z)*$)*J>((I-A)*O+(n[2*e[T]+1]-z)*$)*J&&(F=!0)}if(F){const O=e[x],$=e[p],J=e[_];O!==$&&O!==J&&$!==J&&r.push(J,$,O),p--,p<0&&(p=d-1)}else{const O=e[T],$=e[p],J=e[_];O!==$&&O!==J&&$!==J&&r.push(J,$,O),_++,_>=d&&(_=0)}if(x===T)break}}function jv(n,e,r,o,u,d,p,_,x){const T=u.length/2,E=p&&_&&x;if(T<He.MAX_VERTEX_ARRAY_LENGTH){const I=e.prepareSegment(T,r,o),A=I.vertexLength;for(let F=0;F<d.length;F+=3)o.emplaceBack(A+d[F],A+d[F+1],A+d[F+2]);let z,L;I.vertexLength+=T,I.primitiveLength+=d.length/3,E&&(L=p.prepareSegment(T,r,_),z=L.vertexLength,L.vertexLength+=T);for(let F=0;F<u.length;F+=2)n(u[F],u[F+1]);if(E)for(let F=0;F<x.length;F++){const O=x[F];for(let $=1;$<O.length;$+=2)_.emplaceBack(z+O[$-1],z+O[$]);L.primitiveLength+=O.length/2}}else(function(I,A,z,L,F,O){const $=[];for(let oe=0;oe<L.length/2;oe++)$.push(-1);const J={count:0};let G=0,Z=I.getOrCreateLatestSegment(A,z),te=Z.vertexLength;for(let oe=2;oe<F.length;oe+=3){const be=F[oe-2],Le=F[oe-1],ze=F[oe];let Oe=$[be]<G,Ze=$[Le]<G,je=$[ze]<G;Z.vertexLength+((Oe?1:0)+(Ze?1:0)+(je?1:0))>He.MAX_VERTEX_ARRAY_LENGTH&&(Z=I.createNewSegment(A,z),G=J.count,Oe=!0,Ze=!0,je=!0,te=0);const De=yh($,L,O,J,be,Oe,Z),Me=yh($,L,O,J,Le,Ze,Z),rt=yh($,L,O,J,ze,je,Z);z.emplaceBack(te+De-G,te+Me-G,te+rt-G),Z.primitiveLength++}})(e,r,o,u,d,n),E&&function(I,A,z,L,F,O){const $=[];for(let oe=0;oe<L.length/2;oe++)$.push(-1);const J={count:0};let G=0,Z=I.getOrCreateLatestSegment(A,z),te=Z.vertexLength;for(let oe=0;oe<F.length;oe++){const be=F[oe];for(let Le=1;Le<F[oe].length;Le+=2){const ze=be[Le-1],Oe=be[Le];let Ze=$[ze]<G,je=$[Oe]<G;Z.vertexLength+((Ze?1:0)+(je?1:0))>He.MAX_VERTEX_ARRAY_LENGTH&&(Z=I.createNewSegment(A,z),G=J.count,Ze=!0,je=!0,te=0);const De=yh($,L,O,J,ze,Ze,Z),Me=yh($,L,O,J,Oe,je,Z);z.emplaceBack(te+De-G,te+Me-G),Z.primitiveLength++}}}(p,r,_,u,x,n),e.forceNewSegmentOnNextPrepare(),p==null||p.forceNewSegmentOnNextPrepare()}function yh(n,e,r,o,u,d,p){if(d){const _=o.count;return r(e[2*u],e[2*u+1]),n[u]=o.count,o.count++,p.vertexLength++,_}return n[u]}class lg{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new H,this.indexArray=new Ce,this.indexArray2=new $e,this.programConfigurations=new Qs(e.layers,e.zoom),this.segments=new He,this.segments2=new He,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){this.hasDependencies=Dp("fill",this.layers,r);const u=this.layers[0].layout.get("fill-sort-key"),d=!u.isConstant(),p=[];for(const{feature:_,id:x,index:T,sourceLayerIndex:E}of e){const I=this.layers[0]._featureFilter.needGeometry,A=Ts(_,I);if(!this.layers[0]._featureFilter.filter(new Vt(this.zoom),A,o))continue;const z=d?u.evaluate(A,{},o,r.availableImages):void 0,L={id:x,properties:_.properties,type:_.type,sourceLayerIndex:E,index:T,geometry:I?A.geometry:ws(_),patterns:{},sortKey:z};p.push(L)}d&&p.sort((_,x)=>_.sortKey-x.sortKey);for(const _ of p){const{geometry:x,index:T,sourceLayerIndex:E}=_;if(this.hasDependencies){const I=sg("fill",this.layers,_,{zoom:this.zoom},r);this.patternFeatures.push(I)}else this.addFeature(_,x,T,o,{},r.subdivisionGranularity);r.featureIndex.insert(e[T].feature,x,T,E,this.index)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:o})}addFeatures(e,r,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,r,o,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,W2),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,o,u,d,p){for(const _ of Ul(r,500)){const x=Nv(_,u,p.fill.getGranularityForZoomLevel(u.z)),T=this.layoutVertexArray;jv((E,I)=>{T.emplaceBack(E,I)},this.segments,this.layoutVertexArray,this.indexArray,x.verticesFlattened,x.indicesTriangles,this.segments2,this.indexArray2,x.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:d,canonical:u})}}let Vv,Uv;nt("FillBucket",lg,{omit:["layers","patternFeatures"]});var sT={get paint(){return Uv=Uv||new Tn({"fill-antialias":new ut(Pe.paint_fill["fill-antialias"]),"fill-opacity":new dt(Pe.paint_fill["fill-opacity"]),"fill-color":new dt(Pe.paint_fill["fill-color"]),"fill-outline-color":new dt(Pe.paint_fill["fill-outline-color"]),"fill-translate":new ut(Pe.paint_fill["fill-translate"]),"fill-translate-anchor":new ut(Pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new el(Pe.paint_fill["fill-pattern"])})},get layout(){return Vv=Vv||new Tn({"fill-sort-key":new dt(Pe.layout_fill["fill-sort-key"])})}};class oT extends ti{constructor(e,r){super(e,sT,r)}recalculate(e,r){super.recalculate(e,r);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new lg(e)}queryRadius(){return Ap(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:r,transform:o,pixelsToTileUnits:u}){return xv(zp(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,u),r)}isTileClipped(){return!0}}const aT=Sr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),lT=Sr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:uT}=aT;class vh{constructor(e,r,o,u,d){this.properties={},this.extent=o,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=u,this._values=d,e.readFields(cT,this,r)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const r=e.readVarint()+e.pos,o=[];let u,d=1,p=0,_=0,x=0;for(;e.pos<r;){if(p<=0){const T=e.readVarint();d=7&T,p=T>>3}if(p--,d===1||d===2)_+=e.readSVarint(),x+=e.readSVarint(),d===1&&(u&&o.push(u),u=[]),u&&u.push(new N(_,x));else{if(d!==7)throw new Error(`unknown command ${d}`);u&&u.push(u[0].clone())}}return u&&o.push(u),o}bbox(){const e=this._pbf;e.pos=this._geometry;const r=e.readVarint()+e.pos;let o=1,u=0,d=0,p=0,_=1/0,x=-1/0,T=1/0,E=-1/0;for(;e.pos<r;){if(u<=0){const I=e.readVarint();o=7&I,u=I>>3}if(u--,o===1||o===2)d+=e.readSVarint(),p+=e.readSVarint(),d<_&&(_=d),d>x&&(x=d),p<T&&(T=p),p>E&&(E=p);else if(o!==7)throw new Error(`unknown command ${o}`)}return[_,T,x,E]}toGeoJSON(e,r,o){const u=this.extent*Math.pow(2,o),d=this.extent*e,p=this.extent*r,_=this.loadGeometry();function x(A){return[360*(A.x+d)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(A.y+p)/u)*Math.PI))-90]}function T(A){return A.map(x)}let E;if(this.type===1){const A=[];for(const L of _)A.push(L[0]);const z=T(A);E=A.length===1?{type:"Point",coordinates:z[0]}:{type:"MultiPoint",coordinates:z}}else if(this.type===2){const A=_.map(T);E=A.length===1?{type:"LineString",coordinates:A[0]}:{type:"MultiLineString",coordinates:A}}else{if(this.type!==3)throw new Error("unknown feature type");{const A=$v(_),z=[];for(const L of A)z.push(L.map(T));E=z.length===1?{type:"Polygon",coordinates:z[0]}:{type:"MultiPolygon",coordinates:z}}}const I={type:"Feature",geometry:E,properties:this.properties};return this.id!=null&&(I.id=this.id),I}}function cT(n,e,r){n===1?e.id=r.readVarint():n===2?function(o,u){const d=o.readVarint()+o.pos;for(;o.pos<d;){const p=u._keys[o.readVarint()],_=u._values[o.readVarint()];u.properties[p]=_}}(r,e):n===3?e.type=r.readVarint():n===4&&(e._geometry=r.pos)}function $v(n){const e=n.length;if(e<=1)return[n];const r=[];let o,u;for(let d=0;d<e;d++){const p=hT(n[d]);p!==0&&(u===void 0&&(u=p<0),u===p<0?(o&&r.push(o),o=[n[d]]):o&&o.push(n[d]))}return o&&r.push(o),r}function hT(n){let e=0;for(let r,o,u=0,d=n.length,p=d-1;u<d;p=u++)r=n[u],o=n[p],e+=(o.x-r.x)*(r.y+o.y);return e}vh.types=["Unknown","Point","LineString","Polygon"];class dT{constructor(e,r){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(pT,this,r),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const r=this._pbf.readVarint()+this._pbf.pos;return new vh(this._pbf,r,this.extent,this._keys,this._values)}}function pT(n,e,r){n===15?e.version=r.readVarint():n===1?e.name=r.readString():n===5?e.extent=r.readVarint():n===2?e._features.push(r.pos):n===3?e._keys.push(r.readString()):n===4&&e._values.push(function(o){let u=null;const d=o.readVarint()+o.pos;for(;o.pos<d;){const p=o.readVarint()>>3;u=p===1?o.readString():p===2?o.readFloat():p===3?o.readDouble():p===4?o.readVarint64():p===5?o.readVarint():p===6?o.readSVarint():p===7?o.readBoolean():null}if(u==null)throw new Error("unknown feature value");return u}(r))}class Gv{constructor(e,r){this.layers=e.readFields(fT,{},r)}}function fT(n,e,r){if(n===3){const o=new dT(r,r.readVarint()+r.pos);o.length&&(e[o.name]=o)}}const ug=Math.pow(2,13);function xh(n,e,r,o,u,d,p,_){n.emplaceBack(e,r,2*Math.floor(o*ug)+p,u*ug*2,d*ug*2,Math.round(_))}class cg{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new ee,this.centroidVertexArray=new W,this.indexArray=new Ce,this.programConfigurations=new Qs(e.layers,e.zoom),this.segments=new He,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){this.features=[],this.hasDependencies=Dp("fill-extrusion",this.layers,r);for(const{feature:u,id:d,index:p,sourceLayerIndex:_}of e){const x=this.layers[0]._featureFilter.needGeometry,T=Ts(u,x);if(!this.layers[0]._featureFilter.filter(new Vt(this.zoom),T,o))continue;const E={id:d,sourceLayerIndex:_,index:p,geometry:x?T.geometry:ws(u),properties:u.properties,type:u.type,patterns:{}};this.hasDependencies?this.features.push(sg("fill-extrusion",this.layers,E,{zoom:this.zoom},r)):this.addFeature(E,E.geometry,p,o,{},r.subdivisionGranularity),r.featureIndex.insert(u,E.geometry,p,_,this.index,!0)}}addFeatures(e,r,o){for(const u of this.features){const{geometry:d}=u;this.addFeature(u,d,u.index,r,o,e.subdivisionGranularity)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,uT),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,lT.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,o,u,d,p){for(const _ of Ul(r,500)){const x={x:0,y:0,sampleCount:0},T=this.layoutVertexArray.length;this.processPolygon(x,u,e,_,p);const E=this.layoutVertexArray.length-T,I=Math.floor(x.x/x.sampleCount),A=Math.floor(x.y/x.sampleCount);for(let z=0;z<E;z++)this.centroidVertexArray.emplaceBack(I,A)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:d,canonical:u})}processPolygon(e,r,o,u,d){if(u.length<1||qv(u[0]))return;for(const I of u)I.length!==0&&mT(e,I);const p={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},_=d.fill.getGranularityForZoomLevel(r.z),x=vh.types[o.type]==="Polygon";for(const I of u){if(I.length===0||qv(I))continue;const A=ul(I,_,x);this._generateSideFaces(A,p)}if(!x)return;const T=Nv(u,r,_,!1),E=this.layoutVertexArray;jv((I,A)=>{xh(E,I,A,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,T.verticesFlattened,T.indicesTriangles)}_generateSideFaces(e,r){let o=0;for(let u=1;u<e.length;u++){const d=e[u],p=e[u-1];if(gT(d,p))continue;r.segment.vertexLength+4>He.MAX_VERTEX_ARRAY_LENGTH&&(r.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const _=d.sub(p)._perp()._unit(),x=p.dist(d);o+x>32768&&(o=0),xh(this.layoutVertexArray,d.x,d.y,_.x,_.y,0,0,o),xh(this.layoutVertexArray,d.x,d.y,_.x,_.y,0,1,o),o+=x,xh(this.layoutVertexArray,p.x,p.y,_.x,_.y,0,0,o),xh(this.layoutVertexArray,p.x,p.y,_.x,_.y,0,1,o);const T=r.segment.vertexLength;this.indexArray.emplaceBack(T,T+2,T+1),this.indexArray.emplaceBack(T+1,T+2,T+3),r.segment.vertexLength+=4,r.segment.primitiveLength+=2}}}function mT(n,e){for(let r=0;r<e.length;r++){const o=e[r];r===e.length-1&&e[0].x===o.x&&e[0].y===o.y||(n.x+=o.x,n.y+=o.y,n.sampleCount++)}}function gT(n,e){return n.x===e.x&&(n.x<0||n.x>st)||n.y===e.y&&(n.y<0||n.y>st)}function qv(n){return n.every(e=>e.x<0)||n.every(e=>e.x>st)||n.every(e=>e.y<0)||n.every(e=>e.y>st)}let Zv;nt("FillExtrusionBucket",cg,{omit:["layers","features"]});var _T={get paint(){return Zv=Zv||new Tn({"fill-extrusion-opacity":new ut(Pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new dt(Pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ut(Pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ut(Pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new el(Pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new dt(Pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new dt(Pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ut(Pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class yT extends ti{constructor(e,r){super(e,_T,r)}createBucket(e){return new cg(e)}queryRadius(){return Ap(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:o,geometry:u,transform:d,pixelsToTileUnits:p,pixelPosMatrix:_}){const x=zp(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-d.bearingInRadians,p),T=this.paint.get("fill-extrusion-height").evaluate(r,o),E=this.paint.get("fill-extrusion-base").evaluate(r,o),I=function(z,L){const F=[];for(const O of z){const $=[O.x,O.y,0,1];Xn($,$,L),F.push(new N($[0]/$[3],$[1]/$[3]))}return F}(x,_),A=function(z,L,F,O){const $=[],J=[],G=O[8]*L,Z=O[9]*L,te=O[10]*L,oe=O[11]*L,be=O[8]*F,Le=O[9]*F,ze=O[10]*F,Oe=O[11]*F;for(const Ze of z){const je=[],De=[];for(const Me of Ze){const rt=Me.x,Je=Me.y,it=O[0]*rt+O[4]*Je+O[12],Ye=O[1]*rt+O[5]*Je+O[13],ct=O[2]*rt+O[6]*Je+O[14],kt=O[3]*rt+O[7]*Je+O[15],Et=ct+te,or=kt+oe,hn=it+be,Br=Ye+Le,ar=ct+ze,tr=kt+Oe,Rt=new N((it+G)/or,(Ye+Z)/or);Rt.z=Et/or,je.push(Rt);const _r=new N(hn/tr,Br/tr);_r.z=ar/tr,De.push(_r)}$.push(je),J.push(De)}return[$,J]}(u,E,T,_);return function(z,L,F){let O=1/0;xv(F,L)&&(O=Wv(F,L[0]));for(let $=0;$<L.length;$++){const J=L[$],G=z[$];for(let Z=0;Z<J.length-1;Z++){const te=J[Z],oe=[te,J[Z+1],G[Z+1],G[Z],te];xu(F,oe)&&(O=Math.min(O,Wv(F,oe)))}}return O!==1/0&&O}(A[0],A[1],I)}}function bh(n,e){return n.x*e.x+n.y*e.y}function Wv(n,e){if(n.length===1){let r=0;const o=e[r++];let u;for(;!u||o.equals(u);)if(u=e[r++],!u)return 1/0;for(;r<e.length;r++){const d=e[r],p=n[0],_=u.sub(o),x=d.sub(o),T=p.sub(o),E=bh(_,_),I=bh(_,x),A=bh(x,x),z=bh(T,_),L=bh(T,x),F=E*A-I*I,O=(A*z-I*L)/F,$=(E*L-I*z)/F,J=o.z*(1-O-$)+u.z*O+d.z*$;if(isFinite(J))return J}return 1/0}{let r=1/0;for(const o of e)r=Math.min(r,o.z);return r}}const vT=Sr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:xT}=vT,bT=Sr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:wT}=bT,TT=Math.cos(Math.PI/180*37.5),Hv=Math.pow(2,14)/.5;class hg{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new ae,this.layoutVertexArray2=new Q,this.indexArray=new Ce,this.programConfigurations=new Qs(e.layers,e.zoom),this.segments=new He,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){this.hasDependencies=Dp("line",this.layers,r)||this.hasLineDasharray(this.layers);const u=this.layers[0].layout.get("line-sort-key"),d=!u.isConstant(),p=[];for(const{feature:_,id:x,index:T,sourceLayerIndex:E}of e){const I=this.layers[0]._featureFilter.needGeometry,A=Ts(_,I);if(!this.layers[0]._featureFilter.filter(new Vt(this.zoom),A,o))continue;const z=d?u.evaluate(A,{},o):void 0,L={id:x,properties:_.properties,type:_.type,sourceLayerIndex:E,index:T,geometry:I?A.geometry:ws(_),patterns:{},dashes:{},sortKey:z};p.push(L)}d&&p.sort((_,x)=>_.sortKey-x.sortKey);for(const _ of p){const{geometry:x,index:T,sourceLayerIndex:E}=_;this.hasDependencies?(Dp("line",this.layers,r)?sg("line",this.layers,_,{zoom:this.zoom},r):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,_,this.zoom,r),this.patternFeatures.push(_)):this.addFeature(_,x,T,o,{},{},r.subdivisionGranularity),r.featureIndex.insert(e[T].feature,x,T,E,this.index)}}update(e,r,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:o,dashPositions:u})}addFeatures(e,r,o,u){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,r,o,u,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,wT)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,xT),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,o,u,d,p,_){const x=this.layers[0].layout,T=x.get("line-join").evaluate(e,{}),E=x.get("line-cap"),I=x.get("line-miter-limit"),A=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const z of r)this.addLine(z,e,T,E,I,A,u,_);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:d,dashPositions:p,canonical:u})}addLine(e,r,o,u,d,p,_,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=ul(e,_?x.line.getGranularityForZoomLevel(_.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let G=0;G<e.length-1;G++)this.totalDistance+=e[G].dist(e[G+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=vh.types[r.type]==="Polygon";let E=e.length;for(;E>=2&&e[E-1].equals(e[E-2]);)E--;let I=0;for(;I<E-1&&e[I].equals(e[I+1]);)I++;if(E<(T?3:2))return;o==="bevel"&&(d=1.05);const A=this.overscaling<=16?122880/(512*this.overscaling):0,z=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let L,F,O,$,J;this.e1=this.e2=-1,T&&(L=e[E-2],J=e[I].sub(L)._unit()._perp());for(let G=I;G<E;G++){if(O=G===E-1?T?e[I+1]:void 0:e[G+1],O&&e[G].equals(O))continue;J&&($=J),L&&(F=L),L=e[G],J=O?O.sub(L)._unit()._perp():$,$=$||J;let Z=$.add(J);Z.x===0&&Z.y===0||Z._unit();const te=$.x*J.x+$.y*J.y,oe=Z.x*J.x+Z.y*J.y,be=oe!==0?1/oe:1/0,Le=2*Math.sqrt(2-2*oe),ze=oe<TT&&F&&O,Oe=$.x*J.y-$.y*J.x>0;if(ze&&G>I){const De=L.dist(F);if(De>2*A){const Me=L.sub(L.sub(F)._mult(A/De)._round());this.updateDistance(F,Me),this.addCurrentVertex(Me,$,0,0,z),F=Me}}const Ze=F&&O;let je=Ze?o:T?"butt":u;if(Ze&&je==="round"&&(be<p?je="miter":be<=2&&(je="fakeround")),je==="miter"&&be>d&&(je="bevel"),je==="bevel"&&(be>2&&(je="flipbevel"),be<d&&(je="miter")),F&&this.updateDistance(F,L),je==="miter")Z._mult(be),this.addCurrentVertex(L,Z,0,0,z);else if(je==="flipbevel"){if(be>100)Z=J.mult(-1);else{const De=be*$.add(J).mag()/$.sub(J).mag();Z._perp()._mult(De*(Oe?-1:1))}this.addCurrentVertex(L,Z,0,0,z),this.addCurrentVertex(L,Z.mult(-1),0,0,z)}else if(je==="bevel"||je==="fakeround"){const De=-Math.sqrt(be*be-1),Me=Oe?De:0,rt=Oe?0:De;if(F&&this.addCurrentVertex(L,$,Me,rt,z),je==="fakeround"){const Je=Math.round(180*Le/Math.PI/20);for(let it=1;it<Je;it++){let Ye=it/Je;if(Ye!==.5){const kt=Ye-.5;Ye+=Ye*kt*(Ye-1)*((1.0904+te*(te*(3.55645-1.43519*te)-3.2452))*kt*kt+(.848013+te*(.215638*te-1.06021)))}const ct=J.sub($)._mult(Ye)._add($)._unit()._mult(Oe?-1:1);this.addHalfVertex(L,ct.x,ct.y,!1,Oe,0,z)}}O&&this.addCurrentVertex(L,J,-Me,-rt,z)}else if(je==="butt")this.addCurrentVertex(L,Z,0,0,z);else if(je==="square"){const De=F?1:-1;this.addCurrentVertex(L,Z,De,De,z)}else je==="round"&&(F&&(this.addCurrentVertex(L,$,0,0,z),this.addCurrentVertex(L,$,1,1,z,!0)),O&&(this.addCurrentVertex(L,J,-1,-1,z,!0),this.addCurrentVertex(L,J,0,0,z)));if(ze&&G<E-1){const De=L.dist(O);if(De>2*A){const Me=L.add(O.sub(L)._mult(A/De)._round());this.updateDistance(L,Me),this.addCurrentVertex(Me,J,0,0,z),L=Me}}}}addCurrentVertex(e,r,o,u,d,p=!1){const _=r.y*u-r.x,x=-r.y-r.x*u;this.addHalfVertex(e,r.x+r.y*o,r.y-r.x*o,p,!1,o,d),this.addHalfVertex(e,_,x,p,!0,-u,d),this.distance>Hv/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,r,o,u,d,p))}addHalfVertex({x:e,y:r},o,u,d,p,_,x){const T=.5*(this.lineClips?this.scaledDistance*(Hv-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(r<<1)+(p?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(_===0?0:_<0?-1:1)|(63&T)<<2,T>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const E=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,E,this.e2),x.primitiveLength++),p?this.e2=E:this.e1=E}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}hasLineDasharray(e){for(const r of e){const o=r.paint.get("line-dasharray");if(o&&!o.isConstant())return!0}return!1}addLineDashDependencies(e,r,o,u){for(const d of e){const p=d.paint.get("line-dasharray");if(!p||p.value.kind==="constant")continue;const _=d.layout.get("line-cap")==="round",x={dasharray:p.value.evaluate({zoom:o-1},r,{}),round:_},T={dasharray:p.value.evaluate({zoom:o},r,{}),round:_},E={dasharray:p.value.evaluate({zoom:o+1},r,{}),round:_},I=`${x.dasharray.join(",")},${x.round}`,A=`${T.dasharray.join(",")},${T.round}`,z=`${E.dasharray.join(",")},${E.round}`;u.dashDependencies[I]=x,u.dashDependencies[A]=T,u.dashDependencies[z]=E,r.dashes[d.id]={min:I,mid:A,max:z}}}}let Xv,Yv;nt("LineBucket",hg,{omit:["layers","patternFeatures"]});var Kv={get paint(){return Yv=Yv||new Tn({"line-opacity":new dt(Pe.paint_line["line-opacity"]),"line-color":new dt(Pe.paint_line["line-color"]),"line-translate":new ut(Pe.paint_line["line-translate"]),"line-translate-anchor":new ut(Pe.paint_line["line-translate-anchor"]),"line-width":new dt(Pe.paint_line["line-width"]),"line-gap-width":new dt(Pe.paint_line["line-gap-width"]),"line-offset":new dt(Pe.paint_line["line-offset"]),"line-blur":new dt(Pe.paint_line["line-blur"]),"line-dasharray":new el(Pe.paint_line["line-dasharray"]),"line-pattern":new el(Pe.paint_line["line-pattern"]),"line-gradient":new du(Pe.paint_line["line-gradient"])})},get layout(){return Xv=Xv||new Tn({"line-cap":new ut(Pe.layout_line["line-cap"]),"line-join":new dt(Pe.layout_line["line-join"]),"line-miter-limit":new ut(Pe.layout_line["line-miter-limit"]),"line-round-limit":new ut(Pe.layout_line["line-round-limit"]),"line-sort-key":new dt(Pe.layout_line["line-sort-key"])})}};class ST extends dt{possiblyEvaluate(e,r){return r=new Vt(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,o,u){return r=gn({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,o,u)}}let Bp;class PT extends ti{constructor(e,r){super(e,Kv,r),this.gradientVersion=0,Bp||(Bp=new ST(Kv.paint.properties["line-width"].specification),Bp.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof fs,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,r){super.recalculate(e,r),this.paint._values["line-floorwidth"]=Bp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new hg(e)}queryRadius(e){const r=e,o=Qv(wu("line-width",this,r),wu("line-gap-width",this,r)),u=wu("line-offset",this,r);return o/2+Math.abs(u)+Ap(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:o,geometry:u,transform:d,pixelsToTileUnits:p}){const _=zp(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-d.bearingInRadians,p),x=p/2*Qv(this.paint.get("line-width").evaluate(r,o),this.paint.get("line-gap-width").evaluate(r,o)),T=this.paint.get("line-offset").evaluate(r,o);return T&&(u=function(E,I){const A=[];for(let z=0;z<E.length;z++){const L=D2(E[z]),F=[];for(let O=0;O<L.length;O++){const $=L[O],J=L[O-1],G=L[O+1],Z=O===0?new N(0,0):$.sub(J)._unit()._perp(),te=O===L.length-1?new N(0,0):G.sub($)._unit()._perp(),oe=Z._add(te)._unit(),be=oe.x*te.x+oe.y*te.y;be!==0&&oe._mult(1/be),F.push(oe._mult(I)._add($))}A.push(F)}return A}(u,T*p)),function(E,I,A){for(let z=0;z<I.length;z++){const L=I[z];if(E.length>=3){for(let F=0;F<L.length;F++)if(bu(E,L[F]))return!0}if(k2(E,L,A))return!0}return!1}(_,u,x)}isTileClipped(){return!0}}function Qv(n,e){return e>0?e+2*n:n}const ET=Sr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),CT=Sr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Sr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const MT=Sr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Sr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Jv=Sr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),IT=Sr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function kT(n,e,r){return n.sections.forEach(o=>{o.text=function(u,d,p){const _=d.layout.get("text-transform").evaluate(p,{});return _==="uppercase"?u=u.toLocaleUpperCase():_==="lowercase"&&(u=u.toLocaleLowerCase()),vs.applyArabicShaping&&(u=vs.applyArabicShaping(u)),u}(o.text,e,r)}),n}Sr([{name:"triangle",components:3,type:"Uint16"}]),Sr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Sr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Sr([{type:"Float32",name:"offsetX"}]),Sr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Sr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var Hr=24;const wh={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},AT={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},zT={40:!0};function e0(n,e,r,o,u,d){if("fontStack"in e){const p=r[e.fontStack],_=p&&p[n];return _?_.metrics.advance*e.scale+u:0}{const p=o[e.imageName];return p?p.displaySize[0]*e.scale*Hr/d+u:0}}function t0(n,e,r,o){const u=Math.pow(n-e,2);return o?n<e?u/2:2*u:u+Math.abs(r)*r}function DT(n,e,r){let o=0;return n===10&&(o-=1e4),r&&(o+=150),n!==40&&n!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function r0(n,e,r,o,u,d){let p=null,_=t0(e,r,u,d);for(const x of o){const T=t0(e-x.x,r,u,d)+x.badness;T<=_&&(p=x,_=T)}return{index:n,x:e,priorBreak:p,badness:_}}function n0(n){return n?n0(n.priorBreak).concat(n.index):[]}class Eu{constructor(e="",r=[],o=[]){this.text=e,this.sections=r,this.sectionIndex=o,this.imageSectionID=null}static fromFeature(e,r){const o=new Eu;for(let u=0;u<e.sections.length;u++){const d=e.sections[u];d.image?o.addImageSection(d):o.addTextSection(d,r)}return o}length(){return[...this.text].length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}verticalizePunctuation(){this.text=function(e){let r="",o={premature:!0,value:void 0};const u=e[Symbol.iterator]();let d=u.next();const p=e[Symbol.iterator]();p.next();let _=p.next();for(;!d.done;)r+=!_.done&&Qc(_.value.codePointAt(0))&&!wh[_.value]||!o.premature&&Qc(o.value.codePointAt(0))&&!wh[o.value]||!wh[d.value]?d.value:wh[d.value],o={value:d.value,premature:!1},d=u.next(),_=p.next();return r}(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const e=this.text.match(/^\s*/),r=e?e[0].length:0,o=this.text.match(/\S\s*$/),u=o?o[0].length-1:0;this.text=this.text.substring(r,this.text.length-u),this.sectionIndex=this.sectionIndex.slice(r,this.sectionIndex.length-u)}substring(e,r){const o=[...this.text].slice(e,r).join(""),u=this.sectionIndex.slice(e,r);return new Eu(o,this.sections,u)}toCodeUnitIndex(e){return[...this.text].slice(0,e).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}getMaxImageSize(e){let r=0,o=0;for(let u=0;u<this.length();u++){const d=this.getSection(u);if("imageName"in d){const p=e[d.imageName];if(!p)continue;const _=p.displaySize;r=Math.max(r,_[0]),o=Math.max(o,_[1])}}return{maxImageWidth:r,maxImageHeight:o}}addTextSection(e,r){this.text+=e.text,this.sections.push({scale:e.scale||1,verticalAlign:e.verticalAlign||"bottom",fontStack:e.fontStack||r});const o=this.sections.length-1;this.sectionIndex.push(...[...e.text].map(()=>o))}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void qr("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push({scale:1,verticalAlign:e.verticalAlign||"bottom",imageName:r}),this.sectionIndex.push(this.sections.length-1)):qr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(e,r,o,u,d){const p=[],_=this.determineAverageLineWidth(e,r,o,u,d),x=this.hasZeroWidthSpaces();let T=0,E=0;const I=this.text[Symbol.iterator]();let A=I.next();const z=this.text[Symbol.iterator]();z.next();let L=z.next();const F=this.text[Symbol.iterator]();F.next(),F.next();let O=F.next();for(;!A.done;){const $=this.getSection(E),J=A.value.codePointAt(0);if(vp(J)||(T+=e0(J,$,o,u,e,d)),!L.done){const G=Ka(J),Z=L.value.codePointAt(0);(AT[J]||G||"imageName"in $||!O.done&&zT[Z])&&p.push(r0(E+1,T,_,p,DT(J,Z,G&&x),!1))}E++,A=I.next(),L=z.next(),O=F.next()}return n0(r0(this.length(),T,_,p,0,!0))}determineAverageLineWidth(e,r,o,u,d){let p=0,_=0;for(const x of this.text){const T=this.getSection(_);p+=e0(x.codePointAt(0),T,o,u,e,d),_++}return p/Math.max(1,Math.ceil(p/r))}}const dg=4294967296,i0=1/dg,s0=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Op{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,r,o=this.length){for(;this.pos<o;){const u=this.readVarint(),d=u>>3,p=this.pos;this.type=7&u,e(d,r,this),this.pos===p&&this.skip(u)}return r}readMessage(e,r){return this.readFields(e,r,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*dg;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*dg;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const r=this.buf;let o,u;return u=r[this.pos++],o=127&u,u<128?o:(u=r[this.pos++],o|=(127&u)<<7,u<128?o:(u=r[this.pos++],o|=(127&u)<<14,u<128?o:(u=r[this.pos++],o|=(127&u)<<21,u<128?o:(u=r[this.pos],o|=(15&u)<<28,function(d,p,_){const x=_.buf;let T,E;if(E=x[_.pos++],T=(112&E)>>4,E<128||(E=x[_.pos++],T|=(127&E)<<3,E<128)||(E=x[_.pos++],T|=(127&E)<<10,E<128)||(E=x[_.pos++],T|=(127&E)<<17,E<128)||(E=x[_.pos++],T|=(127&E)<<24,E<128)||(E=x[_.pos++],T|=(1&E)<<31,E<128))return Cu(d,T,p);throw new Error("Expected varint not more than 10 bytes")}(o,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,r=this.pos;return this.pos=e,e-r>=12&&s0?s0.decode(this.buf.subarray(r,e)):function(o,u,d){let p="",_=u;for(;_<d;){const x=o[_];let T,E,I,A=null,z=x>239?4:x>223?3:x>191?2:1;if(_+z>d)break;z===1?x<128&&(A=x):z===2?(T=o[_+1],(192&T)==128&&(A=(31&x)<<6|63&T,A<=127&&(A=null))):z===3?(T=o[_+1],E=o[_+2],(192&T)==128&&(192&E)==128&&(A=(15&x)<<12|(63&T)<<6|63&E,(A<=2047||A>=55296&&A<=57343)&&(A=null))):z===4&&(T=o[_+1],E=o[_+2],I=o[_+3],(192&T)==128&&(192&E)==128&&(192&I)==128&&(A=(15&x)<<18|(63&T)<<12|(63&E)<<6|63&I,(A<=65535||A>=1114112)&&(A=null))),A===null?(A=65533,z=1):A>65535&&(A-=65536,p+=String.fromCharCode(A>>>10&1023|55296),A=56320|1023&A),p+=String.fromCharCode(A),_+=z}return p}(this.buf,r,e)}readBytes(){const e=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,e);return this.pos=e,r}readPackedVarint(e=[],r){const o=this.readPackedEnd();for(;this.pos<o;)e.push(this.readVarint(r));return e}readPackedSVarint(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(e){const r=7&e;if(r===0)for(;this.buf[this.pos++]>127;);else if(r===2)this.pos=this.readVarint()+this.pos;else if(r===5)this.pos+=4;else{if(r!==1)throw new Error(`Unimplemented type: ${r}`);this.pos+=8}}writeTag(e,r){this.writeVarint(e<<3|r)}realloc(e){let r=this.length||16;for(;r<this.pos+e;)r*=2;if(r!==this.length){const o=new Uint8Array(r);o.set(this.buf),this.buf=o,this.dataView=new DataView(o.buffer),this.length=r}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*i0),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*i0),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?function(r,o){let u,d;if(r>=0?(u=r%4294967296|0,d=r/4294967296|0):(u=~(-r%4294967296),d=~(-r/4294967296),4294967295^u?u=u+1|0:(u=0,d=d+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),function(p,_,x){x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,x.buf[x.pos]=127&(p>>>=7)}(u,0,o),function(p,_){const x=(7&p)<<4;_.buf[_.pos++]|=x|((p>>>=3)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p)))))}(d,o)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const r=this.pos;this.pos=function(u,d,p){for(let _,x,T=0;T<d.length;T++){if(_=d.charCodeAt(T),_>55295&&_<57344){if(!x){_>56319||T+1===d.length?(u[p++]=239,u[p++]=191,u[p++]=189):x=_;continue}if(_<56320){u[p++]=239,u[p++]=191,u[p++]=189,x=_;continue}_=x-55296<<10|_-56320|65536,x=null}else x&&(u[p++]=239,u[p++]=191,u[p++]=189,x=null);_<128?u[p++]=_:(_<2048?u[p++]=_>>6|192:(_<65536?u[p++]=_>>12|224:(u[p++]=_>>18|240,u[p++]=_>>12&63|128),u[p++]=_>>6&63|128),u[p++]=63&_|128)}return p}(this.buf,e,this.pos);const o=this.pos-r;o>=128&&o0(r,o,this),this.pos=r-1,this.writeVarint(o),this.pos+=o}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const r=e.length;this.writeVarint(r),this.realloc(r);for(let o=0;o<r;o++)this.buf[this.pos++]=e[o]}writeRawMessage(e,r){this.pos++;const o=this.pos;e(r,this);const u=this.pos-o;u>=128&&o0(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u}writeMessage(e,r,o){this.writeTag(e,2),this.writeRawMessage(r,o)}writePackedVarint(e,r){r.length&&this.writeMessage(e,RT,r)}writePackedSVarint(e,r){r.length&&this.writeMessage(e,LT,r)}writePackedBoolean(e,r){r.length&&this.writeMessage(e,OT,r)}writePackedFloat(e,r){r.length&&this.writeMessage(e,FT,r)}writePackedDouble(e,r){r.length&&this.writeMessage(e,BT,r)}writePackedFixed32(e,r){r.length&&this.writeMessage(e,NT,r)}writePackedSFixed32(e,r){r.length&&this.writeMessage(e,jT,r)}writePackedFixed64(e,r){r.length&&this.writeMessage(e,VT,r)}writePackedSFixed64(e,r){r.length&&this.writeMessage(e,UT,r)}writeBytesField(e,r){this.writeTag(e,2),this.writeBytes(r)}writeFixed32Field(e,r){this.writeTag(e,5),this.writeFixed32(r)}writeSFixed32Field(e,r){this.writeTag(e,5),this.writeSFixed32(r)}writeFixed64Field(e,r){this.writeTag(e,1),this.writeFixed64(r)}writeSFixed64Field(e,r){this.writeTag(e,1),this.writeSFixed64(r)}writeVarintField(e,r){this.writeTag(e,0),this.writeVarint(r)}writeSVarintField(e,r){this.writeTag(e,0),this.writeSVarint(r)}writeStringField(e,r){this.writeTag(e,2),this.writeString(r)}writeFloatField(e,r){this.writeTag(e,5),this.writeFloat(r)}writeDoubleField(e,r){this.writeTag(e,1),this.writeDouble(r)}writeBooleanField(e,r){this.writeVarintField(e,+r)}}function Cu(n,e,r){return r?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}function o0(n,e,r){const o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(o);for(let u=r.pos-1;u>=n;u--)r.buf[u+o]=r.buf[u]}function RT(n,e){for(let r=0;r<n.length;r++)e.writeVarint(n[r])}function LT(n,e){for(let r=0;r<n.length;r++)e.writeSVarint(n[r])}function FT(n,e){for(let r=0;r<n.length;r++)e.writeFloat(n[r])}function BT(n,e){for(let r=0;r<n.length;r++)e.writeDouble(n[r])}function OT(n,e){for(let r=0;r<n.length;r++)e.writeBoolean(n[r])}function NT(n,e){for(let r=0;r<n.length;r++)e.writeFixed32(n[r])}function jT(n,e){for(let r=0;r<n.length;r++)e.writeSFixed32(n[r])}function VT(n,e){for(let r=0;r<n.length;r++)e.writeFixed64(n[r])}function UT(n,e){for(let r=0;r<n.length;r++)e.writeSFixed64(n[r])}function $T(n,e,r){n===1&&r.readMessage(GT,e)}function GT(n,e,r){if(n===3){const{id:o,bitmap:u,width:d,height:p,left:_,top:x,advance:T}=r.readMessage(qT,{});e.push({id:o,bitmap:new dh({width:d+6,height:p+6},u),metrics:{width:d,height:p,left:_,top:x,advance:T}})}}function qT(n,e,r){n===1?e.id=r.readVarint():n===2?e.bitmap=r.readBytes():n===3?e.width=r.readVarint():n===4?e.height=r.readVarint():n===5?e.left=r.readSVarint():n===6?e.top=r.readSVarint():n===7&&(e.advance=r.readVarint())}function a0(n){let e=0,r=0;for(const p of n)e+=p.w*p.h,r=Math.max(r,p.w);n.sort((p,_)=>_.h-p.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let u=0,d=0;for(const p of n)for(let _=o.length-1;_>=0;_--){const x=o[_];if(!(p.w>x.w||p.h>x.h)){if(p.x=x.x,p.y=x.y,d=Math.max(d,p.y+p.h),u=Math.max(u,p.x+p.w),p.w===x.w&&p.h===x.h){const T=o.pop();T&&_<o.length&&(o[_]=T)}else p.h===x.h?(x.x+=p.w,x.w-=p.w):p.w===x.w?(x.y+=p.h,x.h-=p.h):(o.push({x:x.x+p.w,y:x.y,w:x.w-p.w,h:p.h}),x.y+=p.h,x.h-=p.h);break}}return{w:u,h:d,fill:e/(u*d)||0}}class pg{constructor(e,{pixelRatio:r,version:o,stretchX:u,stretchY:d,content:p,textFitWidth:_,textFitHeight:x}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=u,this.stretchY=d,this.content=p,this.version=o,this.textFitWidth=_,this.textFitHeight=x}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class l0{constructor(e,r){const o={},u={};this.haveRenderCallbacks=[];const d=[];this.addImages(e,o,d),this.addImages(r,u,d);const{w:p,h:_}=a0(d),x=new Un({width:p||1,height:_||1});for(const T in e){const E=e[T],I=o[T].paddedRect;Un.copy(E.data,x,{x:0,y:0},{x:I.x+1,y:I.y+1},E.data)}for(const T in r){const E=r[T],I=u[T].paddedRect,A=I.x+1,z=I.y+1,L=E.data.width,F=E.data.height;Un.copy(E.data,x,{x:0,y:0},{x:A,y:z},E.data),Un.copy(E.data,x,{x:0,y:F-1},{x:A,y:z-1},{width:L,height:1}),Un.copy(E.data,x,{x:0,y:0},{x:A,y:z+F},{width:L,height:1}),Un.copy(E.data,x,{x:L-1,y:0},{x:A-1,y:z},{width:1,height:F}),Un.copy(E.data,x,{x:0,y:0},{x:A+L,y:z},{width:1,height:F})}this.image=x,this.iconPositions=o,this.patternPositions=u}addImages(e,r,o){for(const u in e){const d=e[u],p={x:0,y:0,w:d.data.width+2,h:d.data.height+2};o.push(p),r[u]=new pg(p,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),r),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),r)}patchUpdatedImage(e,r,o){if(!e||!r||e.version===r.version)return;e.version=r.version;const[u,d]=e.tl;o.update(r.data,void 0,{x:u,y:d})}}var Zo;function Np(n,e,r,o,u,d,p,_,x,T,E,I,A,z,L){const F=Eu.fromFeature(n,u);let O;I===w.az.vertical&&F.verticalizePunctuation();let $=F.determineLineBreaks(T,d,e,o,z);const{processBidirectionalText:J,processStyledBidirectionalText:G}=vs;if(J&&F.sections.length===1){O=[],$=$.map(be=>F.toCodeUnitIndex(be));const oe=J(F.toString(),$);for(const be of oe){const Le=[...be].map(()=>0);O.push(new Eu(be,F.sections,Le))}}else if(G){O=[],$=$.map(ze=>F.toCodeUnitIndex(ze));let oe=0;const be=[];for(const ze of F.text)be.push(...Array(ze.length).fill(F.sectionIndex[oe])),oe++;const Le=G(F.text,be,$);for(const ze of Le){const Oe=[];let Ze="";for(const je of ze[0])Oe.push(ze[1][Ze.length]),Ze+=je;O.push(new Eu(ze[0],F.sections,Oe))}}else O=function(oe,be){const Le=[];let ze=0;for(const Oe of be)Le.push(oe.substring(ze,Oe)),ze=Oe;return ze<oe.length()&&Le.push(oe.substring(ze,oe.length())),Le}(F,$);const Z=[],te={positionedLines:Z,text:F.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:I,iconsInText:!1,verticalizable:!1};return function(oe,be,Le,ze,Oe,Ze,je,De,Me,rt,Je,it){let Ye=0,ct=0,kt=0,Et=0;const or=De==="right"?1:De==="left"?0:.5,hn=Hr/it;let Br=0;for(const Rt of Oe){Rt.trim();const _r=Rt.getMaxScale(),Er={positionedGlyphs:[],lineOffset:0};oe.positionedLines[Br]=Er;const Yt=Er.positionedGlyphs;let $n=0;if(!Rt.length()){ct+=Ze,++Br;continue}const dn=ZT(ze,Rt,hn);let Gn=0;for(const Kr of Rt.text){const cr=Rt.getSection(Gn),Or=Kr.codePointAt(0),yr=WT(Me,Je,Or),Qr={glyph:Or,imageName:null,x:Ye,y:ct+-17,vertical:yr,scale:1,fontStack:"",sectionIndex:Rt.getSectionIndex(Gn),metrics:null,rect:null};let to;if("fontStack"in cr){if(to=HT(cr,Or,yr,dn,be,Le),!to)continue;Qr.fontStack=cr.fontStack}else{if(oe.iconsInText=!0,cr.scale*=hn,to=XT(cr,yr,_r,dn,ze),!to)continue;$n=Math.max($n,to.imageOffset),Qr.imageName=cr.imageName}const{rect:Ki,metrics:Ih,baselineOffset:Ko}=to;Qr.y+=Ko,Qr.scale=cr.scale,Qr.metrics=Ih,Qr.rect=Ki,Yt.push(Qr),yr?(oe.verticalizable=!0,Ye+=("imageName"in cr?Ih.advance:Hr)*cr.scale+rt):Ye+=Ih.advance*cr.scale+rt,Gn++}Yt.length!==0&&(kt=Math.max(Ye-rt,kt),YT(Yt,0,Yt.length-1,or)),Ye=0,Er.lineOffset=Math.max($n,(_r-1)*Hr);const Li=Ze*_r+$n;ct+=Li,Et=Math.max(Li,Et),++Br}const{horizontalAlign:ar,verticalAlign:tr}=fg(je);(function(Rt,_r,Er,Yt,$n,dn,Gn,Li,Kr){const cr=(_r-Er)*$n;let Or=0;Or=dn!==Gn?-Li*Yt- -17:-Yt*Kr*Gn+.5*Gn;for(const yr of Rt)for(const Qr of yr.positionedGlyphs)Qr.x+=cr,Qr.y+=Or})(oe.positionedLines,or,ar,tr,kt,Et,Ze,ct,Oe.length),oe.top+=-tr*ct,oe.bottom=oe.top+ct,oe.left+=-ar*kt,oe.right=oe.left+kt}(te,e,r,o,O,p,_,x,I,T,A,L),!function(oe){for(const be of oe)if(be.positionedGlyphs.length!==0)return!1;return!0}(Z)&&te}function fg(n){let e=.5,r=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function ZT(n,e,r){const o=e.getMaxScale()*Hr,{maxImageWidth:u,maxImageHeight:d}=e.getMaxImageSize(n),p=Math.max(o,d*r);return{verticalLineContentWidth:Math.max(o,u*r),horizontalLineContentHeight:p}}function u0(n){switch(n){case"top":return 0;case"center":return .5;default:return 1}}function WT(n,e,r){return!(n===w.az.horizontal||!e&&!Kc(r)||e&&(vp(r)||(o=r,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function HT(n,e,r,o,u,d){const p=d[n.fontStack],_=function(T,E,I,A){if(T&&T.rect)return T;const z=E[I.fontStack],L=z&&z[A];return L?{rect:null,metrics:L.metrics}:null}(p&&p[e],u,n,e);if(_===null)return null;let x;if(r)x=o.verticalLineContentWidth-n.scale*Hr;else{const T=u0(n.verticalAlign);x=(o.horizontalLineContentHeight-n.scale*Hr)*T}return{rect:_.rect,metrics:_.metrics,baselineOffset:x}}function XT(n,e,r,o,u){const d=u[n.imageName];if(!d)return null;const p=d.paddedRect,_=d.displaySize,x={width:_[0],height:_[1],left:1,top:-3,advance:e?_[1]:_[0]};let T;if(e)T=o.verticalLineContentWidth-_[1]*n.scale;else{const E=u0(n.verticalAlign);T=(o.horizontalLineContentHeight-_[1]*n.scale)*E}return{rect:p,metrics:x,baselineOffset:T,imageOffset:(e?_[0]:_[1])*n.scale-Hr*r}}function YT(n,e,r,o){if(o===0)return;const u=n[r],d=(n[r].x+u.metrics.advance*u.scale)*o;for(let p=e;p<=r;p++)n[p].x-=d}function KT(n,e,r){const{horizontalAlign:o,verticalAlign:u}=fg(r),d=e[0]-n.displaySize[0]*o,p=e[1]-n.displaySize[1]*u;return{image:n,top:p,bottom:p+n.displaySize[1],left:d,right:d+n.displaySize[0]}}function c0(n){var e,r;let o=n.left,u=n.top,d=n.right-o,p=n.bottom-u;const _=(e=n.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",x=(r=n.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",T=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(x==="proportional"){if(_==="stretchOnly"&&d/p<T||_==="proportional"){const E=Math.ceil(p*T);o*=E/d,d=E}}else if(_==="proportional"&&x==="stretchOnly"&&T!==0&&d/p>T){const E=Math.ceil(d/T);u*=E/p,p=E}return{x1:o,y1:u,x2:o+d,y2:u+p}}function h0(n,e,r,o,u,d){const p=n.image;let _;if(p.content){const O=p.content,$=p.pixelRatio||1;_=[O[0]/$,O[1]/$,p.displaySize[0]-O[2]/$,p.displaySize[1]-O[3]/$]}const x=e.left*d,T=e.right*d;let E,I,A,z;r==="width"||r==="both"?(z=u[0]+x-o[3],I=u[0]+T+o[1]):(z=u[0]+(x+T-p.displaySize[0])/2,I=z+p.displaySize[0]);const L=e.top*d,F=e.bottom*d;return r==="height"||r==="both"?(E=u[1]+L-o[0],A=u[1]+F+o[2]):(E=u[1]+(L+F-p.displaySize[1])/2,A=E+p.displaySize[1]),{image:p,top:E,right:I,bottom:A,left:z,collisionPadding:_}}nt("ImagePosition",pg),nt("ImageAtlas",l0),w.az=void 0,(Zo=w.az||(w.az={}))[Zo.none=0]="none",Zo[Zo.horizontal=1]="horizontal",Zo[Zo.vertical=2]="vertical",Zo[Zo.horizontalOnly=3]="horizontalOnly";const Js=128,Wo=32640;function d0(n,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Vt(n+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:u}=r;let d=0;for(;d<o.length&&o[d]<=n;)d++;d=Math.max(0,d-1);let p=d;for(;p<o.length&&o[p]<n+1;)p++;p=Math.min(o.length-1,p);const _=o[d],x=o[p];return r.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:x,interpolationType:u}:{kind:"camera",minZoom:_,maxZoom:x,minSize:r.evaluate(new Vt(_)),maxSize:r.evaluate(new Vt(x)),interpolationType:u}}}function mg(n,e,r){let o="never";const u=n.get(e);return u?o=u:n.get(r)&&(o="always"),o}const QT=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function jp(n,e,r,o,u,d,p,_,x,T,E,I,A){const z=_?Math.min(Wo,Math.round(_[0])):0,L=_?Math.min(Wo,Math.round(_[1])):0;n.emplaceBack(e,r,Math.round(32*o),Math.round(32*u),d,p,(z<<1)+(x?1:0),L,16*T,16*E,256*I,256*A)}function gg(n,e,r){n.emplaceBack(e.x,e.y,r),n.emplaceBack(e.x,e.y,r),n.emplaceBack(e.x,e.y,r),n.emplaceBack(e.x,e.y,r)}function JT(n){for(const e of n.sections)if(wp(e.text))return!0;return!1}class _g{constructor(e){this.layoutVertexArray=new re,this.indexArray=new Ce,this.programConfigurations=e,this.segments=new He,this.dynamicLayoutVertexArray=new ge,this.opacityVertexArray=new ke,this.hasVisibleVertices=!1,this.placedSymbolArray=new y}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,o,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ET.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,CT.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,QT,!0),this.opacityVertexBuffer.itemSize=1),(o||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}nt("SymbolBuffers",_g);class yg{constructor(e,r,o){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new o,this.segments=new He,this.collisionVertexArray=new Ee}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,MT.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}nt("CollisionBuffers",yg);class Mu{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=d0(this.zoom,r["text-size"]),this.iconSizeData=d0(this.zoom,r["icon-size"]);const o=this.layers[0].layout,u=o.get("symbol-sort-key"),d=o.get("symbol-z-order");this.canOverlap=mg(o,"text-overlap","text-allow-overlap")!=="never"||mg(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(p=>w.az[p])),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID}createArrays(){this.text=new _g(new Qs(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new _g(new Qs(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new M,this.lineVertexArray=new k,this.symbolInstances=new P,this.textAnchorOffsets=new D}calculateGlyphDependencies(e,r,o,u,d){for(const p of e)if(r[p.codePointAt(0)]=!0,(o||u)&&d){const _=wh[p];_&&(r[_.codePointAt(0)]=!0)}}populate(e,r,o){const u=this.layers[0],d=u.layout,p=d.get("text-font"),_=d.get("text-field"),x=d.get("icon-image"),T=(_.value.kind!=="constant"||_.value.value instanceof kn&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&(p.value.kind!=="constant"||p.value.value.length>0),E=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,I=d.get("symbol-sort-key");if(this.features=[],!T&&!E)return;const A=r.iconDependencies,z=r.glyphDependencies,L=r.availableImages,F=new Vt(this.zoom);for(const{feature:O,id:$,index:J,sourceLayerIndex:G}of e){const Z=u._featureFilter.needGeometry,te=Ts(O,Z);if(!u._featureFilter.filter(F,te,o))continue;let oe,be;if(Z||(te.geometry=ws(O)),T){const ze=u.getValueAndResolveTokens("text-field",te,o,L),Oe=kn.factory(ze),Ze=this.hasRTLText=this.hasRTLText||JT(Oe);(!Ze||vs.getRTLTextPluginStatus()==="unavailable"||Ze&&vs.isParsed())&&(oe=kT(Oe,u,te))}if(E){const ze=u.getValueAndResolveTokens("icon-image",te,o,L);be=ze instanceof jn?ze:jn.fromString(ze)}if(!oe&&!be)continue;const Le=this.sortFeaturesByKey?I.evaluate(te,{},o):void 0;if(this.features.push({id:$,text:oe,icon:be,index:J,sourceLayerIndex:G,geometry:te.geometry,properties:O.properties,type:vh.types[O.type],sortKey:Le}),be&&(A[be.name]=!0),oe){const ze=p.evaluate(te,{},o).join(","),Oe=d.get("text-rotation-alignment")!=="viewport"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(w.az.vertical)>=0;for(const Ze of oe.sections)if(Ze.image)A[Ze.image.name]=!0;else{const je=Go(oe.toString()),De=Ze.fontStack||ze,Me=z[De]=z[De]||{};this.calculateGlyphDependencies(Ze.text,Me,Oe,this.allowVerticalPlacement,je)}}}d.get("symbol-placement")==="line"&&(this.features=function(O){const $={},J={},G=[];let Z=0;function te(ze){G.push(O[ze]),Z++}function oe(ze,Oe,Ze){const je=J[ze];return delete J[ze],J[Oe]=je,G[je].geometry[0].pop(),G[je].geometry[0]=G[je].geometry[0].concat(Ze[0]),je}function be(ze,Oe,Ze){const je=$[Oe];return delete $[Oe],$[ze]=je,G[je].geometry[0].shift(),G[je].geometry[0]=Ze[0].concat(G[je].geometry[0]),je}function Le(ze,Oe,Ze){const je=Ze?Oe[0][Oe[0].length-1]:Oe[0][0];return`${ze}:${je.x}:${je.y}`}for(let ze=0;ze<O.length;ze++){const Oe=O[ze],Ze=Oe.geometry,je=Oe.text?Oe.text.toString():null;if(!je){te(ze);continue}const De=Le(je,Ze),Me=Le(je,Ze,!0);if(De in J&&Me in $&&J[De]!==$[Me]){const rt=be(De,Me,Ze),Je=oe(De,Me,G[rt].geometry);delete $[De],delete J[Me],J[Le(je,G[Je].geometry,!0)]=Je,G[rt].geometry=null}else De in J?oe(De,Me,Ze):Me in $?be(De,Me,Ze):(te(ze),$[De]=Z-1,J[Me]=Z-1)}return G.filter(ze=>ze.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((O,$)=>O.sortKey-$.sortKey)}update(e,r,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,{imagePositions:o}),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,{imagePositions:o}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const o=this.lineVertexArray.length;if(e.segment!==void 0){let u=e.dist(r[e.segment+1]),d=e.dist(r[e.segment]);const p={};for(let _=e.segment+1;_<r.length;_++)p[_]={x:r[_].x,y:r[_].y,tileUnitDistanceFromAnchor:u},_<r.length-1&&(u+=r[_+1].dist(r[_]));for(let _=e.segment||0;_>=0;_--)p[_]={x:r[_].x,y:r[_].y,tileUnitDistanceFromAnchor:d},_>0&&(d+=r[_-1].dist(r[_]));for(let _=0;_<r.length;_++){const x=p[_];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,r,o,u,d,p,_,x,T,E,I,A){const z=e.indexArray,L=e.layoutVertexArray,F=e.segments.prepareSegment(4*r.length,L,z,this.canOverlap?p.sortKey:void 0),O=this.glyphOffsetArray.length,$=F.vertexLength,J=this.allowVerticalPlacement&&_===w.az.vertical?Math.PI/2:0,G=p.text&&p.text.sections;for(let Z=0;Z<r.length;Z++){const{tl:te,tr:oe,bl:be,br:Le,tex:ze,pixelOffsetTL:Oe,pixelOffsetBR:Ze,minFontScaleX:je,minFontScaleY:De,glyphOffset:Me,isSDF:rt,sectionIndex:Je}=r[Z],it=F.vertexLength,Ye=Me[1];jp(L,x.x,x.y,te.x,Ye+te.y,ze.x,ze.y,o,rt,Oe.x,Oe.y,je,De),jp(L,x.x,x.y,oe.x,Ye+oe.y,ze.x+ze.w,ze.y,o,rt,Ze.x,Oe.y,je,De),jp(L,x.x,x.y,be.x,Ye+be.y,ze.x,ze.y+ze.h,o,rt,Oe.x,Ze.y,je,De),jp(L,x.x,x.y,Le.x,Ye+Le.y,ze.x+ze.w,ze.y+ze.h,o,rt,Ze.x,Ze.y,je,De),gg(e.dynamicLayoutVertexArray,x,J),z.emplaceBack(it,it+2,it+1),z.emplaceBack(it+1,it+2,it+3),F.vertexLength+=4,F.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Me[0]),Z!==r.length-1&&Je===r[Z+1].sectionIndex||e.programConfigurations.populatePaintArrays(L.length,p,p.index,{imagePositions:{},canonical:A,formattedSection:G&&G[Je]})}e.placedSymbolArray.emplaceBack(x.x,x.y,O,this.glyphOffsetArray.length-O,$,T,E,x.segment,o?o[0]:0,o?o[1]:0,u[0],u[1],_,0,!1,0,I)}_addCollisionDebugVertex(e,r,o,u,d,p){return r.emplaceBack(0,0),e.emplaceBack(o.x,o.y,u,d,Math.round(p.x),Math.round(p.y))}addCollisionDebugVertices(e,r,o,u,d,p,_){const x=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),T=x.vertexLength,E=d.layoutVertexArray,I=d.collisionVertexArray,A=_.anchorX,z=_.anchorY;this._addCollisionDebugVertex(E,I,p,A,z,new N(e,r)),this._addCollisionDebugVertex(E,I,p,A,z,new N(o,r)),this._addCollisionDebugVertex(E,I,p,A,z,new N(o,u)),this._addCollisionDebugVertex(E,I,p,A,z,new N(e,u)),x.vertexLength+=4;const L=d.indexArray;L.emplaceBack(T,T+1),L.emplaceBack(T+1,T+2),L.emplaceBack(T+2,T+3),L.emplaceBack(T+3,T),x.primitiveLength+=4}addDebugCollisionBoxes(e,r,o,u){for(let d=e;d<r;d++){const p=this.collisionBoxArray.get(d);this.addCollisionDebugVertices(p.x1,p.y1,p.x2,p.y2,u?this.textCollisionBox:this.iconCollisionBox,p.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new yg(Se,Jv.members,$e),this.iconCollisionBox=new yg(Se,Jv.members,$e);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,o,u,d,p,_,x,T){const E={};for(let I=r;I<o;I++){const A=e.get(I);E.textBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},E.textFeatureIndex=A.featureIndex;break}for(let I=u;I<d;I++){const A=e.get(I);E.verticalTextBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},E.verticalTextFeatureIndex=A.featureIndex;break}for(let I=p;I<_;I++){const A=e.get(I);E.iconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},E.iconFeatureIndex=A.featureIndex;break}for(let I=x;I<T;I++){const A=e.get(I);E.verticalIconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},E.verticalIconFeatureIndex=A.featureIndex;break}return E}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const o=e.placedSymbolArray.get(r),u=o.vertexStartIndex+4*o.numGlyphs;for(let d=o.vertexStartIndex;d<u;d+=4)e.indexArray.emplaceBack(d,d+2,d+1),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),o=Math.cos(e),u=[],d=[],p=[];for(let _=0;_<this.symbolInstances.length;++_){p.push(_);const x=this.symbolInstances.get(_);u.push(0|Math.round(r*x.anchorX+o*x.anchorY)),d.push(x.featureIndex)}return p.sort((_,x)=>u[_]-u[x]||d[x]-d[_]),p}addToSortKeyRanges(e,r){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===r?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const o=this.symbolInstances.get(r);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((u,d,p)=>{u>=0&&p.indexOf(u)===d&&this.addIndicesForPlacedSymbol(this.text,u)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let p0,f0;nt("SymbolBucket",Mu,{omit:["layers","collisionBoxArray","features","compareText"]}),Mu.MAX_GLYPHS=65535,Mu.addDynamicAttributes=gg;var vg={get paint(){return f0=f0||new Tn({"icon-opacity":new dt(Pe.paint_symbol["icon-opacity"]),"icon-color":new dt(Pe.paint_symbol["icon-color"]),"icon-halo-color":new dt(Pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new dt(Pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new dt(Pe.paint_symbol["icon-halo-blur"]),"icon-translate":new ut(Pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new ut(Pe.paint_symbol["icon-translate-anchor"]),"text-opacity":new dt(Pe.paint_symbol["text-opacity"]),"text-color":new dt(Pe.paint_symbol["text-color"],{runtimeType:Nn,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new dt(Pe.paint_symbol["text-halo-color"]),"text-halo-width":new dt(Pe.paint_symbol["text-halo-width"]),"text-halo-blur":new dt(Pe.paint_symbol["text-halo-blur"]),"text-translate":new ut(Pe.paint_symbol["text-translate"]),"text-translate-anchor":new ut(Pe.paint_symbol["text-translate-anchor"])})},get layout(){return p0=p0||new Tn({"symbol-placement":new ut(Pe.layout_symbol["symbol-placement"]),"symbol-spacing":new ut(Pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ut(Pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new dt(Pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ut(Pe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ut(Pe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ut(Pe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ut(Pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new ut(Pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ut(Pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new dt(Pe.layout_symbol["icon-size"]),"icon-text-fit":new ut(Pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ut(Pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new dt(Pe.layout_symbol["icon-image"]),"icon-rotate":new dt(Pe.layout_symbol["icon-rotate"]),"icon-padding":new dt(Pe.layout_symbol["icon-padding"]),"icon-keep-upright":new ut(Pe.layout_symbol["icon-keep-upright"]),"icon-offset":new dt(Pe.layout_symbol["icon-offset"]),"icon-anchor":new dt(Pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ut(Pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ut(Pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ut(Pe.layout_symbol["text-rotation-alignment"]),"text-field":new dt(Pe.layout_symbol["text-field"]),"text-font":new dt(Pe.layout_symbol["text-font"]),"text-size":new dt(Pe.layout_symbol["text-size"]),"text-max-width":new dt(Pe.layout_symbol["text-max-width"]),"text-line-height":new ut(Pe.layout_symbol["text-line-height"]),"text-letter-spacing":new dt(Pe.layout_symbol["text-letter-spacing"]),"text-justify":new dt(Pe.layout_symbol["text-justify"]),"text-radial-offset":new dt(Pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ut(Pe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new dt(Pe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new dt(Pe.layout_symbol["text-anchor"]),"text-max-angle":new ut(Pe.layout_symbol["text-max-angle"]),"text-writing-mode":new ut(Pe.layout_symbol["text-writing-mode"]),"text-rotate":new dt(Pe.layout_symbol["text-rotate"]),"text-padding":new ut(Pe.layout_symbol["text-padding"]),"text-keep-upright":new ut(Pe.layout_symbol["text-keep-upright"]),"text-transform":new dt(Pe.layout_symbol["text-transform"]),"text-offset":new dt(Pe.layout_symbol["text-offset"]),"text-allow-overlap":new ut(Pe.layout_symbol["text-allow-overlap"]),"text-overlap":new ut(Pe.layout_symbol["text-overlap"]),"text-ignore-placement":new ut(Pe.layout_symbol["text-ignore-placement"]),"text-optional":new ut(Pe.layout_symbol["text-optional"])})}};class m0{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Kn,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}nt("FormatSectionOverride",m0,{omit:["defaultValue"]});class Vp extends ti{constructor(e,r){super(e,vg,r)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const u=[];for(const d of o)u.indexOf(d)<0&&u.push(d);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,o,u){const d=this.layout.get(e).evaluate(r,{},o,u),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||No(p.value)||!d?d:function(_,x){return x.replace(/{([^{}]+)}/g,(T,E)=>_&&E in _?String(_[E]):"")}(r.properties,d)}createBucket(e){return new Mu(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of vg.paint.overridableProperties){if(!Vp.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),o=new m0(r),u=new Nc(o,r.property.specification);let d=null;d=r.value.kind==="constant"||r.value.kind==="source"?new Jl("source",u):new jc("composite",u,r.value.zoomStops),this.paint._values[e]=new _i(r.property,d,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,o){return!(!this.layout||r.isDataDriven()||o.isDataDriven())&&Vp.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const o=e.get("text-field"),u=vg.paint.properties[r];let d=!1;const p=_=>{for(const x of _)if(u.overrides&&u.overrides.hasOverride(x))return void(d=!0)};if(o.value.kind==="constant"&&o.value.value instanceof kn)p(o.value.value.sections);else if(o.value.kind==="source"||o.value.kind==="composite"){const _=T=>{d||(T instanceof Ai&&wr(T.value)===Ta?p(T.value.sections):T instanceof Da?p(T.sections):T.eachChild(_))},x=o.value;x._styleExpression&&_(x._styleExpression.expression)}return d}}let g0;var eS={get paint(){return g0=g0||new Tn({"background-color":new ut(Pe.paint_background["background-color"]),"background-pattern":new hu(Pe.paint_background["background-pattern"]),"background-opacity":new ut(Pe.paint_background["background-opacity"])})}};class tS extends ti{constructor(e,r){super(e,eS,r)}}class rS extends ti{constructor(e,r){super(e,{},r),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class nS{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const iS={once:!0},xg=63710088e-1;class Ho{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ho(Mn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,o=this.lat*r,u=e.lat*r,d=Math.sin(o)*Math.sin(u)+Math.cos(o)*Math.cos(u)*Math.cos((e.lng-this.lng)*r);return xg*Math.acos(Math.min(d,1))}static convert(e){if(e instanceof Ho)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ho(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Ho(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const _0=2*Math.PI*xg;function y0(n){return _0*Math.cos(n*Math.PI/180)}function v0(n){return(180+n)/360}function x0(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function b0(n,e){return n/y0(e)}function w0(n){return 360*n-180}function Up(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function T0(n,e){return n*y0(Up(e))}class Th{constructor(e,r,o=0){this.x=+e,this.y=+r,this.z=+o}static fromLngLat(e,r=0){const o=Ho.convert(e);return new Th(v0(o.lng),x0(o.lat),b0(r,o.lat))}toLngLat(){return new Ho(w0(this.x),Up(this.y))}toAltitude(){return T0(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/_0*(e=Up(this.y),1/Math.cos(e*Math.PI/180));var e}}function S0(n,e,r){var o=2*Math.PI*6378137/256/Math.pow(2,r);return[n*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class bg{constructor(e,r,o){if(!function(u,d,p){return!(u<0||u>25||p<0||p>=Math.pow(2,u)||d<0||d>=Math.pow(2,u))}(e,r,o))throw new Error(`x=${r}, y=${o}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=o,this.key=Iu(0,e,e,r,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,o){const u=function(p,_,x){var T=S0(256*p,256*(_=Math.pow(2,x)-_-1),x),E=S0(256*(p+1),256*(_+1),x);return T[0]+","+T[1]+","+E[0]+","+E[1]}(this.x,this.y,this.z),d=function(p,_,x){let T,E="";for(let I=p;I>0;I--)T=1<<I-1,E+=(_&T?1:0)+(x&T?2:0);return E}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,d).replace(/{bbox-epsg-3857}/g,u)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new N((e.x*r-this.x)*st,(e.y*r-this.y)*st)}toString(){return`${this.z}/${this.x}/${this.y}`}}class P0{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Iu(e,r.z,r.z,r.x,r.y)}}class xi{constructor(e,r,o,u,d){if(this.terrainRttPosMatrix32f=null,e<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${o}`);this.overscaledZ=e,this.wrap=r,this.canonical=new bg(o,+u,+d),this.key=Iu(r,e,o,u,d)}clone(){return new xi(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new xi(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new xi(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?Iu(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):Iu(this.wrap*+r,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap||this.overscaledZ-e.overscaledZ<=0)return!1;if(e.overscaledZ===0)return this.overscaledZ>0;const r=this.canonical.z-e.canonical.z;return!(r<0)&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new xi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,o=2*this.canonical.x,u=2*this.canonical.y;return[new xi(r,this.wrap,r,o,u),new xi(r,this.wrap,r,o+1,u),new xi(r,this.wrap,r,o,u+1),new xi(r,this.wrap,r,o+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new xi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new xi(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new P0(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Th(e.x-this.wrap,e.y))}}function Iu(n,e,r,o,u){(n*=2)<0&&(n=-1*n-1);const d=1<<r;return(d*d*n+d*u+o).toString(36)+r.toString(36)+e.toString(36)}function wg(n,e){return e?n.properties[e]:n.id}function sS(n,e){const r={id:n.id};if(e.removeAllProperties&&(delete n.removeProperties,delete n.addOrUpdateProperties,delete e.removeProperties),e.removeProperties)for(const o of e.removeProperties){const u=n.addOrUpdateProperties.findIndex(d=>d.key===o);u>-1&&n.addOrUpdateProperties.splice(u,1)}return(n.removeAllProperties||e.removeAllProperties)&&(r.removeAllProperties=!0),(n.removeProperties||e.removeProperties)&&(r.removeProperties=[...n.removeProperties||[],...e.removeProperties||[]]),(n.addOrUpdateProperties||e.addOrUpdateProperties)&&(r.addOrUpdateProperties=[...n.addOrUpdateProperties||[],...e.addOrUpdateProperties||[]]),(n.newGeometry||e.newGeometry)&&(r.newGeometry=e.newGeometry||n.newGeometry),r}function E0(n){var e,r;if(!n)return{};const o={};return o.removeAll=n.removeAll,o.remove=new Set(n.remove||[]),o.add=new Map((e=n.add)===null||e===void 0?void 0:e.map(u=>[u.id,u])),o.update=new Map((r=n.update)===null||r===void 0?void 0:r.map(u=>[u.id,u])),o}nt("CanonicalTileID",bg),nt("OverscaledTileID",xi,{omit:["terrainRttPosMatrix32f"]});class cl{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const r=new cl;return r.extend(e(new N(this.minX,this.minY))),r.extend(e(new N(this.maxX,this.minY))),r.extend(e(new N(this.minX,this.maxY))),r.extend(e(new N(this.maxX,this.maxY))),r}static fromPoints(e){const r=new cl;for(const o of e)r.extend(o);return r}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class C0{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const o=e[r];this._stringToNumber[o]=r,this._numberToString[r]=o}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class M0{constructor(e,r,o,u,d){this.type="Feature",this._vectorTileFeature=e,this._x=o,this._y=u,this._z=r,this.properties=e.properties,this.id=d}projectPoint(e,r,o,u){return[360*(e.x+r)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+o)/u)*Math.PI))-90]}projectLine(e,r,o,u){return e.map(d=>this.projectPoint(d,r,o,u))}get geometry(){if(this._geometry)return this._geometry;const e=this._vectorTileFeature,r=e.extent*Math.pow(2,this._z),o=e.extent*this._x,u=e.extent*this._y,d=e.loadGeometry();switch(e.type){case 1:{const p=[];for(const x of d)p.push(x[0]);const _=this.projectLine(p,o,u,r);this._geometry=p.length===1?{type:"Point",coordinates:_[0]}:{type:"MultiPoint",coordinates:_};break}case 2:{const p=d.map(_=>this.projectLine(_,o,u,r));this._geometry=p.length===1?{type:"LineString",coordinates:p[0]}:{type:"MultiLineString",coordinates:p};break}case 3:{const p=$v(d),_=[];for(const x of p)_.push(x.map(T=>this.projectLine(T,o,u,r)));this._geometry=_.length===1?{type:"Polygon",coordinates:_[0]}:{type:"MultiPolygon",coordinates:_};break}default:throw new Error(`unknown feature type: ${e.type}`)}return this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&r!=="_x"&&r!=="_y"&&r!=="_z"&&(e[r]=this[r]);return e}}class ku{constructor(e,r,o){yt(this,"_name");yt(this,"dataBuffer");yt(this,"nullabilityBuffer");yt(this,"_size");this._name=e,this.dataBuffer=r,typeof o=="number"?this._size=o:(this.nullabilityBuffer=o,this._size=o.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class $p extends ku{}class Tg extends $p{getValueFromBuffer(e){return this.dataBuffer[e]}}class Sg extends $p{getValueFromBuffer(e){return this.dataBuffer[e]}}class I0 extends ku{constructor(r,o,u,d){super(r,o,d);yt(this,"delta");this.delta=u}}class Pg extends I0{constructor(e,r,o,u){super(e,Int32Array.of(r),o,u)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class Eg extends ku{constructor(e,r,o){super(e,Int32Array.of(r),o)}getValueFromBuffer(e){return this.dataBuffer[0]}}class oS{constructor(e,r,o,u,d=4096){yt(this,"_name");yt(this,"_geometryVector");yt(this,"_idVector");yt(this,"_propertyVectors");yt(this,"_extent");yt(this,"propertyVectorsMap");this._name=e,this._geometryVector=r,this._idVector=o,this._propertyVectors=u,this._extent=d}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map(r=>[r.name,r]))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let r=0;for(;r<this.numFeatures;){let o;this.idVector&&(o=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(r)):this.idVector.getValue(r));const u=e==null?void 0:e.next().value,d={};for(const p of this.propertyVectors){if(!p)continue;const _=p.name,x=p.getValue(r);x!==null&&(d[_]=x)}r++,yield{id:o,geometry:u,properties:d}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],r=this.geometryVector.getGeometries();for(let o=0;o<this.numFeatures;o++){let u;this.idVector&&(u=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(o)):this.idVector.getValue(o));const d={coordinates:r[o],type:this.geometryVector.geometryType(o)},p={};for(const _ of this.propertyVectors){if(!_)continue;const x=_.name,T=_.getValue(o);T!==null&&(p[x]=T)}e.push({id:u,geometry:d,properties:p})}return e}containsMaxSaveIntegerValues(e){return e instanceof Tg||e instanceof Eg&&e instanceof Pg||e instanceof Sg}}class aS{constructor(e){yt(this,"value");this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var Ct,eo,un,Xi,hl,ni,Xr,Yr,k0,bi;function sn(n,e,r){const o=new Int32Array(r);let u=0,d=e.get();for(let p=0;p<o.length;p++){let _=n[d++],x=127&_;_<128||(_=n[d++],x|=(127&_)<<7,_<128||(_=n[d++],x|=(127&_)<<14,_<128||(_=n[d++],x|=(127&_)<<21,_<128||(_=n[d++],x|=(15&_)<<28)))),o[u++]=x}return e.set(d),o}function Gp(n,e,r){const o=new BigInt64Array(r);for(let u=0;u<o.length;u++)o[u]=uS(n,e);return o}function lS(n,e){let r,o;return o=n[e.get()],e.increment(),r=127&o,o<128?r:(o=n[e.get()],e.increment(),r|=(127&o)<<7,o<128?r:(o=n[e.get()],e.increment(),r|=(127&o)<<14,o<128?r:(o=n[e.get()],e.increment(),r|=(127&o)<<21,o<128?r:(o=n[e.get()],r|=(15&o)<<28,function(u,d,p){let _,x;if(x=d[p.get()],p.increment(),_=(112&x)>>4,x<128||(x=d[p.get()],p.increment(),_|=(127&x)<<3,x<128)||(x=d[p.get()],p.increment(),_|=(127&x)<<10,x<128)||(x=d[p.get()],p.increment(),_|=(127&x)<<17,x<128)||(x=d[p.get()],p.increment(),_|=(127&x)<<24,x<128)||(x=d[p.get()],p.increment(),_|=(1&x)<<31,x<128))return 4294967296*_+(u>>>0);throw new Error("Expected varint not more than 10 bytes")}(r,n,e)))))}function A0(n,e,r,o){throw new Error("FastPFor is not implemented yet.")}function dl(n){return n>>>1^-(1&n)}function Au(n){return n>>1n^-(1n&n)}function uS(n,e){let r=0n,o=0,u=e.get();for(;u<n.length;){const d=n[u++];if(r|=BigInt(127&d)<<BigInt(o),!(128&d))break;if(o+=7,o>=64)throw new Error("Varint too long")}return e.set(u),r}function z0(n,e,r){const o=new Int32Array(r);let u=0;for(let d=0;d<e;d++){const p=n[d];o.fill(n[d+e],u,u+p),u+=p}return o}function D0(n,e,r){const o=new BigInt64Array(r);let u=0;for(let d=0;d<e;d++){const p=Number(n[d]);o.fill(n[d+e],u,u+p),u+=p}return o}function R0(n,e,r){const o=new Float64Array(r);let u=0;for(let d=0;d<e;d++){const p=n[d];o.fill(n[d+e],u,u+p),u+=p}return o}function Cg(n){const e=n.length/4*4;let r=1;if(e>=4)for(let o=n[0];r<e-4;r+=4)o=n[r]+=o,o=n[r+1]+=o,o=n[r+2]+=o,o=n[r+3]+=o;for(;r!=n.length;)n[r]+=n[r-1],++r}function L0(n){n[0]=n[0]>>>1^-(1&n[0]),n[1]=n[1]>>>1^-(1&n[1]);const e=n.length/4*4;let r=2;if(e>=4)for(;r<e-4;r+=4){const o=n[r],u=n[r+1],d=n[r+2],p=n[r+3];n[r]=(o>>>1^-(1&o))+n[r-2],n[r+1]=(u>>>1^-(1&u))+n[r-1],n[r+2]=(d>>>1^-(1&d))+n[r],n[r+3]=(p>>>1^-(1&p))+n[r+1]}for(;r!=n.length;r+=2)n[r]=(n[r]>>>1^-(1&n[r]))+n[r-2],n[r+1]=(n[r+1]>>>1^-(1&n[r+1]))+n[r-1]}(function(n){n.NONE="NONE",n.DELTA="DELTA",n.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",n.RLE="RLE",n.MORTON="MORTON",n.PDE="PDE"})(Ct||(Ct={})),function(n){n.NONE="NONE",n.FAST_PFOR="FAST_PFOR",n.VARINT="VARINT",n.ALP="ALP"}(eo||(eo={})),function(n){n.PRESENT="PRESENT",n.DATA="DATA",n.OFFSET="OFFSET",n.LENGTH="LENGTH"}(un||(un={}));class Mg{constructor(e,r,o){yt(this,"_dictionaryType");yt(this,"_offsetType");yt(this,"_lengthType");this._dictionaryType=e,this._offsetType=r,this._lengthType=o}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Dn(n,e){const r=function(o,u){const d=o[u.get()],p=Object.values(un)[d>>4];let _=null;switch(p){case un.DATA:_=new Mg(Object.values(Xi)[15&d]);break;case un.OFFSET:_=new Mg(null,Object.values(hl)[15&d]);break;case un.LENGTH:_=new Mg(null,null,Object.values(ni)[15&d])}u.increment();const x=o[u.get()],T=Object.values(Ct)[x>>5],E=Object.values(Ct)[x>>2&7],I=Object.values(eo)[3&x];u.increment();const A=sn(o,u,2),z=A[0];return{physicalStreamType:p,logicalStreamType:_,logicalLevelTechnique1:T,logicalLevelTechnique2:E,physicalLevelTechnique:I,numValues:z,byteLength:A[1],decompressedCount:z}}(n,e);return r.logicalLevelTechnique1===Ct.MORTON?function(o,u,d){const p=sn(u,d,2);return{physicalStreamType:o.physicalStreamType,logicalStreamType:o.logicalStreamType,logicalLevelTechnique1:o.logicalLevelTechnique1,logicalLevelTechnique2:o.logicalLevelTechnique2,physicalLevelTechnique:o.physicalLevelTechnique,numValues:o.numValues,byteLength:o.byteLength,decompressedCount:o.decompressedCount,numBits:p[0],coordinateShift:p[1]}}(r,n,e):Ct.RLE!==r.logicalLevelTechnique1&&Ct.RLE!==r.logicalLevelTechnique2||eo.NONE===r.physicalLevelTechnique?r:function(o,u,d){const p=sn(u,d,2);return{physicalStreamType:o.physicalStreamType,logicalStreamType:o.logicalStreamType,logicalLevelTechnique1:o.logicalLevelTechnique1,logicalLevelTechnique2:o.logicalLevelTechnique2,physicalLevelTechnique:o.physicalLevelTechnique,numValues:o.numValues,byteLength:o.byteLength,decompressedCount:p[1],runs:p[0],numRleValues:p[1]}}(r,n,e)}(function(n){n.NONE="NONE",n.SINGLE="SINGLE",n.SHARED="SHARED",n.VERTEX="VERTEX",n.MORTON="MORTON",n.FSST="FSST"})(Xi||(Xi={})),function(n){n.VERTEX="VERTEX",n.INDEX="INDEX",n.STRING="STRING",n.KEY="KEY"}(hl||(hl={})),function(n){n.VAR_BINARY="VAR_BINARY",n.GEOMETRIES="GEOMETRIES",n.PARTS="PARTS",n.RINGS="RINGS",n.TRIANGLES="TRIANGLES",n.SYMBOL="SYMBOL",n.DICTIONARY="DICTIONARY"}(ni||(ni={})),function(n){n[n.FLAT=0]="FLAT",n[n.CONST=1]="CONST",n[n.SEQUENCE=2]="SEQUENCE",n[n.DICTIONARY=3]="DICTIONARY",n[n.FSST_DICTIONARY=4]="FSST_DICTIONARY"}(Xr||(Xr={}));class Yi{constructor(e,r){yt(this,"values");yt(this,"_size");this.values=e,this._size=r}get(e){const r=Math.floor(e/8);return(this.values[r]>>e%8&1)==1}set(e,r){const o=Math.floor(e/8);this.values[o]=this.values[o]|(r?1:0)<<e%8}getInt(e){const r=Math.floor(e/8);return this.values[r]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}function Rn(n,e,r,o,u){return function(d,p,_){switch(p.logicalLevelTechnique1){case Ct.DELTA:return p.logicalLevelTechnique2===Ct.RLE?function(x,T,E){const I=new Int32Array(E);let A=0,z=0;for(let L=0;L<T;L++){const F=x[L],O=dl(x[L+T]);for(let $=0;$<F;$++)z+=O,I[A++]=z}return I}(d,p.runs,p.numRleValues):(function(x){x[0]=x[0]>>>1^-(1&x[0]);const T=x.length/4*4;let E=1;if(T>=4)for(;E<T-4;E+=4){const I=x[E],A=x[E+1],z=x[E+2],L=x[E+3];x[E]=(I>>>1^-(1&I))+x[E-1],x[E+1]=(A>>>1^-(1&A))+x[E],x[E+2]=(z>>>1^-(1&z))+x[E+1],x[E+3]=(L>>>1^-(1&L))+x[E+2]}for(;E!=x.length;++E)x[E]=(x[E]>>>1^-(1&x[E]))+x[E-1]}(d),d);case Ct.RLE:return function(x,T,E){return E?function(I,A,z){const L=new Int32Array(z);let F=0;for(let O=0;O<A;O++){const $=I[O];let J=I[O+A];J=J>>>1^-(1&J),L.fill(J,F,F+$),F+=$}return L}(x,T.runs,T.numRleValues):z0(x,T.runs,T.numRleValues)}(d,p,_);case Ct.MORTON:return Cg(d),d;case Ct.COMPONENTWISE_DELTA:return L0(d),d;case Ct.NONE:return _&&function(x){for(let T=0;T<x.length;T++){const E=x[T];x[T]=E>>>1^-(1&E)}}(d),d;default:throw new Error(`The specified Logical level technique is not supported: ${p.logicalLevelTechnique1}`)}}(qp(n,e,r),r,o)}function Xo(n,e,r){return function(o,u){if(u.logicalLevelTechnique1===Ct.DELTA&&u.logicalLevelTechnique2===Ct.NONE)return function(p){const _=new Int32Array(p.length+1);_[0]=0,_[1]=dl(p[0]);let x=_[1],T=2;for(;T!=_.length;++T){const E=p[T-1];x+=E>>>1^-(1&E),_[T]=_[T-1]+x}return _}(o);if(u.logicalLevelTechnique1===Ct.RLE&&u.logicalLevelTechnique2===Ct.NONE)return function(p,_,x){const T=new Int32Array(x+1);T[0]=0;let E=1,I=T[0];for(let A=0;A<_;A++){const z=p[A],L=p[A+_];for(let F=E;F<E+z;F++)T[F]=L+I,I=T[F];E+=z}return T}(o,u.runs,u.numRleValues);if(u.logicalLevelTechnique1===Ct.NONE&&u.logicalLevelTechnique2===Ct.NONE){(function(p){let _=0;for(let x=0;x<p.length;x++)p[x]+=_,_=p[x]})(o);const d=new Int32Array(u.numValues+1);return d[0]=0,d.set(o,1),d}if(u.logicalLevelTechnique1===Ct.DELTA&&u.logicalLevelTechnique2===Ct.RLE){const d=function(p,_,x){const T=new Int32Array(x+1);T[0]=0;let E=1,I=T[0];for(let A=0;A<_;A++){const z=p[A];let L=p[A+_];L=L>>>1^-(1&L);for(let F=E;F<E+z;F++)T[F]=L+I,I=T[F];E+=z}return T}(o,u.runs,u.numRleValues);return Cg(d),d}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")}(qp(n,e,r),r)}function qp(n,e,r){const o=r.physicalLevelTechnique;if(o===eo.FAST_PFOR)return A0();if(o===eo.VARINT)return sn(n,e,r.numValues);if(o===eo.NONE){const u=e.get();e.add(r.byteLength);const d=n.subarray(u,e.get());return new Int32Array(d)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function Ig(n,e,r,o){const u=qp(n,e,r);if(u.length===1){const d=u[0];return o?dl(d):d}return o?function(d){return dl(d[1])}(u):function(d){return d[1]}(u)}function F0(n,e,r){return function(o){if(o.length==2){const u=dl(o[1]);return[u,u]}return[dl(o[2]),dl(o[3])]}(qp(n,e,r))}function B0(n,e,r){return function(o){if(o.length==2){const u=Au(o[1]);return[u,u]}return[Au(o[2]),Au(o[3])]}(Gp(n,e,r.numValues))}function O0(n,e,r,o){return function(u,d,p){switch(d.logicalLevelTechnique1){case Ct.DELTA:return d.logicalLevelTechnique2===Ct.RLE?function(_,x,T){const E=new BigInt64Array(T);let I=0,A=0n;for(let z=0;z<x;z++){const L=Number(_[z]),F=Au(_[z+x]);for(let O=0;O<L;O++)A+=F,E[I++]=A}return E}(u,d.runs,d.numRleValues):(function(_){_[0]=_[0]>>1n^-(1n&_[0]);const x=_.length/4*4;let T=1;if(x>=4)for(;T<x-4;T+=4){const E=_[T],I=_[T+1],A=_[T+2],z=_[T+3];_[T]=(E>>1n^-(1n&E))+_[T-1],_[T+1]=(I>>1n^-(1n&I))+_[T],_[T+2]=(A>>1n^-(1n&A))+_[T+1],_[T+3]=(z>>1n^-(1n&z))+_[T+2]}for(;T!=_.length;++T)_[T]=(_[T]>>1n^-(1n&_[T]))+_[T-1]}(u),u);case Ct.RLE:return function(_,x,T){return T?function(E,I,A){const z=new BigInt64Array(A);let L=0;for(let F=0;F<I;F++){const O=Number(E[F]);let $=E[F+I];$=$>>1n^-(1n&$),z.fill($,L,L+O),L+=O}return z}(_,x.runs,x.numRleValues):D0(_,x.runs,x.numRleValues)}(u,d,p);case Ct.NONE:return p&&function(_){for(let x=0;x<_.length;x++){const T=_[x];_[x]=T>>1n^-(1n&T)}}(u),u;default:throw new Error(`The specified Logical level technique is not supported: ${d.logicalLevelTechnique1}`)}}(Gp(n,e,r.numValues),r,o)}function N0(n,e,r,o){const u=Gp(n,e,r.numValues);if(u.length===1){const d=u[0];return o?Au(d):d}return o?function(d){return Au(d[1])}(u):function(d){return d[1]}(u)}function kg(n,e,r,o,u){return function(d,p,_,x){switch(p.logicalLevelTechnique1){case Ct.DELTA:return p.logicalLevelTechnique2===Ct.RLE&&(d=z0(d,p.runs,p.numRleValues)),function(T,E){const I=new Int32Array(T.size());let A=0;T.get(0)?(I[0]=T.get(0)?E[0]>>>1^-(1&E[0]):0,A=1):I[0]=0;let z=1;for(;z!=I.length;++z)I[z]=T.get(z)?I[z-1]+(E[A]>>>1^-(1&E[A++])):I[z-1];return I}(x,d);case Ct.RLE:return function(T,E,I,A){const z=E;return I?function(L,F,O){const $=new Int32Array(L.size());let J=0;for(let G=0;G<O;G++){const Z=F[G];let te=F[G+O];te=te>>>1^-(1&te);for(let oe=J;oe<J+Z;oe++)L.get(oe)?$[oe]=te:($[oe]=0,J++);J+=Z}return $}(A,T,z.runs):function(L,F,O){const $=new Int32Array(L.size());let J=0;for(let G=0;G<O;G++){const Z=F[G],te=F[G+O];for(let oe=J;oe<J+Z;oe++)L.get(oe)?$[oe]=te:($[oe]=0,J++);J+=Z}return $}(A,T,z.runs)}(d,p,_,x);case Ct.MORTON:return Cg(d),d;case Ct.COMPONENTWISE_DELTA:return L0(d),d;case Ct.NONE:return d=_?function(T,E){const I=new Int32Array(T.size());let A=0,z=0;for(;z!=I.length;++z)if(T.get(z)){const L=E[A++];I[z]=L>>>1^-(1&L)}else I[z]=0;return I}(x,d):function(T,E){const I=new Int32Array(T.size());let A=0,z=0;for(;z!=I.length;++z)I[z]=T.get(z)?E[A++]:0;return I}(x,d),d;default:throw new Error("The specified Logical level technique is not supported")}}(r.physicalLevelTechnique===eo.FAST_PFOR?A0():sn(n,e,r.numValues),r,o,u)}function Zp(n,e,r,o){const u=n.logicalLevelTechnique1;if(u===Ct.RLE)return n.runs===1?Xr.CONST:Xr.FLAT;const d=e instanceof Yi?e.size():e;if(u===Ct.DELTA&&n.logicalLevelTechnique2===Ct.RLE){const p=n.runs,_=2;if(n.numRleValues!==d)return Xr.FLAT;if(p===1)return Xr.SEQUENCE;if(p===2){const x=o.get();let T;if(n.physicalLevelTechnique===eo.VARINT)T=sn(r,o,4);else{const E=o.get();T=new Int32Array(r.buffer,r.byteOffset+E,4)}if(o.set(x),T[2]===_&&T[3]===_)return Xr.SEQUENCE}}return n.numValues===1?Xr.CONST:Xr.FLAT}class j0 extends $p{getValueFromBuffer(e){return this.dataBuffer[e]}}class V0 extends I0{constructor(e,r,o,u){super(e,BigInt64Array.of(r),o,u)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class zu{constructor(e,r,o){yt(this,"_geometryOffsets");yt(this,"_partOffsets");yt(this,"_ringOffsets");this._geometryOffsets=e,this._partOffsets=r,this._ringOffsets=o}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function Ag(n,e,r){return{x:U0(n,e)-r,y:U0(n>>1,e)-r}}function U0(n,e){let r=0;for(let o=0;o<e;o++)r|=(n&1<<2*o)>>o;return r}(function(n){n[n.POINT=0]="POINT",n[n.LINESTRING=1]="LINESTRING",n[n.POLYGON=2]="POLYGON",n[n.MULTIPOINT=3]="MULTIPOINT",n[n.MULTILINESTRING=4]="MULTILINESTRING",n[n.MULTIPOLYGON=5]="MULTIPOLYGON"})(Yr||(Yr={})),function(n){n[n.POINT=0]="POINT",n[n.LINESTRING=1]="LINESTRING",n[n.POLYGON=2]="POLYGON"}(k0||(k0={})),function(n){n[n.MORTON=0]="MORTON",n[n.VEC_2=1]="VEC_2",n[n.VEC_3=2]="VEC_3"}(bi||(bi={}));class cS{createPoint(e){return[[e]]}createMultiPoint(e){return e.map(r=>[r])}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,r){return[e].concat(r)}createMultiPolygon(e){return e.flat()}}function $0(n){const e=new Array(n.numGeometries);let r=1,o=1,u=1,d=0;const p=new cS;let _=0,x=0;const T=n.mortonSettings,E=n.topologyVector,I=E.geometryOffsets,A=E.partOffsets,z=E.ringOffsets,L=n.vertexOffsets,F=n.containsPolygonGeometry(),O=n.vertexBuffer;for(let $=0;$<n.numGeometries;$++){const J=n.geometryType($);if(J===Yr.POINT){if(L&&L.length!==0)if(n.vertexBufferType===bi.VEC_2){const G=2*L[x++],Z=new N(O[G],O[G+1]);e[d++]=p.createPoint(Z)}else{const G=Ag(O[L[x++]],T.numBits,T.coordinateShift),Z=new N(G.x,G.y);e[d++]=p.createPoint(Z)}else{const G=new N(O[_++],O[_++]);e[d++]=p.createPoint(G)}I&&u++,A&&r++,z&&o++}else if(J===Yr.MULTIPOINT){const G=I[u]-I[u-1];u++;const Z=new Array(G);if(L&&L.length!==0){for(let te=0;te<G;te++){const oe=2*L[x++];Z[te]=new N(O[oe],O[oe+1])}e[d++]=p.createMultiPoint(Z)}else{for(let te=0;te<G;te++){const oe=O[_++],be=O[_++];Z[te]=new N(oe,be)}e[d++]=p.createMultiPoint(Z)}}else if(J===Yr.LINESTRING){let G,Z=0;F?(Z=z[o]-z[o-1],o++):Z=A[r]-A[r-1],r++,L&&L.length!==0?(G=n.vertexBufferType===bi.VEC_2?Dg(O,L,x,Z,!1):Rg(O,L,x,Z,!1,T),x+=Z):(G=zg(O,_,Z,!1),_+=2*Z),e[d++]=p.createLineString(G),I&&u++}else if(J===Yr.POLYGON){const G=A[r]-A[r-1];r++;const Z=new Array(G-1);let te=z[o]-z[o-1];if(o++,L&&L.length!==0){const oe=n.vertexBufferType===bi.VEC_2?Hp(O,L,x,te):Xp(O,L,x,te,0,T);x+=te;for(let be=0;be<Z.length;be++)te=z[o]-z[o-1],o++,Z[be]=n.vertexBufferType===bi.VEC_2?Hp(O,L,x,te):Xp(O,L,x,te,0,T),x+=te;e[d++]=p.createPolygon(oe,Z)}else{const oe=Wp(O,_,te);_+=2*te;for(let be=0;be<Z.length;be++)te=z[o]-z[o-1],o++,Z[be]=Wp(O,_,te),_+=2*te;e[d++]=p.createPolygon(oe,Z)}I&&u++}else if(J===Yr.MULTILINESTRING){const G=I[u]-I[u-1];u++;const Z=new Array(G);if(L&&L.length!==0){for(let te=0;te<G;te++){let oe=0;F?(oe=z[o]-z[o-1],o++):oe=A[r]-A[r-1],r++;const be=n.vertexBufferType===bi.VEC_2?Dg(O,L,x,oe,!1):Rg(O,L,x,oe,!1,T);Z[te]=be,x+=oe}e[d++]=p.createMultiLineString(Z)}else{for(let te=0;te<G;te++){let oe=0;F?(oe=z[o]-z[o-1],o++):oe=A[r]-A[r-1],r++,Z[te]=zg(O,_,oe,!1),_+=2*oe}e[d++]=p.createMultiLineString(Z)}}else{if(J!==Yr.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const G=I[u]-I[u-1];u++;const Z=new Array(G);let te=0;if(L&&L.length!==0){for(let oe=0;oe<G;oe++){const be=A[r]-A[r-1];r++;const Le=new Array(be-1);te=z[o]-z[o-1],o++;const ze=n.vertexBufferType===bi.VEC_2?Hp(O,L,x,te):Xp(O,L,x,te,0,T);x+=te;for(let Oe=0;Oe<Le.length;Oe++)te=z[o]-z[o-1],o++,Le[Oe]=n.vertexBufferType===bi.VEC_2?Hp(O,L,x,te):Xp(O,L,x,te,0,T),x+=te;Z[oe]=p.createPolygon(ze,Le)}e[d++]=p.createMultiPolygon(Z)}else{for(let oe=0;oe<G;oe++){const be=A[r]-A[r-1];r++;const Le=new Array(be-1);te=z[o]-z[o-1],o++;const ze=Wp(O,_,te);_+=2*te;for(let Oe=0;Oe<Le.length;Oe++){const Ze=z[o]-z[o-1];o++,Le[Oe]=Wp(O,_,Ze),_+=2*Ze}Z[oe]=p.createPolygon(ze,Le)}e[d++]=p.createMultiPolygon(Z)}}}}return e}function Wp(n,e,r){return zg(n,e,r,!0)}function Hp(n,e,r,o){return Dg(n,e,r,o,!0)}function Xp(n,e,r,o,u,d){return Rg(n,e,r,o,!0,d)}function zg(n,e,r,o){const u=new Array(o?r+1:r);for(let d=0;d<2*r;d+=2)u[d/2]=new N(n[e+d],n[e+d+1]);return o&&(u[u.length-1]=u[0]),u}function Dg(n,e,r,o,u){const d=new Array(u?o+1:o);for(let p=0;p<2*o;p+=2){const _=2*e[r+p/2];d[p/2]=new N(n[_],n[_+1])}return u&&(d[d.length-1]=d[0]),d}function Rg(n,e,r,o,u,d){const p=new Array(u?o+1:o);for(let _=0;_<o;_++){const x=Ag(n[e[r+_]],d.numBits,d.coordinateShift);p[_]=new N(x.x,x.y)}return u&&(p[p.length-1]=p[0]),p}class G0{constructor(e,r,o,u,d){yt(this,"_vertexBufferType");yt(this,"_topologyVector");yt(this,"_vertexOffsets");yt(this,"_vertexBuffer");yt(this,"_mortonSettings");this._vertexBufferType=e,this._topologyVector=r,this._vertexOffsets=o,this._vertexBuffer=u,this._mortonSettings=d}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=$0(this);let r=0;for(;r<this.numGeometries;)yield{coordinates:e[r],type:this.geometryType(r)},r++}getSimpleEncodedVertex(e){const r=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[r],this.vertexBuffer[r+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const o=Ag(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[o.x,o.y]}const r=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[r],this.vertexBuffer[r+1]]}getGeometries(){return $0(this)}get mortonSettings(){return this._mortonSettings}}class q0 extends G0{constructor(r,o,u,d,p,_,x){super(u,d,p,_,x);yt(this,"_numGeometries");yt(this,"_geometryType");this._numGeometries=r,this._geometryType=o}geometryType(r){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===Yr.POLYGON||this._geometryType===Yr.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class Z0 extends G0{constructor(r,o,u,d,p,_){super(r,u,d,p,_);yt(this,"_geometryTypes");this._geometryTypes=o}geometryType(r){return this._geometryTypes[r]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let r=0;r<this.numGeometries;r++)if(this.geometryType(r)===Yr.POLYGON||this.geometryType(r)===Yr.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class W0{constructor(e,r,o,u){yt(this,"_triangleOffsets");yt(this,"_indexBuffer");yt(this,"_vertexBuffer");yt(this,"_topologyVector");this._triangleOffsets=e,this._indexBuffer=r,this._vertexBuffer=o,this._topologyVector=u}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),r=this._topologyVector,o=r.partOffsets,u=r.ringOffsets,d=r.geometryOffsets;let p=0,_=1,x=1,T=1;for(let E=0;E<this.numGeometries;E++)switch(this.geometryType(E)){case Yr.POLYGON:{const I=o[_]-o[_-1];_++;const A=[];for(let z=0;z<I;z++){const L=u[x]-u[x-1];x++;const F=[];for(let O=0;O<L;O++){const $=this._vertexBuffer[p++],J=this._vertexBuffer[p++];F.push(new N($,J))}F.length>0&&F.push(F[0]),A.push(F)}e[E]=A,d&&T++}break;case Yr.MULTIPOLYGON:{const I=d[T]-d[T-1];T++;const A=[];for(let z=0;z<I;z++){const L=o[_]-o[_-1];_++;for(let F=0;F<L;F++){const O=u[x]-u[x-1];x++;const $=[];for(let J=0;J<O;J++){const G=this._vertexBuffer[p++],Z=this._vertexBuffer[p++];$.push(new N(G,Z))}$.length>0&&$.push($[0]),A.push($)}}e[E]=A}}return e}[Symbol.iterator](){return null}}function H0(n,e,r,o,u,d){return new hS(n,e,r,o,u,d)}class hS extends W0{constructor(r,o,u,d,p,_){super(u,d,p,_);yt(this,"_numGeometries");yt(this,"_geometryType");this._numGeometries=r,this._geometryType=o}geometryType(r){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function X0(n,e,r,o,u){return new dS(n,e,r,o,u)}class dS extends W0{constructor(r,o,u,d,p){super(o,u,d,p);yt(this,"_geometryTypes");this._geometryTypes=r}geometryType(r){return this._geometryTypes[r]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function pS(n,e,r,o,u){const d=Dn(n,r);let p=null,_=null,x=null,T=null,E=null,I=null,A=null,z=null;if(Zp(d,o,n,r)===Xr.CONST){const F=Ig(n,r,d,!1);for(let O=0;O<e-1;O++){const $=Dn(n,r);switch($.physicalStreamType){case un.LENGTH:switch($.logicalStreamType.lengthType){case ni.GEOMETRIES:p=Xo(n,r,$);break;case ni.PARTS:_=Xo(n,r,$);break;case ni.RINGS:x=Xo(n,r,$);break;case ni.TRIANGLES:A=Xo(n,r,$)}break;case un.OFFSET:switch($.logicalStreamType.offsetType){case hl.VERTEX:T=Rn(n,r,$,!1);break;case hl.INDEX:z=Rn(n,r,$,!1)}break;case un.DATA:Xi.VERTEX===$.logicalStreamType.dictionaryType?E=Rn(n,r,$,!0):(I={numBits:$.numBits,coordinateShift:$.coordinateShift},E=Rn(n,r,$,!1))}}return z!==null?p!=null||_!=null?H0(o,F,A,z,E,new zu(p,_,x)):H0(o,F,A,z,E):I===null?function(O,$,J,G,Z){return new q0(O,$,bi.VEC_2,J,G,Z)}(o,F,new zu(p,_,x),T,E):function(O,$,J,G,Z,te){return new q0(O,$,bi.MORTON,J,G,Z,te)}(o,F,new zu(p,_,x),T,E,I)}const L=Rn(n,r,d,!1);for(let F=0;F<e-1;F++){const O=Dn(n,r);switch(O.physicalStreamType){case un.LENGTH:switch(O.logicalStreamType.lengthType){case ni.GEOMETRIES:p=Rn(n,r,O,!1);break;case ni.PARTS:_=Rn(n,r,O,!1);break;case ni.RINGS:x=Rn(n,r,O,!1);break;case ni.TRIANGLES:A=Xo(n,r,O)}break;case un.OFFSET:switch(O.logicalStreamType.offsetType){case hl.VERTEX:T=Rn(n,r,O,!1);break;case hl.INDEX:z=Rn(n,r,O,!1)}break;case un.DATA:Xi.VERTEX===O.logicalStreamType.dictionaryType?E=Rn(n,r,O,!0):(I={numBits:O.numBits,coordinateShift:O.coordinateShift},E=Rn(n,r,O,!1))}}return z!==null&&_===null?X0(L,A,z,E):(p!==null?(p=Lg(L,p,2),_!==null&&x!==null?(_=Y0(L,p,_,!1),x=function(F,O,$,J){const G=new Int32Array($[$.length-1]+1);let Z=0;G[0]=Z;let te=1,oe=1,be=0;for(let Le=0;Le<F.length;Le++){const ze=F[Le],Oe=O[Le+1]-O[Le];if(ze!==0&&ze!==3)for(let Ze=0;Ze<Oe;Ze++){const je=$[te]-$[te-1];te++;for(let De=0;De<je;De++)Z=G[oe++]=Z+J[be++]}else for(let Ze=0;Ze<Oe;Ze++)G[oe++]=++Z,te++}return G}(L,p,_,x)):_!==null&&(_=function(F,O,$){const J=new Int32Array(O[O.length-1]+1);let G=0;J[0]=G;let Z=1,te=0;for(let oe=0;oe<F.length;oe++){const be=F[oe],Le=O[oe+1]-O[oe];if(be===4||be===1)for(let ze=0;ze<Le;ze++)G=J[Z++]=G+$[te++];else for(let ze=0;ze<Le;ze++)J[Z++]=++G}return J}(L,p,_))):_!==null&&x!==null?(_=Lg(L,_,1),x=Y0(L,_,x,!0)):_!==null&&(_=Lg(L,_,0)),z!==null?X0(L,A,z,E,new zu(p,_,x)):I===null?function(F,O,$,J){return new Z0(bi.VEC_2,F,O,$,J)}(L,new zu(p,_,x),T,E):function(F,O,$,J,G){return new Z0(bi.MORTON,F,O,$,J,G)}(L,new zu(p,_,x),T,E,I))}function Lg(n,e,r){const o=new Int32Array(n.length+1);let u=0;o[0]=u;let d=0;for(let p=0;p<n.length;p++)u=o[p+1]=u+(n[p]>r?e[d++]:1);return o}function Y0(n,e,r,o){const u=new Int32Array(e[e.length-1]+1);let d=0;u[0]=d;let p=1,_=0;for(let x=0;x<n.length;x++){const T=n[x],E=e[x+1]-e[x];if(T===5||T===2||o&&(T===4||T===1))for(let I=0;I<E;I++)d=u[p++]=d+r[_++];else for(let I=0;I<E;I++)u[p++]=++d}return u}class fS extends ku{constructor(r,o,u){super(r,o.getBuffer(),u);yt(this,"dataVector");this.dataVector=o}getValueFromBuffer(r){return this.dataVector.get(r)}}class mS extends $p{getValueFromBuffer(e){return this.dataBuffer[e]}}class K0 extends ku{constructor(e,r,o){super(e,BigInt64Array.of(r),o)}getValueFromBuffer(e){return this.dataBuffer[0]}}function Sh(n,e,r){return Q0(n,Math.ceil(e/8),r)}function Q0(n,e,r){const o=new Uint8Array(e);let u=0;for(;u<e;){const d=n[r.increment()];if(d<=127){const p=d+3,_=n[r.increment()],x=u+p;o.fill(_,u,x),u=x}else{const p=256-d;for(let _=0;_<p;_++)o[u++]=n[r.increment()]}}return o}const gS=new TextDecoder;function Fg(n,e,r){return r-e>=12?gS.decode(n.subarray(e,r)):function(o,u,d){let p="",_=u;for(;_<d;){const x=o[_];let T,E,I,A=null,z=x>239?4:x>223?3:x>191?2:1;if(_+z>d)break;z===1?x<128&&(A=x):z===2?(T=o[_+1],(192&T)==128&&(A=(31&x)<<6|63&T,A<=127&&(A=null))):z===3?(T=o[_+1],E=o[_+2],(192&T)==128&&(192&E)==128&&(A=(15&x)<<12|(63&T)<<6|63&E,(A<=2047||A>=55296&&A<=57343)&&(A=null))):z===4&&(T=o[_+1],E=o[_+2],I=o[_+3],(192&T)==128&&(192&E)==128&&(192&I)==128&&(A=(15&x)<<18|(63&T)<<12|(63&E)<<6|63&I,(A<=65535||A>=1114112)&&(A=null))),A===null?(A=65533,z=1):A>65535&&(A-=65536,p+=String.fromCharCode(A>>>10&1023|55296),A=56320|1023&A),p+=String.fromCharCode(A),_+=z}return p}(n,e,r)}class Bg extends ku{constructor(r,o,u,d){super(r,u,d);yt(this,"offsetBuffer");this.offsetBuffer=o}}class J0 extends Bg{constructor(r,o,u,d){super(r,o,u,d??o.length-1);yt(this,"textEncoder");this.textEncoder=new TextEncoder}getValueFromBuffer(r){return Fg(this.dataBuffer,this.offsetBuffer[r],this.offsetBuffer[r+1])}}class Du extends Bg{constructor(r,o,u,d,p){super(r,u,d,p??o.length);yt(this,"indexBuffer");yt(this,"textEncoder");this.indexBuffer=o,this.indexBuffer=o,this.textEncoder=new TextEncoder}getValueFromBuffer(r){const o=this.indexBuffer[r];return Fg(this.dataBuffer,this.offsetBuffer[o],this.offsetBuffer[o+1])}}class ex extends Bg{constructor(r,o,u,d,p,_,x){super(r,u,d,x);yt(this,"indexBuffer");yt(this,"symbolOffsetBuffer");yt(this,"symbolTableBuffer");yt(this,"textEncoder");yt(this,"symbolLengthBuffer");yt(this,"lengthBuffer");yt(this,"decodedDictionary");this.indexBuffer=o,this.symbolOffsetBuffer=p,this.symbolTableBuffer=_,this.textEncoder=new TextEncoder}getValueFromBuffer(r){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=function(u,d,p){const _=[],x=new Array(d.length).fill(0);for(let T=1;T<d.length;T++)x[T]=x[T-1]+d[T-1];for(let T=0;T<p.length;T++)if(p[T]===255)_.push(p[++T]);else{const E=d[p[T]],I=x[p[T]];for(let A=0;A<E;A++)_.push(u[I+A])}return new Uint8Array(_)}(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const o=this.indexBuffer[r];return Fg(this.decodedDictionary,this.offsetBuffer[o],this.offsetBuffer[o+1])}offsetToLengthBuffer(r){const o=new Uint32Array(r.length-1);let u=r[0];for(let d=1;d<r.length;d++){const p=r[d];o[d-1]=p-u,u=p}return o}}function _S(n,e,r,o,u,d){return r.type==="scalarType"?function(p,_,x,T,E,I){let A=null,z=0;if(p===0)return null;if(I.nullable){const F=Dn(_,x);z=F.numValues;const O=x.get(),$=Sh(_,z,x);x.set(O+F.byteLength),A=new Yi($,F.numValues)}const L=A??T;switch(E.physicalType){case 4:case 3:return function(F,O,$,J,G){const Z=Dn(F,O),te=Zp(Z,G,F,O),oe=J.physicalType===3;if(te===Xr.FLAT){const be=Ph(G)?kg(F,O,Z,oe,G):Rn(F,O,Z,oe);return new Tg($.name,be,G)}if(te===Xr.SEQUENCE){const be=F0(F,O,Z);return new Pg($.name,be[0],be[1],Z.numRleValues)}{const be=Ig(F,O,Z,oe);return new Eg($.name,be,G)}}(_,x,I,E,L);case 9:return function(F,O,$,J,G){let Z=null,te=null,oe=null,be=null,Le=null,ze=null,Oe=null,Ze=null;for(let je=0;je<J;je++){const De=Dn(O,$);if(De.byteLength!==0)switch(De.physicalStreamType){case un.PRESENT:{const Me=Sh(O,De.numValues,$);ze=new Yi(Me,De.numValues);break}case un.OFFSET:te=G!=null||ze!=null?kg(O,$,De,!1,G??ze):Rn(O,$,De,!1);break;case un.LENGTH:{const Me=Xo(O,$,De);ni.DICTIONARY===De.logicalStreamType.lengthType?Z=Me:ni.SYMBOL===De.logicalStreamType.lengthType?be=Me:Oe=Me;break}case un.DATA:{const Me=O.subarray($.get(),$.get()+De.byteLength);$.add(De.byteLength);const rt=De.logicalStreamType.dictionaryType;Xi.FSST===rt?Le=Me:Xi.SINGLE===rt||Xi.SHARED===rt?oe=Me:Xi.NONE===rt&&(Ze=Me);break}}}return function(je,De,Me,rt,Je,it,Ye){return De?new ex(je,Me,rt,Je,it,De,Ye):null}(F,Le,te,Z,oe,be,G??ze)??function(je,De,Me,rt,Je){return De?Je?new Du(je,Me,rt,De,Je):new Du(je,Me,rt,De):null}(F,oe,te,Z,G??ze)??function(je,De,Me,rt,Je){if(!De||!Me)return null;if(rt)return Je?new Du(je,rt,De,Me,Je):new Du(je,rt,De,Me);if(Je&&Je.size()!==De.length-1){const it=new Int32Array(Je.size());let Ye=0;for(let ct=0;ct<Je.size();ct++)it[ct]=Je.get(ct)?Ye++:0;return new Du(je,it,De,Me,Je)}return Je?new J0(je,De,Me,Je):new J0(je,De,Me)}(F,Oe,Ze,te,G??ze)}(I.name,_,x,I.nullable?p-1:p,A);case 0:return function(F,O,$,J,G){const Z=Dn(F,O),te=Z.numValues,oe=O.get(),be=Ph(G)?function(ze,Oe,Ze,je){const De=Q0(ze,Math.ceil(Oe/8),Ze),Me=new Yi(De,Oe),rt=je.size(),Je=new Yi(new Uint8Array(rt),rt);let it=0;for(let Ye=0;Ye<je.size();Ye++){const ct=!!je.get(Ye)&&Me.get(it++);Je.set(Ye,ct)}return Je.getBuffer()}(F,te,O,G):Sh(F,te,O);O.set(oe+Z.byteLength);const Le=new Yi(be,te);return new fS($.name,Le,G)}(_,x,I,0,L);case 6:case 5:return function(F,O,$,J,G){const Z=Dn(F,O),te=Zp(Z,J,F,O),oe=G.physicalType===5;if(te===Xr.FLAT){const be=Ph(J)?function(Le,ze,Oe,Ze,je){return function(De,Me,rt,Je){switch(Me.logicalLevelTechnique1){case Ct.DELTA:return Me.logicalLevelTechnique2===Ct.RLE&&(De=D0(De,Me.runs,Me.numRleValues)),function(it,Ye){const ct=new BigInt64Array(it.size());let kt=0;it.get(0)?(ct[0]=it.get(0)?Ye[0]>>1n^-(1n&Ye[0]):0n,kt=1):ct[0]=0n;let Et=1;for(;Et!=ct.length;++Et)ct[Et]=it.get(Et)?ct[Et-1]+(Ye[kt]>>1n^-(1n&Ye[kt++])):ct[Et-1];return ct}(Je,De);case Ct.RLE:return function(it,Ye,ct,kt){const Et=Ye;return ct?function(or,hn,Br){const ar=new BigInt64Array(or.size());let tr=0;for(let Rt=0;Rt<Br;Rt++){const _r=Number(hn[Rt]);let Er=hn[Rt+Br];Er=Er>>1n^-(1n&Er);for(let Yt=tr;Yt<tr+_r;Yt++)or.get(Yt)?ar[Yt]=Er:(ar[Yt]=0n,tr++);tr+=_r}return ar}(kt,it,Et.runs):function(or,hn,Br){const ar=new BigInt64Array(or.size());let tr=0;for(let Rt=0;Rt<Br;Rt++){const _r=Number(hn[Rt]),Er=hn[Rt+Br];for(let Yt=tr;Yt<tr+_r;Yt++)or.get(Yt)?ar[Yt]=Er:(ar[Yt]=0n,tr++);tr+=_r}return ar}(kt,it,Et.runs)}(De,Me,rt,Je);case Ct.NONE:return De=rt?function(it,Ye){const ct=new BigInt64Array(it.size());let kt=0,Et=0;for(;Et!=ct.length;++Et)if(it.get(Et)){const or=Ye[kt++];ct[Et]=or>>1n^-(1n&or)}else ct[Et]=0n;return ct}(Je,De):function(it,Ye){const ct=new BigInt64Array(it.size());let kt=0,Et=0;for(;Et!=ct.length;++Et)ct[Et]=it.get(Et)?Ye[kt++]:0n;return ct}(Je,De),De;default:throw new Error("The specified Logical level technique is not supported")}}(Gp(Le,ze,Oe.numValues),Oe,Ze,je)}(F,O,Z,oe,J):O0(F,O,Z,oe);return new j0($.name,be,J)}if(te===Xr.SEQUENCE){const be=B0(F,O,Z);return new V0($.name,be[0],be[1],Z.numRleValues)}{const be=N0(F,O,Z,oe);return new K0($.name,be,J)}}(_,x,I,L,E);case 7:return function(F,O,$,J){const G=Dn(F,O),Z=Ph(J)?function(te,oe,be,Le){const ze=oe.get(),Oe=ze+Le*Float32Array.BYTES_PER_ELEMENT,Ze=new Uint8Array(te.subarray(ze,Oe)).buffer,je=new Float32Array(Ze);oe.set(Oe);const De=be.size(),Me=new Float32Array(De);let rt=0;for(let Je=0;Je<De;Je++)Me[Je]=be.get(Je)?je[rt++]:0;return Me}(F,O,J,G.numValues):function(te,oe,be){const Le=oe.get(),ze=Le+be*Float32Array.BYTES_PER_ELEMENT,Oe=new Uint8Array(te.subarray(Le,ze)).buffer,Ze=new Float32Array(Oe);return oe.set(ze),Ze}(F,O,G.numValues);return new mS($.name,Z,J)}(_,x,I,L);case 8:return function(F,O,$,J){const G=Dn(F,O),Z=Ph(J)?function(te,oe,be,Le){const ze=oe.get(),Oe=ze+Le*Float64Array.BYTES_PER_ELEMENT,Ze=new Uint8Array(te.subarray(ze,Oe)).buffer,je=new Float64Array(Ze);oe.set(Oe);const De=be.size(),Me=new Float64Array(De);let rt=0;for(let Je=0;Je<De;Je++)Me[Je]=be.get(Je)?je[rt++]:0;return Me}(F,O,J,G.numValues):function(te,oe,be){const Le=oe.get(),ze=Le+be*Float64Array.BYTES_PER_ELEMENT,Oe=new Uint8Array(te.subarray(Le,ze)).buffer,Ze=new Float64Array(Oe);return oe.set(ze),Ze}(F,O,G.numValues);return new Sg($.name,Z,J)}(_,x,I,L);default:throw new Error(`The specified data type for the field is currently not supported: ${E}`)}}(o,n,e,u,r.scalarType,r):o!=1?null:function(p,_,x,T){let E=null,I=null,A=null,z=null,L=!1;for(;!L;){const J=Dn(p,_);switch(J.physicalStreamType){case un.LENGTH:ni.DICTIONARY===J.logicalStreamType.lengthType?E=Xo(p,_,J):A=Xo(p,_,J);break;case un.DATA:Xi.SINGLE===J.logicalStreamType.dictionaryType||Xi.SHARED===J.logicalStreamType.dictionaryType?(I=p.subarray(_.get(),_.get()+J.byteLength),L=!0):z=p.subarray(_.get(),_.get()+J.byteLength),_.add(J.byteLength)}}const F=x.complexType.children,O=[];let $=0;for(const J of F){const G=sn(p,_,1)[0];if(G==0)continue;const Z=`${x.name}${J.name==="default"?"":":"+J.name}`;if(G!==2||J.type!=="scalarField"||J.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const te=Dn(p,_),oe=Sh(p,te.numValues,_),be=Dn(p,_),Le=be.decompressedCount!==T?kg(p,_,be,!1,new Yi(oe,te.numValues)):Rn(p,_,be,!1);O[$++]=z?new ex(Z,Le,E,I,A,z,new Yi(oe,te.numValues)):new Du(Z,Le,E,I,new Yi(oe,te.numValues))}return O}(n,e,r,u)}function Ph(n){return n instanceof Yi}function yS(n){if(n.name==="id")return!1;if(n.type==="scalarType"){const e=n.scalarType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(e.type==="logicalType")return!1}else if(n.type==="complexType"){const e=n.complexType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",n),!1}const vS=new TextDecoder;function tx(n,e){const r=sn(n,e,1)[0];if(r===0)return"";const o=e.get(),u=n.subarray(o,o+r);return e.add(r),vS.decode(u)}function rx(n,e){const r=sn(n,e,1)[0]>>>0,o=!!(4&r),u=!!(2&r),d=sn(n,e,1)[0]>>>0,p={};if(1&r&&(p.nullable=!0),u){const _={};if(o?(_.type="logicalType",_.logicalType=d):(_.type="physicalType",_.physicalType=d),8&r){const x=sn(n,e,1)[0]>>>0;_.children=new Array(x);for(let T=0;T<x;T++)_.children[T]=rx(n,e)}p.type="complexField",p.complexField=_}else{const _={};o?(_.type="logicalType",_.logicalType=d):(_.type="physicalType",_.physicalType=d),p.type="scalarField",p.scalarField=_}return p}function xS(n,e){const r=sn(n,e,1)[0]>>>0,o=function(u){switch(u){case 0:case 1:case 2:case 3:{const d={};d.nullable=!!(1&u),d.columnScope=0;const p={};return p.physicalType=u>1?6:4,p.type="physicalType",d.scalarType=p,d.type="scalarType",d}case 4:{const d={nullable:!1,columnScope:0},p={type:"physicalType",physicalType:0};return d.type="complexType",d.complexType=p,d}case 30:{const d={nullable:!1,columnScope:0},p={type:"physicalType",physicalType:1};return d.type="complexType",d.complexType=p,d}default:return function(d){let p=null;switch(d){case 10:case 11:p=0;break;case 12:case 13:p=1;break;case 14:case 15:p=2;break;case 16:case 17:p=3;break;case 18:case 19:p=4;break;case 20:case 21:p=5;break;case 22:case 23:p=6;break;case 24:case 25:p=7;break;case 26:case 27:p=8;break;case 28:case 29:p=9;break;default:return null}const _={};_.nullable=!!(1&d),_.columnScope=0;const x={type:"physicalType"};return x.physicalType=p,_.type="scalarType",_.scalarType=x,_}(u)}}(r);if(!o)throw new Error(`Unsupported column type code: ${r}`);if(function(u){return u>=10}(r)?o.name=tx(n,e):r>=0&&r<=3?o.name="id":r===4&&(o.name="geometry"),function(u){return u===30}(r)){const u=sn(n,e,1)[0]>>>0,d=o.complexType;d.children=new Array(u);for(let p=0;p<u;p++)d.children[p]=rx(n,e)}return o}function bS(n,e){const r={featureTables:[]},o={};o.name=tx(n,e);const u=sn(n,e,1)[0]>>>0,d=sn(n,e,1)[0]>>>0;o.columns=new Array(d);for(let p=0;p<d;p++)o.columns[p]=xS(n,e);return r.featureTables.push(o),[r,u]}function wS(n,e,r,o,u,d,p=!1){const _=e.scalarType.physicalType,x=Zp(u,d,n,r);if(_===4)switch(x){case Xr.FLAT:{const T=Rn(n,r,u,!1);return new Tg(o,T,d)}case Xr.SEQUENCE:{const T=F0(n,r,u);return new Pg(o,T[0],T[1],u.numRleValues)}case Xr.CONST:{const T=Ig(n,r,u,!1);return new Eg(o,T,d)}}else switch(x){case Xr.FLAT:{if(p){const E=function(I,A,z,L){const F=function(O,$,J){const G=new Float64Array($);for(let Z=0;Z<$;Z++)G[Z]=lS(O,J);return G}(I,z.numValues,A);return function(O,$,J){switch($.logicalLevelTechnique1){case Ct.DELTA:return $.logicalLevelTechnique2===Ct.RLE&&(O=R0(O,$.runs,$.numRleValues)),function(G){G[0]=G[0]%2==1?(G[0]+1)/-2:G[0]/2;const Z=G.length/4*4;let te=1;if(Z>=4)for(;te<Z-4;te+=4){const oe=G[te],be=G[te+1],Le=G[te+2],ze=G[te+3];G[te]=(oe%2==1?(oe+1)/-2:oe/2)+G[te-1],G[te+1]=(be%2==1?(be+1)/-2:be/2)+G[te],G[te+2]=(Le%2==1?(Le+1)/-2:Le/2)+G[te+1],G[te+3]=(ze%2==1?(ze+1)/-2:ze/2)+G[te+2]}for(;te!=G.length;++te)G[te]=(G[te]%2==1?(G[te]+1)/-2:G[te]/2)+G[te-1]}(O),O;case Ct.RLE:return function(G,Z,te){return R0(G,Z.runs,Z.numRleValues)}(O,$);case Ct.NONE:return O;default:throw new Error(`The specified Logical level technique is not supported: ${$.logicalLevelTechnique1}`)}}(F,z)}(n,r,u);return new Sg(o,E,d)}const T=O0(n,r,u,!1);return new j0(o,T,d)}case Xr.SEQUENCE:{const T=B0(n,r,u);return new V0(o,T[0],T[1],u.numRleValues)}case Xr.CONST:{const T=N0(n,r,u,!1);return new K0(o,T,d)}}throw new Error("Vector type not supported for id column.")}class TS{constructor(e,r){var o;switch(this._featureData=e,this.properties=this._featureData.properties||{},(o=this._featureData.geometry)===null||o===void 0?void 0:o.type){case Yr.POINT:case Yr.MULTIPOINT:this.type=1;break;case Yr.LINESTRING:case Yr.MULTILINESTRING:this.type=2;break;case Yr.POLYGON:case Yr.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=r,this.id=Number(this._featureData.id)}loadGeometry(){const e=[];for(const r of this._featureData.geometry.coordinates){const o=[];for(const u of r)o.push(new N(u.x,u.y));e.push(o)}return e}}class SS{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new TS(this.features[e],this.extent)}}class nx{constructor(e){this.layers={};const r=function(o,u,d=!0){const p=new aS(0),_=[];for(;p.get()<o.length;){const x=sn(o,p,1)[0]>>>0,T=p.get()+x;if(T>o.length)throw new Error(`Block overruns tile: ${T} > ${o.length}`);if(sn(o,p,1)[0]>>>0!=1){p.set(T);continue}const E=bS(o,p),I=E[1],A=E[0].featureTables[0];let z=null,L=null;const F=[];let O=0;for(const J of A.columns){const G=J.name;if(G==="id"){let Z=null;if(J.nullable){const oe=Dn(o,p),be=p.get(),Le=Sh(o,oe.numValues,p);p.set(be+oe.byteLength),Z=new Yi(Le,oe.numValues)}const te=Dn(o,p);O=te.decompressedCount,z=wS(o,J,p,G,te,Z??O,d)}else if(G==="geometry"){const Z=sn(o,p,1)[0];if(O===0){const te=p.get();O=Dn(o,p).decompressedCount,p.set(te)}L=pS(o,Z,p,O)}else{const Z=yS(J)?sn(o,p,1)[0]:1;if(Z===0&&J.type==="scalarType")continue;const te=_S(o,p,J,Z,O);if(te)if(Array.isArray(te))for(const oe of te)F.push(oe);else F.push(te)}}const $=new oS(A.name,L,z,F,I);_.push($),p.set(T)}return _}(new Uint8Array(e));this.layers=r.reduce((o,u)=>Object.assign(Object.assign({},o),{[u.name]:new SS(u)}),{})}}class PS{constructor(e,r){this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},this.extent=r,"id"in e&&(typeof e.id=="string"?this.id=parseInt(e.id,10):typeof e.id!="number"||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],r=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const o of r){const u=[];for(const d of o)u.push(new N(d[0],d[1]));e.push(u)}return e}}const Eh="_geojsonTileLayer";function ES(n,e){e.writeVarintField(15,n.version||1),e.writeStringField(1,n.name||""),e.writeVarintField(5,n.extent||4096);const r={keys:[],values:[],keycache:{},valuecache:{}};for(let d=0;d<n.length;d++)r.feature=n.feature(d),e.writeMessage(2,CS,r);const o=r.keys;for(const d of o)e.writeStringField(3,d);const u=r.values;for(const d of u)e.writeMessage(4,kS,d)}function CS(n,e){if(!n.feature)return;const r=n.feature;r.id!==void 0&&e.writeVarintField(1,r.id),e.writeMessage(2,MS,n),e.writeVarintField(3,r.type),e.writeMessage(4,IS,r)}function MS(n,e){var r;for(const o in(r=n.feature)==null?void 0:r.properties){let u=n.feature.properties[o],d=n.keycache[o];if(u==null)continue;d===void 0&&(n.keys.push(o),d=n.keys.length-1,n.keycache[o]=d),e.writeVarint(d),typeof u!="string"&&typeof u!="boolean"&&typeof u!="number"&&(u=JSON.stringify(u));const p=typeof u+":"+u;let _=n.valuecache[p];_===void 0&&(n.values.push(u),_=n.values.length-1,n.valuecache[p]=_),e.writeVarint(_)}}function Og(n,e){return(e<<3)+(7&n)}function ix(n){return n<<1^n>>31}function IS(n,e){const r=n.loadGeometry(),o=n.type;let u=0,d=0;for(const p of r){let _=1;o===1&&(_=p.length),e.writeVarint(Og(1,_));const x=o===3?p.length-1:p.length;for(let T=0;T<x;T++){T===1&&o!==1&&e.writeVarint(Og(2,x-1));const E=p[T].x-u,I=p[T].y-d;e.writeVarint(ix(E)),e.writeVarint(ix(I)),u+=E,d+=I}n.type===3&&e.writeVarint(Og(7,1))}}function kS(n,e){const r=typeof n;r==="string"?e.writeStringField(1,n):r==="boolean"?e.writeBooleanField(7,n):r==="number"&&(n%1!=0?e.writeDoubleField(3,n):n<0?e.writeSVarintField(6,n):e.writeVarintField(5,n))}class sx{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Uo(st,16,0),this.grid3D=new Uo(st,16,0),this.featureIndexArray=new U,this.promoteId=r}insert(e,r,o,u,d,p){const _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,u,d);const x=p?this.grid3D:this.grid;for(let T=0;T<r.length;T++){const E=r[T],I=[1/0,1/0,-1/0,-1/0];for(let A=0;A<E.length;A++){const z=E[A];I[0]=Math.min(I[0],z.x),I[1]=Math.min(I[1],z.y),I[2]=Math.max(I[2],z.x),I[3]=Math.max(I[3],z.y)}I[0]<st&&I[1]<st&&I[2]>=0&&I[3]>=0&&x.insert(_,I[0],I[1],I[2],I[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new Gv(new Op(this.rawTileData)).layers:new nx(this.rawTileData).layers,this.sourceLayerCoder=new C0(this.vtLayers?Object.keys(this.vtLayers).sort():[Eh])),this.vtLayers}query(e,r,o,u){this.loadVTLayers();const d=e.params,p=st/e.tileSize/e.scale,_=ja(d.filter,d.globalState),x=e.queryGeometry,T=e.queryPadding*p,E=cl.fromPoints(x),I=this.grid.query(E.minX-T,E.minY-T,E.maxX+T,E.maxY+T),A=cl.fromPoints(e.cameraQueryGeometry).expandBy(T),z=this.grid3D.query(A.minX,A.minY,A.maxX,A.maxY,(O,$,J,G)=>function(Z,te,oe,be,Le){for(const Oe of Z)if(te<=Oe.x&&oe<=Oe.y&&be>=Oe.x&&Le>=Oe.y)return!0;const ze=[new N(te,oe),new N(te,Le),new N(be,Le),new N(be,oe)];if(Z.length>2){for(const Oe of ze)if(bu(Z,Oe))return!0}for(let Oe=0;Oe<Z.length-1;Oe++)if(z2(Z[Oe],Z[Oe+1],ze))return!0;return!1}(e.cameraQueryGeometry,O-T,$-T,J+T,G+T));for(const O of z)I.push(O);I.sort(AS);const L={};let F;for(let O=0;O<I.length;O++){const $=I[O];if($===F)continue;F=$;const J=this.featureIndexArray.get($);let G=null;this.loadMatchingFeature(L,J.bucketIndex,J.sourceLayerIndex,J.featureIndex,_,d.layers,d.availableImages,r,o,u,(Z,te,oe)=>(G||(G=ws(Z)),te.queryIntersectsFeature({queryGeometry:x,feature:Z,featureState:oe,geometry:G,zoom:this.z,transform:e.transform,pixelsToTileUnits:p,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation})))}return L}loadMatchingFeature(e,r,o,u,d,p,_,x,T,E,I){const A=this.bucketLayerIDs[r];if(p&&!A.some(O=>p.has(O)))return;const z=this.sourceLayerCoder.decode(o),L=this.vtLayers[z].feature(u);if(d.needGeometry){const O=Ts(L,!0);if(!d.filter(new Vt(this.tileID.overscaledZ),O,this.tileID.canonical))return}else if(!d.filter(new Vt(this.tileID.overscaledZ),L))return;const F=this.getId(L,z);for(let O=0;O<A.length;O++){const $=A[O];if(p&&!p.has($))continue;const J=x[$];if(!J)continue;let G={};F&&E&&(G=E.getState(J.sourceLayer||Eh,F));const Z=gn({},T[$]);Z.paint=ox(Z.paint,J.paint,L,G,_),Z.layout=ox(Z.layout,J.layout,L,G,_);const te=!I||I(L,J,G);if(!te)continue;const oe=new M0(L,this.z,this.x,this.y,F);oe.layer=Z;let be=e[$];be===void 0&&(be=e[$]=[]),be.push({featureIndex:u,feature:oe,intersectionZ:te})}}lookupSymbolFeatures(e,r,o,u,d,p,_,x){const T={};this.loadVTLayers();const E=ja(d.filterSpec,d.globalState);for(const I of e)this.loadMatchingFeature(T,o,u,I,E,p,_,x,r);return T}hasLayer(e){for(const r of this.bucketLayerIDs)for(const o of r)if(e===o)return!0;return!1}getId(e,r){var o;let u=e.id;return this.promoteId&&(u=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof u=="boolean"&&(u=Number(u)),u===void 0&&(!((o=e.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(u=Number(e.properties.cluster_id))),u}}function ox(n,e,r,o,u){return ui(n,(d,p)=>{const _=e instanceof Ja?e.get(p):null;return _&&_.evaluate?_.evaluate(r,o,u):_})}function AS(n,e){return e-n}function ax(n,e,r,o,u){const d=[];for(let p=0;p<n.length;p++){const _=n[p];let x;for(let T=0;T<_.length-1;T++){let E=_[T],I=_[T+1];E.x<e&&I.x<e||(E.x<e?E=new N(e,E.y+(e-E.x)/(I.x-E.x)*(I.y-E.y))._round():I.x<e&&(I=new N(e,E.y+(e-E.x)/(I.x-E.x)*(I.y-E.y))._round()),E.y<r&&I.y<r||(E.y<r?E=new N(E.x+(r-E.y)/(I.y-E.y)*(I.x-E.x),r)._round():I.y<r&&(I=new N(E.x+(r-E.y)/(I.y-E.y)*(I.x-E.x),r)._round()),E.x>=o&&I.x>=o||(E.x>=o?E=new N(o,E.y+(o-E.x)/(I.x-E.x)*(I.y-E.y))._round():I.x>=o&&(I=new N(o,E.y+(o-E.x)/(I.x-E.x)*(I.y-E.y))._round()),E.y>=u&&I.y>=u||(E.y>=u?E=new N(E.x+(u-E.y)/(I.y-E.y)*(I.x-E.x),u)._round():I.y>=u&&(I=new N(E.x+(u-E.y)/(I.y-E.y)*(I.x-E.x),u)._round()),x&&E.equals(x[x.length-1])||(x=[E],d.push(x)),x.push(I)))))}}return d}function lx(n,e,r,o,u){switch(e){case 1:return function(d,p,_,x){const T=[];for(const E of d)for(const I of E){const A=x===0?I.x:I.y;A>=p&&A<=_&&T.push([I])}return T}(n,r,o,u);case 2:return ux(n,r,o,u,!1);case 3:return ux(n,r,o,u,!0)}return[]}function zS(n,e,r,o,u){const d=o===0?DS:RS;let p=[];const _=[];for(let E=0;E<n.length-1;E++){const I=n[E],A=n[E+1],z=o===0?I.x:I.y,L=o===0?A.x:A.y;let F=!1;z<e?L>e&&p.push(d(I,A,e)):z>r?L<r&&p.push(d(I,A,r)):p.push(I),L<e&&z>=e&&(p.push(d(I,A,e)),F=!0),L>r&&z<=r&&(p.push(d(I,A,r)),F=!0),!u&&F&&(_.push(p),p=[])}const x=n.length-1,T=o===0?n[x].x:n[x].y;return T>=e&&T<=r&&p.push(n[x]),u&&p.length>0&&!p[0].equals(p[p.length-1])&&p.push(new N(p[0].x,p[0].y)),p.length>0&&_.push(p),_}function ux(n,e,r,o,u){const d=[];for(const p of n){const _=zS(p,e,r,o,u);_.length>0&&d.push(..._)}return d}function DS(n,e,r){return new N(r,n.y+(r-n.x)/(e.x-n.x)*(e.y-n.y))}function RS(n,e,r){return new N(n.x+(r-n.y)/(e.y-n.y)*(e.x-n.x),r)}nt("FeatureIndex",sx,{omit:["rawTileData","sourceLayerCoder"]});class Yo extends N{constructor(e,r,o,u){super(e,r),this.angle=o,u!==void 0&&(this.segment=u)}clone(){return new Yo(this.x,this.y,this.angle,this.segment)}}function cx(n,e,r,o,u){if(e.segment===void 0||r===0)return!0;let d=e,p=e.segment+1,_=0;for(;_>-r/2;){if(p--,p<0)return!1;_-=n[p].dist(d),d=n[p]}_+=n[p].dist(n[p+1]),p++;const x=[];let T=0;for(;_<r/2;){const E=n[p],I=n[p+1];if(!I)return!1;let A=n[p-1].angleTo(E)-E.angleTo(I);for(A=Math.abs((A+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:_,angleDelta:A}),T+=A;_-x[0].distance>o;)T-=x.shift().angleDelta;if(T>u)return!1;p++,_+=E.dist(I)}return!0}function hx(n){let e=0;for(let r=0;r<n.length-1;r++)e+=n[r].dist(n[r+1]);return e}function dx(n,e,r){return n?.6*e*r:0}function px(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function LS(n,e,r,o,u,d){const p=dx(r,u,d),_=px(r,o)*d;let x=0;const T=hx(n)/2;for(let E=0;E<n.length-1;E++){const I=n[E],A=n[E+1],z=I.dist(A);if(x+z>T){const L=(T-x)/z,F=nr.number(I.x,A.x,L),O=nr.number(I.y,A.y,L),$=new Yo(F,O,A.angleTo(I),E);return $._round(),!p||cx(n,$,_,p,e)?$:void 0}x+=z}}function FS(n,e,r,o,u,d,p,_,x){const T=dx(o,d,p),E=px(o,u),I=E*p,A=n[0].x===0||n[0].x===x||n[0].y===0||n[0].y===x;return e-I<e/4&&(e=I+e/4),fx(n,A?e/2*_%e:(E/2+2*d)*p*_%e,e,T,r,I,A,!1,x)}function fx(n,e,r,o,u,d,p,_,x){const T=d/2,E=hx(n);let I=0,A=e-r,z=[];for(let L=0;L<n.length-1;L++){const F=n[L],O=n[L+1],$=F.dist(O),J=O.angleTo(F);for(;A+r<I+$;){A+=r;const G=(A-I)/$,Z=nr.number(F.x,O.x,G),te=nr.number(F.y,O.y,G);if(Z>=0&&Z<x&&te>=0&&te<x&&A-T>=0&&A+T<=E){const oe=new Yo(Z,te,J,L);oe._round(),o&&!cx(n,oe,d,o,u)||z.push(oe)}}I+=$}return _||z.length||p||(z=fx(n,I/2,r,o,u,d,p,!0,x)),z}function mx(n,e,r,o){const u=[],d=n.image,p=d.pixelRatio,_=d.paddedRect.w-2,x=d.paddedRect.h-2;let T={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const E=d.stretchX||[[0,_]],I=d.stretchY||[[0,x]],A=(Me,rt)=>Me+rt[1]-rt[0],z=E.reduce(A,0),L=I.reduce(A,0),F=_-z,O=x-L;let $=0,J=z,G=0,Z=L,te=0,oe=F,be=0,Le=O;if(d.content&&o){const Me=d.content,rt=Me[2]-Me[0],Je=Me[3]-Me[1];(d.textFitWidth||d.textFitHeight)&&(T=c0(n)),$=Yp(E,0,Me[0]),G=Yp(I,0,Me[1]),J=Yp(E,Me[0],Me[2]),Z=Yp(I,Me[1],Me[3]),te=Me[0]-$,be=Me[1]-G,oe=rt-J,Le=Je-Z}const ze=T.x1,Oe=T.y1,Ze=T.x2-ze,je=T.y2-Oe,De=(Me,rt,Je,it)=>{const Ye=Kp(Me.stretch-$,J,Ze,ze),ct=Qp(Me.fixed-te,oe,Me.stretch,z),kt=Kp(rt.stretch-G,Z,je,Oe),Et=Qp(rt.fixed-be,Le,rt.stretch,L),or=Kp(Je.stretch-$,J,Ze,ze),hn=Qp(Je.fixed-te,oe,Je.stretch,z),Br=Kp(it.stretch-G,Z,je,Oe),ar=Qp(it.fixed-be,Le,it.stretch,L),tr=new N(Ye,kt),Rt=new N(or,kt),_r=new N(or,Br),Er=new N(Ye,Br),Yt=new N(ct/p,Et/p),$n=new N(hn/p,ar/p),dn=e*Math.PI/180;if(dn){const Kr=Math.sin(dn),cr=Math.cos(dn),Or=[cr,-Kr,Kr,cr];tr._matMult(Or),Rt._matMult(Or),Er._matMult(Or),_r._matMult(Or)}const Gn=Me.stretch+Me.fixed,Li=rt.stretch+rt.fixed;return{tl:tr,tr:Rt,bl:Er,br:_r,tex:{x:d.paddedRect.x+1+Gn,y:d.paddedRect.y+1+Li,w:Je.stretch+Je.fixed-Gn,h:it.stretch+it.fixed-Li},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Yt,pixelOffsetBR:$n,minFontScaleX:oe/p/Ze,minFontScaleY:Le/p/je,isSDF:r}};if(o&&(d.stretchX||d.stretchY)){const Me=gx(E,F,z),rt=gx(I,O,L);for(let Je=0;Je<Me.length-1;Je++){const it=Me[Je],Ye=Me[Je+1];for(let ct=0;ct<rt.length-1;ct++)u.push(De(it,rt[ct],Ye,rt[ct+1]))}}else u.push(De({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:x+1}));return u}function Yp(n,e,r){let o=0;for(const u of n)o+=Math.max(e,Math.min(r,u[1]))-Math.max(e,Math.min(r,u[0]));return o}function gx(n,e,r){const o=[{fixed:-1,stretch:0}];for(const[u,d]of n){const p=o[o.length-1];o.push({fixed:u-p.stretch,stretch:p.stretch}),o.push({fixed:u-p.stretch,stretch:p.stretch+(d-u)})}return o.push({fixed:e+1,stretch:r}),o}function Kp(n,e,r,o){return n/e*r+o}function Qp(n,e,r,o){return n-e*r/o}nt("Anchor",Yo);class Jp{constructor(e,r,o,u,d,p,_,x,T,E){var I;if(this.boxStartIndex=e.length,T){let A=p.top,z=p.bottom;const L=p.collisionPadding;L&&(A-=L[1],z+=L[3]);let F=z-A;F>0&&(F=Math.max(10,F),this.circleDiameter=F)}else{const A=!((I=p.image)===null||I===void 0)&&I.content&&(p.image.textFitWidth||p.image.textFitHeight)?c0(p):{x1:p.left,y1:p.top,x2:p.right,y2:p.bottom};A.y1=A.y1*_-x[0],A.y2=A.y2*_+x[2],A.x1=A.x1*_-x[3],A.x2=A.x2*_+x[1];const z=p.collisionPadding;if(z&&(A.x1-=z[0]*_,A.y1-=z[1]*_,A.x2+=z[2]*_,A.y2+=z[3]*_),E){const L=new N(A.x1,A.y1),F=new N(A.x2,A.y1),O=new N(A.x1,A.y2),$=new N(A.x2,A.y2),J=E*Math.PI/180;L._rotate(J),F._rotate(J),O._rotate(J),$._rotate(J),A.x1=Math.min(L.x,F.x,O.x,$.x),A.x2=Math.max(L.x,F.x,O.x,$.x),A.y1=Math.min(L.y,F.y,O.y,$.y),A.y2=Math.max(L.y,F.y,O.y,$.y)}e.emplaceBack(r.x,r.y,A.x1,A.y1,A.x2,A.y2,o,u,d)}this.boxEndIndex=e.length}}class BS{constructor(e=[],r=(o,u)=>o<u?-1:o>u?1:0){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:o}=this,u=r[e];for(;e>0;){const d=e-1>>1,p=r[d];if(o(u,p)>=0)break;r[e]=p,e=d}r[e]=u}_down(e){const{data:r,compare:o}=this,u=this.length>>1,d=r[e];for(;e<u;){let p=1+(e<<1);const _=p+1;if(_<this.length&&o(r[_],r[p])<0&&(p=_),o(r[p],d)>=0)break;r[e]=r[p],e=p}r[e]=d}}function OS(n,e=1,r=!1){const o=cl.fromPoints(n[0]),u=Math.min(o.width(),o.height());let d=u/2;const p=new BS([],NS),{minX:_,minY:x,maxX:T,maxY:E}=o;if(u===0)return new N(_,x);for(let z=_;z<T;z+=u)for(let L=x;L<E;L+=u)p.push(new Ru(z+d,L+d,d,n));let I=function(z){let L=0,F=0,O=0;const $=z[0];for(let J=0,G=$.length,Z=G-1;J<G;Z=J++){const te=$[J],oe=$[Z],be=te.x*oe.y-oe.x*te.y;F+=(te.x+oe.x)*be,O+=(te.y+oe.y)*be,L+=3*be}return new Ru(F/L,O/L,0,z)}(n),A=p.length;for(;p.length;){const z=p.pop();(z.d>I.d||!I.d)&&(I=z,r&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,A)),z.max-I.d<=e||(d=z.h/2,p.push(new Ru(z.p.x-d,z.p.y-d,d,n)),p.push(new Ru(z.p.x+d,z.p.y-d,d,n)),p.push(new Ru(z.p.x-d,z.p.y+d,d,n)),p.push(new Ru(z.p.x+d,z.p.y+d,d,n)),A+=4)}return r&&(console.log(`num probes: ${A}`),console.log(`best distance: ${I.d}`)),I.p}function NS(n,e){return e.max-n.max}function Ru(n,e,r,o){this.p=new N(n,e),this.h=r,this.d=function(u,d){let p=!1,_=1/0;for(let x=0;x<d.length;x++){const T=d[x];for(let E=0,I=T.length,A=I-1;E<I;A=E++){const z=T[E],L=T[A];z.y>u.y!=L.y>u.y&&u.x<(L.x-z.x)*(u.y-z.y)/(L.y-z.y)+z.x&&(p=!p),_=Math.min(_,bv(u,z,L))}}return(p?1:-1)*Math.sqrt(_)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var cn;w.aP=void 0,(cn=w.aP||(w.aP={}))[cn.center=1]="center",cn[cn.left=2]="left",cn[cn.right=3]="right",cn[cn.top=4]="top",cn[cn.bottom=5]="bottom",cn[cn["top-left"]=6]="top-left",cn[cn["top-right"]=7]="top-right",cn[cn["bottom-left"]=8]="bottom-left",cn[cn["bottom-right"]=9]="bottom-right";const Ng=Number.POSITIVE_INFINITY;function _x(n,e){return e[1]!==Ng?function(r,o,u){let d=0,p=0;switch(o=Math.abs(o),u=Math.abs(u),r){case"top-right":case"top-left":case"top":p=u-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-u}switch(r){case"top-right":case"bottom-right":case"right":d=-o;break;case"top-left":case"bottom-left":case"left":d=o}return[d,p]}(n,e[0],e[1]):function(r,o){let u=0,d=0;o<0&&(o=0);const p=o/Math.SQRT2;switch(r){case"top-right":case"top-left":d=p-7;break;case"bottom-right":case"bottom-left":d=7-p;break;case"bottom":d=7-o;break;case"top":d=o-7}switch(r){case"top-right":case"bottom-right":u=-p;break;case"top-left":case"bottom-left":u=p;break;case"left":u=o;break;case"right":u=-o}return[u,d]}(n,e[0])}function yx(n,e,r){var o;const u=n.layout,d=(o=u.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(e,{},r);if(d){const _=d.values,x=[];for(let T=0;T<_.length;T+=2){const E=x[T]=_[T],I=_[T+1].map(A=>A*Hr);E.startsWith("top")?I[1]-=7:E.startsWith("bottom")&&(I[1]+=7),x[T+1]=I}return new xn(x)}const p=u.get("text-variable-anchor");if(p){let _;_=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[u.get("text-radial-offset").evaluate(e,{},r)*Hr,Ng]:u.get("text-offset").evaluate(e,{},r).map(T=>T*Hr);const x=[];for(const T of p)x.push(T,_x(T,_));return new xn(x)}return null}function jg(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function jS(n,e,r,o,u,d,p,_,x,T,E,I){let A=d.textMaxSize.evaluate(e,{});A===void 0&&(A=p);const z=n.layers[0].layout,L=z.get("icon-offset").evaluate(e,{},E),F=xx(r.horizontal),O=p/24,$=n.tilePixelRatio*O,J=n.tilePixelRatio*A/24,G=n.tilePixelRatio*_,Z=n.tilePixelRatio*z.get("symbol-spacing"),te=z.get("text-padding")*n.tilePixelRatio,oe=function(Je,it,Ye,ct=1){const kt=Je.get("icon-padding").evaluate(it,{},Ye),Et=kt&&kt.values;return[Et[0]*ct,Et[1]*ct,Et[2]*ct,Et[3]*ct]}(z,e,E,n.tilePixelRatio),be=z.get("text-max-angle")/180*Math.PI,Le=z.get("text-rotation-alignment")!=="viewport"&&z.get("symbol-placement")!=="point",ze=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Oe=z.get("symbol-placement"),Ze=Z/2,je=z.get("icon-text-fit");let De;o&&je!=="none"&&(n.allowVerticalPlacement&&r.vertical&&(De=h0(o,r.vertical,je,z.get("icon-text-fit-padding"),L,O)),F&&(o=h0(o,F,je,z.get("icon-text-fit-padding"),L,O)));const Me=E?I.line.getGranularityForZoomLevel(E.z):1,rt=(Je,it)=>{it.x<0||it.x>=st||it.y<0||it.y>=st||function(Ye,ct,kt,Et,or,hn,Br,ar,tr,Rt,_r,Er,Yt,$n,dn,Gn,Li,Kr,cr,Or,yr,Qr,to,Ki,Ih){const Ko=Ye.addToLineVertexArray(ct,kt);let pl,Lu,Fu,Bu,Sx=0,Px=0,Ex=0,Cx=0,Hg=-1,Xg=-1;const ro={};let Mx=Pr("");if(Ye.allowVerticalPlacement&&Et.vertical){const Sn=ar.layout.get("text-rotate").evaluate(yr,{},Ki)+90;Fu=new Jp(tr,ct,Rt,_r,Er,Et.vertical,Yt,$n,dn,Sn),Br&&(Bu=new Jp(tr,ct,Rt,_r,Er,Br,Li,Kr,dn,Sn))}if(or){const Sn=ar.layout.get("icon-rotate").evaluate(yr,{}),wi=ar.layout.get("icon-text-fit")!=="none",fl=mx(or,Sn,to,wi),Ji=Br?mx(Br,Sn,to,wi):void 0;Lu=new Jp(tr,ct,Rt,_r,Er,or,Li,Kr,!1,Sn),Sx=4*fl.length;const ml=Ye.iconSizeData;let Ss=null;ml.kind==="source"?(Ss=[Js*ar.layout.get("icon-size").evaluate(yr,{})],Ss[0]>Wo&&qr(`${Ye.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):ml.kind==="composite"&&(Ss=[Js*Qr.compositeIconSizes[0].evaluate(yr,{},Ki),Js*Qr.compositeIconSizes[1].evaluate(yr,{},Ki)],(Ss[0]>Wo||Ss[1]>Wo)&&qr(`${Ye.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ye.addSymbols(Ye.icon,fl,Ss,Or,cr,yr,w.az.none,ct,Ko.lineStartIndex,Ko.lineLength,-1,Ki),Hg=Ye.icon.placedSymbolArray.length-1,Ji&&(Px=4*Ji.length,Ye.addSymbols(Ye.icon,Ji,Ss,Or,cr,yr,w.az.vertical,ct,Ko.lineStartIndex,Ko.lineLength,-1,Ki),Xg=Ye.icon.placedSymbolArray.length-1)}const Ix=Object.keys(Et.horizontal);for(const Sn of Ix){const wi=Et.horizontal[Sn];if(!pl){Mx=Pr(wi.text);const Ji=ar.layout.get("text-rotate").evaluate(yr,{},Ki);pl=new Jp(tr,ct,Rt,_r,Er,wi,Yt,$n,dn,Ji)}const fl=wi.positionedLines.length===1;if(Ex+=vx(Ye,ct,wi,hn,ar,dn,yr,Gn,Ko,Et.vertical?w.az.horizontal:w.az.horizontalOnly,fl?Ix:[Sn],ro,Hg,Qr,Ki),fl)break}Et.vertical&&(Cx+=vx(Ye,ct,Et.vertical,hn,ar,dn,yr,Gn,Ko,w.az.vertical,["vertical"],ro,Xg,Qr,Ki));const $S=pl?pl.boxStartIndex:Ye.collisionBoxArray.length,GS=pl?pl.boxEndIndex:Ye.collisionBoxArray.length,qS=Fu?Fu.boxStartIndex:Ye.collisionBoxArray.length,ZS=Fu?Fu.boxEndIndex:Ye.collisionBoxArray.length,WS=Lu?Lu.boxStartIndex:Ye.collisionBoxArray.length,HS=Lu?Lu.boxEndIndex:Ye.collisionBoxArray.length,XS=Bu?Bu.boxStartIndex:Ye.collisionBoxArray.length,YS=Bu?Bu.boxEndIndex:Ye.collisionBoxArray.length;let Qi=-1;const tf=(Sn,wi)=>Sn&&Sn.circleDiameter?Math.max(Sn.circleDiameter,wi):wi;Qi=tf(pl,Qi),Qi=tf(Fu,Qi),Qi=tf(Lu,Qi),Qi=tf(Bu,Qi);const kx=Qi>-1?1:0;kx&&(Qi*=Ih/Hr),Ye.glyphOffsetArray.length>=Mu.MAX_GLYPHS&&qr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),yr.sortKey!==void 0&&Ye.addToSortKeyRanges(Ye.symbolInstances.length,yr.sortKey);const KS=yx(ar,yr,Ki),[QS,JS]=function(Sn,wi){const fl=Sn.length,Ji=wi==null?void 0:wi.values;if((Ji==null?void 0:Ji.length)>0)for(let ml=0;ml<Ji.length;ml+=2){const Ss=Ji[ml+1];Sn.emplaceBack(w.aP[Ji[ml]],Ss[0],Ss[1])}return[fl,Sn.length]}(Ye.textAnchorOffsets,KS);Ye.symbolInstances.emplaceBack(ct.x,ct.y,ro.right>=0?ro.right:-1,ro.center>=0?ro.center:-1,ro.left>=0?ro.left:-1,ro.vertical||-1,Hg,Xg,Mx,$S,GS,qS,ZS,WS,HS,XS,YS,Rt,Ex,Cx,Sx,Px,kx,0,Yt,Qi,QS,JS)}(n,it,Je,r,o,u,De,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,$,[te,te,te,te],Le,x,G,oe,ze,L,e,d,T,E,p)};if(Oe==="line")for(const Je of ax(e.geometry,0,0,st,st)){const it=ul(Je,Me),Ye=FS(it,Z,be,r.vertical||F,o,24,J,n.overscaling,st);for(const ct of Ye)F&&VS(n,F.text,Ze,ct)||rt(it,ct)}else if(Oe==="line-center"){for(const Je of e.geometry)if(Je.length>1){const it=ul(Je,Me),Ye=LS(it,be,r.vertical||F,o,24,J);Ye&&rt(it,Ye)}}else if(e.type==="Polygon")for(const Je of Ul(e.geometry,0)){const it=OS(Je,16);rt(ul(Je[0],Me,!0),new Yo(it.x,it.y,0))}else if(e.type==="LineString")for(const Je of e.geometry){const it=ul(Je,Me);rt(it,new Yo(it[0].x,it[0].y,0))}else if(e.type==="Point")for(const Je of e.geometry)for(const it of Je)rt([it],new Yo(it.x,it.y,0))}function vx(n,e,r,o,u,d,p,_,x,T,E,I,A,z,L){const F=function(J,G,Z,te,oe,be,Le,ze){const Oe=te.layout.get("text-rotate").evaluate(be,{})*Math.PI/180,Ze=[];for(const je of G.positionedLines)for(const De of je.positionedGlyphs){if(!De.rect)continue;const Me=De.rect||{};let rt=4,Je=!0,it=1,Ye=0;const ct=(oe||ze)&&De.vertical,kt=De.metrics.advance*De.scale/2;if(ze&&G.verticalizable&&(Ye=je.lineOffset/2-(De.imageName?-(Hr-De.metrics.width*De.scale)/2:(De.scale-1)*Hr)),De.imageName){const Kr=Le[De.imageName];Je=Kr.sdf,it=Kr.pixelRatio,rt=1/it}const Et=oe?[De.x+kt,De.y]:[0,0];let or=oe?[0,0]:[De.x+kt+Z[0],De.y+Z[1]-Ye],hn=[0,0];ct&&(hn=or,or=[0,0]);const Br=De.metrics.isDoubleResolution?2:1,ar=(De.metrics.left-rt)*De.scale-kt+or[0],tr=(-De.metrics.top-rt)*De.scale+or[1],Rt=ar+Me.w/Br*De.scale/it,_r=tr+Me.h/Br*De.scale/it,Er=new N(ar,tr),Yt=new N(Rt,tr),$n=new N(ar,_r),dn=new N(Rt,_r);if(ct){const Kr=new N(-kt,kt- -17),cr=-Math.PI/2,Or=12-kt,yr=new N(22-Or,-(De.imageName?Or:0)),Qr=new N(...hn);Er._rotateAround(cr,Kr)._add(yr)._add(Qr),Yt._rotateAround(cr,Kr)._add(yr)._add(Qr),$n._rotateAround(cr,Kr)._add(yr)._add(Qr),dn._rotateAround(cr,Kr)._add(yr)._add(Qr)}if(Oe){const Kr=Math.sin(Oe),cr=Math.cos(Oe),Or=[cr,-Kr,Kr,cr];Er._matMult(Or),Yt._matMult(Or),$n._matMult(Or),dn._matMult(Or)}const Gn=new N(0,0),Li=new N(0,0);Ze.push({tl:Er,tr:Yt,bl:$n,br:dn,tex:Me,writingMode:G.writingMode,glyphOffset:Et,sectionIndex:De.sectionIndex,isSDF:Je,pixelOffsetTL:Gn,pixelOffsetBR:Li,minFontScaleX:0,minFontScaleY:0})}return Ze}(0,r,_,u,d,p,o,n.allowVerticalPlacement),O=n.textSizeData;let $=null;O.kind==="source"?($=[Js*u.layout.get("text-size").evaluate(p,{})],$[0]>Wo&&qr(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):O.kind==="composite"&&($=[Js*z.compositeTextSizes[0].evaluate(p,{},L),Js*z.compositeTextSizes[1].evaluate(p,{},L)],($[0]>Wo||$[1]>Wo)&&qr(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,F,$,_,d,p,T,e,x.lineStartIndex,x.lineLength,A,L);for(const J of E)I[J]=n.text.placedSymbolArray.length-1;return 4*F.length}function xx(n){for(const e in n)return n[e];return null}function VS(n,e,r,o){const u=n.compareText;if(e in u){const d=u[e];for(let p=d.length-1;p>=0;p--)if(o.dist(d[p])<r)return!0}else u[e]=[];return u[e].push(o),!1}const bx=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Vg{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,o]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=o>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const d=bx[15&o];if(!d)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[_]=new Uint32Array(e,4,1);return new Vg(_,p,d,e)}constructor(e,r=64,o=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const d=bx.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,_=e*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-_%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${o}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+x,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+_+x),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+x,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=r,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Ug(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:p,nodeSize:_}=this,x=[0,d.length-1,0],T=[];for(;x.length;){const E=x.pop()||0,I=x.pop()||0,A=x.pop()||0;if(I-A<=_){for(let O=A;O<=I;O++){const $=p[2*O],J=p[2*O+1];$>=e&&$<=o&&J>=r&&J<=u&&T.push(d[O])}continue}const z=A+I>>1,L=p[2*z],F=p[2*z+1];L>=e&&L<=o&&F>=r&&F<=u&&T.push(d[z]),(E===0?e<=L:r<=F)&&(x.push(A),x.push(z-1),x.push(1-E)),(E===0?o>=L:u>=F)&&(x.push(z+1),x.push(I),x.push(1-E))}return T}within(e,r,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:d,nodeSize:p}=this,_=[0,u.length-1,0],x=[],T=o*o;for(;_.length;){const E=_.pop()||0,I=_.pop()||0,A=_.pop()||0;if(I-A<=p){for(let O=A;O<=I;O++)Tx(d[2*O],d[2*O+1],e,r)<=T&&x.push(u[O]);continue}const z=A+I>>1,L=d[2*z],F=d[2*z+1];Tx(L,F,e,r)<=T&&x.push(u[z]),(E===0?e-o<=L:r-o<=F)&&(_.push(A),_.push(z-1),_.push(1-E)),(E===0?e+o>=L:r+o>=F)&&(_.push(z+1),_.push(I),_.push(1-E))}return x}}function Ug(n,e,r,o,u,d){if(u-o<=r)return;const p=o+u>>1;wx(n,e,p,o,u,d),Ug(n,e,r,o,p-1,1-d),Ug(n,e,r,p+1,u,1-d)}function wx(n,e,r,o,u,d){for(;u>o;){if(u-o>600){const T=u-o+1,E=r-o+1,I=Math.log(T),A=.5*Math.exp(2*I/3),z=.5*Math.sqrt(I*A*(T-A)/T)*(E-T/2<0?-1:1);wx(n,e,r,Math.max(o,Math.floor(r-E*A/T+z)),Math.min(u,Math.floor(r+(T-E)*A/T+z)),d)}const p=e[2*r+d];let _=o,x=u;for(Ch(n,e,o,r),e[2*u+d]>p&&Ch(n,e,o,u);_<x;){for(Ch(n,e,_,x),_++,x--;e[2*_+d]<p;)_++;for(;e[2*x+d]>p;)x--}e[2*o+d]===p?Ch(n,e,o,x):(x++,Ch(n,e,x,u)),x<=r&&(o=x+1),r<=x&&(u=x-1)}}function Ch(n,e,r,o){$g(n,r,o),$g(e,2*r,2*o),$g(e,2*r+1,2*o+1)}function $g(n,e,r){const o=n[e];n[e]=n[r],n[r]=o}function Tx(n,e,r,o){const u=n-r,d=e-o;return u*u+d*d}var Gg;w.cH=void 0,(Gg=w.cH||(w.cH={})).create="create",Gg.load="load",Gg.fullLoad="fullLoad";let ef=null,Mh=[];const qg=1e3/60,Zg="loadTime",Wg="fullLoadTime",US={mark(n){performance.mark(n)},frame(n){const e=n;ef!=null&&Mh.push(e-ef),ef=e},clearMetrics(){ef=null,Mh=[],performance.clearMeasures(Zg),performance.clearMeasures(Wg);for(const n in w.cH)performance.clearMarks(w.cH[n])},getPerformanceMetrics(){performance.measure(Zg,w.cH.create,w.cH.load),performance.measure(Wg,w.cH.create,w.cH.fullLoad);const n=performance.getEntriesByName(Zg)[0].duration,e=performance.getEntriesByName(Wg)[0].duration,r=Mh.length,o=1/(Mh.reduce((d,p)=>d+p,0)/r/1e3),u=Mh.filter(d=>d>qg).reduce((d,p)=>d+(p-qg)/qg,0);return{loadTime:n,fullLoadTime:e,fps:o,percentDroppedFrames:u/(r+u)*100,totalFrames:r}}};w.$=se,w.A=ne,w.B=Vo,w.C=Zr,w.D=ut,w.E=zt,w.F=function([n,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:n*Math.cos(e)*Math.sin(r),y:n*Math.sin(e)*Math.sin(r),z:n*Math.cos(r)}},w.G=nr,w.H=Vt,w.I=pg,w.J=yp,w.K=function(n){if(dr==null){const e=n.navigator?n.navigator.userAgent:null;dr=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return dr},w.L=class{constructor(n,e){this.target=n,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new nS(()=>this.process()),this.subscription=yo(this.target,"message",r=>this.receive(r),!1),this.globalScope=ki(self)?n:window}registerMessageHandler(n,e){this.messageHandlers[n]=e}unregisterMessageHandler(n){delete this.messageHandlers[n]}sendAsync(n,e){return new Promise((r,o)=>{const u=Math.round(1e18*Math.random()).toString(36).substring(0,10),d=e?yo(e.signal,"abort",()=>{d==null||d.unsubscribe(),delete this.resolveRejects[u];const x={id:u,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(x)},iS):null;this.resolveRejects[u]={resolve:x=>{d==null||d.unsubscribe(),r(x)},reject:x=>{d==null||d.unsubscribe(),o(x)}};const p=[],_=Object.assign(Object.assign({},n),{id:u,sourceMapId:this.mapId,origin:location.origin,data:Xa(n.data,p)});this.target.postMessage(_,{transfer:p})})}receive(n){const e=n.data,r=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[r];const o=this.abortControllers[r];return delete this.abortControllers[r],void(o&&o.abort())}if(ki(self)||e.mustQueue)return this.tasks[r]=e,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,e)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),e=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(n,e)}processTask(n,e){return c(this,void 0,void 0,function*(){if(e.type==="<response>"){const u=this.resolveRejects[n];return delete this.resolveRejects[n],u?void(e.error?u.reject(Ya(e.error)):u.resolve(Ya(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=Ya(e.data),o=new AbortController;this.abortControllers[n]=o;try{const u=yield this.messageHandlers[e.type](e.sourceMapId,r,o);this.completeTask(n,null,u)}catch(u){this.completeTask(n,u)}})}completeTask(n,e,r){const o=[];delete this.abortControllers[n];const u={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?Xa(e):null,data:Xa(r,o)};this.target.postMessage(u,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},w.M=ve,w.N=function(){var n=new ne(16);return ne!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},w.O=function(n,e,r){var o,u,d,p,_,x,T,E,I,A,z,L,F=r[0],O=r[1],$=r[2];return e===n?(n[12]=e[0]*F+e[4]*O+e[8]*$+e[12],n[13]=e[1]*F+e[5]*O+e[9]*$+e[13],n[14]=e[2]*F+e[6]*O+e[10]*$+e[14],n[15]=e[3]*F+e[7]*O+e[11]*$+e[15]):(u=e[1],d=e[2],p=e[3],_=e[4],x=e[5],T=e[6],E=e[7],I=e[8],A=e[9],z=e[10],L=e[11],n[0]=o=e[0],n[1]=u,n[2]=d,n[3]=p,n[4]=_,n[5]=x,n[6]=T,n[7]=E,n[8]=I,n[9]=A,n[10]=z,n[11]=L,n[12]=o*F+_*O+I*$+e[12],n[13]=u*F+x*O+A*$+e[13],n[14]=d*F+T*O+z*$+e[14],n[15]=p*F+E*O+L*$+e[15]),n},w.P=N,w.Q=function(n,e,r){var o=r[0],u=r[1],d=r[2];return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3]*o,n[4]=e[4]*u,n[5]=e[5]*u,n[6]=e[6]*u,n[7]=e[7]*u,n[8]=e[8]*d,n[9]=e[9]*d,n[10]=e[10]*d,n[11]=e[11]*d,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},w.R=Un,w.S=function(n,e,r){var o=e[0],u=e[1],d=e[2],p=e[3],_=e[4],x=e[5],T=e[6],E=e[7],I=e[8],A=e[9],z=e[10],L=e[11],F=e[12],O=e[13],$=e[14],J=e[15],G=r[0],Z=r[1],te=r[2],oe=r[3];return n[0]=G*o+Z*_+te*I+oe*F,n[1]=G*u+Z*x+te*A+oe*O,n[2]=G*d+Z*T+te*z+oe*$,n[3]=G*p+Z*E+te*L+oe*J,n[4]=(G=r[4])*o+(Z=r[5])*_+(te=r[6])*I+(oe=r[7])*F,n[5]=G*u+Z*x+te*A+oe*O,n[6]=G*d+Z*T+te*z+oe*$,n[7]=G*p+Z*E+te*L+oe*J,n[8]=(G=r[8])*o+(Z=r[9])*_+(te=r[10])*I+(oe=r[11])*F,n[9]=G*u+Z*x+te*A+oe*O,n[10]=G*d+Z*T+te*z+oe*$,n[11]=G*p+Z*E+te*L+oe*J,n[12]=(G=r[12])*o+(Z=r[13])*_+(te=r[14])*I+(oe=r[15])*F,n[13]=G*u+Z*x+te*A+oe*O,n[14]=G*d+Z*T+te*z+oe*$,n[15]=G*p+Z*E+te*L+oe*J,n},w.T=ig,w.U=function(n,e){const r={};for(let o=0;o<e.length;o++){const u=e[o];u in n&&(r[u]=n[u])}return r},w.V=Ho,w.W=Mn,w.X=x0,w.Y=v0,w.Z=le,w._=c,w.a=q,w.a$=at,w.a0=ue,w.a1=_o,w.a2=xi,w.a3=w0,w.a4=Up,w.a5=st,w.a6=function(n,e,r){if(!n)return e||{};if(!e)return n||{};const o=E0(n),u=E0(e);(function(p,_){_.removeAll&&(p.add.clear(),p.update.clear(),p.remove.clear(),_.remove.clear());for(const x of _.remove)p.add.delete(x),p.update.delete(x);for(const[x,T]of _.update){const E=p.update.get(x);E&&(_.update.set(x,sS(E,T)),p.update.delete(x))}})(o,u);const d={};if((o.removeAll||u.removeAll)&&(d.removeAll=!0),d.remove=new Set([...o.remove,...u.remove]),d.add=new Map([...o.add,...u.add]),d.update=new Map([...o.update,...u.update]),d.remove.size&&d.add.size)for(const p of d.add.keys())d.remove.delete(p);return function(p){const _={};return p.removeAll&&(_.removeAll=p.removeAll),p.remove&&(_.remove=Array.from(p.remove)),p.add&&(_.add=Array.from(p.add.values())),p.update&&(_.update=Array.from(p.update.values())),_}(d)},w.a7=function(n,e){const r=new Map;if(n==null||n.type==null)return r;if(n.type==="Feature"){const o=wg(n,e);return o==null?void 0:(r.set(o,n),r)}if(n.type==="FeatureCollection"){const o=new Set;for(const u of n.features){const d=wg(u,e);if(d==null||o.has(d))return;o.add(d),r.set(d,u)}return r}},w.a8=function(n,e,r){var o,u;const d=[];if(e.removeAll)n.clear();else if(e.remove)for(const p of e.remove){const _=n.get(p);_&&(d.push(_.geometry),n.delete(p))}if(e.add)for(const p of e.add){const _=wg(p,r);if(_==null)continue;const x=n.get(_);x&&d.push(x.geometry),d.push(p.geometry),n.set(_,p)}if(e.update)for(const p of e.update){const _=n.get(p.id);if(!_)continue;const x=!!p.newGeometry,T=p.removeAllProperties||((o=p.removeProperties)===null||o===void 0?void 0:o.length)>0||((u=p.addOrUpdateProperties)===null||u===void 0?void 0:u.length)>0;if(!x&&!T)continue;d.push(_.geometry);const E=Object.assign({},_);if(n.set(p.id,E),x&&(d.push(p.newGeometry),E.geometry=p.newGeometry),T){if(E.properties=p.removeAllProperties?{}:Object.assign({},E.properties||{}),p.removeProperties)for(const I of p.removeProperties)delete E.properties[I];if(p.addOrUpdateProperties)for(const{key:I,value:A}of p.addOrUpdateProperties)E.properties[I]=A}}return d},w.a9=Th,w.aA=function(n,{uSize:e,uSizeT:r},{lowerSize:o,upperSize:u}){return n.kind==="source"?o/Js:n.kind==="composite"?nr.number(o/Js,u/Js,r):e},w.aB=function(n,e){var r=e[0],o=e[1],u=e[2],d=e[3],p=e[4],_=e[5],x=e[6],T=e[7],E=e[8],I=e[9],A=e[10],z=e[11],L=e[12],F=e[13],O=e[14],$=e[15],J=r*_-o*p,G=r*x-u*p,Z=r*T-d*p,te=o*x-u*_,oe=o*T-d*_,be=u*T-d*x,Le=E*F-I*L,ze=E*O-A*L,Oe=E*$-z*L,Ze=I*O-A*F,je=I*$-z*F,De=A*$-z*O,Me=J*De-G*je+Z*Ze+te*Oe-oe*ze+be*Le;return Me?(n[0]=(_*De-x*je+T*Ze)*(Me=1/Me),n[1]=(u*je-o*De-d*Ze)*Me,n[2]=(F*be-O*oe+$*te)*Me,n[3]=(A*oe-I*be-z*te)*Me,n[4]=(x*Oe-p*De-T*ze)*Me,n[5]=(r*De-u*Oe+d*ze)*Me,n[6]=(O*Z-L*be-$*G)*Me,n[7]=(E*be-A*Z+z*G)*Me,n[8]=(p*je-_*Oe+T*Le)*Me,n[9]=(o*Oe-r*je-d*Le)*Me,n[10]=(L*oe-F*Z+$*J)*Me,n[11]=(I*Z-E*oe-z*J)*Me,n[12]=(_*ze-p*Ze-x*Le)*Me,n[13]=(r*Ze-o*ze+u*Le)*Me,n[14]=(F*G-L*te-O*J)*Me,n[15]=(E*te-I*G+A*J)*Me,n):null},w.aC=en,w.aD=function(n){var e=n[0],r=n[1];return Math.sqrt(e*e+r*r)},w.aE=function(n){return n[0]=0,n[1]=0,n},w.aF=function(n,e,r){return n[0]=e[0]*r,n[1]=e[1]*r,n},w.aG=gg,w.aH=Xn,w.aI=function(n,e,r,o){const u=e.y-n.y,d=e.x-n.x,p=o.y-r.y,_=o.x-r.x,x=p*d-_*u;if(x===0)return null;const T=(_*(n.y-r.y)-p*(n.x-r.x))/x;return new N(n.x+T*d,n.y+T*u)},w.aJ=ax,w.aK=xu,w.aL=function(n){let e=1/0,r=1/0,o=-1/0,u=-1/0;for(const d of n)e=Math.min(e,d.x),r=Math.min(r,d.y),o=Math.max(o,d.x),u=Math.max(u,d.y);return[e,r,o,u]},w.aM=Hr,w.aN=vt,w.aO=function(n,e,r,o,u=!1){if(!r[0]&&!r[1])return[0,0];const d=u?o==="map"?-n.bearingInRadians:0:o==="viewport"?n.bearingInRadians:0;if(d){const p=Math.sin(d),_=Math.cos(d);r=[r[0]*_-r[1]*p,r[0]*p+r[1]*_]}return[u?r[0]:vt(e,r[0],n.zoom),u?r[1]:vt(e,r[1],n.zoom)]},w.aQ=mg,w.aR=jg,w.aS=fg,w.aT=Vg,w.aU=Sr,w.aV=Fp,w.aW=W,w.aX=He,w.aY=Ce,w.aZ=In,w.a_=T0,w.aa=cl,w.ab=25,w.ac=bg,w.ad=n=>{const e=window.document.createElement("video");return e.muted=!0,new Promise(r=>{e.onloadstart=()=>{r(e)};for(const o of n){const u=window.document.createElement("source");Fe(o)||(e.crossOrigin="Anonymous"),u.src=o,e.appendChild(u)}})},w.ae=Ue,w.af=function(){return As++},w.ag=h,w.ah=Mu,w.ai=Eh,w.aj=ja,w.ak=Ts,w.al=M0,w.am=function(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,o,u,d)=>{const p=u||d;return e[o]=!p||p.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e},w.an=Vr,w.ao=85.051129,w.ap=vo,w.aq=function(n){return Math.pow(2,n)},w.ar=qe,w.as=b0,w.at=function(n){return Math.log(n)/Math.LN2},w.au=function(n){var e=n[0],r=n[1];return e*e+r*r},w.av=function(n){if(!n.length)return new Set;const e=Math.max(...n.map(x=>x.canonical.z));let r=1/0,o=-1/0,u=1/0,d=-1/0;const p=[];for(const x of n){const{x:T,y:E,z:I}=x.canonical,A=Math.pow(2,e-I),z=T*A,L=E*A;p.push({id:x,x:z,y:L}),z<r&&(r=z),z>o&&(o=z),L<u&&(u=L),L>d&&(d=L)}const _=new Set;for(const x of p)x.x!==r&&x.x!==o&&x.y!==u&&x.y!==d||_.add(x.id);return _},w.aw=function(n,e){const r=Math.abs(2*n.wrap)-+(n.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return n.overscaledZ-e.overscaledZ||o-r||e.canonical.y-n.canonical.y||e.canonical.x-n.canonical.x},w.ax=class{constructor(n,e){this.max=n,this.onRemove=e,this.reset()}reset(){for(const n in this.data)for(const e of this.data[n])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(n,e,r){const o=n.wrapped().key;this.data[o]===void 0&&(this.data[o]=[]);const u={value:e,timeout:void 0};if(r!==void 0&&(u.timeout=setTimeout(()=>{this.remove(n,u)},r)),this.data[o].push(u),this.order.push(o),this.order.length>this.max){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const e=this.data[n].shift();return e.timeout&&clearTimeout(e.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),e.value}getByKey(n){const e=this.data[n];return e?e[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,e){if(!this.has(n))return this;const r=n.wrapped().key,o=e===void 0?0:this.data[r].indexOf(e),u=this.data[r][o];return this.data[r].splice(o,1),u.timeout&&clearTimeout(u.timeout),this.data[r].length===0&&delete this.data[r],this.onRemove(u.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(n){const e=[];for(const r in this.data)for(const o of this.data[r])n(o.value)||e.push(o);for(const r of e)this.remove(r.value.tileID,r)}},w.ay=function(n,e){let r=0,o=0;if(n.kind==="constant")o=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:u,minZoom:d,maxZoom:p}=n,_=u?Vr(wn.interpolationFactor(u,e,d,p),0,1):0;n.kind==="camera"?o=nr.number(n.minSize,n.maxSize,_):r=_}return{uSizeT:r,uSize:o}},w.b=us,w.b$=Ks,w.b0=_t,w.b1=function(n){var e=new ne(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e},w.b2=function(n,e,r){return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],n},w.b3=function(n,e){var r=e[0],o=e[1],u=e[2],d=r*r+o*o+u*u;return d>0&&(d=1/Math.sqrt(d)),n[0]=e[0]*d,n[1]=e[1]*d,n[2]=e[2]*d,n},w.b4=Qt,w.b5=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]},w.b6=function(n,e,r){return n[0]=e[0]*r[0],n[1]=e[1]*r[1],n[2]=e[2]*r[2],n[3]=e[3]*r[3],n},w.b7=We,w.b8=function(n,e,r){const o=e[0]*r[0]+e[1]*r[1]+e[2]*r[2];return o===0?null:(-(n[0]*r[0]+n[1]*r[1]+n[2]*r[2])-r[3])/o},w.b9=jr,w.bA=function(n,e,r,o){return n[0]=e[0]+r[0]*o,n[1]=e[1]+r[1]*o,n[2]=e[2]+r[2]*o,n},w.bB=ls,w.bC=function(n,e,r){var o=r[0],u=r[1],d=r[2],p=r[3],_=e[0],x=e[1],T=e[2],E=u*T-d*x,I=d*_-o*T,A=o*x-u*_;return n[0]=_+p*(E+=E)+u*(A+=A)-d*(I+=I),n[1]=x+p*I+d*E-o*A,n[2]=T+p*A+o*I-u*E,n},w.bD=function(n,e,r){const o=function(x){var T=x[3],E=x[4],I=x[5],A=x[6],z=x[7],L=x[8];return x[0]*(L*E-I*z)+x[1]*(-L*T+I*A)+x[2]*(z*T-E*A)}([n[0],n[1],n[2],e[0],e[1],e[2],r[0],r[1],r[2]]);if(o===0)return null;const u=Qt([],[e[0],e[1],e[2]],[r[0],r[1],r[2]]),d=Qt([],[r[0],r[1],r[2]],[n[0],n[1],n[2]]),p=Qt([],[n[0],n[1],n[2]],[e[0],e[1],e[2]]),_=at([],u,-n[3]);return _t(_,_,at([],d,-e[3])),_t(_,_,at([],p,-r[3])),at(_,_,1/o),_},w.bE=xg,w.bF=function(){return new Float64Array(4)},w.bG=function(n,e,r,o){var u=[],d=[];return u[0]=e[0]-r[0],u[1]=e[1]-r[1],u[2]=e[2]-r[2],d[0]=u[0]*Math.cos(o)-u[1]*Math.sin(o),d[1]=u[0]*Math.sin(o)+u[1]*Math.cos(o),d[2]=u[2],n[0]=d[0]+r[0],n[1]=d[1]+r[1],n[2]=d[2]+r[2],n},w.bH=function(n,e,r,o){var u=[],d=[];return u[0]=e[0]-r[0],u[1]=e[1]-r[1],u[2]=e[2]-r[2],d[0]=u[0],d[1]=u[1]*Math.cos(o)-u[2]*Math.sin(o),d[2]=u[1]*Math.sin(o)+u[2]*Math.cos(o),n[0]=d[0]+r[0],n[1]=d[1]+r[1],n[2]=d[2]+r[2],n},w.bI=function(n,e,r,o){var u=[],d=[];return u[0]=e[0]-r[0],u[1]=e[1]-r[1],u[2]=e[2]-r[2],d[0]=u[2]*Math.sin(o)+u[0]*Math.cos(o),d[1]=u[1],d[2]=u[2]*Math.cos(o)-u[0]*Math.sin(o),n[0]=d[0]+r[0],n[1]=d[1]+r[1],n[2]=d[2]+r[2],n},w.bJ=function(n,e,r){var o=Math.sin(r),u=Math.cos(r),d=e[0],p=e[1],_=e[2],x=e[3],T=e[8],E=e[9],I=e[10],A=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=d*u-T*o,n[1]=p*u-E*o,n[2]=_*u-I*o,n[3]=x*u-A*o,n[8]=d*o+T*u,n[9]=p*o+E*u,n[10]=_*o+I*u,n[11]=x*o+A*u,n},w.bK=function(n,e){const r=Lt(n,360),o=Lt(e,360),u=o-r,d=o>r?u-360:u+360;return Math.abs(u)<Math.abs(d)?u:d},w.bL=function(n){return n[0]=0,n[1]=0,n[2]=0,n},w.bM=function(n,e,r,o){const u=Math.sqrt(n*n+e*e),d=Math.sqrt(r*r+o*o);n/=u,e/=u,r/=d,o/=d;const p=Math.acos(n*r+e*o);return-e*r+n*o>0?p:-p},w.bN=function(n,e){const r=Lt(n,2*Math.PI),o=Lt(e,2*Math.PI);return Math.min(Math.abs(r-o),Math.abs(r-o+2*Math.PI),Math.abs(r-o-2*Math.PI))},w.bO=function(){const n={},e=Pe.$version;for(const r in Pe.$root){const o=Pe.$root[r];if(o.required){let u=null;u=r==="version"?e:o.type==="array"?[]:{},u!=null&&(n[r]=u)}}return n},w.bP=Ie,w.bQ=Yc,w.bR=function n(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(let o=0;o<e.length;o++)if(!n(e[o],r[o]))return!1;return!0}if(typeof e=="object"&&e!==null&&r!==null){if(typeof r!="object"||Object.keys(e).length!==Object.keys(r).length)return!1;for(const o in e)if(!n(e[o],r[o]))return!1;return!0}return e===r},w.bS=function(n){n=n.slice();const e=Object.create(null);for(let r=0;r<n.length;r++)e[n[r].id]=n[r];for(let r=0;r<n.length;r++)"ref"in n[r]&&(n[r]=tn(n[r],e[n[r].ref]));return n},w.bT=function(n,e){if(n.type==="custom")return new rS(n,e);switch(n.type){case"background":return new tS(n,e);case"circle":return new N2(n,e);case"color-relief":return new q2(n,e);case"fill":return new oT(n,e);case"fill-extrusion":return new yT(n,e);case"heatmap":return new V2(n,e);case"hillshade":return new $2(n,e);case"line":return new PT(n,e);case"raster":return new Xm(n,e);case"symbol":return new Vp(n,e)}},w.bU=n=>n.type==="raster",w.bV=ci,w.bW=function(n,e){if(!n)return[{command:"setStyle",args:[e]}];let r=[];try{if(!mt(n.version,e.version))return[{command:"setStyle",args:[e]}];mt(n.center,e.center)||r.push({command:"setCenter",args:[e.center]}),mt(n.state,e.state)||r.push({command:"setGlobalState",args:[e.state]}),mt(n.centerAltitude,e.centerAltitude)||r.push({command:"setCenterAltitude",args:[e.centerAltitude]}),mt(n.zoom,e.zoom)||r.push({command:"setZoom",args:[e.zoom]}),mt(n.bearing,e.bearing)||r.push({command:"setBearing",args:[e.bearing]}),mt(n.pitch,e.pitch)||r.push({command:"setPitch",args:[e.pitch]}),mt(n.roll,e.roll)||r.push({command:"setRoll",args:[e.roll]}),mt(n.sprite,e.sprite)||r.push({command:"setSprite",args:[e.sprite]}),mt(n.glyphs,e.glyphs)||r.push({command:"setGlyphs",args:[e.glyphs]}),mt(n.transition,e.transition)||r.push({command:"setTransition",args:[e.transition]}),mt(n.light,e.light)||r.push({command:"setLight",args:[e.light]}),mt(n.terrain,e.terrain)||r.push({command:"setTerrain",args:[e.terrain]}),mt(n.sky,e.sky)||r.push({command:"setSky",args:[e.sky]}),mt(n.projection,e.projection)||r.push({command:"setProjection",args:[e.projection]});const o={},u=[];(function(p,_,x,T){let E;for(E in _=_||{},p=p||{})Object.prototype.hasOwnProperty.call(p,E)&&(Object.prototype.hasOwnProperty.call(_,E)||Jt(E,x,T));for(E in _)Object.prototype.hasOwnProperty.call(_,E)&&(Object.prototype.hasOwnProperty.call(p,E)?mt(p[E],_[E])||(p[E].type==="geojson"&&_[E].type==="geojson"&&$t(p,_,E)?Ot(x,{command:"setGeoJSONSourceData",args:[E,_[E].data]}):pr(E,_,x,T)):rn(E,_,x))})(n.sources,e.sources,u,o);const d=[];n.layers&&n.layers.forEach(p=>{"source"in p&&o[p.source]?r.push({command:"removeLayer",args:[p.id]}):d.push(p)}),r=r.concat(u),function(p,_,x){_=_||[];const T=(p=p||[]).map(xa),E=_.map(xa),I=p.reduce(ba,{}),A=_.reduce(ba,{}),z=T.slice(),L=Object.create(null);let F,O,$,J,G;for(let Z=0,te=0;Z<T.length;Z++)F=T[Z],Object.prototype.hasOwnProperty.call(A,F)?te++:(Ot(x,{command:"removeLayer",args:[F]}),z.splice(z.indexOf(F,te),1));for(let Z=0,te=0;Z<E.length;Z++)F=E[E.length-1-Z],z[z.length-1-Z]!==F&&(Object.prototype.hasOwnProperty.call(I,F)?(Ot(x,{command:"removeLayer",args:[F]}),z.splice(z.lastIndexOf(F,z.length-te),1)):te++,J=z[z.length-Z],Ot(x,{command:"addLayer",args:[A[F],J]}),z.splice(z.length-Z,0,F),L[F]=!0);for(let Z=0;Z<E.length;Z++)if(F=E[Z],O=I[F],$=A[F],!L[F]&&!mt(O,$))if(mt(O.source,$.source)&&mt(O["source-layer"],$["source-layer"])&&mt(O.type,$.type)){for(G in Lr(O.layout,$.layout,x,F,null,"setLayoutProperty"),Lr(O.paint,$.paint,x,F,null,"setPaintProperty"),mt(O.filter,$.filter)||Ot(x,{command:"setFilter",args:[F,$.filter]}),mt(O.minzoom,$.minzoom)&&mt(O.maxzoom,$.maxzoom)||Ot(x,{command:"setLayerZoomRange",args:[F,$.minzoom,$.maxzoom]}),O)Object.prototype.hasOwnProperty.call(O,G)&&G!=="layout"&&G!=="paint"&&G!=="filter"&&G!=="metadata"&&G!=="minzoom"&&G!=="maxzoom"&&(G.indexOf("paint.")===0?Lr(O[G],$[G],x,F,G.slice(6),"setPaintProperty"):mt(O[G],$[G])||Ot(x,{command:"setLayerProperty",args:[F,G,$[G]]}));for(G in $)Object.prototype.hasOwnProperty.call($,G)&&!Object.prototype.hasOwnProperty.call(O,G)&&G!=="layout"&&G!=="paint"&&G!=="filter"&&G!=="metadata"&&G!=="minzoom"&&G!=="maxzoom"&&(G.indexOf("paint.")===0?Lr(O[G],$[G],x,F,G.slice(6),"setPaintProperty"):mt(O[G],$[G])||Ot(x,{command:"setLayerProperty",args:[F,G,$[G]]}))}else Ot(x,{command:"removeLayer",args:[F]}),J=z[z.lastIndexOf(F)+1],Ot(x,{command:"addLayer",args:[$,J]})}(d,e.layers,r)}catch(o){console.warn("Unable to compute style diff:",o),r=[{command:"setStyle",args:[e]}]}return r},w.bX=function(n){const e=[],r=n.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},w.bY=ui,w.bZ=ya,w.b_=class extends zn{constructor(n,e){super(n,e),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},w.ba=function(n,e,r){return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*r,n},w.bb=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]},w.bc=P0,w.bd=Iu,w.be=function(n,e,r,o,u){var d=1/Math.tan(e/2);if(n[0]=d/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=d,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,u!=null&&u!==1/0){var p=1/(o-u);n[10]=(u+o)*p,n[14]=2*u*o*p}else n[10]=-1,n[14]=-2*o;return n},w.bf=function(n){var e=new ne(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},w.bg=function(n,e,r){var o=Math.sin(r),u=Math.cos(r),d=e[0],p=e[1],_=e[2],x=e[3],T=e[4],E=e[5],I=e[6],A=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=d*u+T*o,n[1]=p*u+E*o,n[2]=_*u+I*o,n[3]=x*u+A*o,n[4]=T*u-d*o,n[5]=E*u-p*o,n[6]=I*u-_*o,n[7]=A*u-x*o,n},w.bh=function(n,e,r){var o=Math.sin(r),u=Math.cos(r),d=e[4],p=e[5],_=e[6],x=e[7],T=e[8],E=e[9],I=e[10],A=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=d*u+T*o,n[5]=p*u+E*o,n[6]=_*u+I*o,n[7]=x*u+A*o,n[8]=T*u-d*o,n[9]=E*u-p*o,n[10]=I*u-_*o,n[11]=A*u-x*o,n},w.bi=function(){const n=new Float32Array(16);return qe(n),n},w.bj=function(){const n=new Float64Array(16);return qe(n),n},w.bk=function(){return new Float64Array(16)},w.bl=function(n,e,r){const o=new Float64Array(4);return ls(o,n,e-90,r),o},w.bm=function(n,e,r,o){var u,d,p,_,x,T=e[0],E=e[1],I=e[2],A=e[3],z=r[0],L=r[1],F=r[2],O=r[3];return(d=T*z+E*L+I*F+A*O)<0&&(d=-d,z=-z,L=-L,F=-F,O=-O),1-d>Y?(u=Math.acos(d),p=Math.sin(u),_=Math.sin((1-o)*u)/p,x=Math.sin(o*u)/p):(_=1-o,x=o),n[0]=_*T+x*z,n[1]=_*E+x*L,n[2]=_*I+x*F,n[3]=_*A+x*O,n},w.bn=function(n){const e=new Float64Array(9);(function(d,p){var _=p[0],x=p[1],T=p[2],E=p[3],I=_+_,A=x+x,z=T+T,L=_*I,F=x*I,O=x*A,$=T*I,J=T*A,G=T*z,Z=E*I,te=E*A,oe=E*z;d[0]=1-O-G,d[3]=F-oe,d[6]=$+te,d[1]=F+oe,d[4]=1-L-G,d[7]=J-Z,d[2]=$-te,d[5]=J+Z,d[8]=1-L-O})(e,n);const r=In(-Math.asin(Vr(e[2],-1,1)));let o,u;return Math.hypot(e[5],e[8])<.001?(o=0,u=-In(Math.atan2(e[3],e[4]))):(o=In(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),u=In(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:o,pitch:r+90,bearing:u}},w.bo=function(n,e){return n.roll==e.roll&&n.pitch==e.pitch&&n.bearing==e.bearing},w.bp=St,w.bq=Ys,w.br=Pu,w.bs=_h,w.bt=Su,w.bu=rr,w.bv=Ii,w.bw=bn,w.bx=function(n,e,r,o,u){return rr(o,u,Vr((n-e)/(r-e),0,1))},w.by=Lt,w.bz=function(){return new Float64Array(3)},w.c=he,w.c$=function(n,e,r,o,u){return c(this,void 0,void 0,function*(){if(ue())try{return yield _o(n,e,r,o,u)}catch{}return function(d,p,_,x,T){const E=d.width,I=d.height;cs&&hi||(cs=new OffscreenCanvas(E,I),hi=cs.getContext("2d",{willReadFrequently:!0})),cs.width=E,cs.height=I,hi.drawImage(d,0,0,E,I);const A=hi.getImageData(p,_,x,T);return hi.clearRect(0,0,E,I),A.data}(n,e,r,o,u)})},w.c0=class extends zn{constructor(n,e){super(n,e),this.current=ri}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let e=1;e<16;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},w.c1=al,w.c2=class extends zn{constructor(n,e){super(n,e),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},w.c3=class extends zn{constructor(n,e){super(n,e),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},w.c4=Be,w.c5=function(n,e){var r=Math.sin(e),o=Math.cos(e);return n[0]=o,n[1]=r,n[2]=0,n[3]=-r,n[4]=o,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},w.c6=function(n,e,r){var o=e[0],u=e[1],d=e[2];return n[0]=o*r[0]+u*r[3]+d*r[6],n[1]=o*r[1]+u*r[4]+d*r[7],n[2]=o*r[2]+u*r[5]+d*r[8],n},w.c7=function(n,e,r,o,u,d,p){var _=1/(e-r),x=1/(o-u),T=1/(d-p);return n[0]=-2*_,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*x,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*T,n[11]=0,n[12]=(e+r)*_,n[13]=(u+o)*x,n[14]=(p+d)*T,n[15]=1,n},w.c8=class extends zn{constructor(n,e){super(n,e),this.current=new Array}set(n){if(n!=this.current){this.current=n;const e=new Float32Array(4*n.length);for(let r=0;r<n.length;r++)e[4*r]=n[r].r,e[4*r+1]=n[r].g,e[4*r+2]=n[r].b,e[4*r+3]=n[r].a;this.gl.uniform4fv(this.location,e)}}},w.c9=class extends zn{constructor(n,e){super(n,e),this.current=new Array}set(n){if(n!=this.current){this.current=n;const e=new Float32Array(n);this.gl.uniform1fv(this.location,e)}}},w.cA=function(n,e){return xe[e]&&"touches"in n},w.cB=function(n){return xe[n]||V[n]},w.cC=function(n,e,r){var o=e[0],u=e[1];return n[0]=r[0]*o+r[4]*u+r[12],n[1]=r[1]*o+r[5]*u+r[13],n},w.cD=function(n,e){const{x:r,y:o}=Th.fromLngLat(e);return!(n<0||n>25||o<0||o>=1||r<0||r>=1)},w.cE=function(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},w.cF=class extends pu{},w.cG=US,w.cI=me,w.cJ=function(n,e){he.REGISTERED_PROTOCOLS[n]=e},w.cK=function(n){delete he.REGISTERED_PROTOCOLS[n]},w.cL=function(n,e){const r={};for(let u=0;u<n.length;u++){const d=e&&e[n[u].id]||ap(n[u]);e&&(e[n[u].id]=d);let p=r[d];p||(p=r[d]=[]),p.push(n[u])}const o=[];for(const u in r)o.push(r[u]);return o},w.cM=nt,w.cN=C0,w.cO=sx,w.cP=l0,w.cQ=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=st/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const e=n.bucket.layers[0],r=e.layout,o=e._unevaluatedLayout._values,u={layoutIconSize:o["icon-size"].possiblyEvaluate(new Vt(n.bucket.zoom+1),n.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new Vt(n.bucket.zoom+1),n.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new Vt(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:T,maxZoom:E}=n.bucket.textSizeData;u.compositeTextSizes=[o["text-size"].possiblyEvaluate(new Vt(T),n.canonical),o["text-size"].possiblyEvaluate(new Vt(E),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:T,maxZoom:E}=n.bucket.iconSizeData;u.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new Vt(T),n.canonical),o["icon-size"].possiblyEvaluate(new Vt(E),n.canonical)]}const d=r.get("text-line-height")*Hr,p=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",_=r.get("text-keep-upright"),x=r.get("text-size");for(const T of n.bucket.features){const E=r.get("text-font").evaluate(T,{},n.canonical).join(","),I=x.evaluate(T,{},n.canonical),A=u.layoutTextSize.evaluate(T,{},n.canonical),z=u.layoutIconSize.evaluate(T,{},n.canonical),L={horizontal:{},vertical:void 0},F=T.text;let O,$=[0,0];if(F){const Z=F.toString(),te=r.get("text-letter-spacing").evaluate(T,{},n.canonical)*Hr,oe=Wm(Z)?te:0,be=r.get("text-anchor").evaluate(T,{},n.canonical),Le=yx(e,T,n.canonical);if(!Le){const je=r.get("text-radial-offset").evaluate(T,{},n.canonical);$=je?_x(be,[je*Hr,Ng]):r.get("text-offset").evaluate(T,{},n.canonical).map(De=>De*Hr)}let ze=p?"center":r.get("text-justify").evaluate(T,{},n.canonical);const Oe=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(T,{},n.canonical)*Hr:1/0,Ze=()=>{n.bucket.allowVerticalPlacement&&Go(Z)&&(L.vertical=Np(F,n.glyphMap,n.glyphPositions,n.imagePositions,E,Oe,d,be,"left",oe,$,w.az.vertical,!0,A,I))};if(!p&&Le){const je=new Set;if(ze==="auto")for(let Me=0;Me<Le.values.length;Me+=2)je.add(jg(Le.values[Me]));else je.add(ze);let De=!1;for(const Me of je)if(!L.horizontal[Me])if(De)L.horizontal[Me]=L.horizontal[0];else{const rt=Np(F,n.glyphMap,n.glyphPositions,n.imagePositions,E,Oe,d,"center",Me,oe,$,w.az.horizontal,!1,A,I);rt&&(L.horizontal[Me]=rt,De=rt.positionedLines.length===1)}Ze()}else{ze==="auto"&&(ze=jg(be));const je=Np(F,n.glyphMap,n.glyphPositions,n.imagePositions,E,Oe,d,be,ze,oe,$,w.az.horizontal,!1,A,I);je&&(L.horizontal[ze]=je),Ze(),Go(Z)&&p&&_&&(L.vertical=Np(F,n.glyphMap,n.glyphPositions,n.imagePositions,E,Oe,d,be,ze,oe,$,w.az.vertical,!1,A,I))}}let J=!1;if(T.icon&&T.icon.name){const Z=n.imageMap[T.icon.name];Z&&(O=KT(n.imagePositions[T.icon.name],r.get("icon-offset").evaluate(T,{},n.canonical),r.get("icon-anchor").evaluate(T,{},n.canonical)),J=!!Z.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=J:n.bucket.sdfIcons!==J&&qr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Z.pixelRatio!==n.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const G=xx(L.horizontal)||L.vertical;n.bucket.iconsInText=!!G&&G.iconsInText,(G||O)&&jS(n.bucket,T,L,O,n.imageMap,u,A,z,$,J,n.canonical,n.subdivisionGranularity)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},w.cR=lg,w.cS=cg,w.cT=hg,w.cU=function(n){const e=new Op;return function(r,o){for(const u in r.layers)o.writeMessage(3,ES,r.layers[u])}(n,e),e.finish()},w.cV=function(n,e,r,o,u,d){let p=lx(n,e,r,u,0);return p=lx(p,e,o,d,1),p},w.cW=class{constructor(n){this.maxEntries=n,this.map=new Map}get(n){const e=this.map.get(n);return e!==void 0&&(this.map.delete(n),this.map.set(n,e)),e}set(n,e){if(this.map.has(n))this.map.delete(n);else if(this.map.size>=this.maxEntries){const r=this.map.keys().next().value;this.map.delete(r)}this.map.set(n,e)}clear(){this.map.clear()}},w.cX=Gv,w.cY=Op,w.cZ=nx,w.c_=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},w.ca=class extends Hs{},w.cb=IT,w.cc=class extends ol{},w.cd=ng,w.ce=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},w.cf=Iv,w.cg=function(n,e,r){var o=e[0],u=e[1],d=e[2],p=r[3]*o+r[7]*u+r[11]*d+r[15];return n[0]=(r[0]*o+r[4]*u+r[8]*d+r[12])/(p=p||1),n[1]=(r[1]*o+r[5]*u+r[9]*d+r[13])/p,n[2]=(r[2]*o+r[6]*u+r[10]*d+r[14])/p,n},w.ch=class extends nh{},w.ci=class extends t{},w.cj=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]&&n[4]===e[4]&&n[5]===e[5]&&n[6]===e[6]&&n[7]===e[7]&&n[8]===e[8]&&n[9]===e[9]&&n[10]===e[10]&&n[11]===e[11]&&n[12]===e[12]&&n[13]===e[13]&&n[14]===e[14]&&n[15]===e[15]},w.ck=function(n,e){var r=n[0],o=n[1],u=n[2],d=n[3],p=n[4],_=n[5],x=n[6],T=n[7],E=n[8],I=n[9],A=n[10],z=n[11],L=n[12],F=n[13],O=n[14],$=n[15],J=e[0],G=e[1],Z=e[2],te=e[3],oe=e[4],be=e[5],Le=e[6],ze=e[7],Oe=e[8],Ze=e[9],je=e[10],De=e[11],Me=e[12],rt=e[13],Je=e[14],it=e[15];return Math.abs(r-J)<=Y*Math.max(1,Math.abs(r),Math.abs(J))&&Math.abs(o-G)<=Y*Math.max(1,Math.abs(o),Math.abs(G))&&Math.abs(u-Z)<=Y*Math.max(1,Math.abs(u),Math.abs(Z))&&Math.abs(d-te)<=Y*Math.max(1,Math.abs(d),Math.abs(te))&&Math.abs(p-oe)<=Y*Math.max(1,Math.abs(p),Math.abs(oe))&&Math.abs(_-be)<=Y*Math.max(1,Math.abs(_),Math.abs(be))&&Math.abs(x-Le)<=Y*Math.max(1,Math.abs(x),Math.abs(Le))&&Math.abs(T-ze)<=Y*Math.max(1,Math.abs(T),Math.abs(ze))&&Math.abs(E-Oe)<=Y*Math.max(1,Math.abs(E),Math.abs(Oe))&&Math.abs(I-Ze)<=Y*Math.max(1,Math.abs(I),Math.abs(Ze))&&Math.abs(A-je)<=Y*Math.max(1,Math.abs(A),Math.abs(je))&&Math.abs(z-De)<=Y*Math.max(1,Math.abs(z),Math.abs(De))&&Math.abs(L-Me)<=Y*Math.max(1,Math.abs(L),Math.abs(Me))&&Math.abs(F-rt)<=Y*Math.max(1,Math.abs(F),Math.abs(rt))&&Math.abs(O-Je)<=Y*Math.max(1,Math.abs(O),Math.abs(Je))&&Math.abs($-it)<=Y*Math.max(1,Math.abs($),Math.abs(it))},w.cl=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},w.cm=n=>n.type==="symbol",w.cn=n=>n.type==="circle",w.co=n=>n.type==="heatmap",w.cp=n=>n.type==="line",w.cq=n=>n.type==="fill",w.cr=n=>n.type==="fill-extrusion",w.cs=n=>n.type==="hillshade",w.ct=n=>n.type==="color-relief",w.cu=n=>n.type==="background",w.cv=n=>n.type==="custom",w.cw=mn,w.cx=function(n,e,r){const o=ot(e.x-r.x,e.y-r.y),u=ot(n.x-r.x,n.y-r.y),d=Math.atan2(o[0]*u[1]-o[1]*u[0],function(p,_){return p[0]*_[0]+p[1]*_[1]}(o,u));return In(d)},w.cy=Rr,w.cz=function(n,e){return V[e]&&(n instanceof MouseEvent||n instanceof WheelEvent)},w.d=Fe,w.d0=zv,w.d1=K,w.d2=class{constructor(n,e){this.layers={[Eh]:this},this.name=Eh,this.version=e?e.version:1,this.extent=e?e.extent:4096,this.length=n.length,this.features=n}feature(n){return new PS(this.features[n],this.extent)}},w.d3=Na,w.d4=vs,w.e=gn,w.f=n=>c(void 0,void 0,void 0,function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(e)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),w.g=Te,w.h=n=>new Promise((e,r)=>{const o=new Image;o.onload=()=>{e(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame(()=>{o.src=zs})},o.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(n)],{type:"image/png"});o.src=n.byteLength?URL.createObjectURL(u):zs}),w.i=ki,w.j=(n,e)=>Ve(gn(n,{type:"json"}),e),w.k=jt,w.l=ft,w.m=Ve,w.n=(n,e)=>Ve(gn(n,{type:"arrayBuffer"}),e),w.o=function(n){return new Op(n).readFields($T,[])},w.p=a0,w.q=function(n){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(n))},w.r=dh,w.s=yo,w.t=Tn,w.u=Pe,w.v=Wa,w.w=qr,w.x=th,w.y=Ha,w.z=Qa}),S("worker",["./shared"],function(w){class c{constructor(V,j){this.keyCache={},V&&this.replace(V,j)}replace(V,j){this._layerConfigs={},this._layers={},this.update(V,[],j)}update(V,j,q){for(const he of V){this._layerConfigs[he.id]=he;const Te=this._layers[he.id]=w.bT(he,q);Te._featureFilter=w.aj(Te.filter,q),this.keyCache[he.id]&&delete this.keyCache[he.id]}for(const he of j)delete this.keyCache[he],delete this._layerConfigs[he],delete this._layers[he];this.familiesBySource={};const le=w.cL(Object.values(this._layerConfigs),this.keyCache);for(const he of le){const Te=he.map(tt=>this._layers[tt.id]),ve=Te[0];if(ve.isHidden())continue;const me=ve.source||"";let Ie=this.familiesBySource[me];Ie||(Ie=this.familiesBySource[me]={});const Ve=ve.sourceLayer||w.ai;let Fe=Ie[Ve];Fe||(Fe=Ie[Ve]=[]),Fe.push(Te)}}}class N{constructor(V){const j={},q=[];for(const ve in V){const me=V[ve],Ie=j[ve]={};for(const Ve in me){const Fe=me[+Ve];if(!Fe||Fe.bitmap.width===0||Fe.bitmap.height===0)continue;const tt={x:0,y:0,w:Fe.bitmap.width+2,h:Fe.bitmap.height+2};q.push(tt),Ie[Ve]={rect:tt,metrics:Fe.metrics}}}const{w:le,h:he}=w.p(q),Te=new w.r({width:le||1,height:he||1});for(const ve in V){const me=V[ve];for(const Ie in me){const Ve=me[+Ie];if(!Ve||Ve.bitmap.width===0||Ve.bitmap.height===0)continue;const Fe=j[ve][Ie].rect;w.r.copy(Ve.bitmap,Te,{x:0,y:0},{x:Fe.x+1,y:Fe.y+1},Ve.bitmap)}}this.image=Te,this.positions=j}}w.cM("GlyphAtlas",N);class K{constructor(V){this.tileID=new w.a2(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId,this.inFlightDependencies=[]}parse(V,j,q,le,he){return w._(this,void 0,void 0,function*(){this.status="parsing",this.data=V,this.collisionBoxArray=new w.ag;const Te=new w.cN(Object.keys(V.layers).sort()),ve=new w.cO(this.tileID,this.promoteId);ve.bucketLayerIDs=[];const me={},Ie={featureIndex:ve,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:q,subdivisionGranularity:he},Ve=j.familiesBySource[this.source];for(const $t in Ve){const Lr=V.layers[$t];if(!Lr)continue;Lr.version===1&&w.w(`Vector tile source "${this.source}" layer "${$t}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const xa=Te.encode($t),ba=[];for(let Ue=0;Ue<Lr.length;Ue++){const _n=Lr.feature(Ue),yn=ve.getId(_n,$t);ba.push({feature:_n,id:yn,index:Ue,sourceLayerIndex:xa})}for(const Ue of Ve[$t]){const _n=Ue[0];_n.source!==this.source&&w.w(`layer.source = ${_n.source} does not equal this.source = ${this.source}`),_n.isHidden(this.zoom,!0)||(fe(Ue,this.zoom,q),(me[_n.id]=_n.createBucket({index:ve.bucketLayerIDs.length,layers:Ue,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:xa,sourceID:this.source})).populate(ba,Ie,this.tileID.canonical),ve.bucketLayerIDs.push(Ue.map(yn=>yn.id)))}}const Fe=w.bY(Ie.glyphDependencies,$t=>Object.keys($t).map(Number));this.inFlightDependencies.forEach($t=>$t==null?void 0:$t.abort()),this.inFlightDependencies=[];let tt=Promise.resolve({});if(Object.keys(Fe).length){const $t=new AbortController;this.inFlightDependencies.push($t),tt=le.sendAsync({type:"GG",data:{stacks:Fe,source:this.source,tileID:this.tileID,type:"glyphs"}},$t)}const lt=Object.keys(Ie.iconDependencies);let ft=Promise.resolve({});if(lt.length){const $t=new AbortController;this.inFlightDependencies.push($t),ft=le.sendAsync({type:"GI",data:{icons:lt,source:this.source,tileID:this.tileID,type:"icons"}},$t)}const jt=Object.keys(Ie.patternDependencies);let zt=Promise.resolve({});if(jt.length){const $t=new AbortController;this.inFlightDependencies.push($t),zt=le.sendAsync({type:"GI",data:{icons:jt,source:this.source,tileID:this.tileID,type:"patterns"}},$t)}const Pe=Ie.dashDependencies;let Ut=Promise.resolve({});if(Object.keys(Pe).length){const $t=new AbortController;this.inFlightDependencies.push($t),Ut=le.sendAsync({type:"GDA",data:{dashes:Pe}},$t)}const[tn,mt,Ot,rn]=yield Promise.all([tt,ft,zt,Ut]),Jt=new N(tn),pr=new w.cP(mt,Ot);for(const $t in me){const Lr=me[$t];Lr instanceof w.ah?(fe(Lr.layers,this.zoom,q),w.cQ({bucket:Lr,glyphMap:tn,glyphPositions:Jt.positions,imageMap:mt,imagePositions:pr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Ie.subdivisionGranularity})):Lr.hasDependencies&&(Lr instanceof w.cR||Lr instanceof w.cS||Lr instanceof w.cT)&&(fe(Lr.layers,this.zoom,q),Lr.addFeatures(Ie,this.tileID.canonical,pr.patternPositions,rn))}return this.status="done",{buckets:Object.values(me).filter($t=>!$t.isEmpty()),featureIndex:ve,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Jt.image,imageAtlas:pr,dashPositions:rn,glyphMap:this.returnDependencies?tn:null,iconMap:this.returnDependencies?mt:null,glyphPositions:this.returnDependencies?Jt.positions:null}})}}function fe(xe,V,j){const q=new w.H(V);for(const le of xe)le.recalculate(q,j)}class pe{constructor(V,j,q,le,he){this.type=V,this.properties=q||{},this.extent=he,this.pointsArray=j,this.id=le}loadGeometry(){return this.pointsArray.map(V=>V.map(j=>new w.P(j.x,j.y)))}}class ye{constructor(V,j,q){this.version=2,this._myFeatures=V,this.name=j,this.length=V.length,this.extent=q}feature(V){return this._myFeatures[V]}}class Ae{constructor(){this.layers={}}addLayer(V){this.layers[V.name]=V}}function we(xe){let V=w.cU(xe);return V.byteOffset===0&&V.byteLength===V.buffer.byteLength||(V=new Uint8Array(V)),{vectorTile:xe,rawData:V.buffer}}function _e(xe,V,j){const{extent:q}=xe,le=Math.pow(2,j.z-V.z),he=(j.x-V.x*le)*q,Te=(j.y-V.y*le)*q,ve=[];for(let me=0;me<xe.length;me++){const Ie=xe.feature(me);let Ve=Ie.loadGeometry();for(const tt of Ve)for(const lt of tt)lt.x=lt.x*le-he,lt.y=lt.y*le-Te;const Fe=128;Ve=w.cV(Ve,Ie.type,-Fe,-Fe,q+Fe,q+Fe),Ve.length!==0&&ve.push(new pe(Ie.type,Ve,Ie.properties,Ie.id,q))}return new ye(ve,xe.name,q)}class se{constructor(V,j,q){this.actor=V,this.layerIndex=j,this.availableImages=q,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new w.cW(1e3)}loadVectorTile(V,j){return w._(this,void 0,void 0,function*(){const q=yield w.n(V.request,j);try{return{vectorTile:V.encoding!=="mlt"?new w.cX(new w.cY(q.data)):new w.cZ(q.data),rawData:q.data,cacheControl:q.cacheControl,expires:q.expires}}catch(le){const he=new Uint8Array(q.data);let Te=`Unable to parse the tile at ${V.request.url}, `;throw Te+=he[0]===31&&he[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${le.message}`,new Error(Te)}})}loadTile(V){return w._(this,void 0,void 0,function*(){const{uid:j,overzoomParameters:q}=V;q&&(V.request=q.overzoomRequest);const le=!!(V&&V.request&&V.request.collectResourceTiming)&&new w.c_(V.request),he=new K(V);this.loading[j]=he;const Te=new AbortController;he.abort=Te;try{const ve=yield this.loadVectorTile(V,Te);if(delete this.loading[j],!ve)return null;if(q){const tt=this._getOverzoomTile(V,ve.vectorTile);ve.rawData=tt.rawData,ve.vectorTile=tt.vectorTile}const me=ve.rawData,Ie={};ve.expires&&(Ie.expires=ve.expires),ve.cacheControl&&(Ie.cacheControl=ve.cacheControl);const Ve={};if(le){const tt=le.finish();tt&&(Ve.resourceTiming=JSON.parse(JSON.stringify(tt)))}he.vectorTile=ve.vectorTile;const Fe=he.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity);this.loaded[j]=he,this.fetching[j]={rawTileData:me,cacheControl:Ie,resourceTiming:Ve};try{const tt=yield Fe;return w.e({rawTileData:me.slice(0),encoding:V.encoding},tt,Ie,Ve)}finally{delete this.fetching[j]}}catch(ve){throw delete this.loading[j],he.status="done",this.loaded[j]=he,ve}})}_getOverzoomTile(V,j){const{tileID:q,source:le,overzoomParameters:he}=V,{maxZoomTileID:Te}=he,ve=`${Te.key}_${q.key}`,me=this.overzoomedTileResultCache.get(ve);if(me)return me;const Ie=new Ae,Ve=this.layerIndex.familiesBySource[le];for(const tt in Ve){const lt=j.layers[tt];if(!lt)continue;const ft=_e(lt,Te,q.canonical);ft.length>0&&Ie.addLayer(ft)}const Fe=we(Ie);return this.overzoomedTileResultCache.set(ve,Fe),Fe}reloadTile(V){return w._(this,void 0,void 0,function*(){const j=V.uid;if(!this.loaded||!this.loaded[j])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const q=this.loaded[j];if(q.showCollisionBoxes=V.showCollisionBoxes,q.status==="parsing"){const le=yield q.parse(q.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity);let he;if(this.fetching[j]){const{rawTileData:Te,cacheControl:ve,resourceTiming:me}=this.fetching[j];delete this.fetching[j],he=w.e({rawTileData:Te.slice(0),encoding:V.encoding},le,ve,me)}else he=le;return he}if(q.status==="done"&&q.vectorTile)return q.parse(q.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity)})}abortTile(V){return w._(this,void 0,void 0,function*(){const j=this.loading,q=V.uid;j&&j[q]&&j[q].abort&&(j[q].abort.abort(),delete j[q])})}removeTile(V){return w._(this,void 0,void 0,function*(){this.loaded&&this.loaded[V.uid]&&delete this.loaded[V.uid]})}}class ue{constructor(){this.loaded={}}loadTile(V){return w._(this,void 0,void 0,function*(){const{uid:j,encoding:q,rawImageData:le,redFactor:he,greenFactor:Te,blueFactor:ve,baseShift:me}=V,Ie=le.width+2,Ve=le.height+2,Fe=w.b(le)?new w.R({width:Ie,height:Ve},yield w.c$(le,-1,-1,Ie,Ve)):le,tt=new w.d0(j,Fe,q,he,Te,ve,me);return this.loaded=this.loaded||{},this.loaded[j]=tt,tt})}removeTile(V){const j=this.loaded,q=V.uid;j&&j[q]&&delete j[q]}}var Y,ne,Be=function(){if(ne)return Y;function xe(j,q){if(j.length!==0){V(j[0],q);for(var le=1;le<j.length;le++)V(j[le],!q)}}function V(j,q){for(var le=0,he=0,Te=0,ve=j.length,me=ve-1;Te<ve;me=Te++){var Ie=(j[Te][0]-j[me][0])*(j[me][1]+j[Te][1]),Ve=le+Ie;he+=Math.abs(le)>=Math.abs(Ie)?le-Ve+Ie:Ie-Ve+le,le=Ve}le+he>=0!=!!q&&j.reverse()}return ne=1,Y=function j(q,le){var he,Te=q&&q.type;if(Te==="FeatureCollection")for(he=0;he<q.features.length;he++)j(q.features[he],le);else if(Te==="GeometryCollection")for(he=0;he<q.geometries.length;he++)j(q.geometries[he],le);else if(Te==="Feature")j(q.geometry,le);else if(Te==="Polygon")xe(q.coordinates,le);else if(Te==="MultiPolygon")for(he=0;he<q.coordinates.length;he++)xe(q.coordinates[he],le);return q}}(),qe=w.d1(Be);const et={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:xe=>xe},We=Math.fround||(Ke=new Float32Array(1),xe=>(Ke[0]=+xe,Ke[0]));var Ke;class _t{constructor(V){this.options=Object.assign(Object.create(et),V),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(V){const{log:j,minZoom:q,maxZoom:le}=this.options;j&&console.time("total time");const he=`prepare ${V.length} points`;j&&console.time(he),this.points=V;const Te=[];for(let me=0;me<V.length;me++){const Ie=V[me];if(!Ie.geometry)continue;const[Ve,Fe]=Ie.geometry.coordinates,tt=We(br(Ve)),lt=We(jr(Fe));Te.push(tt,lt,1/0,me,-1,1),this.options.reduce&&Te.push(0)}let ve=this.trees[le+1]=this._createTree(Te);j&&console.timeEnd(he);for(let me=le;me>=q;me--){const Ie=+Date.now();ve=this.trees[me]=this._createTree(this._cluster(ve,me)),j&&console.log("z%d: %d clusters in %dms",me,ve.numItems,+Date.now()-Ie)}return j&&console.timeEnd("total time"),this}getClusters(V,j){let q=((V[0]+180)%360+360)%360-180;const le=Math.max(-90,Math.min(90,V[1]));let he=V[2]===180?180:((V[2]+180)%360+360)%360-180;const Te=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)q=-180,he=180;else if(q>he){const Fe=this.getClusters([q,le,180,Te],j),tt=this.getClusters([-180,le,he,Te],j);return Fe.concat(tt)}const ve=this.trees[this._limitZoom(j)],me=ve.range(br(q),jr(Te),br(he),jr(le)),Ie=ve.data,Ve=[];for(const Fe of me){const tt=this.stride*Fe;Ve.push(Ie[tt+5]>1?at(Ie,tt,this.clusterProps):this.points[Ie[tt+3]])}return Ve}getChildren(V){const j=this._getOriginId(V),q=this._getOriginZoom(V),le="No cluster with the specified id.",he=this.trees[q];if(!he)throw new Error(le);const Te=he.data;if(j*this.stride>=Te.length)throw new Error(le);const ve=this.options.radius/(this.options.extent*Math.pow(2,q-1)),me=he.within(Te[j*this.stride],Te[j*this.stride+1],ve),Ie=[];for(const Ve of me){const Fe=Ve*this.stride;Te[Fe+4]===V&&Ie.push(Te[Fe+5]>1?at(Te,Fe,this.clusterProps):this.points[Te[Fe+3]])}if(Ie.length===0)throw new Error(le);return Ie}getLeaves(V,j,q){const le=[];return this._appendLeaves(le,V,j=j||10,q=q||0,0),le}getTile(V,j,q){const le=this.trees[this._limitZoom(V)],he=Math.pow(2,V),{extent:Te,radius:ve}=this.options,me=ve/Te,Ie=(q-me)/he,Ve=(q+1+me)/he,Fe={features:[]};return this._addTileFeatures(le.range((j-me)/he,Ie,(j+1+me)/he,Ve),le.data,j,q,he,Fe),j===0&&this._addTileFeatures(le.range(1-me/he,Ie,1,Ve),le.data,he,q,he,Fe),j===he-1&&this._addTileFeatures(le.range(0,Ie,me/he,Ve),le.data,-1,q,he,Fe),Fe.features.length?Fe:null}getClusterExpansionZoom(V){let j=this._getOriginZoom(V)-1;for(;j<=this.options.maxZoom;){const q=this.getChildren(V);if(j++,q.length!==1)break;V=q[0].properties.cluster_id}return j}_appendLeaves(V,j,q,le,he){const Te=this.getChildren(j);for(const ve of Te){const me=ve.properties;if(me&&me.cluster?he+me.point_count<=le?he+=me.point_count:he=this._appendLeaves(V,me.cluster_id,q,le,he):he<le?he++:V.push(ve),V.length===q)break}return he}_createTree(V){const j=new w.aT(V.length/this.stride|0,this.options.nodeSize,Float32Array);for(let q=0;q<V.length;q+=this.stride)j.add(V[q],V[q+1]);return j.finish(),j.data=V,j}_addTileFeatures(V,j,q,le,he,Te){for(const ve of V){const me=ve*this.stride,Ie=j[me+5]>1;let Ve,Fe,tt;if(Ie)Ve=Qt(j,me,this.clusterProps),Fe=j[me],tt=j[me+1];else{const jt=this.points[j[me+3]];Ve=jt.properties;const[zt,Pe]=jt.geometry.coordinates;Fe=br(zt),tt=jr(Pe)}const lt={type:1,geometry:[[Math.round(this.options.extent*(Fe*he-q)),Math.round(this.options.extent*(tt*he-le))]],tags:Ve};let ft;ft=Ie||this.options.generateId?j[me+3]:this.points[j[me+3]].id,ft!==void 0&&(lt.id=ft),Te.features.push(lt)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,j){const{radius:q,extent:le,reduce:he,minPoints:Te}=this.options,ve=q/(le*Math.pow(2,j)),me=V.data,Ie=[],Ve=this.stride;for(let Fe=0;Fe<me.length;Fe+=Ve){if(me[Fe+2]<=j)continue;me[Fe+2]=j;const tt=me[Fe],lt=me[Fe+1],ft=V.within(me[Fe],me[Fe+1],ve),jt=me[Fe+5];let zt=jt;for(const Pe of ft){const Ut=Pe*Ve;me[Ut+2]>j&&(zt+=me[Ut+5])}if(zt>jt&&zt>=Te){let Pe,Ut=tt*jt,tn=lt*jt,mt=-1;const Ot=(Fe/Ve<<5)+(j+1)+this.points.length;for(const rn of ft){const Jt=rn*Ve;if(me[Jt+2]<=j)continue;me[Jt+2]=j;const pr=me[Jt+5];Ut+=me[Jt]*pr,tn+=me[Jt+1]*pr,me[Jt+4]=Ot,he&&(Pe||(Pe=this._map(me,Fe,!0),mt=this.clusterProps.length,this.clusterProps.push(Pe)),he(Pe,this._map(me,Jt)))}me[Fe+4]=Ot,Ie.push(Ut/zt,tn/zt,1/0,Ot,-1,zt),he&&Ie.push(mt)}else{for(let Pe=0;Pe<Ve;Pe++)Ie.push(me[Fe+Pe]);if(zt>1)for(const Pe of ft){const Ut=Pe*Ve;if(!(me[Ut+2]<=j)){me[Ut+2]=j;for(let tn=0;tn<Ve;tn++)Ie.push(me[Ut+tn])}}}}return Ie}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,j,q){if(V[j+5]>1){const Te=this.clusterProps[V[j+6]];return q?Object.assign({},Te):Te}const le=this.points[V[j+3]].properties,he=this.options.map(le);return q&&he===le?Object.assign({},he):he}}function at(xe,V,j){return{type:"Feature",id:xe[V+3],properties:Qt(xe,V,j),geometry:{type:"Point",coordinates:[(q=xe[V],360*(q-.5)),Xn(xe[V+1])]}};var q}function Qt(xe,V,j){const q=xe[V+5],le=q>=1e4?`${Math.round(q/1e3)}k`:q>=1e3?Math.round(q/100)/10+"k":q,he=xe[V+6],Te=he===-1?{}:Object.assign({},j[he]);return Object.assign(Te,{cluster:!0,cluster_id:xe[V+3],point_count:q,point_count_abbreviated:le})}function br(xe){return xe/360+.5}function jr(xe){const V=Math.sin(xe*Math.PI/180),j=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return j<0?0:j>1?1:j}function Xn(xe){const V=(180-360*xe)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function Gi(xe,V,j,q){let le=q;const he=V+(j-V>>1);let Te,ve=j-V;const me=xe[V],Ie=xe[V+1],Ve=xe[j],Fe=xe[j+1];for(let tt=V+3;tt<j;tt+=3){const lt=ls(xe[tt],xe[tt+1],me,Ie,Ve,Fe);if(lt>le)Te=tt,le=lt;else if(lt===le){const ft=Math.abs(tt-he);ft<ve&&(Te=tt,ve=ft)}}le>q&&(Te-V>3&&Gi(xe,V,Te,q),xe[Te+2]=le,j-Te>3&&Gi(xe,Te,j,q))}function ls(xe,V,j,q,le,he){let Te=le-j,ve=he-q;if(Te!==0||ve!==0){const me=((xe-j)*Te+(V-q)*ve)/(Te*Te+ve*ve);me>1?(j=le,q=he):me>0&&(j+=Te*me,q+=ve*me)}return Te=xe-j,ve=V-q,Te*Te+ve*ve}function en(xe,V,j,q){const le={id:xe??null,type:V,geometry:j,tags:q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(V==="Point"||V==="MultiPoint"||V==="LineString")ot(le,j);else if(V==="Polygon")ot(le,j[0]);else if(V==="MultiLineString")for(const he of j)ot(le,he);else if(V==="MultiPolygon")for(const he of j)ot(le,he[0]);return le}function ot(xe,V){for(let j=0;j<V.length;j+=3)xe.minX=Math.min(xe.minX,V[j]),xe.minY=Math.min(xe.minY,V[j+1]),xe.maxX=Math.max(xe.maxX,V[j]),xe.maxY=Math.max(xe.maxY,V[j+1])}function st(xe,V,j,q){if(!V.geometry)return;const le=V.geometry.coordinates;if(le&&le.length===0)return;const he=V.geometry.type,Te=Math.pow(j.tolerance/((1<<j.maxZoom)*j.extent),2);let ve=[],me=V.id;if(j.promoteId?me=V.properties[j.promoteId]:j.generateId&&(me=q||0),he==="Point")vt(le,ve);else if(he==="MultiPoint")for(const Ie of le)vt(Ie,ve);else if(he==="LineString")Lt(le,ve,Te,!1);else if(he==="MultiLineString"){if(j.lineMetrics){for(const Ie of le)ve=[],Lt(Ie,ve,Te,!1),xe.push(en(me,"LineString",ve,V.properties));return}rr(le,ve,Te,!1)}else if(he==="Polygon")rr(le,ve,Te,!0);else{if(he!=="MultiPolygon"){if(he==="GeometryCollection"){for(const Ie of V.geometry.geometries)st(xe,{id:me,geometry:Ie,properties:V.properties},j,q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ie of le){const Ve=[];rr(Ie,Ve,Te,!0),ve.push(Ve)}}xe.push(en(me,he,ve,V.properties))}function vt(xe,V){V.push(Ii(xe[0]),mn(xe[1]),0)}function Lt(xe,V,j,q){let le,he,Te=0;for(let me=0;me<xe.length;me++){const Ie=Ii(xe[me][0]),Ve=mn(xe[me][1]);V.push(Ie,Ve,0),me>0&&(Te+=q?(le*Ve-Ie*he)/2:Math.sqrt(Math.pow(Ie-le,2)+Math.pow(Ve-he,2))),le=Ie,he=Ve}const ve=V.length-3;V[2]=1,Gi(V,0,ve,j),V[ve+2]=1,V.size=Math.abs(Te),V.start=0,V.end=V.size}function rr(xe,V,j,q){for(let le=0;le<xe.length;le++){const he=[];Lt(xe[le],he,j,q),V.push(he)}}function Ii(xe){return xe/360+.5}function mn(xe){const V=Math.sin(xe*Math.PI/180),j=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return j<0?0:j>1?1:j}function Rr(xe,V,j,q,le,he,Te,ve){if(q/=V,he>=(j/=V)&&Te<q)return xe;if(Te<j||he>=q)return null;const me=[];for(const Ie of xe){const Ve=Ie.geometry;let Fe=Ie.type;const tt=le===0?Ie.minX:Ie.minY,lt=le===0?Ie.maxX:Ie.maxY;if(tt>=j&&lt<q){me.push(Ie);continue}if(lt<j||tt>=q)continue;let ft=[];if(Fe==="Point"||Fe==="MultiPoint")Vr(Ve,ft,j,q,le);else if(Fe==="LineString")Mn(Ve,ft,j,q,le,!1,ve.lineMetrics);else if(Fe==="MultiLineString")As(Ve,ft,j,q,le,!1);else if(Fe==="Polygon")As(Ve,ft,j,q,le,!0);else if(Fe==="MultiPolygon")for(const jt of Ve){const zt=[];As(jt,zt,j,q,le,!0),zt.length&&ft.push(zt)}if(ft.length){if(ve.lineMetrics&&Fe==="LineString"){for(const jt of ft)me.push(en(Ie.id,Fe,jt,Ie.tags));continue}Fe!=="LineString"&&Fe!=="MultiLineString"||(ft.length===1?(Fe="LineString",ft=ft[0]):Fe="MultiLineString"),Fe!=="Point"&&Fe!=="MultiPoint"||(Fe=ft.length===3?"Point":"MultiPoint"),me.push(en(Ie.id,Fe,ft,Ie.tags))}}return me.length?me:null}function Vr(xe,V,j,q,le){for(let he=0;he<xe.length;he+=3){const Te=xe[he+le];Te>=j&&Te<=q&&ui(V,xe[he],xe[he+1],xe[he+2])}}function Mn(xe,V,j,q,le,he,Te){let ve=gn(xe);const me=le===0?ya:ci;let Ie,Ve,Fe=xe.start;for(let zt=0;zt<xe.length-3;zt+=3){const Pe=xe[zt],Ut=xe[zt+1],tn=xe[zt+2],mt=xe[zt+3],Ot=xe[zt+4],rn=le===0?Pe:Ut,Jt=le===0?mt:Ot;let pr=!1;Te&&(Ie=Math.sqrt(Math.pow(Pe-mt,2)+Math.pow(Ut-Ot,2))),rn<j?Jt>j&&(Ve=me(ve,Pe,Ut,mt,Ot,j),Te&&(ve.start=Fe+Ie*Ve)):rn>q?Jt<q&&(Ve=me(ve,Pe,Ut,mt,Ot,q),Te&&(ve.start=Fe+Ie*Ve)):ui(ve,Pe,Ut,tn),Jt<j&&rn>=j&&(Ve=me(ve,Pe,Ut,mt,Ot,j),pr=!0),Jt>q&&rn<=q&&(Ve=me(ve,Pe,Ut,mt,Ot,q),pr=!0),!he&&pr&&(Te&&(ve.end=Fe+Ie*Ve),V.push(ve),ve=gn(xe)),Te&&(Fe+=Ie)}let tt=xe.length-3;const lt=xe[tt],ft=xe[tt+1],jt=le===0?lt:ft;jt>=j&&jt<=q&&ui(ve,lt,ft,xe[tt+2]),tt=ve.length-3,he&&tt>=3&&(ve[tt]!==ve[0]||ve[tt+1]!==ve[1])&&ui(ve,ve[0],ve[1],ve[2]),ve.length&&V.push(ve)}function gn(xe){const V=[];return V.size=xe.size,V.start=xe.start,V.end=xe.end,V}function As(xe,V,j,q,le,he){for(const Te of xe)Mn(Te,V,j,q,le,he,!1)}function ui(xe,V,j,q){xe.push(V,j,q)}function ya(xe,V,j,q,le,he){const Te=(he-V)/(q-V);return ui(xe,he,j+(le-j)*Te,1),Te}function ci(xe,V,j,q,le,he){const Te=(he-j)/(le-j);return ui(xe,V+(q-V)*Te,he,1),Te}function va(xe,V){const j=[];for(let q=0;q<xe.length;q++){const le=xe[q],he=le.type;let Te;if(he==="Point"||he==="MultiPoint"||he==="LineString")Te=qr(le.geometry,V);else if(he==="MultiLineString"||he==="Polygon"){Te=[];for(const ve of le.geometry)Te.push(qr(ve,V))}else if(he==="MultiPolygon"){Te=[];for(const ve of le.geometry){const me=[];for(const Ie of ve)me.push(qr(Ie,V));Te.push(me)}}j.push(en(le.id,he,Te,le.tags))}return j}function qr(xe,V){const j=[];j.size=xe.size,xe.start!==void 0&&(j.start=xe.start,j.end=xe.end);for(let q=0;q<xe.length;q+=3)j.push(xe[q]+V,xe[q+1],xe[q+2]);return j}function Yn(xe,V){if(xe.transformed)return xe;const j=1<<xe.z,q=xe.x,le=xe.y;for(const he of xe.features){const Te=he.geometry,ve=he.type;if(he.geometry=[],ve===1)for(let me=0;me<Te.length;me+=2)he.geometry.push(ki(Te[me],Te[me+1],V,j,q,le));else for(let me=0;me<Te.length;me++){const Ie=[];for(let Ve=0;Ve<Te[me].length;Ve+=2)Ie.push(ki(Te[me][Ve],Te[me][Ve+1],V,j,q,le));he.geometry.push(Ie)}}return xe.transformed=!0,xe}function ki(xe,V,j,q,le,he){return[Math.round(j*(xe*q-le)),Math.round(j*(V*q-he))]}function dr(xe,V,j,q,le){const he=V===le.maxZoom?0:le.tolerance/((1<<V)*le.extent),Te={features:[],numPoints:0,numSimplified:0,numFeatures:xe.length,source:null,x:j,y:q,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ve of xe)us(Te,ve,he,le);return Te}function us(xe,V,j,q){const le=V.geometry,he=V.type,Te=[];if(xe.minX=Math.min(xe.minX,V.minX),xe.minY=Math.min(xe.minY,V.minY),xe.maxX=Math.max(xe.maxX,V.maxX),xe.maxY=Math.max(xe.maxY,V.maxY),he==="Point"||he==="MultiPoint")for(let ve=0;ve<le.length;ve+=3)Te.push(le[ve],le[ve+1]),xe.numPoints++,xe.numSimplified++;else if(he==="LineString")zs(Te,le,xe,j,!1,!1);else if(he==="MultiLineString"||he==="Polygon")for(let ve=0;ve<le.length;ve++)zs(Te,le[ve],xe,j,he==="Polygon",ve===0);else if(he==="MultiPolygon")for(let ve=0;ve<le.length;ve++){const me=le[ve];for(let Ie=0;Ie<me.length;Ie++)zs(Te,me[Ie],xe,j,!0,Ie===0)}if(Te.length){let ve=V.tags||null;if(he==="LineString"&&q.lineMetrics){ve={};for(const Ie in V.tags)ve[Ie]=V.tags[Ie];ve.mapbox_clip_start=le.start/le.size,ve.mapbox_clip_end=le.end/le.size}const me={geometry:Te,type:he==="Polygon"||he==="MultiPolygon"?3:he==="LineString"||he==="MultiLineString"?2:1,tags:ve};V.id!==null&&(me.id=V.id),xe.features.push(me)}}function zs(xe,V,j,q,le,he){const Te=q*q;if(q>0&&V.size<(le?Te:q))return void(j.numPoints+=V.length/3);const ve=[];for(let me=0;me<V.length;me+=3)(q===0||V[me+2]>Te)&&(j.numSimplified++,ve.push(V[me],V[me+1])),j.numPoints++;le&&function(me,Ie){let Ve=0;for(let Fe=0,tt=me.length,lt=tt-2;Fe<tt;lt=Fe,Fe+=2)Ve+=(me[Fe]-me[lt])*(me[Fe+1]+me[lt+1]);if(Ve>0===Ie)for(let Fe=0,tt=me.length;Fe<tt/2;Fe+=2){const lt=me[Fe],ft=me[Fe+1];me[Fe]=me[tt-2-Fe],me[Fe+1]=me[tt-1-Fe],me[tt-2-Fe]=lt,me[tt-1-Fe]=ft}}(ve,he),xe.push(ve)}const _o={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class cs{constructor(V,j){const q=(j=this.options=function(he,Te){for(const ve in Te)he[ve]=Te[ve];return he}(Object.create(_o),j)).debug;if(q&&console.time("preprocess data"),j.maxZoom<0||j.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(j.promoteId&&j.generateId)throw new Error("promoteId and generateId cannot be used together.");let le=function(he,Te){const ve=[];if(he.type==="FeatureCollection")for(let me=0;me<he.features.length;me++)st(ve,he.features[me],Te,me);else st(ve,he.type==="Feature"?he:{geometry:he},Te);return ve}(V,j);this.tiles={},this.tileCoords=[],q&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",j.indexMaxZoom,j.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),le=function(he,Te){const ve=Te.buffer/Te.extent;let me=he;const Ie=Rr(he,1,-1-ve,ve,0,-1,2,Te),Ve=Rr(he,1,1-ve,2+ve,0,-1,2,Te);return(Ie||Ve)&&(me=Rr(he,1,-ve,1+ve,0,-1,2,Te)||[],Ie&&(me=va(Ie,1).concat(me)),Ve&&(me=me.concat(va(Ve,-1)))),me}(le,j),le.length&&this.splitTile(le,0,0,0),q&&(le.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(V,j,q,le,he,Te,ve){const me=[V,j,q,le],Ie=this.options,Ve=Ie.debug;for(;me.length;){le=me.pop(),q=me.pop(),j=me.pop(),V=me.pop();const Fe=1<<j,tt=hi(j,q,le);let lt=this.tiles[tt];if(!lt&&(Ve>1&&console.time("creation"),lt=this.tiles[tt]=dr(V,j,q,le,Ie),this.tileCoords.push({z:j,x:q,y:le}),Ve)){Ve>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",j,q,le,lt.numFeatures,lt.numPoints,lt.numSimplified),console.timeEnd("creation"));const pr=`z${j}`;this.stats[pr]=(this.stats[pr]||0)+1,this.total++}if(lt.source=V,he==null){if(j===Ie.indexMaxZoom||lt.numPoints<=Ie.indexMaxPoints)continue}else{if(j===Ie.maxZoom||j===he)continue;if(he!=null){const pr=he-j;if(q!==Te>>pr||le!==ve>>pr)continue}}if(lt.source=null,V.length===0)continue;Ve>1&&console.time("clipping");const ft=.5*Ie.buffer/Ie.extent,jt=.5-ft,zt=.5+ft,Pe=1+ft;let Ut=null,tn=null,mt=null,Ot=null,rn=Rr(V,Fe,q-ft,q+zt,0,lt.minX,lt.maxX,Ie),Jt=Rr(V,Fe,q+jt,q+Pe,0,lt.minX,lt.maxX,Ie);V=null,rn&&(Ut=Rr(rn,Fe,le-ft,le+zt,1,lt.minY,lt.maxY,Ie),tn=Rr(rn,Fe,le+jt,le+Pe,1,lt.minY,lt.maxY,Ie),rn=null),Jt&&(mt=Rr(Jt,Fe,le-ft,le+zt,1,lt.minY,lt.maxY,Ie),Ot=Rr(Jt,Fe,le+jt,le+Pe,1,lt.minY,lt.maxY,Ie),Jt=null),Ve>1&&console.timeEnd("clipping"),me.push(Ut||[],j+1,2*q,2*le),me.push(tn||[],j+1,2*q,2*le+1),me.push(mt||[],j+1,2*q+1,2*le),me.push(Ot||[],j+1,2*q+1,2*le+1)}}getTile(V,j,q){V=+V,j=+j,q=+q;const le=this.options,{extent:he,debug:Te}=le;if(V<0||V>24)return null;const ve=1<<V,me=hi(V,j=j+ve&ve-1,q);if(this.tiles[me])return Yn(this.tiles[me],he);Te>1&&console.log("drilling down to z%d-%d-%d",V,j,q);let Ie,Ve=V,Fe=j,tt=q;for(;!Ie&&Ve>0;)Ve--,Fe>>=1,tt>>=1,Ie=this.tiles[hi(Ve,Fe,tt)];return Ie&&Ie.source?(Te>1&&(console.log("found parent tile z%d-%d-%d",Ve,Fe,tt),console.time("drilling down")),this.splitTile(Ie.source,Ve,Fe,tt,V,j,q),Te>1&&console.timeEnd("drilling down"),this.tiles[me]?Yn(this.tiles[me],he):null):null}}function hi(xe,V,j){return 32*((1<<xe)*j+V)+xe}class yo extends se{constructor(V,j,q,le=vo){super(V,j,q),this._dataUpdateable=new Map,this._createGeoJSONIndex=le}loadVectorTile(V,j){return w._(this,void 0,void 0,function*(){const q=V.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const le=this._geoJSONIndex.getTile(q.z,q.x,q.y);return le?we(new w.d2(le.features,{version:2,extent:w.a5})):null})}loadData(V){return w._(this,void 0,void 0,function*(){var j;(j=this._pendingRequest)===null||j===void 0||j.abort();const q=this._startPerformance(V);this._pendingRequest=new AbortController;try{(!this._pendingData||V.request||V.data||V.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(V,this._pendingRequest));const le=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(le,V),this.loaded={};const he={};return V.request&&(he.data=le),this._finishPerformance(q,V,he),he}catch(le){if(delete this._pendingRequest,w.Z(le))return{abandoned:!0};throw le}})}_startPerformance(V){var j;if(!((j=V==null?void 0:V.request)===null||j===void 0)&&j.collectResourceTiming)return new w.c_(V.request)}_finishPerformance(V,j,q){if(!V)return;const le=V.finish();le&&(q.resourceTiming={},q.resourceTiming[j.source]=JSON.parse(JSON.stringify(le)))}getData(){return w._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(V){const j=this.loaded;return j&&j[V.uid]?super.reloadTile(V):this.loadTile(V)}loadAndProcessGeoJSON(V,j){return w._(this,void 0,void 0,function*(){let q;if(V.request?q=yield this.loadGeoJSONFromUrl(V.request,V.promoteId,j):V.data?q=this._loadGeoJSONFromObject(V.data,V.promoteId):V.dataDiff&&(q=this._loadGeoJSONFromDiff(V.dataDiff,V.promoteId,V.source)),delete this._pendingRequest,typeof q!="object")throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`);return qe(q,!0),V.filter&&(q=this._filterGeoJSON(q,V.filter)),q})}loadGeoJSONFromUrl(V,j,q){return w._(this,void 0,void 0,function*(){const le=yield w.j(V,q);return this._dataUpdateable=w.a7(le.data,j),le.data})}_loadGeoJSONFromObject(V,j){return this._dataUpdateable=w.a7(V,j),V}_loadGeoJSONFromDiff(V,j,q){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${q}`);w.a8(this._dataUpdateable,V,j);const le=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(le)}_filterGeoJSON(V,j){const q=w.d3(j,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(q.result==="error")throw new Error(q.value.map(he=>`${he.key}: ${he.message}`).join(", "));const le=V.features.filter(he=>q.value.evaluate({zoom:0},he));return this._toFeatureCollection(le)}_toFeatureCollection(V){return{type:"FeatureCollection",features:V}}removeSource(V){return w._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(V){return this._geoJSONIndex.getClusterExpansionZoom(V.clusterId)}getClusterChildren(V){return this._geoJSONIndex.getChildren(V.clusterId)}getClusterLeaves(V){return this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset)}}function vo(xe,V){return V.cluster?new _t(function({superclusterOptions:j,clusterProperties:q}){if(!q||!j)return j;const le={},he={},Te={accumulated:null,zoom:0},ve={properties:null},me=Object.keys(q);for(const Ie of me){const[Ve,Fe]=q[Ie],tt=w.d3(Fe),lt=w.d3(typeof Ve=="string"?[Ve,["accumulated"],["get",Ie]]:Ve);le[Ie]=tt.value,he[Ie]=lt.value}return j.map=Ie=>{ve.properties=Ie;const Ve={};for(const Fe of me)Ve[Fe]=le[Fe].evaluate(Te,ve);return Ve},j.reduce=(Ie,Ve)=>{ve.properties=Ve;for(const Fe of me)Te.accumulated=Ie[Fe],Ie[Fe]=he[Fe].evaluate(Te,ve)},j}(V)).load(xe.features):function(j,q){return new cs(j,q)}(xe,V.geojsonVtOptions)}class In{constructor(V){this.self=V,this.actor=new w.L(V),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(j,q)=>{if(this.externalWorkerSourceTypes[j])throw new Error(`Worker source with name "${j}" already registered.`);this.externalWorkerSourceTypes[j]=q},this.self.addProtocol=w.cJ,this.self.removeProtocol=w.cK,this.self.registerRTLTextPlugin=j=>{w.d4.setMethods(j)},this.actor.registerMessageHandler("LDT",(j,q)=>this._getDEMWorkerSource(j,q.source).loadTile(q)),this.actor.registerMessageHandler("RDT",(j,q)=>w._(this,void 0,void 0,function*(){this._getDEMWorkerSource(j,q.source).removeTile(q)})),this.actor.registerMessageHandler("GCEZ",(j,q)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(j,q.type,q.source).getClusterExpansionZoom(q)})),this.actor.registerMessageHandler("GCC",(j,q)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(j,q.type,q.source).getClusterChildren(q)})),this.actor.registerMessageHandler("GCL",(j,q)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(j,q.type,q.source).getClusterLeaves(q)})),this.actor.registerMessageHandler("LD",(j,q)=>this._getWorkerSource(j,q.type,q.source).loadData(q)),this.actor.registerMessageHandler("GD",(j,q)=>this._getWorkerSource(j,q.type,q.source).getData()),this.actor.registerMessageHandler("LT",(j,q)=>this._getWorkerSource(j,q.type,q.source).loadTile(q)),this.actor.registerMessageHandler("RT",(j,q)=>this._getWorkerSource(j,q.type,q.source).reloadTile(q)),this.actor.registerMessageHandler("AT",(j,q)=>this._getWorkerSource(j,q.type,q.source).abortTile(q)),this.actor.registerMessageHandler("RMT",(j,q)=>this._getWorkerSource(j,q.type,q.source).removeTile(q)),this.actor.registerMessageHandler("RS",(j,q)=>w._(this,void 0,void 0,function*(){if(!this.workerSources[j]||!this.workerSources[j][q.type]||!this.workerSources[j][q.type][q.source])return;const le=this.workerSources[j][q.type][q.source];delete this.workerSources[j][q.type][q.source],le.removeSource!==void 0&&le.removeSource(q)})),this.actor.registerMessageHandler("RM",j=>w._(this,void 0,void 0,function*(){delete this.layerIndexes[j],delete this.availableImages[j],delete this.workerSources[j],delete this.demWorkerSources[j],this.globalStates.delete(j)})),this.actor.registerMessageHandler("SR",(j,q)=>w._(this,void 0,void 0,function*(){this.referrer=q})),this.actor.registerMessageHandler("SRPS",(j,q)=>this._syncRTLPluginState(j,q)),this.actor.registerMessageHandler("IS",(j,q)=>w._(this,void 0,void 0,function*(){this.self.importScripts(q)})),this.actor.registerMessageHandler("SI",(j,q)=>this._setImages(j,q)),this.actor.registerMessageHandler("UL",(j,q)=>w._(this,void 0,void 0,function*(){this._getLayerIndex(j).update(q.layers,q.removedIds,this._getGlobalState(j))})),this.actor.registerMessageHandler("UGS",(j,q)=>w._(this,void 0,void 0,function*(){const le=this._getGlobalState(j);for(const he in q)le[he]=q[he]})),this.actor.registerMessageHandler("SL",(j,q)=>w._(this,void 0,void 0,function*(){this._getLayerIndex(j).replace(q,this._getGlobalState(j))}))}_getGlobalState(V){let j=this.globalStates.get(V);return j||(j={},this.globalStates.set(V,j)),j}_setImages(V,j){return w._(this,void 0,void 0,function*(){this.availableImages[V]=j;for(const q in this.workerSources[V]){const le=this.workerSources[V][q];for(const he in le)le[he].availableImages=j}})}_syncRTLPluginState(V,j){return w._(this,void 0,void 0,function*(){return yield w.d4.syncState(j,this.self.importScripts)})}_getAvailableImages(V){let j=this.availableImages[V];return j||(j=[]),j}_getLayerIndex(V){let j=this.layerIndexes[V];return j||(j=this.layerIndexes[V]=new c),j}_getWorkerSource(V,j,q){if(this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][j]||(this.workerSources[V][j]={}),!this.workerSources[V][j][q]){const le={sendAsync:(he,Te)=>(he.targetMapId=V,this.actor.sendAsync(he,Te))};switch(j){case"vector":this.workerSources[V][j][q]=new se(le,this._getLayerIndex(V),this._getAvailableImages(V));break;case"geojson":this.workerSources[V][j][q]=new yo(le,this._getLayerIndex(V),this._getAvailableImages(V));break;default:this.workerSources[V][j][q]=new this.externalWorkerSourceTypes[j](le,this._getLayerIndex(V),this._getAvailableImages(V))}}return this.workerSources[V][j][q]}_getDEMWorkerSource(V,j){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][j]||(this.demWorkerSources[V][j]=new ue),this.demWorkerSources[V][j]}}return w.i(self)&&(self.worker=new In(self)),In}),S("index",["exports","./shared"],function(w,c){var N="5.16.0";function K(){var m=new c.A(4);return c.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}let fe,pe,ye;const Ae={frame(m,t,s){const l=requestAnimationFrame(g=>{h(),t(g)}),{unsubscribe:h}=c.s(m.signal,"abort",()=>{h(),cancelAnimationFrame(l),s(new c.a(m.signal.reason))},!1)},frameAsync(m){return new Promise((t,s)=>{this.frame(m,t,s)})},getImageData(m,t=0){return this.getImageCanvasContext(m).getImageData(-t,-t,m.width+2*t,m.height+2*t)},getImageCanvasContext(m){const t=window.document.createElement("canvas"),s=t.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return t.width=m.width,t.height=m.height,s.drawImage(m,0,0,m.width,m.height),s},resolveURL:m=>(fe||(fe=document.createElement("a")),fe.href=m,fe.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return ye!==void 0?ye:!!matchMedia&&(pe==null&&(pe=matchMedia("(prefers-reduced-motion: reduce)")),pe.matches)},set prefersReducedMotion(m){ye=m}},we=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(m){this._frozenAt=m}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function _e(){return we.getCurrentTime()}class se{static testProp(t){if(!se.docStyle)return t[0];for(let s=0;s<t.length;s++)if(t[s]in se.docStyle)return t[s];return t[0]}static create(t,s,l){const h=window.document.createElement(t);return s!==void 0&&(h.className=s),l&&l.appendChild(h),h}static createNS(t,s){return window.document.createElementNS(t,s)}static disableDrag(){se.docStyle&&se.selectProp&&(se.userSelect=se.docStyle[se.selectProp],se.docStyle[se.selectProp]="none")}static enableDrag(){se.docStyle&&se.selectProp&&(se.docStyle[se.selectProp]=se.userSelect)}static setTransform(t,s){t.style[se.transformProp]=s}static addEventListener(t,s,l,h={}){t.addEventListener(s,l,"passive"in h?h:h.capture)}static removeEventListener(t,s,l,h={}){t.removeEventListener(s,l,"passive"in h?h:h.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",se.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",se.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",se.suppressClickInternal,!0)},0)}static getScale(t){const s=t.getBoundingClientRect();return{x:s.width/t.offsetWidth||1,y:s.height/t.offsetHeight||1,boundingClientRect:s}}static getPoint(t,s,l){const h=s.boundingClientRect;return new c.P((l.clientX-h.left)/s.x-t.clientLeft,(l.clientY-h.top)/s.y-t.clientTop)}static mousePos(t,s){const l=se.getScale(t);return se.getPoint(t,l,s)}static touchPos(t,s){const l=[],h=se.getScale(t);for(let g=0;g<s.length;g++)l.push(se.getPoint(t,h,s[g]));return l}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const s=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),l=s.querySelectorAll("script");for(const h of l)h.remove();return se.clean(s),s.innerHTML}static isPossiblyDangerous(t,s){const l=s.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!l.includes("javascript:")&&!l.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const s=t.children;for(const l of s)se.removeAttributes(l),se.clean(l)}static removeAttributes(t){for(const{name:s,value:l}of t.attributes)se.isPossiblyDangerous(s,l)&&t.removeAttribute(s)}}se.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,se.selectProp=se.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),se.transformProp=se.testProp(["transform","WebkitTransform"]);const ue={supported:!1,testSupport:function(m){!Be&&ne&&(qe?et(m):Y=m)}};let Y,ne,Be=!1,qe=!1;function et(m){const t=m.createTexture();m.bindTexture(m.TEXTURE_2D,t);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,ne),m.isContextLost())return;ue.supported=!0}catch{}m.deleteTexture(t),Be=!0}var We;typeof document<"u"&&(ne=document.createElement("img"),ne.onload=()=>{Y&&et(Y),Y=null,qe=!0},ne.onerror=()=>{Be=!0,Y=null},ne.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(m){let t,s,l,h;m.resetRequestQueue=()=>{t=[],s=0,l=0,h={}},m.addThrottleControl=P=>{const M=l++;return h[M]=P,M},m.removeThrottleControl=P=>{delete h[P],y()},m.getImage=(P,M,k=!0)=>new Promise((R,D)=>{ue.supported&&(P.headers||(P.headers={}),P.headers.accept="image/webp,*/*"),c.e(P,{type:"image"}),t.push({abortController:M,requestParameters:P,supportImageRefresh:k,state:"queued",onError:B=>{D(B)},onSuccess:B=>{R(B)}}),y()});const g=P=>c._(this,void 0,void 0,function*(){P.state="running";const{requestParameters:M,supportImageRefresh:k,onError:R,onSuccess:D,abortController:B}=P,U=k===!1&&!c.i(self)&&!c.g(M.url)&&(!M.headers||Object.keys(M.headers).reduce((H,ee)=>H&&ee==="accept",!0));s++;const W=U?b(M,B):c.m(M,B);try{const H=yield W;delete P.abortController,P.state="completed",H.data instanceof HTMLImageElement||c.b(H.data)?D(H):H.data&&D({data:yield(X=H.data,typeof createImageBitmap=="function"?c.f(X):c.h(X)),cacheControl:H.cacheControl,expires:H.expires})}catch(H){delete P.abortController,R(H)}finally{s--,y()}var X}),y=()=>{const P=(()=>{for(const M of Object.keys(h))if(h[M]())return!0;return!1})()?c.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let M=s;M<P&&t.length>0;M++){const k=t.shift();k.abortController.signal.aborted?M--:g(k)}},b=(P,M)=>new Promise((k,R)=>{const D=new Image,B=P.url,U=P.credentials;U&&U==="include"?D.crossOrigin="use-credentials":(U&&U==="same-origin"||!c.d(B))&&(D.crossOrigin="anonymous"),M.signal.addEventListener("abort",()=>{D.src="",R(new c.a(M.signal.reason))}),D.fetchPriority="high",D.onload=()=>{D.onerror=D.onload=null,k({data:D})},D.onerror=()=>{D.onerror=D.onload=null,M.signal.aborted||R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},D.src=B})}(We||(We={})),We.resetRequestQueue();class Ke{constructor(t){this._transformRequestFn=t??null}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function _t(m){const t=[];if(typeof m=="string")t.push({id:"default",url:m});else if(m&&m.length>0){const s=[];for(const{id:l,url:h}of m){const g=`${l}${h}`;s.indexOf(g)===-1&&(s.push(g),t.push({id:l,url:h}))}}return t}function at(m,t,s){try{const l=new URL(m);return l.pathname+=`${t}${s}`,l.toString()}catch{throw new Error(`Invalid sprite URL "${m}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Qt(m){const{userImage:t}=m;return!!(t&&t.render&&t.render())&&(m.data.replace(new Uint8Array(t.data.buffer)),!0)}class br extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const t of Object.keys(this.images))this.removeImage(t);this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:s,promiseResolve:l}of this.requestors)l(this._getImagesForIds(s));this.requestors=[]}}getImage(t){const s=this.images[t];if(s&&!s.data&&s.spriteData){const l=s.spriteData;s.data=new c.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),s.spriteData=null}return s}addImage(t,s){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,s)&&(this.images[t]=s)}_validate(t,s){let l=!0;const h=s.data||s.spriteData;return this._validateStretch(s.stretchX,h&&h.width)||(this.fire(new c.k(new Error(`Image "${t}" has invalid "stretchX" value`))),l=!1),this._validateStretch(s.stretchY,h&&h.height)||(this.fire(new c.k(new Error(`Image "${t}" has invalid "stretchY" value`))),l=!1),this._validateContent(s.content,s)||(this.fire(new c.k(new Error(`Image "${t}" has invalid "content" value`))),l=!1),l}_validateStretch(t,s){if(!t)return!0;let l=0;for(const h of t){if(h[0]<l||h[1]<h[0]||s<h[1])return!1;l=h[1]}return!0}_validateContent(t,s){if(!t)return!0;if(t.length!==4)return!1;const l=s.spriteData,h=l&&l.width||s.data.width,g=l&&l.height||s.data.height;return!(t[0]<0||h<t[0]||t[1]<0||g<t[1]||t[2]<0||h<t[2]||t[3]<0||g<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,s,l=!0){const h=this.getImage(t);if(l&&(h.data.width!==s.data.width||h.data.height!==s.data.height))throw new Error(`size mismatch between old image (${h.data.width}x${h.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=h.version+1,this.images[t]=s,this.updatedImages[t]=!0}removeImage(t){const s=this.images[t];delete this.images[t],delete this.patterns[t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((s,l)=>{let h=!0;if(!this.isLoaded())for(const g of t)this.images[g]||(h=!1);this.isLoaded()||h?s(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:s})})}_getImagesForIds(t){const s={};for(const l of t){let h=this.getImage(l);h||(this.fire(new c.l("styleimagemissing",{id:l})),h=this.getImage(l)),h?s[l]={data:h.data.clone(),pixelRatio:h.pixelRatio,sdf:h.sdf,version:h.version,stretchX:h.stretchX,stretchY:h.stretchY,content:h.content,textFitWidth:h.textFitWidth,textFitHeight:h.textFitHeight,hasRenderCallback:!!(h.userImage&&h.userImage.render)}:c.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return s}getPixelSize(){const{width:t,height:s}=this.atlasImage;return{width:t,height:s}}getPattern(t){const s=this.patterns[t],l=this.getImage(t);if(!l)return null;if(s&&s.position.version===l.version)return s.position;if(s)s.position.version=l.version;else{const h={w:l.data.width+2,h:l.data.height+2,x:0,y:0},g=new c.I(h,l);this.patterns[t]={bin:h,position:g}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const s=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new c.T(t,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const g in this.patterns)t.push(this.patterns[g].bin);const{w:s,h:l}=c.p(t),h=this.atlasImage;h.resize({width:s||1,height:l||1});for(const g in this.patterns){const{bin:y}=this.patterns[g],b=y.x+1,P=y.y+1,M=this.getImage(g).data,k=M.width,R=M.height;c.R.copy(M,h,{x:0,y:0},{x:b,y:P},{width:k,height:R}),c.R.copy(M,h,{x:0,y:R-1},{x:b,y:P-1},{width:k,height:1}),c.R.copy(M,h,{x:0,y:0},{x:b,y:P+R},{width:k,height:1}),c.R.copy(M,h,{x:k-1,y:0},{x:b-1,y:P},{width:1,height:R}),c.R.copy(M,h,{x:0,y:0},{x:b+k,y:P},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const s of t){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const l=this.getImage(s);l||c.w(`Image with ID: "${s}" was not found`),Qt(l)&&this.updateImage(s,l)}}cloneImages(){const t={};for(const s in this.images){const l=this.images[s];t[s]=Object.assign(Object.assign({},l),{data:l.data?l.data.clone():null})}return t}}const jr=1e20;function Xn(m,t,s,l,h,g,y,b,P){for(let M=t;M<t+l;M++)Gi(m,s*g+M,g,h,y,b,P);for(let M=s;M<s+h;M++)Gi(m,M*g+t,1,l,y,b,P)}function Gi(m,t,s,l,h,g,y){g[0]=0,y[0]=-jr,y[1]=jr,h[0]=m[t];for(let b=1,P=0,M=0;b<l;b++){h[b]=m[t+b*s];const k=b*b;do{const R=g[P];M=(h[b]-h[R]+k-R*R)/(b-R)/2}while(M<=y[P]&&--P>-1);P++,g[P]=b,y[P]=M,y[P+1]=jr}for(let b=0,P=0;b<l;b++){for(;y[P+1]<b;)P++;const M=g[P],k=b-M;m[t+b*s]=h[M]+k*k}}const ls=c.v.layout_symbol["text-font"].default.join(",");class en{constructor(t,s,l){this.requestManager=t,this.localIdeographFontFamily=s,this.entries={},this.lang=l}setURL(t){this.url=t}getGlyphs(t){return c._(this,void 0,void 0,function*(){const s=[];for(const g in t)for(const y of t[g])s.push(this._getAndCacheGlyphsPromise(g,y));const l=yield Promise.all(s),h={};for(const{stack:g,id:y,glyph:b}of l)h[g]||(h[g]={}),h[g][y]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics};return h})}_getAndCacheGlyphsPromise(t,s){return c._(this,void 0,void 0,function*(){let l=this.entries[t];l||(l=this.entries[t]={glyphs:{},requests:{},ranges:{}});let h=l.glyphs[s];return h!==void 0?{stack:t,id:s,glyph:h}:!this.url||this._charUsesLocalIdeographFontFamily(s)?(h=l.glyphs[s]=this._drawGlyph(l,t,s),{stack:t,id:s,glyph:h}):yield this._downloadAndCacheRangePromise(t,s)})}_downloadAndCacheRangePromise(t,s){return c._(this,void 0,void 0,function*(){const l=this.entries[t],h=Math.floor(s/256);if(l.ranges[h])return{stack:t,id:s,glyph:null};if(!l.requests[h]){const g=en.loadGlyphRange(t,h,this.url,this.requestManager);l.requests[h]=g}try{const g=yield l.requests[h];for(const y in g)l.glyphs[+y]=g[+y];return l.ranges[h]=!0,{stack:t,id:s,glyph:g[s]||null}}catch(g){const y=l.glyphs[s]=this._drawGlyph(l,t,s);return this._warnOnMissingGlyphRange(y,h,s,g),{stack:t,id:s,glyph:y}}})}_warnOnMissingGlyphRange(t,s,l,h){const g=256*s,y=g+255,b=l.toString(16).padStart(4,"0").toUpperCase();c.w(`Unable to load glyph range ${s}, ${g}-${y}. Rendering codepoint U+${b} locally instead. ${h}`)}_charUsesLocalIdeographFontFamily(t){return!!this.localIdeographFontFamily&&c.q(t)}_drawGlyph(t,s,l){const h=s===ls&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(l),g=h?"ideographTinySDF":"tinySDF";t[g]||(t[g]=this._createTinySDF(h?this.localIdeographFontFamily:s));const y=t[g].draw(String.fromCodePoint(l)),b=new RegExp("^\\p{gc=Cf}+$","u").test(String.fromCodePoint(l));return{id:l,bitmap:new c.r({width:y.width||60,height:y.height||60},y.data),metrics:{width:b?0:y.glyphWidth/2||24,height:y.glyphHeight/2||24,left:y.glyphLeft/2+.5||0,top:y.glyphTop/2-27.5||-8,advance:b?0:y.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(t){const s=t?t.split(","):[];s.push("sans-serif");const l=s.map(h=>/[-\w]+/.test(h)?h:`'${CSS.escape(h)}'`).join(",");return new en.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:l,fontWeight:this._fontWeight(s[0]),fontStyle:this._fontStyle(s[0]),lang:this.lang})}_fontStyle(t){return/italic/i.test(t)?"italic":/oblique/i.test(t)?"oblique":"normal"}_fontWeight(t){const s={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let l;for(const[h,g]of Object.entries(s))new RegExp(`\\b${h}\\b`,"i").test(t)&&(l=`${g}`);return l}destroy(){for(const t in this.entries){const s=this.entries[t];s.tinySDF&&(s.tinySDF=null),s.ideographTinySDF&&(s.ideographTinySDF=null),s.glyphs={},s.requests={},s.ranges={}}this.entries={}}}en.loadGlyphRange=function(m,t,s,l){return c._(this,void 0,void 0,function*(){const h=256*t,g=h+255,y=l.transformRequest(s.replace("{fontstack}",m).replace("{range}",`${h}-${g}`),"Glyphs"),b=yield c.n(y,new AbortController);if(!b||!b.data)throw new Error(`Could not load glyph range. range: ${t}, ${h}-${g}`);const P={};for(const M of c.o(b.data))P[M.id]=M;return P})},en.TinySDF=class{constructor({fontSize:m=24,buffer:t=3,radius:s=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:g="normal",fontStyle:y="normal",lang:b=null}={}){this.buffer=t,this.cutoff=l,this.radius=s,this.lang=b;const P=this.size=m+4*t,M=this._createCanvas(P),k=this.ctx=M.getContext("2d",{willReadFrequently:!0});k.font=`${y} ${g} ${m}px ${h}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Uint16Array(P)}_createCanvas(m){const t=document.createElement("canvas");return t.width=t.height=m,t}draw(m){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:g}=this.ctx.measureText(m),y=Math.ceil(s),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-h))),P=Math.min(this.size-this.buffer,y+Math.ceil(l)),M=b+2*this.buffer,k=P+2*this.buffer,R=Math.max(M*k,0),D=new Uint8ClampedArray(R),B={data:D,width:M,height:k,glyphWidth:b,glyphHeight:P,glyphTop:y,glyphLeft:0,glyphAdvance:t};if(b===0||P===0)return B;const{ctx:U,buffer:W,gridInner:X,gridOuter:H}=this;this.lang&&(U.lang=this.lang),U.clearRect(W,W,b,P),U.fillText(m,W,W+y);const ee=U.getImageData(W,W,b,P);H.fill(jr,0,R),X.fill(0,0,R);for(let ae=0;ae<P;ae++)for(let Q=0;Q<b;Q++){const ie=ee.data[4*(ae*b+Q)+3]/255;if(ie===0)continue;const ce=(ae+W)*M+Q+W;if(ie===1)H[ce]=0,X[ce]=jr;else{const re=.5-ie;H[ce]=re>0?re*re:0,X[ce]=re<0?re*re:0}}Xn(H,0,0,M,k,M,this.f,this.v,this.z),Xn(X,W,W,b,P,M,this.f,this.v,this.z);for(let ae=0;ae<R;ae++){const Q=Math.sqrt(H[ae])-Math.sqrt(X[ae]);D[ae]=Math.round(255-255*(Q/this.radius+this.cutoff))}return B}};class ot{constructor(){this.specification=c.u.light.position}possiblyEvaluate(t,s){return c.F(t.expression.evaluate(s))}interpolate(t,s,l){return{x:c.G.number(t.x,s.x,l),y:c.G.number(t.y,s.y,l),z:c.G.number(t.z,s.z,l)}}}let st;class vt extends c.E{constructor(t){super(),st=st||new c.t({anchor:new c.D(c.u.light.anchor),position:new ot,color:new c.D(c.u.light.color),intensity:new c.D(c.u.light.intensity)}),this._transitionable=new c.x(st,void 0),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s={}){if(!this._validate(c.y,t,s))for(const l in t){const h=t[l];l.endsWith(c.z)?this._transitionable.setTransition(l.slice(0,-c.z.length),h):this._transitionable.setValue(l,h)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,l){return(!l||l.validate!==!1)&&c.B(this,t.call(c.C,{value:s,style:{glyphs:!0,sprite:!0},styleSpec:c.u}))}}const Lt=new c.t({"sky-color":new c.D(c.u.sky["sky-color"]),"horizon-color":new c.D(c.u.sky["horizon-color"]),"fog-color":new c.D(c.u.sky["fog-color"]),"fog-ground-blend":new c.D(c.u.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.u.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.u.sky["atmosphere-blend"])});class rr extends c.E{constructor(t){super(),this._transitionable=new c.x(Lt,void 0),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.H(0))}setSky(t,s={}){if(!this._validate(c.J,t,s)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in t){const h=t[l];l.endsWith(c.z)?this._transitionable.setTransition(l.slice(0,-c.z.length),h):this._transitionable.setValue(l,h)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,l={}){return(l==null?void 0:l.validate)!==!1&&c.B(this,t.call(c.C,c.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:c.u})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class Ii{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,s){const l=t.join(",")+String(s);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(t,s)),this.dashEntry[l]}getDashRanges(t,s,l){const h=[];let g=t.length%2==1?-t[t.length-1]*l:0,y=t[0]*l,b=!0;h.push({left:g,right:y,isDash:b,zeroLength:t[0]===0});let P=t[0];for(let M=1;M<t.length;M++){b=!b;const k=t[M];g=P*l,P+=k,y=P*l,h.push({left:g,right:y,isDash:b,zeroLength:k===0})}return h}addRoundDash(t,s,l){const h=s/2;for(let g=-l;g<=l;g++){const y=this.width*(this.nextRow+l+g);let b=0,P=t[b];for(let M=0;M<this.width;M++){M/P.right>1&&(P=t[++b]);const k=Math.abs(M-P.left),R=Math.abs(M-P.right),D=Math.min(k,R);let B;const U=g/l*(h+1);if(P.isDash){const W=h-Math.abs(U);B=Math.sqrt(D*D+W*W)}else B=h-Math.sqrt(D*D+U*U);this.data[y+M]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(t){for(let b=t.length-1;b>=0;--b){const P=t[b],M=t[b+1];P.zeroLength?t.splice(b,1):M&&M.isDash===P.isDash&&(M.left=P.left,t.splice(b,1))}const s=t[0],l=t[t.length-1];s.isDash===l.isDash&&(s.left=l.left-this.width,l.right=s.right+this.width);const h=this.width*this.nextRow;let g=0,y=t[g];for(let b=0;b<this.width;b++){b/y.right>1&&(y=t[++g]);const P=Math.abs(b-y.left),M=Math.abs(b-y.right),k=Math.min(P,M);this.data[h+b]=Math.max(0,Math.min(255,(y.isDash?k:-k)+128))}}addDash(t,s){const l=s?7:0,h=2*l+1;if(this.nextRow+h>this.height)return c.w("LineAtlas out of space"),null;let g=0;for(let b=0;b<t.length;b++)g+=t[b];if(g!==0){const b=this.width/g,P=this.getDashRanges(t,this.width,b);s?this.addRoundDash(P,b,l):this.addRegularDash(P)}const y={y:this.nextRow+l,height:2*l,width:g};return this.nextRow+=h,this.dirty=!0,y}bind(t){const s=t.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}const mn="maplibre_preloaded_worker_pool";class Rr{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Rr.workerCount;)this.workers.push(new Worker(c.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[mn]}numActive(){return Object.keys(this.active).length}}const Vr=Math.floor(Ae.hardwareConcurrency/2);let Mn,gn;function As(){return Mn||(Mn=new Rr),Mn}Rr.workerCount=c.K(globalThis)?Math.max(Math.min(Vr,3),1):1;class ui{constructor(t,s){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=s;const l=this.workerPool.acquire(s);for(let h=0;h<l.length;h++){const g=new c.L(l[h],s);g.name=`Worker ${h}`,this.actors.push(g)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,s){const l=[];for(const h of this.actors)l.push(h.sendAsync({type:t,data:s}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(s=>{s.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,s){for(const l of this.actors)l.registerMessageHandler(t,s)}unregisterMessageHandler(t){for(const s of this.actors)s.unregisterMessageHandler(t)}}function ya(){return gn||(gn=new ui(As(),c.M),gn.registerMessageHandler("GR",(m,t,s)=>c.m(t,s))),gn}function ci(m,t){const s=c.N();return c.O(s,s,[1,1,0]),c.Q(s,s,[.5*m.width,.5*m.height,1]),m.calculatePosMatrix?c.S(s,s,m.calculatePosMatrix(t.toUnwrapped())):s}function va(m,t,s,l,h,g,y){var b;const P=function(D,B,U){if(D)for(const W of D){const X=B[W];if(X&&X.source===U&&X.type==="fill-extrusion")return!0}else for(const W in B){const X=B[W];if(X.source===U&&X.type==="fill-extrusion")return!0}return!1}((b=h==null?void 0:h.layers)!==null&&b!==void 0?b:null,t,m.id),M=g.maxPitchScaleFactor(),k=m.tilesIn(l,M,P);k.sort(qr);const R=[];for(const D of k)R.push({wrappedTileID:D.tileID.wrapped().key,queryResults:D.tile.queryRenderedFeatures(t,s,m.getState(),D.queryGeometry,D.cameraQueryGeometry,D.scale,h,g,M,ci(g,D.tileID),y?(B,U)=>y(D.tileID,B,U):void 0)});return function(D,B){for(const U in D)for(const W of D[U])Yn(W,B);return D}(function(D){const B={},U={};for(const W of D){const X=W.queryResults,H=W.wrappedTileID,ee=U[H]=U[H]||{};for(const ae in X){const Q=X[ae],ie=ee[ae]=ee[ae]||{},ce=B[ae]=B[ae]||[];for(const re of Q)ie[re.featureIndex]||(ie[re.featureIndex]=!0,ce.push(re))}}return B}(R),m)}function qr(m,t){const s=m.tileID,l=t.tileID;return s.overscaledZ-l.overscaledZ||s.canonical.y-l.canonical.y||s.wrap-l.wrap||s.canonical.x-l.canonical.x}function Yn(m,t){const s=m.feature,l=t.getFeatureState(s.layer["source-layer"],s.id);s.source=s.layer.source,s.layer["source-layer"]&&(s.sourceLayer=s.layer["source-layer"]),s.state=l}function ki(m,t,s){return c._(this,void 0,void 0,function*(){let l=m;if(m.url?l=(yield c.j(t.transformRequest(m.url,"Source"),s)).data:yield Ae.frameAsync(s),!l)return null;const h=c.U(c.e(l,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(h.vectorLayerIds=l.vector_layers.map(g=>g.id)),h})}class dr{constructor(t,s){t&&(s?this.setSouthWest(t).setNorthEast(s):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof c.V?new c.V(t.lng,t.lat):c.V.convert(t),this}setSouthWest(t){return this._sw=t instanceof c.V?new c.V(t.lng,t.lat):c.V.convert(t),this}extend(t){const s=this._sw,l=this._ne;let h,g;if(t instanceof c.V)h=t,g=t;else{if(!(t instanceof dr))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(dr.convert(t)):this.extend(c.V.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(c.V.convert(t)):this;if(h=t._sw,g=t._ne,!h||!g)return this}return s||l?(s.lng=Math.min(h.lng,s.lng),s.lat=Math.min(h.lat,s.lat),l.lng=Math.max(g.lng,l.lng),l.lat=Math.max(g.lat,l.lat)):(this._sw=new c.V(h.lng,h.lat),this._ne=new c.V(g.lng,g.lat)),this}getCenter(){return new c.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.V(this.getWest(),this.getNorth())}getSouthEast(){return new c.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:s,lat:l}=c.V.convert(t);let h=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}intersects(t){if(!((t=dr.convert(t)).getNorth()>=this.getSouth()&&t.getSouth()<=this.getNorth()))return!1;const s=Math.abs(this.getEast()-this.getWest()),l=Math.abs(t.getEast()-t.getWest());if(s>=360||l>=360)return!0;const h=c.W(this.getWest(),-180,180),g=c.W(this.getEast(),-180,180),y=c.W(t.getWest(),-180,180),b=c.W(t.getEast(),-180,180),P=h>=g,M=y>=b;return!(!P||!M)||(P?b>=h||y<=g:M?g>=y||h<=b:y<=g&&b>=h)}static convert(t){return t instanceof dr?t:t&&new dr(t)}static fromLngLat(t,s=0){const l=360*s/40075017,h=l/Math.cos(Math.PI/180*t.lat);return new dr(new c.V(t.lng-h,t.lat-l),new c.V(t.lng+h,t.lat+l))}adjustAntiMeridian(){const t=new c.V(this._sw.lng,this._sw.lat),s=new c.V(this._ne.lng,this._ne.lat);return new dr(t,t.lng>s.lng?new c.V(s.lng+360,s.lat):s)}}class us{constructor(t,s,l){this.bounds=dr.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=l||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),l=Math.floor(c.Y(this.bounds.getWest())*s),h=Math.floor(c.X(this.bounds.getNorth())*s),g=Math.ceil(c.Y(this.bounds.getEast())*s),y=Math.ceil(c.X(this.bounds.getSouth())*s);return t.x>=l&&t.x<g&&t.y>=h&&t.y<y}}class zs extends c.E{constructor(t,s,l,h){if(super(),this.id=t,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.U(s,["url","scheme","tileSize","promoteId","encoding"])),this._options=c.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h)}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield ki(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),t&&(c.e(this,t),t.bounds&&(this.tileBounds=new us(t.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this._loaded=!0,c.Z(t)||this.fire(new c.k(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(t){return c._(this,void 0,void 0,function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(s,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(t)};l.request.collectResourceTiming=this._collectResourceTiming;let h="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise((g,y)=>{t.reloadPromise={resolve:g,reject:y}})}else t.actor=this.dispatcher.getActor(),h="LT";t.abortController=new AbortController;try{const g=yield t.actor.sendAsync({type:h,data:l},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,g)}catch(g){if(delete t.abortController,t.aborted)return;if(g&&g.status!==404)throw g;this._afterTileLoadWorkerResponse(t,null)}})}_getOverzoomParameters(t){if(t.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const s=t.tileID.scaledTo(this.maxzoom).canonical,l=s.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:s,overzoomRequest:this.map._requestManager.transformRequest(l,"Tile")}}_afterTileLoadWorkerResponse(t,s){if(s&&s.resourceTiming&&(t.resourceTiming=s.resourceTiming),s&&this.map._refreshExpiredTiles&&t.setExpiryData(s),t.loadVectorData(s,this.map.painter),t.reloadPromise){const l=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(l.resolve).catch(l.reject)}}abortTile(t){return c._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return c._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class _o extends c.E{constructor(t,s,l,h){super(),this.id=t,this.dispatcher=l,this.setEventedParent(h),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},s),c.e(this,c.U(s,["url","scheme","tileSize"]))}load(){return c._(this,arguments,void 0,function*(t=!1){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield ki(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,s&&(c.e(this,s),s.bounds&&(this.tileBounds=new us(s.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(s){this._tileJSONRequest=null,this._loaded=!0,c.Z(s)||this.fire(new c.k(s))}})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return c.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return c._(this,void 0,void 0,function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const l=yield We.getImage(this.map._requestManager.transformRequest(s,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&(l.cacheControl||l.expires)&&t.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const h=this.map.painter.context,g=h.gl,y=l.data;t.texture=this.map.painter.getTileTexture(y.width),t.texture?t.texture.update(y,{useMipmap:!0}):(t.texture=new c.T(h,y,g.RGBA,{useMipmap:!0}),t.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(l){if(delete t.abortController,t.aborted)t.state="unloaded";else if(l)throw t.state="errored",l}})}abortTile(t){return c._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return c._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class cs extends _o{constructor(t,s,l,h){super(t,s,l,h),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(t){return c._(this,void 0,void 0,function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(s,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const h=yield We.getImage(l,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(h&&h.data){const g=h.data;this.map._refreshExpiredTiles&&(h.cacheControl||h.expires)&&t.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});const y=c.b(g)&&c.$()?g:yield this.readImageNow(g),b={type:this.type,uid:t.uid,source:this.id,rawImageData:y,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const P=yield t.actor.sendAsync({type:"LDT",data:b});t.dem=P,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(h){if(delete t.abortController,t.aborted)t.state="unloaded";else if(h)throw t.state="errored",h}})}readImageNow(t){return c._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&c.a0()){const s=t.width+2,l=t.height+2;try{return new c.R({width:s,height:l},yield c.a1(t,-1,-1,s,l))}catch{}}return Ae.getImageData(t,1)})}_getNeighboringTiles(t){const s=t.canonical,l=Math.pow(2,s.z),h=(s.x-1+l)%l,g=s.x===0?t.wrap-1:t.wrap,y=(s.x+1+l)%l,b=s.x+1===l?t.wrap+1:t.wrap,P={};return P[new c.a2(t.overscaledZ,g,s.z,h,s.y).key]={backfilled:!1},P[new c.a2(t.overscaledZ,b,s.z,y,s.y).key]={backfilled:!1},s.y>0&&(P[new c.a2(t.overscaledZ,g,s.z,h,s.y-1).key]={backfilled:!1},P[new c.a2(t.overscaledZ,t.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},P[new c.a2(t.overscaledZ,b,s.z,y,s.y-1).key]={backfilled:!1}),s.y+1<l&&(P[new c.a2(t.overscaledZ,g,s.z,h,s.y+1).key]={backfilled:!1},P[new c.a2(t.overscaledZ,t.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},P[new c.a2(t.overscaledZ,b,s.z,y,s.y+1).key]={backfilled:!1}),P}unloadTile(t){return c._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))})}}function hi(m){return m.type==="GeometryCollection"?m.geometries.map(t=>t.coordinates).flat(1/0):m.coordinates.flat(1/0)}function yo(m){const t=new dr;let s;switch(m.type){case"FeatureCollection":s=m.features.map(l=>hi(l.geometry)).flat(1/0);break;case"Feature":s=hi(m.geometry);break;default:s=hi(m)}if(s.length==0)return t;for(let l=0;l<s.length-1;l+=2)t.extend([s[l],s[l+1]]);return t}class vo extends c.E{constructor(t,s,l,h){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:s.data},this.actor=l.getActor(),this.setEventedParent(h),this._data=typeof s.data=="string"?{url:s.data}:{geojson:s.data},this._options=c.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId,s.clusterMaxZoom!==void 0&&this.maxzoom<=s.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${s.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(s.buffer!==void 0?s.buffer:128),tolerance:this._pixelsToTileUnits(s.tolerance!==void 0?s.tolerance:.375),extent:c.a5,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(s.clusterMaxZoom),minPoints:Math.max(2,s.clusterMinPoints||2),extent:c.a5,radius:this._pixelsToTileUnits(s.clusterRadius||50),log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(t){return t*(c.a5/this.tileSize)}_getClusterMaxZoom(t){const s=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||c.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${s}"`),s}load(){return c._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t,s){this._data=typeof t=="string"?{url:t}:{geojson:t},this._pendingWorkerUpdate={data:t};const l=this._updateWorkerData();return s?l:this}updateData(t,s){this._pendingWorkerUpdate.diff=c.a6(this._pendingWorkerUpdate.diff,t);const l=this._updateWorkerData();return s?l:this}getData(){return c._(this,void 0,void 0,function*(){const t=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})})}getBounds(){return c._(this,void 0,void 0,function*(){return yo(yield this.getData())})}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,s,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:s,offset:l}})}_updateWorkerData(){return c._(this,void 0,void 0,function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void c.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:t,diff:s}=this._pendingWorkerUpdate,l=c.e({type:this.type},this.workerOptions);t!==void 0?(typeof t=="string"?(l.request=this.map._requestManager.transformRequest(Ae.resolveURL(t),"Source"),l.request.collectResourceTiming=this._collectResourceTiming):l.data=t,this._pendingWorkerUpdate.data=void 0):s&&(l.dataDiff=s,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new c.l("dataloading",{dataType:"source"}));try{const h=yield this.actor.sendAsync({type:"LD",data:l});if(this._isUpdatingWorker=!1,this._removed||h.abandoned)return void this.fire(new c.l("dataabort",{dataType:"source"}));h.data&&(this._data={geojson:h.data});const g=this._applyDiffToSource(s),y=this._getShouldReloadTileOptions(g);let b=null;h.resourceTiming&&h.resourceTiming[this.id]&&(b=h.resourceTiming[this.id].slice(0));const P={dataType:"source"};this._collectResourceTiming&&b&&b.length>0&&c.e(P,{resourceTiming:b}),this.fire(new c.l("data",Object.assign(Object.assign({},P),{sourceDataType:"metadata"}))),this.fire(new c.l("data",Object.assign(Object.assign({},P),{sourceDataType:"content",shouldReloadTileOptions:y})))}catch(h){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new c.l("dataabort",{dataType:"source"}));this.fire(new c.k(h))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}})}_applyDiffToSource(t){if(!t)return;const s=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const h=c.a7(this._data.geojson,s);if(!h)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:h}}if(!this._data.updateable)return;const l=c.a8(this._data.updateable,t,s);return t.removeAll||this._options.cluster?void 0:l}_getShouldReloadTileOptions(t){if(t)return{affectedBounds:t.filter(Boolean).map(s=>yo(s))}}shouldReloadTile(t,{affectedBounds:s}){if(t.state==="loading")return!0;if(t.state==="unloaded")return!1;const{buffer:l,extent:h}=this.workerOptions.geojsonVtOptions,g=function({x:y,y:b,z:P},M=0){const k=c.a3((y-M)/Math.pow(2,P)),R=c.a4((b+1+M)/Math.pow(2,P)),D=c.a3((y+1+M)/Math.pow(2,P)),B=c.a4((b-M)/Math.pow(2,P));return new dr([k,R],[D,B])}(t.tileID.canonical,l/h);for(const y of s)if(g.intersects(y))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(t){return c._(this,void 0,void 0,function*(){const s=t.actor?"RT":"LT";t.actor=this.actor;const l={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const h=yield this.actor.sendAsync({type:s,data:l},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(h,this.map.painter,s==="RT")})}abortTile(t){return c._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return c._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class In extends c.E{constructor(t,s,l,h){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=l,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(h),this.options=s}load(t){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const s=yield We.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,s&&s.data&&(this.image=s.data,t&&(this.coordinates=t),this._finishLoading())}catch(s){this._request=null,this._loaded=!0,c.Z(s)||this.fire(new c.k(s))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const s=t.map(c.a9.fromLngLat);var l;return this.tileID=function(h){const g=c.aa.fromPoints(h),y=g.width(),b=g.height(),P=Math.max(y,b),M=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),k=Math.pow(2,M);return new c.ac(M,Math.floor((g.minX+g.maxX)/2*k),Math.floor((g.minY+g.maxY)/2*k))}(s),this.terrainTileRanges=this._getOverlappingTileRanges(s),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=s.map(h=>this.tileID.getTilePoint(h)._round()),this.flippedWindingOrder=((l=this.tileCoords)[1].x-l[0].x)*(l[2].y-l[0].y)-(l[1].y-l[0].y)*(l[2].x-l[0].x)<0,this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,s=t.gl;this.texture||(this.texture=new c.T(t,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const g=this.tiles[h];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,l=!0)}l&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return c._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:s,minY:l,maxX:h,maxY:g}=c.aa.fromPoints(t),y={};for(let b=0;b<=c.ab;b++){const P=Math.pow(2,b),M=Math.floor(s*P),k=Math.floor(l*P),R=Math.floor(h*P),D=Math.floor(g*P),B=(M%P+P)%P,U=R%P,W=Math.floor(M/P),X=Math.floor(R/P);y[b]={minWrap:W,maxWrap:X,minTileXWrapped:B,maxTileXWrapped:U,minTileY:k,maxTileY:D}}return y}}class xe extends In{constructor(t,s,l,h){super(t,s,l,h),this.roundZoom=!0,this.type="video",this.options=s}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const s of t.urls)this.urls.push(this.map._requestManager.transformRequest(s,"Source").url);try{const s=yield c.ad(this.urls);if(this._loaded=!0,!s)return;this.video=s,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(s){this.fire(new c.k(s))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const s=this.video.seekable;t<s.start(0)||t>s.end(0)?this.fire(new c.k(new c.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,s=t.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new c.T(t,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const g=this.tiles[h];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,l=!0)}l&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class V extends In{constructor(t,s,l,h){super(t,s,l,h),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(y=>typeof y!="number"))||this.fire(new c.k(new c.ae(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.k(new c.ae(`sources.${t}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new c.k(new c.ae(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new c.k(new c.ae(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.k(new c.ae(`sources.${t}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){return c._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,l=s.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new c.T(s,this.canvas,l.RGBA,{premultiply:!0}),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));let h=!1;for(const g in this.tiles){const y=this.tiles[g];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,h=!0)}h&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const j={},q=m=>{switch(m){case"geojson":return vo;case"image":return In;case"raster":return _o;case"raster-dem":return cs;case"vector":return zs;case"video":return xe;case"canvas":return V}return j[m]},le="RTLPluginLoaded";class he extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=ya()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch(s=>{throw this.status="error",s})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return c._(this,arguments,void 0,function*(s,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Ae.resolveURL(s),!this.url)throw new Error(`requested url ${s} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return c._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.l(le))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Te=null;function ve(){return Te||(Te=new he),Te}var me,Ie;(function(m){m[m.Base=0]="Base",m[m.Parent=1]="Parent"})(me||(me={})),function(m){m[m.Departing=0]="Departing",m[m.Incoming=1]="Incoming"}(Ie||(Ie={}));class Ve{constructor(t,s){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=t,this.uid=c.af(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(t){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(t||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:t,fadingDirection:s,fadingParentID:l,fadeEndTime:h}){this.resetFadeLogic(),this.fadingRole=t,this.fadingDirection=s,this.fadingParentID=l,this.fadeEndTime=h}setSelfFadeLogic(t){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=t}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=_e(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,s,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData,this.latestFeatureIndex.encoding=t.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(h,g){const y={};if(!g)return y;for(const b of h){const P=b.layerIds.map(M=>g.getLayer(M)).filter(Boolean);if(P.length!==0){b.layers=P,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(M=>P.filter(k=>k.id===M)[0]));for(const M of P)y[M.id]=b}}return y}(t.buckets,s==null?void 0:s.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const g=this.buckets[h];if(g instanceof c.ah){if(this.hasSymbolBuckets=!0,!l)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const g=this.buckets[h];if(g instanceof c.ah&&g.hasRTLText){this.hasRTLText=!0,ve().lazyLoad();break}}this.queryPadding=0;for(const h in this.buckets){const g=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(h).queryRadius(g))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),this.dashPositions=t.dashPositions}else this.collisionBoxArray=new c.ag}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const l in this.buckets){const h=this.buckets[l];h.uploadPending()&&h.upload(t)}const s=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new c.T(t,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new c.T(t,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,s,l,h,g,y,b,P,M,k,R){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:g,scale:y,tileSize:this.tileSize,pixelPosMatrix:k,transform:P,params:b,queryPadding:this.queryPadding*M,getElevation:R},t,s,l):{}}querySourceFeatures(t,s){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),g=s&&s.sourceLayer?s.sourceLayer:"",y=h[c.ai]||h[g];if(!y)return;const b=c.aj(s==null?void 0:s.filter,s==null?void 0:s.globalState),{z:P,x:M,y:k}=this.tileID.canonical,R={z:P,x:M,y:k};for(let D=0;D<y.length;D++){const B=y.feature(D);if(b.needGeometry){const X=c.ak(B,!0);if(!b.filter(new c.H(this.tileID.overscaledZ),X,this.tileID.canonical))continue}else if(!b.filter(new c.H(this.tileID.overscaledZ),B))continue;const U=l.getId(B,g),W=new c.al(B,P,M,k,U);W.tile=R,t.push(W)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const l=c.am(t.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(s)if(this.expirationTime<s)h=!0;else{const g=this.expirationTime-s;g?this.expirationTime=l+Math.max(g,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const h in this.buckets){if(!s.style.hasLayer(h))continue;const g=this.buckets[h],y=g.layers[0].sourceLayer||c.ai,b=l[y],P=t[y];if(!b||!P||Object.keys(P).length===0)continue;g.update(P,b,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const M=s&&s.style&&s.style.getLayer(h);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(g)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<_e()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(t){this.symbolFadeHoldUntil=_e()+t}setDependencies(t,s){const l={};for(const h of s)l[h]=!0;this.dependencies[t]=l}hasDependency(t,s){for(const l of t){const h=this.dependencies[l];if(h){for(const g of s)if(h[g])return!0}}return!1}}class Fe{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,l){const h=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},c.e(this.stateChanges[t][h],l),this.deletedStates[t]===null){this.deletedStates[t]={};for(const g in this.state[t])g!==h&&(this.deletedStates[t][g]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][h]===null){this.deletedStates[t][h]={};for(const g in this.state[t][h])l[g]||(this.deletedStates[t][h][g]=null)}else for(const g in l)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][g]===null&&delete this.deletedStates[t][h][g]}removeFeatureState(t,s,l){if(this.deletedStates[t]===null)return;const h=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},l&&s!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][l]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(l in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][l]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}getState(t,s){const l=String(s),h=c.e({},(this.state[t]||{})[l],(this.stateChanges[t]||{})[l]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const g=this.deletedStates[t][s];if(g===null)return{};for(const y in g)delete h[y]}return h}initializeTileState(t,s){t.setFeatureState(this.state,s)}coalesceChanges(t,s){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const g={};for(const y in this.stateChanges[h])this.state[h][y]||(this.state[h][y]={}),c.e(this.state[h][y],this.stateChanges[h][y]),g[y]=this.state[h][y];l[h]=g}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const g={};if(this.deletedStates[h]===null)for(const y in this.state[h])g[y]={},this.state[h][y]={};else for(const y in this.deletedStates[h]){if(this.deletedStates[h][y]===null)this.state[h][y]={};else for(const b of Object.keys(this.deletedStates[h][y]))delete this.state[h][y][b];g[y]=this.state[h][y]}l[h]=l[h]||{},c.e(l[h],g)}this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0&&t.setFeatureState(l,s)}}const tt=89.25;function lt(m,t){const s=c.an(t.lat,-c.ao,c.ao);return new c.P(c.Y(t.lng)*m,c.X(s)*m)}function ft(m,t){return new c.a9(t.x/m,t.y/m).toLngLat()}function jt(m){return m.cameraToCenterDistance*Math.min(.85*Math.tan(c.ap(90-m.pitch)),Math.tan(c.ap(tt-m.pitch)))}function zt(m,t){const s=m.canonical,l=t/c.aq(s.z),h=s.x+Math.pow(2,s.z)*m.wrap,g=c.ar(new Float64Array(16));return c.O(g,g,[h*l,s.y*l,0]),c.Q(g,g,[l/c.a5,l/c.a5,1]),g}function Pe(m,t,s,l,h){const g=c.a9.fromLngLat(m,t),y=h*c.as(1,m.lat),{x:b,y:P,z:M}=Ut(s,l);return new c.a9(g.x+y*-b,g.y+y*-P,g.z+y*-M)}function Ut(m,t){const s=c.ap(m),l=c.ap(t),h=Math.cos(-s),g=Math.sin(s);return{x:g*Math.sin(l),y:-g*Math.cos(l),z:h}}function tn(m,t,s){const l=t.intersectsFrustum(m);if(!s||l===0)return l;const h=t.intersectsPlane(s);return h===0?0:l===2&&h===2?2:1}function mt(m,t,s){let l=0;const h=(s-t)/10;for(let g=0;g<10;g++)l+=h*Math.pow(Math.cos(t+(g+.5)/10*(s-t)),m);return l}function Ot(m,t){return function(s,l,h,g,y){const b=2*((m-1)/c.at(Math.cos(c.ap(tt-y))/Math.cos(c.ap(tt)))-1),P=Math.acos(h/g),M=2*mt(b-1,0,c.ap(y/2)),k=Math.min(c.ap(tt),P+c.ap(y/2)),R=mt(b-1,Math.min(k,P-c.ap(y/2)),k),D=Math.atan(l/h),B=Math.hypot(l,h);let U=s;return U+=c.at(g/B/Math.max(.5,Math.cos(c.ap(y/2)))),U+=b*c.at(Math.cos(D))/2,U-=c.at(Math.max(1,R/M/t))/2,U}}const rn=Ot(9.314,3);function Jt(m,t){const s=(t.roundZoom?Math.round:Math.floor)(m.zoom+c.at(m.tileSize/t.tileSize));return Math.max(0,s)}function pr(m,t){const s=m.getCameraFrustum(),l=m.getClippingPlane(),h=m.screenPointToMercatorCoordinate(m.getCameraPoint()),g=c.a9.fromLngLat(m.center,m.elevation);h.z=g.z+Math.cos(m.pitchInRadians)*m.cameraToCenterDistance/m.worldSize;const y=m.getCoveringTilesDetailsProvider(),b=y.allowVariableZoom(m,t),P=Jt(m,t),M=t.minzoom||0,k=t.maxzoom!==void 0?t.maxzoom:m.maxZoom,R=Math.min(Math.max(0,P),k),D=Math.pow(2,R),B=[D*h.x,D*h.y,0],U=[D*g.x,D*g.y,0],W=Math.hypot(g.x-h.x,g.y-h.y),X=Math.abs(g.z-h.z),H=Math.hypot(W,X),ee=ie=>({zoom:0,x:0,y:0,wrap:ie,fullyVisible:!1}),ae=[],Q=[];if(m.renderWorldCopies&&y.allowWorldCopies())for(let ie=1;ie<=3;ie++)ae.push(ee(-ie)),ae.push(ee(ie));for(ae.push(ee(0));ae.length>0;){const ie=ae.pop(),ce=ie.x,re=ie.y;let ge=ie.fullyVisible;const ke={x:ce,y:re,z:ie.zoom},Se=y.getTileBoundingVolume(ke,ie.wrap,m.elevation,t);if(!ge){const Ge=tn(s,Se,l);if(Ge===0)continue;ge=Ge===2}const Ee=y.distanceToTile2d(h.x,h.y,ke,Se);let Ce=P;b&&(Ce=(t.calculateTileZoom||rn)(m.zoom+c.at(m.tileSize/t.tileSize),Ee,X,H,m.fov)),Ce=(t.roundZoom?Math.round:Math.floor)(Ce),Ce=Math.max(0,Ce);const $e=Math.min(Ce,k);if(ie.wrap=y.getWrap(g,ke,ie.wrap),ie.zoom>=$e){if(ie.zoom<M)continue;const Ge=R-ie.zoom,Ne=B[0]-.5-(ce<<Ge),He=B[1]-.5-(re<<Ge),gt=t.reparseOverscaled?Math.max(ie.zoom,Ce):ie.zoom;Q.push({tileID:new c.a2(ie.zoom===k?gt:ie.zoom,ie.wrap,ie.zoom,ce,re),distanceSq:c.au([U[0]-.5-ce,U[1]-.5-re]),tileDistanceToCamera:Math.sqrt(Ne*Ne+He*He)})}else for(let Ge=0;Ge<4;Ge++)ae.push({zoom:ie.zoom+1,x:(ce<<1)+Ge%2,y:(re<<1)+(Ge>>1),wrap:ie.wrap,fullyVisible:ge})}return Q.sort((ie,ce)=>ie.distanceSq-ce.distanceSq).map(ie=>ie.tileID)}const $t=c.aa.fromPoints([new c.P(0,0),new c.P(c.a5,c.a5)]);function Lr(m){return m==="raster"||m==="image"||m==="video"}function xa(m,t,s,l,h,g,y){if(!t.hasData())return!1;const{tileID:b,fadingRole:P,fadingDirection:M,fadingParentID:k}=t;if(P===me.Base&&M===Ie.Incoming&&k)return s[k.key]=k,!0;const R=Math.max(b.overscaledZ-h,g);for(let D=b.overscaledZ-1;D>=R;D--){const B=b.scaledTo(D),U=m.getLoadedTile(B);if(U)return t.setCrossFadeLogic({fadingRole:me.Base,fadingDirection:Ie.Incoming,fadingParentID:U.tileID,fadeEndTime:l+y}),U.setCrossFadeLogic({fadingRole:me.Parent,fadingDirection:Ie.Departing,fadeEndTime:l+y}),s[B.key]=B,!0}return!1}function ba(m,t,s,l,h,g){if(!t.hasData())return!1;const y=t.tileID.children(h);let b=Ue(m,t,y,s,l,h,g);if(b)return!0;for(const P of y)Ue(m,t,P.children(h),s,l,h,g)&&(b=!0);return b}function Ue(m,t,s,l,h,g,y){if(s[0].overscaledZ>=g)return!1;let b=!1;for(const P of s){const M=m.getLoadedTile(P);if(!M)continue;const{fadingRole:k,fadingDirection:R,fadingParentID:D}=M;k===me.Base&&R===Ie.Departing&&D||(M.setCrossFadeLogic({fadingRole:me.Base,fadingDirection:Ie.Departing,fadingParentID:t.tileID,fadeEndTime:h+y}),t.setCrossFadeLogic({fadingRole:me.Parent,fadingDirection:Ie.Incoming,fadeEndTime:h+y})),l[P.key]=P,b=!0}return b}function _n(m,t,s,l){const h=m.tileID;return!!m.selfFading||!m.hasData()&&!!t.has(h)&&(m.setSelfFadeLogic(s+l),!0)}function yn(m,t){var s;m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let l=t.tileID.canonical.x-m.tileID.canonical.x;const h=t.tileID.canonical.y-m.tileID.canonical.y,g=Math.pow(2,m.tileID.canonical.z),y=t.tileID.key;l===0&&h===0||Math.abs(h)>1||(Math.abs(l)>1&&(Math.abs(l+g)===1?l+=g:Math.abs(l-g)===1&&(l-=g)),t.dem&&m.dem&&(m.dem.backfillBorder(t.dem,l,h),!((s=m.neighboringTiles)===null||s===void 0)&&s[y]&&(m.neighboringTiles[y].backfilled=!0)))}class Al{constructor(){this._tiles={}}handleWrapJump(t){const s={};for(const l in this._tiles){const h=this._tiles[l];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+t),s[h.tileID.key]=h}this._tiles=s}setFeatureState(t,s){for(const l in this._tiles)this._tiles[l].setFeatureState(t,s)}getAllTiles(){return Object.values(this._tiles)}getAllIds(t=!1){return t?Object.values(this._tiles).map(s=>s.tileID).sort(c.aw).map(s=>s.key):Object.keys(this._tiles)}getTileById(t){return this._tiles[t]}setTile(t,s){this._tiles[t]=s}deleteTileById(t){delete this._tiles[t]}getLoadedTile(t){const s=this.getTileById(t.key);return s!=null&&s.hasData()?s:null}isIdRenderable(t,s=!1){var l;return(l=this.getTileById(t))===null||l===void 0?void 0:l.isRenderable(s)}getRenderableIds(t=0,s){const l=[];for(const h of this.getAllIds())this.isIdRenderable(h,s)&&l.push(this.getTileById(h));return s?l.sort((h,g)=>{const y=h.tileID,b=g.tileID,P=new c.P(y.canonical.x,y.canonical.y)._rotate(-t),M=new c.P(b.canonical.x,b.canonical.y)._rotate(-t);return y.overscaledZ-b.overscaledZ||M.y-P.y||M.x-P.x}).map(h=>h.tileID.key):l.map(h=>h.tileID).sort(c.aw).map(h=>h.key)}}class Kn extends c.E{constructor(t,s,l){super(),this.id=t,this.dispatcher=l,this.on("data",h=>this._dataHandler(h)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((h,g,y,b)=>{const P=new(q(g.type))(h,g,y,b);if(P.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${P.id}`);return P})(t,s,l,this),this._inViewTiles=new Al,this._outOfViewCache=new c.ax(0,h=>this._unloadTile(h)),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new Fe,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){for(const s of this._inViewTiles.getAllTiles())s.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t),this._inViewTiles=new Al}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,s,l){return c._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,s,l)}catch(h){t.state="errored",h.status!==404?this._source.fire(new c.k(h,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new c.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const s of this._inViewTiles.getAllTiles())s.upload(t),s.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(t){var s;return this._inViewTiles.getRenderableIds((s=this.transform)===null||s===void 0?void 0:s.bearingInRadians,t)}hasRenderableParent(t){const s=t.overscaledZ-1;if(s>=this._source.minzoom){const l=this.getLoadedTile(t.scaledTo(s));if(l)return this._inViewTiles.isIdRenderable(l.tileID.key)}return!1}reload(t,s=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const l of this._inViewTiles.getAllIds()){const h=this._inViewTiles.getTileById(l);s&&!this._source.shouldReloadTile(h,s)||(t?this._reloadTile(l,"expired"):h.state!=="errored"&&this._reloadTile(l,"reloading"))}}}_reloadTile(t,s){return c._(this,void 0,void 0,function*(){const l=this._inViewTiles.getTileById(t);l&&(l.state!=="loading"&&(l.state=s),yield this._loadTile(l,t,s))})}_tileLoaded(t,s,l){t.timeAdded=_e(),t.selfFading&&(t.fadeEndTime=t.timeAdded+this._rasterFadeDuration),l==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this.getSource().type==="raster-dem"&&t.dem&&function(h,g){var y,b;const P=g.getRenderableIds();for(const M of P){if(!h.neighboringTiles||!h.neighboringTiles[M])continue;const k=g.getTileById(M);h.neighboringTiles[M].backfilled||yn(h,k),!((b=(y=k.neighboringTiles)===null||y===void 0?void 0:y[h.tileID.key])===null||b===void 0)&&b.backfilled||yn(k,h)}}(t,this._inViewTiles),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new c.l("data",{dataType:"source",tile:t,coord:t.tileID}))}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._inViewTiles.getTileById(t)}_retainLoadedChildren(t,s){const l=this._getLoadedDescendents(s),h=new Set;for(const g of s){const y=l[g.key];if(!(y!=null&&y.length)){h.add(g);continue}const b=g.overscaledZ+Kn.maxOverzooming,P=y.filter(R=>R.tileID.overscaledZ<=b);if(!P.length){h.add(g);continue}const M=Math.min(...P.map(R=>R.tileID.overscaledZ)),k=P.filter(R=>R.tileID.overscaledZ===M).map(R=>R.tileID);for(const R of k)t[R.key]=R;this._areDescendentsComplete(k,M,g.overscaledZ)||h.add(g)}return h}_getLoadedDescendents(t){var s;const l={};for(const h of this._inViewTiles.getAllTiles().filter(g=>g.hasData()))for(const g of t)h.tileID.isChildOf(g)&&(l[s=g.key]||(l[s]=[])).push(h);return l}_areDescendentsComplete(t,s,l){return t.length===1&&t[0].isOverscaled()?t[0].overscaledZ===s:Math.pow(4,s-l)===t.length}getLoadedTile(t){return this._inViewTiles.getLoadedTile(t)}updateCacheSize(t){const s=Math.ceil(t.width/this._source.tileSize)+1,l=Math.ceil(t.height/this._source.tileSize)+1,h=Math.floor(s*l*(this._maxTileCacheZoomLevels===null?c.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._outOfViewCache.setMaxSize(g)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);this._prevLng=t,s&&(this._inViewTiles.handleWrapJump(s),this._resetTileReloadTimers())}update(t,s){if(!this._sourceLoaded||this._paused)return;let l;this.transform=t,this.terrain=s,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?l=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(P=>new c.a2(P.canonical.z,P.wrap,P.canonical.z,P.canonical.x,P.canonical.y)):(l=pr(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?t.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(l=l.filter(P=>this._source.hasTile(P)))):l=[],this.usedForTerrain&&(l=this._addTerrainIdealTiles(l));const h=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,h&&this.fire(new c.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const g=Jt(t,this._source),y=this._updateRetainedTiles(l,g),b=Lr(this._source.type);b&&this._rasterFadeDuration>0&&!s&&function(P,M,k,R,D,B,U){const W=_e(),X=c.av(M);for(const H of M){const ee=P.getTileById(H.key);ee.fadingDirection!==Ie.Departing&&ee.fadeOpacity!==0||ee.resetFadeLogic(),xa(P,ee,k,W,R,D,U)||ba(P,ee,k,W,B,U)||_n(ee,X,W,U)||ee.resetFadeLogic()}}(this._inViewTiles,l,y,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),b?this._cleanUpRasterTiles(y):this._cleanUpVectorTiles(y)}_cleanUpRasterTiles(t){for(const s of this._inViewTiles.getAllIds())t[s]||this._removeTile(s)}_cleanUpVectorTiles(t){for(const s of this._inViewTiles.getAllIds()){const l=this._inViewTiles.getTileById(s);t[s]?l.clearSymbolFadeHold():l.hasSymbolBuckets?l.holdingForSymbolFade()?l.symbolFadeFinished()&&this._removeTile(s):l.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(s)}}_addTerrainIdealTiles(t){const s=[];for(const l of t)if(l.canonical.z>this._source.minzoom){const h=l.scaledTo(l.canonical.z-1);s.push(h);const g=l.scaledTo(Math.max(this._source.minzoom,Math.min(l.canonical.z,5)));s.push(g)}return t.concat(s)}releaseSymbolFadeTiles(){for(const t of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(t).holdingForSymbolFade()&&this._removeTile(t)}_updateRetainedTiles(t,s){var l;const h=new Set;for(const M of t)this._addTile(M).hasData()||h.add(M);const g=t.reduce((M,k)=>(M[k.key]=k,M),{}),y=this._retainLoadedChildren(g,h),b={},P=Math.max(s-Kn.maxUnderzooming,this._source.minzoom);for(const M of y){let k=this._inViewTiles.getTileById(M.key),R=k==null?void 0:k.wasRequested();for(let D=M.overscaledZ-1;D>=P;--D){const B=M.scaledTo(D);if(b[B.key])break;if(b[B.key]=!0,k=this.getTile(B),!k&&R&&(k=this._addTile(B)),k){const U=k.hasData();if((U||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||R)&&(g[B.key]=B),R=k.wasRequested(),U)break}}}return g}_addTile(t){let s=this._inViewTiles.getTileById(t.key);if(s)return s;s=this._outOfViewCache.getAndRemove(t),s&&(s.resetFadeLogic(),this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null));const l=s;return s||(s=new Ve(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(s,t.key,s.state)),s.uses++,this._inViewTiles.setTile(t.key,s),l||this._source.fire(new c.l("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){this._clearTileReloadTimer(t);const l=s.getExpiryTimeout();l&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},l))}_clearTileReloadTimer(t){const s=this._timers[t];s&&(clearTimeout(s),delete this._timers[t])}_resetTileReloadTimers(){for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t of this._inViewTiles.getAllIds()){const s=this._inViewTiles.getTileById(t);this._setTileReloadTimer(t,s)}}refreshTiles(t){for(const s of this._inViewTiles.getAllIds()){const l=this._inViewTiles.getTileById(s);(this._inViewTiles.isIdRenderable(s)||l.state=="errored")&&t.some(h=>h.equals(l.tileID.canonical))&&this._reloadTile(s,"expired")}}_removeTile(t){const s=this._inViewTiles.getTileById(t);s&&(s.uses--,this._inViewTiles.deleteTileById(t),this._clearTileReloadTimer(t),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._outOfViewCache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}_dataHandler(t){t.dataType==="source"&&(t.sourceDataType!=="metadata"?t.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(t.sourceDataChanged,t.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t of this._inViewTiles.getAllIds())this._removeTile(t);this._outOfViewCache.reset()}tilesIn(t,s,l){const h=[],g=this.transform;if(!g)return h;const y=g.getCoveringTilesDetailsProvider().allowWorldCopies(),b=l?g.getCameraQueryGeometry(t):t,P=B=>g.screenPointToMercatorCoordinate(B,this.terrain),M=this.transformBbox(t,P,!y),k=this.transformBbox(b,P,!y),R=this.getIds(),D=c.aa.fromPoints(k);for(let B=0;B<R.length;B++){const U=this._inViewTiles.getTileById(R[B]);if(U.holdingForSymbolFade())continue;const W=y?[U.tileID]:[U.tileID.unwrapTo(-1),U.tileID.unwrapTo(0)],X=Math.pow(2,g.zoom-U.tileID.overscaledZ),H=s*U.queryPadding*c.a5/U.tileSize/X;for(const ee of W){const ae=D.map(Q=>ee.getTilePoint(new c.a9(Q.x,Q.y)));if(ae.expandBy(H),ae.intersects($t)){const Q=M.map(ce=>ee.getTilePoint(ce)),ie=k.map(ce=>ee.getTilePoint(ce));h.push({tile:U,tileID:y?ee:ee.unwrapTo(0),queryGeometry:Q,cameraQueryGeometry:ie,scale:X})}}}return h}transformBbox(t,s,l){let h=t.map(s);if(l){const g=c.aa.fromPoints(t);g.shrinkBy(.001*Math.min(g.width(),g.height()));const y=g.map(s);c.aa.fromPoints(h).covers(y)||(h=h.map(b=>b.x>.5?new c.a9(b.x-1,b.y,b.z):b))}return h}getVisibleCoordinates(t){const s=this.getRenderableIds(t).map(l=>this._inViewTiles.getTileById(l).tileID);return this.transform&&this.transform.populateCache(s),s}hasTransition(){return!!this._source.hasTransition()||!(!Lr(this._source.type)||!function(t,s){if(s<=0)return!1;const l=_e();for(const h of t.getAllTiles())if(h.fadeEndTime>=l)return!0;return!1}(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(t){this._rasterFadeDuration=t}setFeatureState(t,s,l){this._state.updateState(t=t||c.ai,s,l)}removeFeatureState(t,s,l){this._state.removeFeatureState(t=t||c.ai,s,l)}getFeatureState(t,s){return this._state.getState(t=t||c.ai,s)}setDependencies(t,s,l){const h=this._inViewTiles.getTileById(t);h&&h.setDependencies(s,l)}reloadTilesForDependencies(t,s){for(const l of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(l).hasDependency(t,s)&&this._reloadTile(l,"reloading");this._outOfViewCache.filter(l=>!l.hasDependency(t,s))}areTilesLoaded(){for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}}Kn.maxUnderzooming=10,Kn.maxOverzooming=3;class Qe{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=c.an(t,0,1);let s=1,l=this._distances[s];const h=t*this.paddedLength+this.padding;for(;l<h&&s<this._distances.length;)l=this._distances[++s];const g=s-1,y=this._distances[g],b=l-y,P=b>0?(h-y)/b:0;return this.points[g].mult(1-P).add(this.points[s].mult(P))}}function wt(m,t){let s=!0;return m==="always"||m!=="never"&&t!=="never"||(s=!1),s}class Tt{constructor(t,s,l){const h=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(t/l),this.yCellCount=Math.ceil(s/l);for(let y=0;y<this.xCellCount*this.yCellCount;y++)h.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,l,h,g){this._forEachCell(s,l,h,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(g)}insertCircle(t,s,l,h){this._forEachCell(s-h,l-h,s+h,l+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(l),this.circles.push(h)}_insertBoxCell(t,s,l,h,g,y){this.boxCells[g].push(y)}_insertCircleCell(t,s,l,h,g,y){this.circleCells[g].push(y)}_query(t,s,l,h,g,y,b){if(l<0||t>this.width||h<0||s>this.height)return[];const P=[];if(t<=0&&s<=0&&this.width<=l&&this.height<=h){if(g)return[{key:null,x1:t,y1:s,x2:l,y2:h}];for(let M=0;M<this.boxKeys.length;M++)P.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const k=this.circles[3*M],R=this.circles[3*M+1],D=this.circles[3*M+2];P.push({key:this.circleKeys[M],x1:k-D,y1:R-D,x2:k+D,y2:R+D})}}else this._forEachCell(t,s,l,h,this._queryCell,P,{hitTest:g,overlapMode:y,seenUids:{box:{},circle:{}}},b);return P}query(t,s,l,h){return this._query(t,s,l,h,!1,null)}hitTest(t,s,l,h,g,y){return this._query(t,s,l,h,!0,g,y).length>0}hitTestCircle(t,s,l,h,g){const y=t-l,b=t+l,P=s-l,M=s+l;if(b<0||y>this.width||M<0||P>this.height)return!1;const k=[];return this._forEachCell(y,P,b,M,this._queryCellCircle,k,{hitTest:!0,overlapMode:h,circle:{x:t,y:s,radius:l},seenUids:{box:{},circle:{}}},g),k.length>0}_queryCell(t,s,l,h,g,y,b,P){const{seenUids:M,hitTest:k,overlapMode:R}=b,D=this.boxCells[g];if(D!==null){const U=this.bboxes;for(const W of D)if(!M.box[W]){M.box[W]=!0;const X=4*W,H=this.boxKeys[W];if(t<=U[X+2]&&s<=U[X+3]&&l>=U[X+0]&&h>=U[X+1]&&(!P||P(H))&&(!k||!wt(R,H.overlapMode))&&(y.push({key:H,x1:U[X],y1:U[X+1],x2:U[X+2],y2:U[X+3]}),k))return!0}}const B=this.circleCells[g];if(B!==null){const U=this.circles;for(const W of B)if(!M.circle[W]){M.circle[W]=!0;const X=3*W,H=this.circleKeys[W];if(this._circleAndRectCollide(U[X],U[X+1],U[X+2],t,s,l,h)&&(!P||P(H))&&(!k||!wt(R,H.overlapMode))){const ee=U[X],ae=U[X+1],Q=U[X+2];if(y.push({key:H,x1:ee-Q,y1:ae-Q,x2:ee+Q,y2:ae+Q}),k)return!0}}}return!1}_queryCellCircle(t,s,l,h,g,y,b,P){const{circle:M,seenUids:k,overlapMode:R}=b,D=this.boxCells[g];if(D!==null){const U=this.bboxes;for(const W of D)if(!k.box[W]){k.box[W]=!0;const X=4*W,H=this.boxKeys[W];if(this._circleAndRectCollide(M.x,M.y,M.radius,U[X+0],U[X+1],U[X+2],U[X+3])&&(!P||P(H))&&!wt(R,H.overlapMode))return y.push(!0),!0}}const B=this.circleCells[g];if(B!==null){const U=this.circles;for(const W of B)if(!k.circle[W]){k.circle[W]=!0;const X=3*W,H=this.circleKeys[W];if(this._circlesCollide(U[X],U[X+1],U[X+2],M.x,M.y,M.radius)&&(!P||P(H))&&!wt(R,H.overlapMode))return y.push(!0),!0}}}_forEachCell(t,s,l,h,g,y,b,P){const M=this._convertToXCellCoord(t),k=this._convertToYCellCoord(s),R=this._convertToXCellCoord(l),D=this._convertToYCellCoord(h);for(let B=M;B<=R;B++)for(let U=k;U<=D;U++)if(g.call(this,t,s,l,h,this.xCellCount*U+B,y,b,P))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,l,h,g,y){const b=h-t,P=g-s,M=l+y;return M*M>b*b+P*P}_circleAndRectCollide(t,s,l,h,g,y,b){const P=(y-h)/2,M=Math.abs(t-(h+P));if(M>P+l)return!1;const k=(b-g)/2,R=Math.abs(s-(g+k));if(R>k+l)return!1;if(M<=P||R<=k)return!0;const D=M-P,B=R-k;return D*D+B*B<=l*l}}function Nn(m,t,s){const l=c.N();if(!m){const{vecSouth:R,vecEast:D}=qi(t),B=K();B[0]=D[0],B[1]=D[1],B[2]=R[0],B[3]=R[1],h=B,(k=(y=(g=B)[0])*(M=g[3])-(P=g[2])*(b=g[1]))&&(h[0]=M*(k=1/k),h[1]=-b*k,h[2]=-P*k,h[3]=y*k),l[0]=B[0],l[1]=B[1],l[4]=B[2],l[5]=B[3]}var h,g,y,b,P,M,k;return c.Q(l,l,[1/s,1/s,1]),l}function zl(m,t,s,l){if(m){const h=c.N();if(!t){const{vecSouth:g,vecEast:y}=qi(s);h[0]=y[0],h[1]=y[1],h[4]=g[0],h[5]=g[1]}return c.Q(h,h,[l,l,1]),h}return s.pixelsToClipSpaceMatrix}function qi(m){const t=Math.cos(m.rollInRadians),s=Math.sin(m.rollInRadians),l=Math.cos(m.pitchInRadians),h=Math.cos(m.bearingInRadians),g=Math.sin(m.bearingInRadians),y=c.aC();y[0]=-h*l*s-g*t,y[1]=-g*l*s+h*t;const b=c.aD(y);b<1e-9?c.aE(y):c.aF(y,y,1/b);const P=c.aC();P[0]=h*l*t-g*s,P[1]=g*l*t+h*s;const M=c.aD(P);return M<1e-9?c.aE(P):c.aF(P,P,1/M),{vecEast:P,vecSouth:y}}function xt(m,t,s,l){let h;l?(h=[m,t,l(m,t),1],c.aH(h,h,s)):(h=[m,t,0,1],Ll(h,h,s));const g=h[3];return{point:new c.P(h[0]/g,h[1]/g),signedDistanceFromCamera:g,isOccluded:!1}}function wa(m,t){return .5+m/t*.5}function Ta(m,t){return m.x>=-t[0]&&m.x<=t[0]&&m.y>=-t[1]&&m.y<=t[1]}function Dl(m,t,s,l,h,g,y,b,P,M,k,R,D){const B=s?m.textSizeData:m.iconSizeData,U=c.ay(B,t.transform.zoom),W=[256/t.width*2+1,256/t.height*2+1],X=s?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;X.clear();const H=m.lineVertexArray,ee=s?m.text.placedSymbolArray:m.icon.placedSymbolArray,ae=t.transform.width/t.transform.height;let Q=!1;for(let ie=0;ie<ee.length;ie++){const ce=ee.get(ie);if(ce.hidden||ce.writingMode===c.az.vertical&&!Q){Rs(ce.numGlyphs,X);continue}Q=!1;const re=new c.P(ce.anchorX,ce.anchorY),ge={getElevation:D,pitchedLabelPlaneMatrix:l,lineVertexArray:H,pitchWithMap:g,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:re,unwrappedTileID:P,width:M,height:k,translation:R},ke=wo(ce.anchorX,ce.anchorY,ge);if(!Ta(ke.point,W)){Rs(ce.numGlyphs,X);continue}const Se=wa(t.transform.cameraToCenterDistance,ke.signedDistanceFromCamera),Ee=c.aA(B,U,ce),Ce=g?Ee*t.transform.getPitchedTextCorrection(ce.anchorX,ce.anchorY,P)/Se:Ee*Se,$e=bo({projectionContext:ge,pitchedLabelPlaneMatrixInverse:h,symbol:ce,fontSize:Ce,flip:!1,keepUpright:y,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:X,aspectRatio:ae,rotateToLine:b});Q=$e.useVertical,($e.notEnoughRoom||Q||$e.needsFlipping&&bo({projectionContext:ge,pitchedLabelPlaneMatrixInverse:h,symbol:ce,fontSize:Ce,flip:!0,keepUpright:y,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:X,aspectRatio:ae,rotateToLine:b}).notEnoughRoom)&&Rs(ce.numGlyphs,X)}s?m.text.dynamicLayoutVertexBuffer.updateData(X):m.icon.dynamicLayoutVertexBuffer.updateData(X)}function xo(m,t,s,l,h,g,y,b){const P=g.glyphStartIndex+g.numGlyphs,M=g.lineStartIndex,k=g.lineStartIndex+g.lineLength,R=t.getoffsetX(g.glyphStartIndex),D=t.getoffsetX(P-1),B=di(m*R,s,l,h,g.segment,M,k,b,y);if(!B)return null;const U=di(m*D,s,l,h,g.segment,M,k,b,y);return U?b.projectionCache.anyProjectionOccluded?null:{first:B,last:U}:null}function Sa(m,t,s,l){return m===c.az.horizontal&&Math.abs(s.y-t.y)>Math.abs(s.x-t.x)*l?{useVertical:!0}:(m===c.az.vertical?t.y<s.y:t.x>s.x)?{needsFlipping:!0}:null}function bo(m){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:s,symbol:l,fontSize:h,flip:g,keepUpright:y,glyphOffsetArray:b,dynamicLayoutVertexArray:P,aspectRatio:M,rotateToLine:k}=m,R=h/24,D=l.lineOffsetX*R,B=l.lineOffsetY*R;let U;if(l.numGlyphs>1){const W=l.glyphStartIndex+l.numGlyphs,X=l.lineStartIndex,H=l.lineStartIndex+l.lineLength,ee=xo(R,b,D,B,g,l,k,t);if(!ee)return{notEnoughRoom:!0};const ae=Rl(ee.first.point.x,ee.first.point.y,t,s),Q=Rl(ee.last.point.x,ee.last.point.y,t,s);if(y&&!g){const ie=Sa(l.writingMode,ae,Q,M);if(ie)return ie}U=[ee.first];for(let ie=l.glyphStartIndex+1;ie<W-1;ie++){const ce=di(R*b.getoffsetX(ie),D,B,g,l.segment,X,H,t,k);if(!ce)return{notEnoughRoom:!0};U.push(ce)}U.push(ee.last)}else{if(y&&!g){const X=Nt(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,H=l.lineStartIndex+l.segment+1,ee=new c.P(t.lineVertexArray.getx(H),t.lineVertexArray.gety(H)),ae=Nt(ee.x,ee.y,t),Q=ae.signedDistanceFromCamera>0?ae.point:Pa(t.tileAnchorPoint,ee,X,1,t),ie=Rl(X.x,X.y,t,s),ce=Rl(Q.x,Q.y,t,s),re=Sa(l.writingMode,ie,ce,M);if(re)return re}const W=di(R*b.getoffsetX(l.glyphStartIndex),D,B,g,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,t,k);if(!W||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};U=[W]}for(const W of U)c.aG(P,W.point,W.angle);return{}}function Pa(m,t,s,l,h){const g=m.add(m.sub(t)._unit()),y=Nt(g.x,g.y,h).point,b=s.sub(y);return s.add(b._mult(l/b.mag()))}function vn(m,t,s){const l=t.projectionCache;if(l.projections[m])return l.projections[m];const h=new c.P(t.lineVertexArray.getx(m),t.lineVertexArray.gety(m)),g=Nt(h.x,h.y,t);if(g.signedDistanceFromCamera>0)return l.projections[m]=g.point,l.anyProjectionOccluded=l.anyProjectionOccluded||g.isOccluded,g.point;const y=m-s.direction;return Pa(s.distanceFromAnchor===0?t.tileAnchorPoint:new c.P(t.lineVertexArray.getx(y),t.lineVertexArray.gety(y)),h,s.previousVertex,s.absOffsetX-s.distanceFromAnchor+1,t)}function Nt(m,t,s){const l=m+s.translation[0],h=t+s.translation[1];let g;return s.pitchWithMap?(g=xt(l,h,s.pitchedLabelPlaneMatrix,s.getElevation),g.isOccluded=!1):(g=s.transform.projectTileCoordinates(l,h,s.unwrappedTileID,s.getElevation),g.point.x=(.5*g.point.x+.5)*s.width,g.point.y=(.5*-g.point.y+.5)*s.height),g}function Rl(m,t,s,l){if(s.pitchWithMap){const h=[m,t,0,1];return c.aH(h,h,l),s.transform.projectTileCoordinates(h[0]/h[3],h[1]/h[3],s.unwrappedTileID,s.getElevation).point}return{x:m/s.width*2-1,y:1-t/s.height*2}}function wo(m,t,s){return s.transform.projectTileCoordinates(m,t,s.unwrappedTileID,s.getElevation)}function Ea(m,t,s){return m._unit()._perp()._mult(t*s)}function Ds(m,t,s,l,h,g,y,b,P){if(b.projectionCache.offsets[m])return b.projectionCache.offsets[m];const M=s.add(t);if(m+P.direction<l||m+P.direction>=h)return b.projectionCache.offsets[m]=M,M;const k=vn(m+P.direction,b,P),R=Ea(k.sub(s),y,P.direction),D=s.add(R),B=k.add(R);return b.projectionCache.offsets[m]=c.aI(g,M,D,B)||M,b.projectionCache.offsets[m]}function di(m,t,s,l,h,g,y,b,P){const M=l?m-t:m+t;let k=M>0?1:-1,R=0;l&&(k*=-1,R=Math.PI),k<0&&(R+=Math.PI);let D,B=k>0?g+h:g+h+1;b.projectionCache.cachedAnchorPoint?D=b.projectionCache.cachedAnchorPoint:(D=Nt(b.tileAnchorPoint.x,b.tileAnchorPoint.y,b).point,b.projectionCache.cachedAnchorPoint=D);let U,W,X=D,H=D,ee=0,ae=0;const Q=Math.abs(M),ie=[];let ce;for(;ee+ae<=Q;){if(B+=k,B<g||B>=y)return null;ee+=ae,H=X,W=U;const ke={absOffsetX:Q,direction:k,distanceFromAnchor:ee,previousVertex:H};if(X=vn(B,b,ke),s===0)ie.push(H),ce=X.sub(H);else{let Se;const Ee=X.sub(H);Se=Ee.mag()===0?Ea(vn(B+k,b,ke).sub(X),s,k):Ea(Ee,s,k),W||(W=H.add(Se)),U=Ds(B,Se,X,g,y,W,s,b,ke),ie.push(W),ce=U.sub(W)}ae=ce.mag()}const re=ce._mult((Q-ee)/ae)._add(W||H),ge=R+Math.atan2(X.y-H.y,X.x-H.x);return ie.push(re),{point:re,angle:P?ge:0,path:ie}}const Cd=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Rs(m,t){for(let s=0;s<m;s++){const l=t.length;t.resize(l+4),t.float32.set(Cd,3*l)}}function Ll(m,t,s){const l=t[0],h=t[1];return m[0]=s[0]*l+s[4]*h+s[12],m[1]=s[1]*l+s[5]*h+s[13],m[3]=s[3]*l+s[7]*h+s[15],m}const fr=100;class Md{constructor(t,s=new Tt(t.width+200,t.height+200,25),l=new Tt(t.width+200,t.height+200,25)){this.transform=t,this.grid=s,this.ignoredGrid=l,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+fr,this.screenBottomBoundary=t.height+fr,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,s,l,h,g,y,b,P,M,k,R,D){const B=this.projectAndGetPerspectiveRatio(t.anchorPointX+P[0],t.anchorPointY+P[1],g,k,D),U=l*B.perspectiveRatio;let W;if(y||b)W=this._projectCollisionBox(t,U,h,g,y,b,P,B,k,R,D);else{const ce=B.x+(R?R.x*U:0),re=B.y+(R?R.y*U:0);W={allPointsOccluded:!1,box:[ce+t.x1*U,re+t.y1*U,ce+t.x2*U,re+t.y2*U]}}const[X,H,ee,ae]=W.box,Q=y?W.allPointsOccluded:B.isOccluded;let ie=Q;return ie||(ie=B.perspectiveRatio<this.perspectiveRatioCutoff),ie||(ie=!this.isInsideGrid(X,H,ee,ae)),ie||s!=="always"&&this.grid.hitTest(X,H,ee,ae,s,M)?{box:[X,H,ee,ae],placeable:!1,offscreen:!1,occluded:Q}:{box:[X,H,ee,ae],placeable:!0,offscreen:this.isOffscreen(X,H,ee,ae),occluded:Q}}placeCollisionCircles(t,s,l,h,g,y,b,P,M,k,R,D,B,U){const W=[],X=new c.P(s.anchorX,s.anchorY),H=this.getPerspectiveRatio(X.x,X.y,y,U),ee=(M?g*this.transform.getPitchedTextCorrection(s.anchorX,s.anchorY,y)/H:g*H)/c.aM,ae={getElevation:U,pitchedLabelPlaneMatrix:b,lineVertexArray:l,pitchWithMap:M,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:X,unwrappedTileID:y,width:this.transform.width,height:this.transform.height,translation:B},Q=xo(ee,h,s.lineOffsetX*ee,s.lineOffsetY*ee,!1,s,!1,ae);let ie=!1,ce=!1,re=!0;if(Q){const ge=.5*R*H+D,ke=new c.P(-100,-100),Se=new c.P(this.screenRightBoundary,this.screenBottomBoundary),Ee=new Qe,Ce=Q.first,$e=Q.last;let Ge=[];for(let gt=Ce.path.length-1;gt>=1;gt--)Ge.push(Ce.path[gt]);for(let gt=1;gt<$e.path.length;gt++)Ge.push($e.path[gt]);const Ne=2.5*ge;if(M){const gt=this.projectPathToScreenSpace(Ge,ae);Ge=gt.some(Ft=>Ft.signedDistanceFromCamera<=0)?[]:gt.map(Ft=>Ft.point)}let He=[];if(Ge.length>0){const gt=Ge[0].clone(),Ft=Ge[0].clone();for(let er=1;er<Ge.length;er++)gt.x=Math.min(gt.x,Ge[er].x),gt.y=Math.min(gt.y,Ge[er].y),Ft.x=Math.max(Ft.x,Ge[er].x),Ft.y=Math.max(Ft.y,Ge[er].y);He=gt.x>=ke.x&&Ft.x<=Se.x&&gt.y>=ke.y&&Ft.y<=Se.y?[Ge]:Ft.x<ke.x||gt.x>Se.x||Ft.y<ke.y||gt.y>Se.y?[]:c.aJ([Ge],ke.x,ke.y,Se.x,Se.y)}for(const gt of He){Ee.reset(gt,.25*ge);let Ft=0;Ft=Ee.length<=.5*ge?1:Math.ceil(Ee.paddedLength/Ne)+1;for(let er=0;er<Ft;er++){const Zt=er/Math.max(Ft-1,1),ir=Ee.lerp(Zt),Wt=ir.x+fr,gr=ir.y+fr;W.push(Wt,gr,ge,0);const sr=Wt-ge,Wr=gr-ge,Mr=Wt+ge,Pr=gr+ge;if(re=re&&this.isOffscreen(sr,Wr,Mr,Pr),ce=ce||this.isInsideGrid(sr,Wr,Mr,Pr),t!=="always"&&this.grid.hitTestCircle(Wt,gr,ge,t,k)&&(ie=!0,!P))return{circles:[],offscreen:!1,collisionDetected:ie}}}}return{circles:!P&&ie||!ce||H<this.perspectiveRatioCutoff?[]:W,offscreen:re,collisionDetected:ie}}projectPathToScreenSpace(t,s){const l=function(h,g){const y=c.N();return c.aB(y,g.pitchedLabelPlaneMatrix),h.map(b=>{const P=xt(b.x,b.y,y,g.getElevation),M=g.transform.projectTileCoordinates(P.point.x,P.point.y,g.unwrappedTileID,g.getElevation);return M.point.x=(.5*M.point.x+.5)*g.width,M.point.y=(.5*-M.point.y+.5)*g.height,M})}(t,s);return function(h){let g=0,y=0,b=0,P=0;for(let M=0;M<h.length;M++)h[M].isOccluded?(b=M+1,P=0):(P++,P>y&&(y=P,g=b));return h.slice(g,g+y)}(l)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[],l=new c.aa;for(const R of t){const D=new c.P(R.x+fr,R.y+fr);l.extend(D),s.push(D)}const{minX:h,minY:g,maxX:y,maxY:b}=l,P=this.grid.query(h,g,y,b).concat(this.ignoredGrid.query(h,g,y,b)),M={},k={};for(const R of P){const D=R.key;if(M[D.bucketInstanceId]===void 0&&(M[D.bucketInstanceId]={}),M[D.bucketInstanceId][D.featureIndex])continue;const B=[new c.P(R.x1,R.y1),new c.P(R.x2,R.y1),new c.P(R.x2,R.y2),new c.P(R.x1,R.y2)];c.aK(s,B)&&(M[D.bucketInstanceId][D.featureIndex]=!0,k[D.bucketInstanceId]===void 0&&(k[D.bucketInstanceId]=[]),k[D.bucketInstanceId].push(D.featureIndex))}return k}insertCollisionBox(t,s,l,h,g,y){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:g,collisionGroupID:y,overlapMode:s},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,l,h,g,y){const b=l?this.ignoredGrid:this.grid,P={bucketInstanceId:h,featureIndex:g,collisionGroupID:y,overlapMode:s};for(let M=0;M<t.length;M+=4)b.insertCircle(P,t[M],t[M+1],t[M+2])}projectAndGetPerspectiveRatio(t,s,l,h,g){if(g){let y;h?(y=[t,s,h(t,s),1],c.aH(y,y,g)):(y=[t,s,0,1],Ll(y,y,g));const b=y[3];return{x:(y[0]/b+1)/2*this.transform.width+fr,y:(-y[1]/b+1)/2*this.transform.height+fr,perspectiveRatio:.5+this.transform.cameraToCenterDistance/b*.5,isOccluded:!1,signedDistanceFromCamera:b}}{const y=this.transform.projectTileCoordinates(t,s,l,h);return{x:(y.point.x+1)/2*this.transform.width+fr,y:(1-y.point.y)/2*this.transform.height+fr,perspectiveRatio:.5+this.transform.cameraToCenterDistance/y.signedDistanceFromCamera*.5,isOccluded:y.isOccluded,signedDistanceFromCamera:y.signedDistanceFromCamera}}}getPerspectiveRatio(t,s,l,h){const g=this.transform.projectTileCoordinates(t,s,l,h);return .5+this.transform.cameraToCenterDistance/g.signedDistanceFromCamera*.5}isOffscreen(t,s,l,h){return l<fr||t>=this.screenRightBoundary||h<fr||s>this.screenBottomBoundary}isInsideGrid(t,s,l,h){return l>=0&&t<this.gridRightBoundary&&h>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=c.ar([]);return c.O(t,t,[-100,-100,0]),t}_projectCollisionBox(t,s,l,h,g,y,b,P,M,k,R){let D=1,B=0,U=0,W=1;const X=t.anchorPointX+b[0],H=t.anchorPointY+b[1];if(y&&!g){const Ge=this.projectAndGetPerspectiveRatio(X+1,H,h,M,R),Ne=Ge.x-P.x,He=Math.atan((Ge.y-P.y)/Ne)+(Ne<0?Math.PI:0),gt=Math.sin(He),Ft=Math.cos(He);D=Ft,B=gt,U=-gt,W=Ft}else if(!y&&g){const Ge=qi(this.transform);D=Ge.vecEast[0],B=Ge.vecEast[1],U=Ge.vecSouth[0],W=Ge.vecSouth[1]}let ee=P.x,ae=P.y,Q=s;g&&(ee=X,ae=H,Q=Math.pow(2,-(this.transform.zoom-l.overscaledZ)),Q*=this.transform.getPitchedTextCorrection(X,H,h),k||(Q*=c.an(.5+P.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),k&&(ee+=D*k.x*Q+U*k.y*Q,ae+=B*k.x*Q+W*k.y*Q);const ie=t.x1*Q,ce=t.x2*Q,re=(ie+ce)/2,ge=t.y1*Q,ke=t.y2*Q,Se=(ge+ke)/2,Ee=[{offsetX:ie,offsetY:ge},{offsetX:re,offsetY:ge},{offsetX:ce,offsetY:ge},{offsetX:ce,offsetY:Se},{offsetX:ce,offsetY:ke},{offsetX:re,offsetY:ke},{offsetX:ie,offsetY:ke},{offsetX:ie,offsetY:Se}];let Ce=[];for(const{offsetX:Ge,offsetY:Ne}of Ee)Ce.push(new c.P(ee+D*Ge+U*Ne,ae+B*Ge+W*Ne));let $e=!1;if(g){const Ge=Ce.map(Ne=>this.projectAndGetPerspectiveRatio(Ne.x,Ne.y,h,M,R));$e=Ge.some(Ne=>!Ne.isOccluded),Ce=Ge.map(Ne=>new c.P(Ne.x,Ne.y))}else $e=!0;return{box:c.aL(Ce),allPointsOccluded:!$e}}}class Id{constructor(t,s,l,h){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):h&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class Ca{constructor(t,s,l,h,g){this.text=new Id(t?t.text:null,s,l,g),this.icon=new Id(t?t.icon:null,s,h,g)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class kd{constructor(t,s,l){this.text=t,this.icon=s,this.skipFade=l}}class Ad{constructor(t,s,l,h,g){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=l,this.bucketIndex=h,this.tileID=g}}class zd{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:l=>l.collisionGroupID===s}}return this.collisionGroups[t]}}function Fl(m,t,s,l,h){const{horizontalAlign:g,verticalAlign:y}=c.aS(m);return new c.P(-(g-.5)*t+l[0]*h,-(y-.5)*s+l[1]*h)}class mc{constructor(t,s,l,h,g){this.transform=t.clone(),this.terrain=s,this.collisionIndex=new Md(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new zd(h),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const s=this.terrain;return s?(l,h)=>s.getElevation(t,l,h):null}getBucketParts(t,s,l,h){const g=l.getBucket(s),y=l.latestFeatureIndex;if(!g||!y||s.id!==g.layerIds[0])return;const b=l.collisionBoxArray,P=g.layers[0].layout,M=g.layers[0].paint,k=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),R=l.tileSize/c.a5,D=l.tileID.toUnwrapped(),B=P.get("text-rotation-alignment")==="map",U=c.aN(l,1,this.transform.zoom),W=c.aO(this.collisionIndex.transform,l,M.get("text-translate"),M.get("text-translate-anchor")),X=c.aO(this.collisionIndex.transform,l,M.get("icon-translate"),M.get("icon-translate-anchor")),H=Nn(B,this.transform,U);this.retainedQueryData[g.bucketInstanceId]=new Ad(g.bucketInstanceId,y,g.sourceLayerIndex,g.index,l.tileID);const ee={bucket:g,layout:P,translationText:W,translationIcon:X,unwrappedTileID:D,pitchedLabelPlaneMatrix:H,scale:k,textPixelRatio:R,holdingForFade:l.holdingForSymbolFade(),collisionBoxArray:b,partiallyEvaluatedTextSize:c.ay(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(h)for(const ae of g.sortKeyRanges){const{sortKey:Q,symbolInstanceStart:ie,symbolInstanceEnd:ce}=ae;t.push({sortKey:Q,symbolInstanceStart:ie,symbolInstanceEnd:ce,parameters:ee})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:ee})}attemptAnchorPlacement(t,s,l,h,g,y,b,P,M,k,R,D,B,U,W,X,H,ee,ae,Q){const ie=c.aP[t.textAnchor],ce=[t.textOffset0,t.textOffset1],re=Fl(ie,l,h,ce,g),ge=this.collisionIndex.placeCollisionBox(s,D,P,M,k,b,y,X,R.predicate,ae,re,Q);if((!ee||this.collisionIndex.placeCollisionBox(ee,D,P,M,k,b,y,H,R.predicate,ae,re,Q).placeable)&&ge.placeable){let ke;if(this.prevPlacement&&this.prevPlacement.variableOffsets[B.crossTileID]&&this.prevPlacement.placements[B.crossTileID]&&this.prevPlacement.placements[B.crossTileID].text&&(ke=this.prevPlacement.variableOffsets[B.crossTileID].anchor),B.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[B.crossTileID]={textOffset:ce,width:l,height:h,anchor:ie,textBoxScale:g,prevAnchor:ke},this.markUsedJustification(U,ie,B,W),U.allowVerticalPlacement&&(this.markUsedOrientation(U,W,B),this.placedOrientations[B.crossTileID]=W),{shift:re,placedGlyphBoxes:ge}}}placeLayerBucketPart(t,s,l){const{bucket:h,layout:g,translationText:y,translationIcon:b,unwrappedTileID:P,pitchedLabelPlaneMatrix:M,textPixelRatio:k,holdingForFade:R,collisionBoxArray:D,partiallyEvaluatedTextSize:B,collisionGroup:U}=t.parameters,W=g.get("text-optional"),X=g.get("icon-optional"),H=c.aQ(g,"text-overlap","text-allow-overlap"),ee=H==="always",ae=c.aQ(g,"icon-overlap","icon-allow-overlap"),Q=ae==="always",ie=g.get("text-rotation-alignment")==="map",ce=g.get("text-pitch-alignment")==="map",re=g.get("icon-text-fit")!=="none",ge=g.get("symbol-z-order")==="viewport-y",ke=ee&&(Q||!h.hasIconData()||X),Se=Q&&(ee||!h.hasTextData()||W);!h.collisionArrays&&D&&h.deserializeCollisionBoxes(D);const Ee=this.retainedQueryData[h.bucketInstanceId].tileID,Ce=this._getTerrainElevationFunc(Ee),$e=this.transform.getFastPathSimpleProjectionMatrix(Ee),Ge=(Ne,He,gt)=>{var Ft,er;if(s[Ne.crossTileID])return;if(R)return void(this.placements[Ne.crossTileID]=new kd(!1,!1,!1));let Zt=!1,ir=!1,Wt=!0,gr=null,sr={box:null,placeable:!1,offscreen:null,occluded:!1},Wr={placeable:!1},Mr=null,Pr=null,nn=null,xs=0,Hi=0,Di=0;He.textFeatureIndex?xs=He.textFeatureIndex:Ne.useRuntimeCollisionCircles&&(xs=Ne.featureIndex),He.verticalTextFeatureIndex&&(Hi=He.verticalTextFeatureIndex);const zn=He.textBox;if(zn){const ri=Xt=>{let Ht=c.az.horizontal;if(h.allowVerticalPlacement&&!Xt&&this.prevPlacement){const Ur=this.prevPlacement.placedOrientations[Ne.crossTileID];Ur&&(this.placedOrientations[Ne.crossTileID]=Ur,Ht=Ur,this.markUsedOrientation(h,Ht,Ne))}return Ht},Ri=(Xt,Ht)=>{if(h.allowVerticalPlacement&&Ne.numVerticalGlyphVertices>0&&He.verticalTextBox){for(const Ur of h.writingModes)if(Ur===c.az.vertical?(sr=Ht(),Wr=sr):sr=Xt(),sr&&sr.placeable)break}else sr=Xt()},yi=Ne.textAnchorOffsetStartIndex,vi=Ne.textAnchorOffsetEndIndex;if(vi===yi){const Xt=(Ht,Ur)=>{const $r=this.collisionIndex.placeCollisionBox(Ht,H,k,Ee,P,ce,ie,y,U.predicate,Ce,void 0,$e);return $r&&$r.placeable&&(this.markUsedOrientation(h,Ur,Ne),this.placedOrientations[Ne.crossTileID]=Ur),$r};Ri(()=>Xt(zn,c.az.horizontal),()=>{const Ht=He.verticalTextBox;return h.allowVerticalPlacement&&Ne.numVerticalGlyphVertices>0&&Ht?Xt(Ht,c.az.vertical):{box:null,offscreen:null}}),ri(sr&&sr.placeable)}else{let Xt=c.aP[(er=(Ft=this.prevPlacement)===null||Ft===void 0?void 0:Ft.variableOffsets[Ne.crossTileID])===null||er===void 0?void 0:er.anchor];const Ht=($r,Cp,Mp)=>{const Qs=$r.x2-$r.x1,Km=$r.y2-$r.y1,Ip=Ne.textBoxScale,uh=re&&ae==="never"?Cp:null;let bs=null,ws=H==="never"?1:2,Ts="never";Xt&&ws++;for(let ch=0;ch<ws;ch++){for(let hh=yi;hh<vi;hh++){const vu=h.textAnchorOffsets.get(hh);if(Xt&&vu.textAnchor!==Xt)continue;const xu=this.attemptAnchorPlacement(vu,$r,Qs,Km,Ip,ie,ce,k,Ee,P,U,Ts,Ne,h,Mp,y,b,uh,Ce);if(xu&&(bs=xu.placedGlyphBoxes,bs&&bs.placeable))return Zt=!0,gr=xu.shift,bs}Xt?Xt=null:Ts=H}return l&&!bs&&(bs={box:this.collisionIndex.placeCollisionBox(zn,"always",k,Ee,P,ce,ie,y,U.predicate,Ce,void 0,$e).box,offscreen:!1,placeable:!1,occluded:!1}),bs};Ri(()=>Ht(zn,He.iconBox,c.az.horizontal),()=>{const $r=He.verticalTextBox;return h.allowVerticalPlacement&&(!sr||!sr.placeable)&&Ne.numVerticalGlyphVertices>0&&$r?Ht($r,He.verticalIconBox,c.az.vertical):{box:null,occluded:!0,offscreen:null}}),sr&&(Zt=sr.placeable,Wt=sr.offscreen);const Ur=ri(sr&&sr.placeable);if(!Zt&&this.prevPlacement){const $r=this.prevPlacement.variableOffsets[Ne.crossTileID];$r&&(this.variableOffsets[Ne.crossTileID]=$r,this.markUsedJustification(h,$r.anchor,Ne,Ur))}}}if(Mr=sr,Zt=Mr&&Mr.placeable,Wt=Mr&&Mr.offscreen,Ne.useRuntimeCollisionCircles&&Ne.centerJustifiedTextSymbolIndex>=0){const ri=h.text.placedSymbolArray.get(Ne.centerJustifiedTextSymbolIndex),Ri=c.aA(h.textSizeData,B,ri),yi=g.get("text-padding");Pr=this.collisionIndex.placeCollisionCircles(H,ri,h.lineVertexArray,h.glyphOffsetArray,Ri,P,M,l,ce,U.predicate,Ne.collisionCircleDiameter,yi,y,Ce),Pr.circles.length&&Pr.collisionDetected&&!l&&c.w("Collisions detected, but collision boxes are not shown"),Zt=ee||Pr.circles.length>0&&!Pr.collisionDetected,Wt=Wt&&Pr.offscreen}if(He.iconFeatureIndex&&(Di=He.iconFeatureIndex),He.iconBox){const ri=Ri=>this.collisionIndex.placeCollisionBox(Ri,ae,k,Ee,P,ce,ie,b,U.predicate,Ce,re&&gr?gr:void 0,$e);Wr&&Wr.placeable&&He.verticalIconBox?(nn=ri(He.verticalIconBox),ir=nn.placeable):(nn=ri(He.iconBox),ir=nn.placeable),Wt=Wt&&nn.offscreen}const Ys=W||Ne.numHorizontalGlyphVertices===0&&Ne.numVerticalGlyphVertices===0,al=X||Ne.numIconVertices===0;Ys||al?al?Ys||(ir=ir&&Zt):Zt=ir&&Zt:ir=Zt=ir&&Zt;const Ks=ir&&nn.placeable;if(Zt&&Mr.placeable&&this.collisionIndex.insertCollisionBox(Mr.box,H,g.get("text-ignore-placement"),h.bucketInstanceId,Wr&&Wr.placeable&&Hi?Hi:xs,U.ID),Ks&&this.collisionIndex.insertCollisionBox(nn.box,ae,g.get("icon-ignore-placement"),h.bucketInstanceId,Di,U.ID),Pr&&Zt&&this.collisionIndex.insertCollisionCircles(Pr.circles,H,g.get("text-ignore-placement"),h.bucketInstanceId,xs,U.ID),l&&this.storeCollisionData(h.bucketInstanceId,gt,He,Mr,nn,Pr),Ne.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(h.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ne.crossTileID]=new kd((Zt||ke)&&!(Mr!=null&&Mr.occluded),(ir||Se)&&!(nn!=null&&nn.occluded),Wt||h.justReloaded),s[Ne.crossTileID]=!0};if(ge){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ne=h.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let He=Ne.length-1;He>=0;--He){const gt=Ne[He];Ge(h.symbolInstances.get(gt),h.collisionArrays[gt],gt)}}else for(let Ne=t.symbolInstanceStart;Ne<t.symbolInstanceEnd;Ne++)Ge(h.symbolInstances.get(Ne),h.collisionArrays[Ne],Ne);h.justReloaded=!1}storeCollisionData(t,s,l,h,g,y){if(l.textBox||l.iconBox){let b,P;this.collisionBoxArrays.has(t)?b=this.collisionBoxArrays.get(t):(b=new Map,this.collisionBoxArrays.set(t,b)),b.has(s)?P=b.get(s):(P={text:null,icon:null},b.set(s,P)),l.textBox&&(P.text=h.box),l.iconBox&&(P.icon=g.box)}if(y){let b=this.collisionCircleArrays[t];b===void 0&&(b=this.collisionCircleArrays[t]=[]);for(let P=0;P<y.circles.length;P+=4)b.push(y.circles[P+0]-fr),b.push(y.circles[P+1]-fr),b.push(y.circles[P+2]),b.push(y.collisionDetected?1:0)}}markUsedJustification(t,s,l,h){let g;g=h===c.az.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[c.aR(s)];const y=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const b of y)b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=g>=0&&b!==g?0:l.crossTileID)}markUsedOrientation(t,s,l){const h=s===c.az.horizontal||s===c.az.horizontalOnly?s:0,g=s===c.az.vertical?s:0,y=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const b of y)t.text.placedSymbolArray.get(b).placedOrientation=h;l.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let l=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const h=s?s.symbolFadeChange(t):1,g=s?s.opacities:{},y=s?s.variableOffsets:{},b=s?s.placedOrientations:{};for(const P in this.placements){const M=this.placements[P],k=g[P];k?(this.opacities[P]=new Ca(k,h,M.text,M.icon),l=l||M.text!==k.text.placed||M.icon!==k.icon.placed):(this.opacities[P]=new Ca(null,h,M.text,M.icon,M.skipFade),l=l||M.text||M.icon)}for(const P in g){const M=g[P];if(!this.opacities[P]){const k=new Ca(M,h,!1,!1);k.isHidden()||(this.opacities[P]=k,l=l||M.text.placed||M.icon.placed)}}for(const P in y)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=y[P]);for(const P in b)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=b[P]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s){const l={};for(const h of s){const g=h.getBucket(t);g&&h.latestFeatureIndex&&t.id===g.layerIds[0]&&this.updateBucketOpacities(g,h.tileID,l,h.collisionBoxArray)}}updateBucketOpacities(t,s,l,h){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const g=t.layers[0],y=g.layout,b=new Ca(null,0,!1,!1,!0),P=y.get("text-allow-overlap"),M=y.get("icon-allow-overlap"),k=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),R=y.get("text-rotation-alignment")==="map",D=y.get("text-pitch-alignment")==="map",B=y.get("icon-text-fit")!=="none",U=new Ca(null,0,P&&(M||!t.hasIconData()||y.get("icon-optional")),M&&(P||!t.hasTextData()||y.get("text-optional")),!0);!t.collisionArrays&&h&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(h);const W=(H,ee,ae)=>{for(let Q=0;Q<ee/4;Q++)H.opacityVertexArray.emplaceBack(ae);H.hasVisibleVertices=H.hasVisibleVertices||ae!==Ia},X=this.collisionBoxArrays.get(t.bucketInstanceId);for(let H=0;H<t.symbolInstances.length;H++){const ee=t.symbolInstances.get(H),{numHorizontalGlyphVertices:ae,numVerticalGlyphVertices:Q,crossTileID:ie}=ee;let ce=this.opacities[ie];l[ie]?ce=b:ce||(ce=U,this.opacities[ie]=ce),l[ie]=!0;const re=ee.numIconVertices>0,ge=this.placedOrientations[ee.crossTileID],ke=ge===c.az.vertical,Se=ge===c.az.horizontal||ge===c.az.horizontalOnly;if(ae>0||Q>0){const Ce=vc(ce.text);W(t.text,ae,ke?Ia:Ce),W(t.text,Q,Se?Ia:Ce);const $e=ce.text.isHidden();[ee.rightJustifiedTextSymbolIndex,ee.centerJustifiedTextSymbolIndex,ee.leftJustifiedTextSymbolIndex].forEach(He=>{He>=0&&(t.text.placedSymbolArray.get(He).hidden=$e||ke?1:0)}),ee.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(ee.verticalPlacedTextSymbolIndex).hidden=$e||Se?1:0);const Ge=this.variableOffsets[ee.crossTileID];Ge&&this.markUsedJustification(t,Ge.anchor,ee,ge);const Ne=this.placedOrientations[ee.crossTileID];Ne&&(this.markUsedJustification(t,"left",ee,Ne),this.markUsedOrientation(t,Ne,ee))}if(re){const Ce=vc(ce.icon),$e=!(B&&ee.verticalPlacedIconSymbolIndex&&ke);ee.placedIconSymbolIndex>=0&&(W(t.icon,ee.numIconVertices,$e?Ce:Ia),t.icon.placedSymbolArray.get(ee.placedIconSymbolIndex).hidden=ce.icon.isHidden()),ee.verticalPlacedIconSymbolIndex>=0&&(W(t.icon,ee.numVerticalIconVertices,$e?Ia:Ce),t.icon.placedSymbolArray.get(ee.verticalPlacedIconSymbolIndex).hidden=ce.icon.isHidden())}const Ee=X&&X.has(H)?X.get(H):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ce=t.collisionArrays[H];if(Ce){let $e=new c.P(0,0);if(Ce.textBox||Ce.verticalTextBox){let Ge=!0;if(k){const Ne=this.variableOffsets[ie];Ne?($e=Fl(Ne.anchor,Ne.width,Ne.height,Ne.textOffset,Ne.textBoxScale),R&&$e._rotate(D?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Ge=!1}if(Ce.textBox||Ce.verticalTextBox){let Ne;Ce.textBox&&(Ne=ke),Ce.verticalTextBox&&(Ne=Se),gc(t.textCollisionBox.collisionVertexArray,ce.text.placed,!Ge||Ne,Ee.text,$e.x,$e.y)}}if(Ce.iconBox||Ce.verticalIconBox){const Ge=!!(!Se&&Ce.verticalIconBox);let Ne;Ce.iconBox&&(Ne=Ge),Ce.verticalIconBox&&(Ne=!Ge),gc(t.iconCollisionBox.collisionVertexArray,ce.icon.placed,Ne,Ee.icon,B?$e.x:0,B?$e.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const l=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*l>t}setStale(){this.stale=!0}}function gc(m,t,s,l,h,g){l&&l.length!==0||(l=[0,0,0,0]);const y=l[0]-fr,b=l[1]-fr,P=l[2]-fr,M=l[3]-fr;m.emplaceBack(t?1:0,s?1:0,h||0,g||0,y,b),m.emplaceBack(t?1:0,s?1:0,h||0,g||0,P,b),m.emplaceBack(t?1:0,s?1:0,h||0,g||0,P,M),m.emplaceBack(t?1:0,s?1:0,h||0,g||0,y,M)}const _c=Math.pow(2,25),yc=Math.pow(2,24),Em=Math.pow(2,17),Ma=Math.pow(2,16),Bl=Math.pow(2,9),Dd=Math.pow(2,8),To=Math.pow(2,1);function vc(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const t=m.placed?1:0,s=Math.floor(127*m.opacity);return s*_c+t*yc+s*Em+t*Ma+s*Bl+t*Dd+s*To+t}const Ia=0;class hs{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,s,l,h,g){const y=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(y,h,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,y.sort((b,P)=>b.sortKey-P.sortKey));this._currentPartIndex<y.length;)if(s.placeLayerBucketPart(y[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,g())return!0;return!1}}class So{constructor(t,s,l,h,g,y,b,P){this.placement=new mc(t,s,y,b,P),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(t,s,l){const h=_e(),g=()=>!this._forceFullPlacement&&_e()-h>2;for(;this._currentPlacementIndex>=0;){const y=s[t[this._currentPlacementIndex]],b=this.placement.collisionIndex.transform.zoom;if(y.type==="symbol"&&(!y.minzoom||y.minzoom<=b)&&(!y.maxzoom||y.maxzoom>b)){if(this._inProgressLayer||(this._inProgressLayer=new hs(y)),this._inProgressLayer.continuePlacement(l[y.source],this.placement,this._showCollisionBoxes,y,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const St=512/c.a5/2;class xc{constructor(t,s,l){this.tileID=t,this.bucketInstanceId=l,this._symbolsByKey={};const h=new Map;for(let g=0;g<s.length;g++){const y=s.get(g),b=y.key,P=h.get(b);P?P.push(y):h.set(b,[y])}for(const[g,y]of h){const b={positions:y.map(P=>({x:Math.floor(P.anchorX*St),y:Math.floor(P.anchorY*St)})),crossTileIDs:y.map(P=>P.crossTileID)};if(b.positions.length>128){const P=new c.aT(b.positions.length,16,Uint16Array);for(const{x:M,y:k}of b.positions)P.add(M,k);P.finish(),delete b.positions,b.index=P}this._symbolsByKey[g]=b}}getScaledCoordinates(t,s){const{x:l,y:h,z:g}=this.tileID.canonical,{x:y,y:b,z:P}=s.canonical,M=St/Math.pow(2,P-g),k=(b*c.a5+t.anchorY)*M,R=h*c.a5*St;return{x:Math.floor((y*c.a5+t.anchorX)*M-l*c.a5*St),y:Math.floor(k-R)}}findMatches(t,s,l){const h=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let g=0;g<t.length;g++){const y=t.get(g);if(y.crossTileID)continue;const b=this._symbolsByKey[y.key];if(!b)continue;const P=this.getScaledCoordinates(y,s);if(b.index){const M=b.index.range(P.x-h,P.y-h,P.x+h,P.y+h).sort();for(const k of M){const R=b.crossTileIDs[k];if(!l[R]){l[R]=!0,y.crossTileID=R;break}}}else if(b.positions)for(let M=0;M<b.positions.length;M++){const k=b.positions[M],R=b.crossTileIDs[M];if(Math.abs(k.x-P.x)<=h&&Math.abs(k.y-P.y)<=h&&!l[R]){l[R]=!0,y.crossTileID=R;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class Cm{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class bc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const l in this.indexes){const h=this.indexes[l],g={};for(const y in h){const b=h[y];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+s),g[b.tileID.key]=b}this.indexes[l]=g}this.lng=t}addBucket(t,s,l){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let g=0;g<s.symbolInstances.length;g++)s.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const h=this.usedCrossTileIDs[t.overscaledZ];for(const g in this.indexes){const y=this.indexes[g];if(Number(g)>t.overscaledZ)for(const b in y){const P=y[b];P.tileID.isChildOf(t)&&P.findMatches(s.symbolInstances,t,h)}else{const b=y[t.scaledTo(Number(g)).key];b&&b.findMatches(s.symbolInstances,t,h)}}for(let g=0;g<s.symbolInstances.length;g++){const y=s.symbolInstances.get(g);y.crossTileID||(y.crossTileID=l.generate(),h[y.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new xc(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const l of s.getCrossTileIDsLists())for(const h of l)delete this.usedCrossTileIDs[t][h]}removeStaleBuckets(t){let s=!1;for(const l in this.indexes){const h=this.indexes[l];for(const g in h)t[h[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,h[g]),delete h[g],s=!0)}return s}}class kn{constructor(){this.layerIndexes={},this.crossTileIDs=new Cm,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,l){let h=this.layerIndexes[t.id];h===void 0&&(h=this.layerIndexes[t.id]=new bc);let g=!1;const y={};h.handleWrapJump(l);for(const b of s){const P=b.getBucket(t);P&&t.id===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(b.tileID,P,this.crossTileIDs)&&(g=!0),y[P.bucketInstanceId]=!0)}return h.removeStaleBuckets(y)&&(g=!0),g}pruneUnusedLayers(t){const s={};t.forEach(l=>{s[l]=!0});for(const l in this.layerIndexes)s[l]||delete this.layerIndexes[l]}}var ln="void main() {fragColor=vec4(1.0);}";const lr={prelude:pt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:pt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:pt("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:pt(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:pt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:pt(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:pt(ln,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:pt(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:pt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:pt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:pt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:pt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:pt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:pt(ln,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:pt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:pt(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:pt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:pt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:pt(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:pt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:pt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:pt(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:pt(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:pt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:pt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:pt(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:pt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:pt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:pt(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:pt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:pt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:pt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:pt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:pt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:pt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:pt(`#ifdef GL_ES
precision highp float;
#endif
in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:pt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function pt(m,t){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=t.match(/in ([\w]+) ([\w]+)/g),h=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=g?g.concat(h):h,b={};return{fragmentSource:m=m.replace(s,(P,M,k,R,D)=>(b[D]=!0,M==="define"?`
#ifndef HAS_UNIFORM_u_${D}
in ${k} ${R} ${D};
#else
uniform ${k} ${R} u_${D};
#endif
`:`
#ifdef HAS_UNIFORM_u_${D}
    ${k} ${R} ${D} = u_${D};
#endif
`)),vertexSource:t=t.replace(s,(P,M,k,R,D)=>{const B=R==="float"?"vec2":"vec4",U=D.match(/color/)?"color":B;return b[D]?M==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
in ${k} ${B} a_${D};
out ${k} ${R} ${D};
#else
uniform ${k} ${R} u_${D};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = a_${D};
#else
    ${k} ${R} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = unpack_mix_${U}(a_${D}, u_${D}_t);
#else
    ${k} ${R} ${D} = u_${D};
#endif
`:M==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
in ${k} ${B} a_${D};
#else
uniform ${k} ${R} u_${D};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${k} ${R} ${D} = a_${D};
#else
    ${k} ${R} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${k} ${R} ${D} = unpack_mix_${U}(a_${D}, u_${D}_t);
#else
    ${k} ${R} ${D} = u_${D};
#endif
`}),staticAttributes:l,staticUniforms:y}}class Gt{constructor(t,s,l){this.vertexBuffer=t,this.indexBuffer=s,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var ds=c.aU([{name:"a_pos",type:"Int16",components:2}]);const xn="#define PROJECTION_MERCATOR",jn="mercator";class bn{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return jn}get shaderDefine(){return xn}get shaderPreludeCode(){return lr.projectionMercator}get vertexShaderPreludeCode(){return lr.projectionMercator.vertexSource}get subdivisionGranularity(){return c.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,s,l,h,g){if(this._cachedMesh)return this._cachedMesh;const y=new c.aW;y.emplaceBack(0,0),y.emplaceBack(c.a5,0),y.emplaceBack(0,c.a5),y.emplaceBack(c.a5,c.a5);const b=t.createVertexBuffer(y,ds.members),P=c.aX.simpleSegment(0,0,4,2),M=new c.aY;M.emplaceBack(1,0,2),M.emplaceBack(1,2,3);const k=t.createIndexBuffer(M);return this._cachedMesh=new Gt(b,k,P),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class Po{constructor(t=0,s=0,l=0,h=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(l)||l<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=l,this.right=h}interpolate(t,s,l){return s.top!=null&&t.top!=null&&(this.top=c.G.number(t.top,s.top,l)),s.bottom!=null&&t.bottom!=null&&(this.bottom=c.G.number(t.bottom,s.bottom,l)),s.left!=null&&t.left!=null&&(this.left=c.G.number(t.left,s.left,l)),s.right!=null&&t.right!=null&&(this.right=c.G.number(t.right,s.right,l)),this}getCenter(t,s){const l=c.an((this.left+t-this.right)/2,0,t),h=c.an((this.top+s-this.bottom)/2,0,s);return new c.P(l,h)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Po(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ps(m,t){if(!m.renderWorldCopies||m.lngRange)return;const s=t.lng-m.center.lng;t.lng+=s>180?-360:s<-180?360:0}function wr(m){return Math.max(0,Math.floor(m))}class Ls{constructor(t,s){var l;this.applyConstrain=(h,g)=>this._constrainOverride!==null?this._constrainOverride(h,g):this._callbacks.defaultConstrain(h,g),this._callbacks=t,this._tileSize=512,this._renderWorldCopies=(s==null?void 0:s.renderWorldCopies)===void 0||!!(s!=null&&s.renderWorldCopies),this._minZoom=(s==null?void 0:s.minZoom)||0,this._maxZoom=(s==null?void 0:s.maxZoom)||22,this._minPitch=(s==null?void 0:s.minPitch)==null?0:s==null?void 0:s.minPitch,this._maxPitch=(s==null?void 0:s.maxPitch)==null?60:s==null?void 0:s.maxPitch,this._constrainOverride=(l=s==null?void 0:s.constrainOverride)!==null&&l!==void 0?l:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new c.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=wr(this._zoom),this._scale=c.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Po,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,s,l){this._constrainOverride=t.constrainOverride,this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=wr(this._zoom),this._scale=c.aq(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new Po(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!l&&t.autoCalculateNearFarZ,s&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get constrainOverride(){return this._constrainOverride}setConstrainOverride(t){t===void 0&&(t=null),this._constrainOverride!==t&&(this._constrainOverride=t,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const s=c.W(t,-180,180)*Math.PI/180;var l,h,g,y,b,P,M,k,R;this._bearingInRadians!==s&&(this._unmodified=!1,this._bearingInRadians=s,this._calcMatrices(),this._rotationMatrix=K(),l=this._rotationMatrix,g=-this._bearingInRadians,y=(h=this._rotationMatrix)[0],b=h[1],P=h[2],M=h[3],k=Math.sin(g),R=Math.cos(g),l[0]=y*R+P*k,l[1]=b*R+M*k,l[2]=y*-k+P*R,l[3]=b*-k+M*R)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const s=c.an(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==s&&(this._unmodified=!1,this._pitchInRadians=s,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const s=t/180*Math.PI;this._rollInRadians!==s&&(this._unmodified=!1,this._rollInRadians=s,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return c.aZ(this._fovInRadians)}setFov(t){t=c.an(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=c.ap(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const s=this.applyConstrain(this._center,t).zoom;this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this._tileZoom=Math.max(0,Math.floor(s)),this._scale=c.aq(s),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,s){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=s,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,l){this._unmodified=!1,this._edgeInsets.interpolate(t,s,l),this.constrainInternal(),this._calcMatrices()}resize(t,s,l=!0){this._width=t,this._height=s,l&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new dr([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-c.ao,c.ao])}getCameraQueryGeometry(t,s){if(s.length===1)return[s[0],t];{const{minX:l,minY:h,maxX:g,maxY:y}=c.aa.fromPoints(s).extend(t);return[new c.P(l,h),new c.P(g,h),new c.P(g,y),new c.P(l,y),new c.P(l,h)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:s,zoom:l}=this.applyConstrain(this.center,this.zoom);this.setCenter(s),this.setZoom(l),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=c.ar(new Float64Array(16));c.Q(t,t,[this._width/2,-this._height/2,1]),c.O(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=c.ar(new Float64Array(16)),c.Q(t,t,[1,-1,1]),c.O(t,t,[-1,-1,0]),c.Q(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,s,l,h){const g=l!==void 0?l:this.bearing,y=h=h!==void 0?h:this.pitch,{distanceToCenter:b,clampedElevation:P}=this._distanceToCenterFromAltElevationPitch(s,this.elevation,y),{x:M,y:k}=Ut(y,g),R=c.a9.fromLngLat(t,s);let D,B,U=c.a_(1,R.y),W=0;do{if(W+=1,W>10)break;B=b/U,D=new c.a9(R.x+M*B,R.y+k*B),U=1/D.meterInMercatorCoordinateUnits()}while(Math.abs(b-B*U)>1e-12);return{center:D.toLngLat(),elevation:P,zoom:c.at(this.height/2/Math.tan(this.fovInRadians/2)/B/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const s=1/this.worldSize,l=c.as(1,this.center.lat)*this.worldSize,h=c.a9.fromLngLat(this.center,this.elevation),g=h.x/s,y=h.y/s,b=h.z/s,P=this.pitch,M=this.bearing,{x:k,y:R,z:D}=Ut(P,M),B=this.cameraToCenterDistance,U=g+B*-k,W=y+B*-R,X=b+B*D,{distanceToCenter:H,clampedElevation:ee}=this._distanceToCenterFromAltElevationPitch(X/l,t,P),ae=H*l,Q=new c.a9((U+k*ae)*s,(W+R*ae)*s,0).toLngLat(),ie=c.as(1,Q.lat),ce=c.at(this.height/2/Math.tan(this.fovInRadians/2)/H/ie/this.tileSize);this._elevation=ee,this._center=Q,this.setZoom(ce)}_distanceToCenterFromAltElevationPitch(t,s,l){const h=-Math.cos(c.ap(l)),g=t-s;let y,b=s;return h*g>=0||Math.abs(h)<.1?(y=1e4,b=t+y*h):y=-g/h,{distanceToCenter:y,clampedElevation:b}}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=c.as(1,this.center.lat)*this.worldSize;return Pe(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const s=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/s,t.canonical.y/s,1/s/c.a5,1/s/c.a5]}}class Ai{constructor(t,s){this.min=t,this.max=s,this.center=c.a$([],c.b0([],this.min,this.max),.5)}quadrant(t){const s=[t%2==0,t<2],l=c.b1(this.min),h=c.b1(this.max);for(let g=0;g<s.length;g++)l[g]=s[g]?this.min[g]:this.center[g],h[g]=s[g]?this.center[g]:this.max[g];return h[2]=this.max[2],new Ai(l,h)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let s=!0;for(let l=0;l<t.planes.length;l++){const h=this.intersectsPlane(t.planes[l]);if(h===0)return 0;h===1&&(s=!1)}return s?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let s=t[3],l=t[3];for(let h=0;h<3;h++)t[h]>0?(s+=t[h]*this.min[h],l+=t[h]*this.max[h]):(l+=t[h]*this.min[h],s+=t[h]*this.max[h]);return s>=0?2:l<0?0:1}}class Ol{distanceToTile2d(t,s,l,h){const g=h.distanceX([t,s]),y=h.distanceY([t,s]);return Math.hypot(g,y)}getWrap(t,s,l){return l}getTileBoundingVolume(t,s,l,h){var g,y;let b=0,P=0;if(h!=null&&h.terrain){const k=new c.a2(t.z,s,t.z,t.x,t.y),R=h.terrain.getMinMaxElevation(k);b=(g=R.minElevation)!==null&&g!==void 0?g:Math.min(0,l),P=(y=R.maxElevation)!==null&&y!==void 0?y:Math.max(0,l)}const M=1<<t.z;return new Ai([s+t.x/M,t.y/M,b],[s+(t.x+1)/M,(t.y+1)/M,P])}allowVariableZoom(t,s){const l=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,h=c.an(78.5-l/2,0,60);return!!s.terrain||t.pitch>h}allowWorldCopies(){return!0}prepareNextFrame(){}}class An{constructor(t,s,l){this.points=t,this.planes=s,this.aabb=l}static fromInvProjectionMatrix(t,s=1,l=0,h,g){const y=g?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],b=Math.pow(2,l),P=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>function(B,U,W,X){const H=c.aH([],B,U),ee=1/H[3]/W*X;return c.b6(H,H,[ee,ee,1/H[3],ee])}(D,t,s,b));h&&function(D,B,U,W){const X=W?4:0,H=W?0:4;let ee=0;const ae=[],Q=[];for(let re=0;re<4;re++){const ge=c.b2([],D[re+H],D[re+X]),ke=c.b7(ge);c.a$(ge,ge,1/ke),ae.push(ke),Q.push(ge)}for(let re=0;re<4;re++){const ge=c.b8(D[re+X],Q[re],U);ee=ge!==null&&ge>=0?Math.max(ee,ge):Math.max(ee,ae[re])}const ie=function(re,ge){const ke=c.b2([],re[ge[0]],re[ge[1]]),Se=c.b2([],re[ge[2]],re[ge[1]]),Ee=[0,0,0,0];return c.b3(Ee,c.b4([],ke,Se)),Ee[3]=-c.b5(Ee,re[ge[0]]),Ee}(D,B),ce=function(re,ge){const ke=c.b9(re),Se=c.ba([],re,1/ke),Ee=c.b2([],ge,c.a$([],Se,c.b5(ge,Se))),Ce=c.b9(Ee);if(Ce>0){const $e=Math.sqrt(1-Se[3]*Se[3]),Ge=c.a$([],Se,-Se[3]),Ne=c.b0([],Ge,c.a$([],Ee,$e/Ce));return c.bb(ge,Ne)}return null}(U,ie);if(ce!==null){const re=ce/c.b5(Q[0],ie);ee=Math.min(ee,re)}for(let re=0;re<4;re++){const ge=Math.min(ee,ae[re]);D[re+H]=[D[re+X][0]+Q[re][0]*ge,D[re+X][1]+Q[re][1]*ge,D[re+X][2]+Q[re][2]*ge,1]}}(P,y[0],h,g);const M=y.map(D=>{const B=c.b2([],P[D[0]],P[D[1]]),U=c.b2([],P[D[2]],P[D[1]]),W=c.b3([],c.b4([],B,U)),X=-c.b5(W,P[D[1]]);return W.concat(X)}),k=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],R=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const D of P)for(let B=0;B<3;B++)k[B]=Math.min(k[B],D[B]),R[B]=Math.max(R[B],D[B]);return new An(P,M,new Ai(k,R))}}class Fs{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,s,l){return this._helper.interpolatePadding(t,s,l)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,s,l=!0){this._helper.resize(t,s,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,s){this._helper.overrideNearFarZ(t,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,s){}constructor(t){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(s,l)=>{l=c.an(+l,this.minZoom,this.maxZoom);const h={center:new c.V(s.lng,s.lat),zoom:l};let g=this._helper._lngRange;if(!this._helper._renderWorldCopies&&g===null){const Q=179.9999999999;g=[-Q,Q]}const y=this.tileSize*c.aq(h.zoom);let b=0,P=y,M=0,k=y,R=0,D=0;const{x:B,y:U}=this.size;if(this._helper._latRange){const Q=this._helper._latRange;b=c.X(Q[1])*y,P=c.X(Q[0])*y,P-b<U&&(R=U/(P-b))}g&&(M=c.W(c.Y(g[0])*y,0,y),k=c.W(c.Y(g[1])*y,0,y),k<M&&(k+=y),k-M<B&&(D=B/(k-M)));const{x:W,y:X}=lt(y,s);let H,ee;const ae=Math.max(D||0,R||0);if(ae){const Q=new c.P(D?(k+M)/2:W,R?(P+b)/2:X);return h.center=ft(y,Q).wrap(),h.zoom+=c.at(ae),h}if(this._helper._latRange){const Q=U/2;X-Q<b&&(ee=b+Q),X+Q>P&&(ee=P-Q)}if(g){const Q=(M+k)/2;let ie=W;this._helper._renderWorldCopies&&(ie=c.W(W,Q-y/2,Q+y/2));const ce=B/2;ie-ce<M&&(H=M+ce),ie+ce>k&&(H=k-ce)}if(H!==void 0||ee!==void 0){const Q=new c.P(H??W,ee??X);h.center=ft(y,Q).wrap()}return h},this.applyConstrain=(s,l)=>this._helper.applyConstrain(s,l),this._helper=new Ls({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(s,l)=>this.defaultConstrain(s,l)},t),this._coveringTilesDetailsProvider=new Ol}clone(){const t=new Fs;return t.apply(this,!1),t}apply(t,s,l){this._helper.apply(t,s,l)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const s=[new c.bc(0,t)];if(this._helper._renderWorldCopies){const l=this.screenPointToMercatorCoordinate(new c.P(0,0)),h=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,0)),g=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,this._helper._height)),y=this.screenPointToMercatorCoordinate(new c.P(0,this._helper._height)),b=Math.floor(Math.min(l.x,h.x,g.x,y.x)),P=Math.floor(Math.max(l.x,h.x,g.x,y.x)),M=1;for(let k=b-M;k<=P+M;k++)k!==0&&s.push(new c.bc(k,t))}return s}getCameraFrustum(){return An.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const s=this.screenPointToLocation(this.centerPoint,t),l=t?t.getElevationForLngLatZoom(s,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(l)}setLocationAtPoint(t,s){const l=c.as(this.elevation,this.center.lat),h=this.screenPointToMercatorCoordinateAtZ(s,l),g=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,l),y=c.a9.fromLngLat(t),b=new c.a9(y.x-(h.x-g.x),y.y-(h.y-g.y));this.setCenter(b==null?void 0:b.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,s){return s?this.coordinatePoint(c.a9.fromLngLat(t),s.getElevationForLngLat(t,this),this._pixelMatrix3D):this.coordinatePoint(c.a9.fromLngLat(t))}screenPointToLocation(t,s){var l;return(l=this.screenPointToMercatorCoordinate(t,s))===null||l===void 0?void 0:l.toLngLat()}screenPointToMercatorCoordinate(t,s){if(s){const l=s.pointCoordinate(t);if(l!=null)return l}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,s){const l=s||0,h=[t.x,t.y,0,1],g=[t.x,t.y,1,1];c.aH(h,h,this._pixelMatrixInverse),c.aH(g,g,this._pixelMatrixInverse);const y=h[3],b=g[3],P=h[1]/y,M=g[1]/b,k=h[2]/y,R=g[2]/b,D=k===R?0:(l-k)/(R-k);return new c.a9(c.G.number(h[0]/y,g[0]/b,D)/this.worldSize,c.G.number(P,M,D)/this.worldSize,l)}coordinatePoint(t,s=0,l=this._pixelMatrix){const h=[t.x*this.worldSize,t.y*this.worldSize,s,1];return c.aH(h,h,l),new c.P(h[0]/h[3],h[1]/h[3])}getBounds(){const t=Math.max(0,this._helper._height/2-jt(this));return new dr().extend(this.screenPointToLocation(new c.P(0,t))).extend(this.screenPointToLocation(new c.P(this._helper._width,t))).extend(this.screenPointToLocation(new c.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new c.P(0,this._helper._height)))}isPointOnMapSurface(t,s){return s?s.pointCoordinate(t)!=null:t.y>this.height/2-jt(this)}calculatePosMatrix(t,s=!1,l){var h;const g=(h=t.key)!==null&&h!==void 0?h:c.bd(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),y=s?this._alignedPosMatrixCache:this._posMatrixCache;if(y.has(g)){const M=y.get(g);return l?M.f32:M.f64}const b=zt(t,this.worldSize);c.S(b,s?this._alignedProjMatrix:this._viewProjMatrix,b);const P={f64:b,f32:new Float32Array(b)};return y.set(g,P),l?P.f32:P.f64}calculateFogMatrix(t){const s=t.key,l=this._fogMatrixCacheF32;if(l.has(s))return l.get(s);const h=zt(t,this.worldSize);return c.S(h,this._fogMatrix,h),l.set(s,new Float32Array(h)),l.get(s)}calculateCenterFromCameraLngLatAlt(t,s,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(t,s,l,h)}_calculateNearFarZIfNeeded(t,s,l){if(!this._helper.autoCalculateNearFarZ)return;const h=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),g=t-h*this._helper._pixelPerMeter/Math.cos(s),y=h<0?g:t,b=Math.PI/2+this.pitchInRadians,P=c.ap(this.fov)*(Math.abs(Math.cos(c.ap(this.roll)))*this.height+Math.abs(Math.sin(c.ap(this.roll)))*this.width)/this.height*(.5+l.y/this.height),M=Math.sin(P)*y/Math.sin(c.an(Math.PI-b-P,.01,Math.PI-.01)),k=jt(this),R=Math.atan(k/this._helper.cameraToCenterDistance),D=c.ap(.75),B=R>D?2*R*(.5+l.y/(2*k)):D,U=Math.sin(B)*y/Math.sin(c.an(Math.PI-b-B,.01,Math.PI-.01)),W=Math.min(M,U);this._helper._farZ=1.01*(Math.cos(Math.PI/2-s)*W+y),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,s=lt(this.worldSize,this.center),l=s.x,h=s.y;this._helper._pixelPerMeter=c.as(1,this.center.lat)*this.worldSize;const g=c.ap(Math.min(this.pitch,tt)),y=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(g));let b;this._calculateNearFarZIfNeeded(y,g,t),b=new Float64Array(16),c.be(b,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),c.aB(this._invProjMatrix,b),b[8]=2*-t.x/this._helper._width,b[9]=2*t.y/this._helper._height,this._projectionMatrix=c.bf(b),c.Q(b,b,[1,-1,1]),c.O(b,b,[0,0,-this._helper.cameraToCenterDistance]),c.bg(b,b,-this.rollInRadians),c.bh(b,b,this.pitchInRadians),c.bg(b,b,-this.bearingInRadians),c.O(b,b,[-l,-h,0]),this._mercatorMatrix=c.Q([],b,[this.worldSize,this.worldSize,this.worldSize]),c.Q(b,b,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=c.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,b),c.O(b,b,[0,0,-this.elevation]),this._viewProjMatrix=b,this._invViewProjMatrix=c.aB([],b);const P=[0,0,-1,1];c.aH(P,P,this._invViewProjMatrix),this._cameraPosition=[P[0]/P[3],P[1]/P[3],P[2]/P[3]],this._fogMatrix=new Float64Array(16),c.be(this._fogMatrix,this.fovInRadians,this.width/this.height,y,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,c.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),c.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),c.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),c.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),c.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),c.O(this._fogMatrix,this._fogMatrix,[-l,-h,0]),c.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),c.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=c.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,b);const M=this._helper._width%2/2,k=this._helper._height%2/2,R=Math.cos(this.bearingInRadians),D=Math.sin(-this.bearingInRadians),B=l-Math.round(l)+R*M+D*k,U=h-Math.round(h)+R*k+D*M,W=new Float64Array(b);if(c.O(W,W,[B>.5?B-1:B,U>.5?U-1:U,0]),this._alignedProjMatrix=W,b=c.aB(new Float64Array(16),this._pixelMatrix),!b)throw new Error("failed to invert matrix");this._pixelMatrixInverse=b,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new c.P(0,0)),s=[t.x*this.worldSize,t.y*this.worldSize,0,1];return c.aH(s,s,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=c.as(1,this.center.lat)*this.worldSize;return Pe(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,s){const l=c.a9.fromLngLat(t),h=[l.x*this.worldSize,l.y*this.worldSize,s,1];return c.aH(h,h,this._viewProjMatrix),h[2]/h[3]}getProjectionData(t){const{overscaledTileID:s,aligned:l,applyTerrainMatrix:h}=t,g=this._helper.getMercatorTileCoordinates(s),y=s?this.calculatePosMatrix(s,l,!0):null;let b;return b=s&&s.terrainRttPosMatrix32f&&h?s.terrainRttPosMatrix32f:y||c.bi(),{mainMatrix:b,tileMercatorCoords:g,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:b}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,s,l){return 1}transformLightDirection(t){return c.b1(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,s,l,h){const g=this.calculatePosMatrix(l);let y;h?(y=[t,s,h(t,s),1],c.aH(y,y,g)):(y=[t,s,0,1],Ll(y,y,g));const b=y[3];return{point:new c.P(y[0]/b,y[1]/b),signedDistanceFromCamera:b,isOccluded:!1}}populateCache(t){for(const s of t)this.calculatePosMatrix(s)}getMatrixForModel(t,s){const l=c.a9.fromLngLat(t,s),h=l.meterInMercatorCoordinateUnits(),g=c.bj();return c.O(g,g,[l.x,l.y,l.z]),c.bg(g,g,Math.PI),c.bh(g,g,Math.PI/2),c.Q(g,g,[-h,h,h]),g}getProjectionDataForCustomLayer(t=!0){const s=new c.a2(0,0,0,0,0),l=this.getProjectionData({overscaledTileID:s,applyGlobeMatrix:t}),h=zt(s,this.worldSize);c.S(h,this._viewProjMatrix,h),l.tileMercatorCoords=[0,0,1,1];const g=[c.a5,c.a5,this.worldSize/this._helper.pixelsPerMeter],y=c.bk();return c.Q(y,h,g),l.fallbackMatrix=y,l.mainMatrix=y,l}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function Zi(){c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Rd(m){if(m.useSlerp)if(m.k<1){const t=c.bl(m.startEulerAngles.roll,m.startEulerAngles.pitch,m.startEulerAngles.bearing),s=c.bl(m.endEulerAngles.roll,m.endEulerAngles.pitch,m.endEulerAngles.bearing),l=new Float64Array(4);c.bm(l,t,s,m.k);const h=c.bn(l);m.tr.setRoll(h.roll),m.tr.setPitch(h.pitch),m.tr.setBearing(h.bearing)}else m.tr.setRoll(m.endEulerAngles.roll),m.tr.setPitch(m.endEulerAngles.pitch),m.tr.setBearing(m.endEulerAngles.bearing);else m.tr.setRoll(c.G.number(m.startEulerAngles.roll,m.endEulerAngles.roll,m.k)),m.tr.setPitch(c.G.number(m.startEulerAngles.pitch,m.endEulerAngles.pitch,m.k)),m.tr.setBearing(c.G.number(m.startEulerAngles.bearing,m.endEulerAngles.bearing,m.k))}function wc(m,t,s,l,h){const g=h.padding,y=lt(h.worldSize,s.getNorthWest()),b=lt(h.worldSize,s.getNorthEast()),P=lt(h.worldSize,s.getSouthEast()),M=lt(h.worldSize,s.getSouthWest()),k=c.ap(-l),R=y.rotate(k),D=b.rotate(k),B=P.rotate(k),U=M.rotate(k),W=new c.P(Math.max(R.x,D.x,U.x,B.x),Math.max(R.y,D.y,U.y,B.y)),X=new c.P(Math.min(R.x,D.x,U.x,B.x),Math.min(R.y,D.y,U.y,B.y)),H=W.sub(X),ee=(h.width-(g.left+g.right+t.left+t.right))/H.x,ae=(h.height-(g.top+g.bottom+t.top+t.bottom))/H.y;if(ae<0||ee<0)return void Zi();const Q=Math.min(c.at(h.scale*Math.min(ee,ae)),m.maxZoom),ie=c.P.convert(m.offset),ce=new c.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(c.ap(l)),re=ie.add(ce).mult(h.scale/c.aq(Q));return{center:ft(h.worldSize,y.add(P).div(2).sub(re)),zoom:Q,bearing:l}}class Bs{get useGlobeControls(){return!1}handlePanInertia(t,s){const l=t.mag(),h=Math.abs(jt(s));return{easingOffset:t.mult(Math.min(.75*h/l,1)),easingCenter:s.center}}handleMapControlsRollPitchBearingZoom(t,s){t.bearingDelta&&s.setBearing(s.bearing+t.bearingDelta),t.pitchDelta&&s.setPitch(s.pitch+t.pitchDelta),t.rollDelta&&s.setRoll(s.roll+t.rollDelta),t.zoomDelta&&s.setZoom(s.zoom+t.zoomDelta)}handleMapControlsPan(t,s,l){t.around.distSqr(s.centerPoint)<.01||s.setLocationAtPoint(l,t.around)}cameraForBoxAndBearing(t,s,l,h,g){return wc(t,s,l,h,g)}handleJumpToCenterZoom(t,s){t.zoom!==(s.zoom!==void 0?+s.zoom:t.zoom)&&t.setZoom(+s.zoom),s.center!==void 0&&t.setCenter(c.V.convert(s.center))}handleEaseTo(t,s){const l=t.zoom,h=t.padding,g={roll:t.roll,pitch:t.pitch,bearing:t.bearing},y={roll:s.roll===void 0?t.roll:s.roll,pitch:s.pitch===void 0?t.pitch:s.pitch,bearing:s.bearing===void 0?t.bearing:s.bearing},b=s.zoom!==void 0,P=!t.isPaddingEqual(s.padding);let M=!1;const k=b?+s.zoom:t.zoom;let R=t.centerPoint.add(s.offsetAsPoint);const D=t.screenPointToLocation(R),{center:B,zoom:U}=t.applyConstrain(c.V.convert(s.center||D),k??l);ps(t,B);const W=lt(t.worldSize,D),X=lt(t.worldSize,B).sub(W),H=c.aq(U-l);return M=U!==l,{easeFunc:ee=>{if(M&&t.setZoom(c.G.number(l,U,ee)),c.bo(g,y)||Rd({startEulerAngles:g,endEulerAngles:y,tr:t,k:ee,useSlerp:g.roll!=y.roll}),P&&(t.interpolatePadding(h,s.padding,ee),R=t.centerPoint.add(s.offsetAsPoint)),s.around)t.setLocationAtPoint(s.around,s.aroundPoint);else{const ae=c.aq(t.zoom-l),Q=U>l?Math.min(2,H):Math.max(.5,H),ie=Math.pow(Q,1-ee),ce=ft(t.worldSize,W.add(X.mult(ee*ie)).mult(ae));t.setLocationAtPoint(t.renderWorldCopies?ce.wrap():ce,R)}},isZooming:M,elevationCenter:B}}handleFlyTo(t,s){const l=s.zoom!==void 0,h=t.zoom,g=t.applyConstrain(c.V.convert(s.center||s.locationAtOffset),l?+s.zoom:h),y=g.center,b=g.zoom;ps(t,y);const P=lt(t.worldSize,s.locationAtOffset),M=lt(t.worldSize,y).sub(P),k=M.mag(),R=c.aq(b-h);let D;if(s.minZoom!==void 0){const B=Math.min(+s.minZoom,h,b),U=t.applyConstrain(y,B).zoom;D=c.aq(U-h)}return{easeFunc:(B,U,W,X)=>{t.setZoom(B===1?b:h+c.at(U));const H=B===1?y:ft(t.worldSize,P.add(M.mult(W)).mult(U));t.setLocationAtPoint(t.renderWorldCopies?H.wrap():H,X)},scaleOfZoom:R,targetCenter:y,scaleOfMinZoom:D,pixelPathLength:k}}}class qt{constructor(t,s,l){this.blendFunction=t,this.blendColor=s,this.mask=l}}qt.Replace=[1,0],qt.disabled=new qt(qt.Replace,c.bp.transparent,[!1,!1,!1,!1]),qt.unblended=new qt(qt.Replace,c.bp.transparent,[!0,!0,!0,!0]),qt.alphaBlended=new qt([1,771],c.bp.transparent,[!0,!0,!0,!0]);const Eo=2305;class Mt{constructor(t,s,l){this.enable=t,this.mode=s,this.frontFace=l}}Mt.disabled=new Mt(!1,1029,Eo),Mt.backCCW=new Mt(!0,1029,Eo),Mt.frontCCW=new Mt(!0,1028,Eo);class bt{constructor(t,s,l){this.func=t,this.mask=s,this.range=l}}bt.ReadOnly=!1,bt.ReadWrite=!0,bt.disabled=new bt(519,bt.ReadOnly,[0,1]);const Co=7680;class It{constructor(t,s,l,h,g,y){this.test=t,this.ref=s,this.mask=l,this.fail=h,this.depthFail=g,this.pass=y}}It.disabled=new It({func:519,mask:0},0,0,Co,Co,Co);const ka=new WeakMap;function Qn(m){var t;if(ka.has(m))return ka.get(m);{const s=(t=m.getParameter(m.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return ka.set(m,s),s}}class Mo{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const s=t.context,l=s.gl;this._texFormat=l.RGBA,this._texType=l.UNSIGNED_BYTE;const h=new c.aW;h.emplaceBack(-1,-1),h.emplaceBack(2,-1),h.emplaceBack(-1,2);const g=new c.aY;g.emplaceBack(0,1,2),this._fullscreenTriangle=new Gt(s.createVertexBuffer(h,ds.members),s.createIndexBuffer(g),c.aX.simpleSegment(0,0,h.length,g.length)),this._resultBuffer=new Uint8Array(4),s.activeTexture.set(l.TEXTURE1);const y=l.createTexture();l.bindTexture(l.TEXTURE_2D,y),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texImage2D(l.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=s.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(y),Qn(l)&&(this._pbo=l.createBuffer(),l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.bufferData(l.PIXEL_PACK_BUFFER,4,l.STREAM_READ),l.bindBuffer(l.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,s){const l=this._updateCount;return this._readbackQueue?l>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():l>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,s),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,s=t.gl;t.activeTexture.set(s.TEXTURE1),s.bindTexture(s.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,s){const l=this._cachedRenderContext.context,h=l.gl;if(this._bindFramebuffer(),l.viewport.set([0,0,this._texWidth,this._texHeight]),l.clear({color:c.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(l,h.TRIANGLES,bt.disabled,It.disabled,qt.unblended,Mt.disabled,((g,y)=>({u_input:g,u_output_expected:y}))(t,s),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Qn(h)){h.bindBuffer(h.PIXEL_PACK_BUFFER,this._pbo),h.readBuffer(h.COLOR_ATTACHMENT0),h.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),h.bindBuffer(h.PIXEL_PACK_BUFFER,null);const g=h.fenceSync(h.SYNC_GPU_COMMANDS_COMPLETE,0);h.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:g}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Qn(t)){const s=t.clientWaitSync(this._readbackQueue.sync,0,0);if(s===t.WAIT_FAILED)return c.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(s===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Mo._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let s=0;return s+=t[0]/256,s+=t[1]/65536,s+=t[2]/16777216,t[3]<127&&(s=-s),s/128}}const fs=c.a5/128;function Ld(m,t){const s=m.granularity!==void 0?Math.max(m.granularity,1):1,l=s+(m.generateBorders?2:0),h=s+(m.extendToNorthPole||m.generateBorders?1:0)+(m.extendToSouthPole||m.generateBorders?1:0),g=l+1,y=h+1,b=m.generateBorders?-1:0,P=m.generateBorders||m.extendToNorthPole?-1:0,M=s+(m.generateBorders?1:0),k=s+(m.generateBorders||m.extendToSouthPole?1:0),R=g*y,D=l*h*6,B=g*y>65536;if(B&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const U=B||t==="32bit",W=new Int16Array(2*R);let X=0;for(let ae=P;ae<=k;ae++)for(let Q=b;Q<=M;Q++){let ie=Q/s*c.a5;Q===-1&&(ie=-fs),Q===s+1&&(ie=c.a5+fs);let ce=ae/s*c.a5;ae===-1&&(ce=m.extendToNorthPole?c.br:-fs),ae===s+1&&(ce=m.extendToSouthPole?c.bs:c.a5+fs),W[X++]=ie,W[X++]=ce}const H=U?new Uint32Array(D):new Uint16Array(D);let ee=0;for(let ae=0;ae<h;ae++)for(let Q=0;Q<l;Q++){const ie=Q+1+ae*g,ce=Q+(ae+1)*g,re=Q+1+(ae+1)*g;H[ee++]=Q+ae*g,H[ee++]=ce,H[ee++]=ie,H[ee++]=ie,H[ee++]=ce,H[ee++]=re}return{vertices:W.buffer.slice(0),indices:H.buffer.slice(0),uses32bitIndices:U}}const Aa=new c.aV({fill:new c.bt(128,2),line:new c.bt(512,0),tile:new c.bt(128,32),stencil:new c.bt(128,1),circle:3});class Tc{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return lr.projectionGlobe}get vertexShaderPreludeCode(){return lr.projectionMercator.vertexSource}get subdivisionGranularity(){return Aa}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new Mo(t));const s=c.X(this._errorQueryLatitudeDegrees),l=2*Math.atan(Math.exp(Math.PI-s*Math.PI*2))-.5*Math.PI,h=this._errorMeasurement.updateErrorLoop(s,l),g=_e();h!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=h,this._errorMeasurementLastChangeTime=g);const y=Math.min(Math.max((g-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=c.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,c.bv(y))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,s,l,h,g){const y=(g==="stencil"?Aa.stencil:Aa.tile).getGranularityForZoomLevel(s.z);return this._getMesh(t,{granularity:y,generateBorders:l,extendToNorthPole:s.y===0&&h,extendToSouthPole:s.y===(1<<s.z)-1&&h})}_getMesh(t,s){const l=this._getMeshKey(s);if(l in this._tileMeshCache)return this._tileMeshCache[l];const h=function(g,y){const b=Ld(y,"16bit"),P=c.aW.deserialize({arrayBuffer:b.vertices,length:b.vertices.byteLength/2/2}),M=c.aY.deserialize({arrayBuffer:b.indices,length:b.indices.byteLength/2/3});return new Gt(g.createVertexBuffer(P,ds.members),g.createIndexBuffer(M),c.aX.simpleSegment(0,0,P.length,M.length))}(t,s);return this._tileMeshCache[l]=h,h}recalculate(t){}hasTransition(){const t=_e();let s=!1;return s=s||(t-this._errorMeasurementLastChangeTime)/1e3<.7,s=s||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,s}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const Mm=new c.t({type:new c.D(c.u.projection.type)});class Fd extends c.E{constructor(t){super(),this._transitionable=new c.x(Mm,void 0),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.H(0)),this._mercatorProjection=new bn,this._verticalPerspectiveProjection=new Tc}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof c.bw){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,s,l,h,g){return this.currentProjection.getMeshFromTileID(t,s,l,h,g)}setProjection(t){this._transitionable.setValue("type",(t==null?void 0:t.type)||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function wn(m){const t=Os(m.worldSize,m.center.lat);return 2*Math.PI*t}function zi(m,t,s,l,h){const g=1/(1<<h),y=t/c.a5*g+l*g,b=c.by((m/c.a5*g+s*g)*Math.PI*2+Math.PI,2*Math.PI),P=2*Math.atan(Math.exp(Math.PI-y*Math.PI*2))-.5*Math.PI,M=Math.cos(P),k=new Float64Array(3);return k[0]=Math.sin(b)*M,k[1]=Math.sin(P),k[2]=Math.cos(b)*M,k}function nr(m){return function(t,s){const l=Math.cos(s),h=new Float64Array(3);return h[0]=Math.sin(t)*l,h[1]=Math.sin(s),h[2]=Math.cos(t)*l,h}(m.lng*Math.PI/180,m.lat*Math.PI/180)}function Os(m,t){return m/(2*Math.PI)/Math.cos(t*Math.PI/180)}function Sc(m){const t=Math.asin(m[1])/Math.PI*180,s=Math.sqrt(m[0]*m[0]+m[2]*m[2]);if(s>1e-6){const l=m[0]/s,h=Math.acos(m[2]/s),g=(l>0?h:-h)/Math.PI*180;return new c.V(c.W(g,-180,180),t)}return new c.V(0,t)}function za(m){return Math.cos(m*Math.PI/180)}function mr(m,t){const s=za(m),l=za(t);return c.at(l/s)}function Bd(m,t){const s=m.rotate(t.bearingInRadians),l=t.zoom+mr(t.center.lat,0),h=c.bu(1/za(t.center.lat),1/za(Math.min(Math.abs(t.center.lat),60)),c.bx(l,7,3,0,1)),g=360/wn({worldSize:t.worldSize,center:{lat:t.center.lat}});return new c.V(t.center.lng-s.x*g*h,c.an(t.center.lat+s.y*g,-c.ao,c.ao))}function Pc(m){const t=.5*m,s=Math.sin(t),l=Math.cos(t);return Math.log(s+l)-Math.log(l-s)}function Od(m,t,s,l){const h=m.lat+s*l;if(Math.abs(s)>1){const g=(Math.sign(m.lat+s)!==Math.sign(m.lat)?-Math.abs(m.lat):Math.abs(m.lat))*Math.PI/180,y=Math.abs(m.lat+s)*Math.PI/180,b=Pc(g+l*(y-g)),P=Pc(g),M=Pc(y);return new c.V(m.lng+t*((b-P)/(M-P)),h)}return new c.V(m.lng+t*l,h)}class Im{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,s,l,h){const g=`${t.z}_${t.x}_${t.y}_${h!=null&&h.terrain?"t":""}`,y=this._cache.get(g);if(y)return y;const b=this._cachePrevious.get(g);if(b)return this._cache.set(g,b),b;const P=this._boundingVolumeFactory(t,s,l,h);return this._cache.set(g,P),this._hadAnyChanges=!0,P}}class Io{constructor(t,s,l,h){this.min=l,this.max=h,this.points=t,this.planes=s}static fromAabb(t,s){const l=[];for(let h=0;h<8;h++)l.push([1&~h?t[0]:s[0],(h>>1&1)==1?s[1]:t[1],(h>>2&1)==1?s[2]:t[2]]);return new Io(l,[[-1,0,0,s[0]],[1,0,0,-t[0]],[0,-1,0,s[1]],[0,1,0,-t[1]],[0,0,-1,s[2]],[0,0,1,-t[2]]],t,s)}static fromCenterSizeAngles(t,s,l){const h=c.bB([],l[0],l[1],l[2]),g=c.bC([],[s[0],0,0],h),y=c.bC([],[0,s[1],0],h),b=c.bC([],[0,0,s[2]],h),P=[...t],M=[...t];for(let R=0;R<8;R++)for(let D=0;D<3;D++){const B=t[D]+g[D]*(1&~R?-1:1)+y[D]*((R>>1&1)==1?1:-1)+b[D]*((R>>2&1)==1?1:-1);P[D]=Math.min(P[D],B),M[D]=Math.max(M[D],B)}const k=[];for(let R=0;R<8;R++){const D=[...t];c.b0(D,D,c.a$([],g,1&~R?-1:1)),c.b0(D,D,c.a$([],y,(R>>1&1)==1?1:-1)),c.b0(D,D,c.a$([],b,(R>>2&1)==1?1:-1)),k.push(D)}return new Io(k,[[...g,-c.b5(g,k[0])],[...y,-c.b5(y,k[0])],[...b,-c.b5(b,k[0])],[-g[0],-g[1],-g[2],-c.b5(g,k[7])],[-y[0],-y[1],-y[2],-c.b5(y,k[7])],[-b[0],-b[1],-b[2],-c.b5(b,k[7])]],P,M)}intersectsFrustum(t){let s=!0;const l=this.points.length,h=this.planes.length,g=t.planes.length,y=t.points.length;for(let b=0;b<g;b++){const P=t.planes[b];let M=0;for(let k=0;k<l;k++){const R=this.points[k];P[0]*R[0]+P[1]*R[1]+P[2]*R[2]+P[3]>=0&&M++}if(M===0)return 0;M<l&&(s=!1)}if(s)return 2;for(let b=0;b<h;b++){const P=this.planes[b];let M=0;for(let k=0;k<y;k++){const R=t.points[k];P[0]*R[0]+P[1]*R[1]+P[2]*R[2]+P[3]>=0&&M++}if(M===0)return 0}return 1}intersectsPlane(t){const s=this.points.length;let l=0;for(let h=0;h<s;h++){const g=this.points[h];t[0]*g[0]+t[1]*g[1]+t[2]*g[2]+t[3]>=0&&l++}return l===s?2:l===0?0:1}}function Nl(m,t,s){const l=m-t;return l<0?-l:Math.max(0,l-s)}function ko(m,t,s,l,h){const g=m-s;let y;return y=g<0?Math.min(-g,1+g-h):g>1?Math.min(Math.max(g-h,0),1-g):0,Math.max(y,Nl(t,l,h))}class Ec{constructor(){this._boundingVolumeCache=new Im(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,s,l,h){const g=1<<l.z,y=1/g,b=l.x/g,P=l.y/g;let M=2;return M=Math.min(M,ko(t,s,b,P,y)),M=Math.min(M,ko(t,s,b+.5,-P-y,y)),M=Math.min(M,ko(t,s,b+.5,2-P-y,y)),M}getWrap(t,s,l){const h=1<<s.z,g=1/h,y=s.x/h,b=Nl(t.x,y,g),P=Nl(t.x,y-1,g),M=Nl(t.x,y+1,g),k=Math.min(b,P,M);return k===M?1:k===P?-1:0}allowVariableZoom(t,s){return Jt(t,s)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,s,l,h){return this._boundingVolumeCache.getTileBoundingVolume(t,s,l,h)}_computeTileBoundingVolume(t,s,l,h){var g,y;let b=0,P=0;if(h!=null&&h.terrain){const M=new c.a2(t.z,s,t.z,t.x,t.y),k=h.terrain.getMinMaxElevation(M);b=(g=k.minElevation)!==null&&g!==void 0?g:Math.min(0,l),P=(y=k.maxElevation)!==null&&y!==void 0?y:Math.max(0,l)}if(b/=c.bE,P/=c.bE,b+=1,P+=1,t.z<=0)return Io.fromAabb([-P,-P,-P],[P,P,P]);if(t.z===1)return Io.fromAabb([t.x===0?-P:0,t.y===0?0:-P,-P],[t.x===0?0:P,t.y===0?P:0,P]);{const M=[zi(0,0,t.x,t.y,t.z),zi(c.a5,0,t.x,t.y,t.z),zi(c.a5,c.a5,t.x,t.y,t.z),zi(0,c.a5,t.x,t.y,t.z)],k=[];for(const Ee of M)k.push(c.a$([],Ee,P));if(P!==b)for(const Ee of M)k.push(c.a$([],Ee,b));t.y===0&&k.push([0,1,0]),t.y===(1<<t.z)-1&&k.push([0,-1,0]);const R=[1,1,1],D=[-1,-1,-1];for(const Ee of k)for(let Ce=0;Ce<3;Ce++)R[Ce]=Math.min(R[Ce],Ee[Ce]),D[Ce]=Math.max(D[Ce],Ee[Ce]);const B=zi(c.a5/2,c.a5/2,t.x,t.y,t.z),U=c.b4([],[0,1,0],B);c.b3(U,U);const W=c.b4([],B,U);c.b3(W,W);const X=c.b4([],M[2],M[1]);c.b3(X,X);const H=c.b4([],M[0],M[3]);c.b3(H,H),k.push(c.a$([],B,P)),t.y>=(1<<t.z)/2&&k.push(c.a$([],zi(c.a5/2,0,t.x,t.y,t.z),P)),t.y<(1<<t.z)/2&&k.push(c.a$([],zi(c.a5/2,c.a5,t.x,t.y,t.z),P));const ee=Da(B,k),ae=Da(W,k),Q=[-B[0],-B[1],-B[2],ee.max],ie=[B[0],B[1],B[2],-ee.min],ce=[-W[0],-W[1],-W[2],ae.max],re=[W[0],W[1],W[2],-ae.min],ge=[...X,0],ke=[...H,0],Se=[];return t.y===0?Se.push(c.bD(ke,ge,Q),c.bD(ke,ge,ie)):Se.push(c.bD(ce,ge,Q),c.bD(ce,ge,ie),c.bD(ce,ke,Q),c.bD(ce,ke,ie)),t.y===(1<<t.z)-1?Se.push(c.bD(ke,ge,Q),c.bD(ke,ge,ie)):Se.push(c.bD(re,ge,Q),c.bD(re,ge,ie),c.bD(re,ke,Q),c.bD(re,ke,ie)),new Io(Se,[Q,ie,ce,re,ge,ke],R,D)}}}function Da(m,t){let s=1/0,l=-1/0;for(const h of t){const g=c.b5(m,h);s=Math.min(s,g),l=Math.max(l,g)}return{min:s,max:l}}class Ao{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,s,l){return this._helper.interpolatePadding(t,s,l)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,s){this._helper.resize(t,s)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,s){this._helper.overrideNearFarZ(t,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(t){this._cachedClippingPlane=c.bF(),this._projectionMatrix=c.bj(),this._globeViewProjMatrix32f=c.bi(),this._globeViewProjMatrixNoCorrection=c.bj(),this._globeViewProjMatrixNoCorrectionInverted=c.bj(),this._globeProjMatrixInverted=c.bj(),this._cameraPosition=c.bz(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(s,l)=>{const h=c.an(s.lat,-c.ao,c.ao),g=c.an(+l,this.minZoom+mr(0,h),this.maxZoom);return{center:new c.V(s.lng,h),zoom:g}},this.applyConstrain=(s,l)=>this._helper.applyConstrain(s,l),this._helper=new Ls({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(s,l)=>this.defaultConstrain(s,l)},t),this._coveringTilesDetailsProvider=new Ec}clone(){const t=new Ao;return t.apply(this,!1),t}apply(t,s,l){this._globeLatitudeErrorCorrectionRadians=l||0,this._helper.apply(t,s)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=c.bz();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:s,applyGlobeMatrix:l}=t,h=this._helper.getMercatorTileCoordinates(s);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:h,clippingPlane:this._cachedClippingPlane,projectionTransition:l?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const s=this.pitchInRadians,l=this.cameraToCenterDistance/t,h=Math.sin(s)*l,g=Math.cos(s)*l+1,y=1/Math.sqrt(h*h+g*g)*1;let b=-h,P=g;const M=Math.sqrt(b*b+P*P);b/=M,P/=M;const k=[0,b,P];c.bG(k,k,[0,0,0],-this.bearingInRadians),c.bH(k,k,[0,0,0],-1*this.center.lat*Math.PI/180),c.bI(k,k,[0,0,0],this.center.lng*Math.PI/180);const R=1/c.b7(k);return c.a$(k,k,R),[...k,-y*R]}isLocationOccluded(t){return!this.isSurfacePointVisible(nr(t))}transformLightDirection(t){const s=this._helper._center.lng*Math.PI/180,l=this._helper._center.lat*Math.PI/180,h=Math.cos(l),g=[Math.sin(s)*h,Math.sin(l),Math.cos(s)*h],y=[g[2],0,-g[0]],b=[0,0,0];c.b4(b,y,g),c.b3(y,y),c.b3(b,b);const P=[0,0,0];return c.b3(P,[y[0]*t[0]+b[0]*t[1]+g[0]*t[2],y[1]*t[0]+b[1]*t[1]+g[1]*t[2],y[2]*t[0]+b[2]*t[1]+g[2]*t[2]]),P}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,s,l){const h=function(b,P,M){const k=1/(1<<M.z);return new c.a9(b/c.a5*k+M.x*k,P/c.a5*k+M.y*k)}(t,s,l.canonical),g=(y=h.y,[c.by(h.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-y*Math.PI*2))-.5*Math.PI]);var y;return this.getCircleRadiusCorrection()/Math.cos(g[1])}projectTileCoordinates(t,s,l,h){const g=l.canonical,y=zi(t,s,g.x,g.y,g.z),b=1+(h?h(t,s):0)/c.bE,P=[y[0]*b,y[1]*b,y[2]*b,1];c.aH(P,P,this._globeViewProjMatrixNoCorrection);const M=this._cachedClippingPlane,k=M[0]*y[0]+M[1]*y[1]+M[2]*y[2]+M[3]<0;return{point:new c.P(P[0]/P[3],P[1]/P[3]),signedDistanceFromCamera:P[3],isOccluded:k}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=Os(this.worldSize,this.center.lat),s=c.bk(),l=c.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),c.be(s,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const h=this.centerOffset;s[8]=2*-h.x/this._helper._width,s[9]=2*h.y/this._helper._height,this._projectionMatrix=c.bf(s),this._globeProjMatrixInverted=c.bk(),c.aB(this._globeProjMatrixInverted,s),c.O(s,s,[0,0,-this.cameraToCenterDistance]),c.bg(s,s,this.rollInRadians),c.bh(s,s,-this.pitchInRadians),c.bg(s,s,this.bearingInRadians),c.O(s,s,[0,0,-t]);const g=c.bz();g[0]=t,g[1]=t,g[2]=t,c.bh(l,s,this.center.lat*Math.PI/180),c.bJ(l,l,-this.center.lng*Math.PI/180),c.Q(l,l,g),this._globeViewProjMatrixNoCorrection=l,c.bh(s,s,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),c.bJ(s,s,-this.center.lng*Math.PI/180),c.Q(s,s,g),this._globeViewProjMatrix32f=new Float32Array(s),this._globeViewProjMatrixNoCorrectionInverted=c.bk(),c.aB(this._globeViewProjMatrixNoCorrectionInverted,l);const y=c.bz();this._cameraPosition=c.bz(),this._cameraPosition[2]=this.cameraToCenterDistance/t,c.bG(this._cameraPosition,this._cameraPosition,y,-this.rollInRadians),c.bH(this._cameraPosition,this._cameraPosition,y,this.pitchInRadians),c.bG(this._cameraPosition,this._cameraPosition,y,-this.bearingInRadians),c.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),c.bH(this._cameraPosition,this._cameraPosition,y,-this.center.lat*Math.PI/180),c.bI(this._cameraPosition,this._cameraPosition,y,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const b=c.bf(this._globeViewProjMatrixNoCorrectionInverted);c.Q(b,b,[1,1,-1]),this._cachedFrustum=An.fromInvProjectionMatrix(b,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){c.w("calculateFogMatrix is not supported on globe projection.");const s=c.bk();return c.ar(s),s}getVisibleUnwrappedCoordinates(t){return[new c.bc(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&c.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,s){if(!this._globeViewProjMatrixNoCorrection)return 1;const l=nr(t);c.a$(l,l,1+s/c.bE);const h=c.bF();return c.aH(h,[l[0],l[1],l[2],1],this._globeViewProjMatrixNoCorrection),h[2]/h[3]}populateCache(t){}getBounds(){const t=.5*this.width,s=.5*this.height,l=[new c.P(0,0),new c.P(t,0),new c.P(this.width,0),new c.P(this.width,s),new c.P(this.width,this.height),new c.P(t,this.height),new c.P(0,this.height),new c.P(0,s)],h=[];for(const R of l)h.push(this.unprojectScreenPoint(R));let g=0,y=0,b=0,P=0;const M=this.center;for(const R of h){const D=c.bK(M.lng,R.lng),B=c.bK(M.lat,R.lat);D<y&&(y=D),D>g&&(g=D),B<P&&(P=B),B>b&&(b=B)}const k=[M.lng+y,M.lat+P,M.lng+g,M.lat+b];return this.isSurfacePointOnScreen([0,1,0])&&(k[3]=90,k[0]=-180,k[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(k[1]=-90,k[0]=-180,k[2]=180),new dr(k)}calculateCenterFromCameraLngLatAlt(t,s,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(t,s,l,h)}setLocationAtPoint(t,s){const l=nr(this.unprojectScreenPoint(s)),h=nr(t),g=c.bz();c.bL(g);const y=c.bz();c.bI(y,l,g,-this.center.lng*Math.PI/180),c.bH(y,y,g,this.center.lat*Math.PI/180);const b=h[0]*h[0]+h[2]*h[2],P=y[0]*y[0];if(b<P)return;const M=Math.sqrt(b-P),k=-M,R=c.bM(h[0],h[2],y[0],M),D=c.bM(h[0],h[2],y[0],k),B=c.bz();c.bI(B,h,g,-R);const U=c.bM(B[1],B[2],y[1],y[2]),W=c.bz();c.bI(W,h,g,-D);const X=c.bM(W[1],W[2],y[1],y[2]),H=.5*Math.PI,ee=U>=-H&&U<=H,ae=X>=-H&&X<=H;let Q,ie;if(ee&&ae){const ke=this.center.lng*Math.PI/180,Se=this.center.lat*Math.PI/180;c.bN(R,ke)+c.bN(U,Se)<c.bN(D,ke)+c.bN(X,Se)?(Q=R,ie=U):(Q=D,ie=X)}else if(ee)Q=R,ie=U;else{if(!ae)return;Q=D,ie=X}const ce=Q/Math.PI*180,re=ie/Math.PI*180,ge=this.center.lat;this.setCenter(new c.V(ce,c.an(re,-90,90))),this.setZoom(this.zoom+mr(ge,this.center.lat))}locationToScreenPoint(t,s){const l=nr(t);if(s){const h=s.getElevationForLngLatZoom(t,this._helper._tileZoom);c.a$(l,l,1+h/c.bE)}return this._projectSurfacePointToScreen(l)}_projectSurfacePointToScreen(t){const s=c.bF();return c.aH(s,[...t,1],this._globeViewProjMatrixNoCorrection),s[0]/=s[3],s[1]/=s[3],new c.P((.5*s[0]+.5)*this.width,(.5*-s[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,s){if(s){const l=s.pointCoordinate(t);if(l)return l}return c.a9.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,s){var l;return(l=this.screenPointToMercatorCoordinate(t,s))===null||l===void 0?void 0:l.toLngLat()}isPointOnMapSurface(t,s){const l=this._cameraPosition,h=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(l,h)}getRayDirectionFromPixel(t){const s=c.bF();s[0]=t.x/this.width*2-1,s[1]=-1*(t.y/this.height*2-1),s[2]=1,s[3]=1,c.aH(s,s,this._globeViewProjMatrixNoCorrectionInverted),s[0]/=s[3],s[1]/=s[3],s[2]/=s[3];const l=c.bz();l[0]=s[0]-this._cameraPosition[0],l[1]=s[1]-this._cameraPosition[1],l[2]=s[2]-this._cameraPosition[2];const h=c.bz();return c.b3(h,l),h}isSurfacePointVisible(t){const s=this._cachedClippingPlane;return s[0]*t[0]+s[1]*t[1]+s[2]*t[2]+s[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const s=c.bF();return c.aH(s,[...t,1],this._globeViewProjMatrixNoCorrection),s[0]/=s[3],s[1]/=s[3],s[2]/=s[3],s[0]>-1&&s[0]<1&&s[1]>-1&&s[1]<1&&s[2]>-1&&s[2]<1}rayPlanetIntersection(t,s){const l=c.b5(t,s),h=c.bz(),g=c.bz();c.a$(g,s,l),c.b2(h,t,g);const y=1-c.b5(h,h);if(y<0)return null;const b=c.b5(t,t)-1,P=-l+(l<0?1:-1)*Math.sqrt(y),M=b/P,k=P;return{tMin:Math.min(M,k),tMax:Math.max(M,k)}}unprojectScreenPoint(t){const s=this._cameraPosition,l=this.getRayDirectionFromPixel(t),h=this.rayPlanetIntersection(s,l);if(h){const k=c.bz();c.b0(k,s,[l[0]*h.tMin,l[1]*h.tMin,l[2]*h.tMin]);const R=c.bz();return c.b3(R,k),Sc(R)}const g=this._cachedClippingPlane,y=g[0]*l[0]+g[1]*l[1]+g[2]*l[2],b=-c.bb(g,s)/y,P=c.bz();if(b>0)c.b0(P,s,[l[0]*b,l[1]*b,l[2]*b]);else{const k=c.bz();c.b0(k,s,[2*l[0],2*l[1],2*l[2]]);const R=c.bb(this._cachedClippingPlane,k);c.b2(P,k,[this._cachedClippingPlane[0]*R,this._cachedClippingPlane[1]*R,this._cachedClippingPlane[2]*R])}const M=function(k){const R=c.bz();return R[0]=k[0]*-k[3],R[1]=k[1]*-k[3],R[2]=k[2]*-k[3],{center:R,radius:Math.sqrt(1-k[3]*k[3])}}(g);return Sc(function(k,R,D){const B=c.bz();c.b2(B,D,k);const U=c.bz();return c.bA(U,k,B,R/c.b9(B)),U}(M.center,M.radius,P))}getMatrixForModel(t,s){const l=c.V.convert(t),h=1/c.bE,g=c.bj();return c.bJ(g,g,l.lng/180*Math.PI),c.bh(g,g,-l.lat/180*Math.PI),c.O(g,g,[0,0,1+s/c.bE]),c.bh(g,g,.5*Math.PI),c.Q(g,g,[h,h,h]),g}getProjectionDataForCustomLayer(t=!0){const s=this.getProjectionData({overscaledTileID:new c.a2(0,0,0,0,0),applyGlobeMatrix:t});return s.tileMercatorCoords=[0,0,1,1],s}getFastPathSimpleProjectionMatrix(t){}}class zo{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,s,l){return this._helper.interpolatePadding(t,s,l)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,s,l=!0){this._helper.resize(t,s,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,s){this._helper.overrideNearFarZ(t,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,s){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=s,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(t){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(s,l)=>this.currentTransform.defaultConstrain(s,l),this.applyConstrain=(s,l)=>this._helper.applyConstrain(s,l),this._helper=new Ls({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(s,l)=>this.defaultConstrain(s,l)},t),this._globeness=1,this._mercatorTransform=new Fs,this._verticalPerspectiveTransform=new Ao}clone(){const t=new zo;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this,!1),t}apply(t,s){this._helper.apply(t,s),this._mercatorTransform.apply(this,!1),this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const s=this._mercatorTransform.getProjectionData(t),l=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?l.mainMatrix:s.mainMatrix,clippingPlane:l.clippingPlane,tileMercatorCoords:l.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:s.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return c.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return c.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,s,l){const h=this._mercatorTransform.getPitchedTextCorrection(t,s,l),g=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,s,l);return c.bu(h,g,this._globeness)}projectTileCoordinates(t,s,l,h){return this.currentTransform.projectTileCoordinates(t,s,l,h)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,s){return this.currentTransform.lngLatToCameraDepth(t,s)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(t,s,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(t,s,l,h)}setLocationAtPoint(t,s){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,s),void this.apply(this._mercatorTransform,!1);this._verticalPerspectiveTransform.setLocationAtPoint(t,s),this.apply(this._verticalPerspectiveTransform,!1)}locationToScreenPoint(t,s){return this.currentTransform.locationToScreenPoint(t,s)}screenPointToMercatorCoordinate(t,s){return this.currentTransform.screenPointToMercatorCoordinate(t,s)}screenPointToLocation(t,s){return this.currentTransform.screenPointToLocation(t,s)}isPointOnMapSurface(t,s){return this.currentTransform.isPointOnMapSurface(t,s)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,s){return this.currentTransform.getMatrixForModel(t,s)}getProjectionDataForCustomLayer(t=!0){const s=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return s;const l=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return l.fallbackMatrix=s.mainMatrix,l}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class Fr{get useGlobeControls(){return!0}handlePanInertia(t,s){const l=Bd(t,s);return Math.abs(l.lng-s.center.lng)>180&&(l.lng=s.center.lng+179.5*Math.sign(l.lng-s.center.lng)),{easingCenter:l,easingOffset:new c.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,s){const l=t.around,h=s.screenPointToLocation(l);t.bearingDelta&&s.setBearing(s.bearing+t.bearingDelta),t.pitchDelta&&s.setPitch(s.pitch+t.pitchDelta),t.rollDelta&&s.setRoll(s.roll+t.rollDelta);const g=s.zoom;t.zoomDelta&&s.setZoom(s.zoom+t.zoomDelta);const y=s.zoom-g;if(y===0)return;const b=c.bK(s.center.lng,h.lng),P=b/(Math.abs(b/180)+1),M=c.bK(s.center.lat,h.lat),k=s.getRayDirectionFromPixel(l),R=s.cameraPosition,D=-1*c.b5(R,k),B=c.bz();c.b0(B,R,[k[0]*D,k[1]*D,k[2]*D]);const U=c.b7(B)-1,W=Math.exp(.5*-Math.max(U-.3,0)),X=Os(s.worldSize,s.center.lat)/Math.min(s.width,s.height),H=c.bx(X,.9,.5,1,.25),ee=(1-c.aq(-y))*Math.min(W,H),ae=s.center.lat,Q=s.zoom,ie=new c.V(s.center.lng+P*ee,c.an(s.center.lat+M*ee,-c.ao,c.ao));s.setLocationAtPoint(h,l);const ce=s.center,re=c.bx(Math.abs(b),45,85,0,1),ge=c.bx(X,.75,.35,0,1),ke=Math.pow(Math.max(re,ge),.25),Se=c.bK(ce.lng,ie.lng),Ee=c.bK(ce.lat,ie.lat);s.setCenter(new c.V(ce.lng+Se*ke,ce.lat+Ee*ke).wrap()),s.setZoom(Q+mr(ae,s.center.lat))}handleMapControlsPan(t,s,l){if(!t.panDelta)return;const h=s.center.lat,g=s.zoom;s.setCenter(Bd(t.panDelta,s).wrap()),s.setZoom(g+mr(h,s.center.lat))}cameraForBoxAndBearing(t,s,l,h,g){const y=wc(t,s,l,h,g),b=s.left/g.width*2-1,P=(g.width-s.right)/g.width*2-1,M=s.top/g.height*-2+1,k=(g.height-s.bottom)/g.height*-2+1,R=c.bK(l.getWest(),l.getEast())<0,D=R?l.getEast():l.getWest(),B=R?l.getWest():l.getEast(),U=Math.max(l.getNorth(),l.getSouth()),W=Math.min(l.getNorth(),l.getSouth()),X=D+.5*c.bK(D,B),H=U+.5*c.bK(U,W),ee=g.clone();ee.setCenter(y.center),ee.setBearing(y.bearing),ee.setPitch(0),ee.setRoll(0),ee.setZoom(y.zoom);const ae=ee.modelViewProjectionMatrix,Q=[nr(l.getNorthWest()),nr(l.getNorthEast()),nr(l.getSouthWest()),nr(l.getSouthEast()),nr(new c.V(B,H)),nr(new c.V(D,H)),nr(new c.V(X,U)),nr(new c.V(X,W))],ie=nr(y.center);let ce=Number.POSITIVE_INFINITY;for(const re of Q)b<0&&(ce=Fr.getLesserNonNegativeNonNull(ce,Fr.solveVectorScale(re,ie,ae,"x",b))),P>0&&(ce=Fr.getLesserNonNegativeNonNull(ce,Fr.solveVectorScale(re,ie,ae,"x",P))),M>0&&(ce=Fr.getLesserNonNegativeNonNull(ce,Fr.solveVectorScale(re,ie,ae,"y",M))),k<0&&(ce=Fr.getLesserNonNegativeNonNull(ce,Fr.solveVectorScale(re,ie,ae,"y",k)));if(Number.isFinite(ce)&&ce!==0)return y.zoom=ee.zoom+c.at(ce),y;Zi()}handleJumpToCenterZoom(t,s){const l=t.center.lat,h=t.applyConstrain(s.center?c.V.convert(s.center):t.center,t.zoom).center;t.setCenter(h.wrap());const g=s.zoom!==void 0?+s.zoom:t.zoom+mr(l,h.lat);t.zoom!==g&&t.setZoom(g)}handleEaseTo(t,s){const l=t.zoom,h=t.center,g=t.padding,y={roll:t.roll,pitch:t.pitch,bearing:t.bearing},b={roll:s.roll===void 0?t.roll:s.roll,pitch:s.pitch===void 0?t.pitch:s.pitch,bearing:s.bearing===void 0?t.bearing:s.bearing},P=s.zoom!==void 0,M=!t.isPaddingEqual(s.padding);let k=!1;const R=s.center?c.V.convert(s.center):h,D=t.applyConstrain(R,l).center;ps(t,D);const B=t.clone();B.setCenter(D),B.setZoom(P?+s.zoom:l+mr(h.lat,R.lat)),B.setBearing(s.bearing);const U=new c.P(c.an(t.centerPoint.x+s.offsetAsPoint.x,0,t.width),c.an(t.centerPoint.y+s.offsetAsPoint.y,0,t.height));B.setLocationAtPoint(D,U);const W=(s.offset&&s.offsetAsPoint.mag())>0?B.center:D,X=P?+s.zoom:l+mr(h.lat,W.lat),H=l+mr(h.lat,0),ee=X+mr(W.lat,0),ae=c.bK(h.lng,W.lng),Q=c.bK(h.lat,W.lat),ie=c.aq(ee-H);return k=X!==l,{easeFunc:ce=>{if(c.bo(y,b)||Rd({startEulerAngles:y,endEulerAngles:b,tr:t,k:ce,useSlerp:y.roll!=b.roll}),M&&t.interpolatePadding(g,s.padding,ce),s.around)c.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(s.around,s.aroundPoint);else{const re=ee>H?Math.min(2,ie):Math.max(.5,ie),ge=Math.pow(re,1-ce),ke=Od(h,ae,Q,ce*ge);t.setCenter(ke.wrap())}if(k){const re=c.G.number(H,ee,ce)+mr(0,t.center.lat);t.setZoom(re)}},isZooming:k,elevationCenter:W}}handleFlyTo(t,s){const l=s.zoom!==void 0,h=t.center,g=t.zoom,y=t.padding,b=!t.isPaddingEqual(s.padding),P=t.applyConstrain(c.V.convert(s.center||s.locationAtOffset),g).center,M=l?+s.zoom:t.zoom+mr(t.center.lat,P.lat),k=t.clone();k.setCenter(P),k.setZoom(M),k.setBearing(s.bearing);const R=new c.P(c.an(t.centerPoint.x+s.offsetAsPoint.x,0,t.width),c.an(t.centerPoint.y+s.offsetAsPoint.y,0,t.height));k.setLocationAtPoint(P,R);const D=k.center;ps(t,D);const B=function(Q,ie,ce){const re=nr(ie),ge=nr(ce),ke=c.b5(re,ge),Se=Math.acos(ke),Ee=wn(Q);return Se/(2*Math.PI)*Ee}(t,h,D),U=g+mr(h.lat,0),W=M+mr(D.lat,0),X=c.aq(W-U);let H;if(typeof s.minZoom=="number"){const Q=+s.minZoom+mr(D.lat,0),ie=Math.min(Q,U,W)+mr(0,D.lat),ce=t.applyConstrain(D,ie).zoom+mr(D.lat,0);H=c.aq(ce-U)}const ee=c.bK(h.lng,D.lng),ae=c.bK(h.lat,D.lat);return{easeFunc:(Q,ie,ce,re)=>{const ge=Od(h,ee,ae,ce);b&&t.interpolatePadding(y,s.padding,Q);const ke=Q===1?D:ge;t.setCenter(ke.wrap());const Se=U+c.at(ie);t.setZoom(Q===1?M:Se+mr(0,ke.lat))},scaleOfZoom:X,targetCenter:D,scaleOfMinZoom:H,pixelPathLength:B}}static solveVectorScale(t,s,l,h,g){const y=h==="x"?[l[0],l[4],l[8],l[12]]:[l[1],l[5],l[9],l[13]],b=[l[3],l[7],l[11],l[15]],P=t[0]*y[0]+t[1]*y[1]+t[2]*y[2],M=t[0]*b[0]+t[1]*b[1]+t[2]*b[2],k=s[0]*y[0]+s[1]*y[1]+s[2]*y[2],R=s[0]*b[0]+s[1]*b[1]+s[2]*b[2];return k+g*M===P+g*R||b[3]*(P-k)+y[3]*(R-M)+P*R==k*M?null:(k+y[3]-g*R-g*b[3])/(k-P-g*R+g*M)}static getLesserNonNegativeNonNull(t,s){return s!==null&&s>=0&&s<t?s:t}}class Nd{constructor(t){this._globe=t,this._mercatorCameraHelper=new Bs,this._verticalPerspectiveCameraHelper=new Fr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,s){return this.currentHelper.handlePanInertia(t,s)}handleMapControlsRollPitchBearingZoom(t,s){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,s)}handleMapControlsPan(t,s,l){this.currentHelper.handleMapControlsPan(t,s,l)}cameraForBoxAndBearing(t,s,l,h,g){return this.currentHelper.cameraForBoxAndBearing(t,s,l,h,g)}handleJumpToCenterZoom(t,s){this.currentHelper.handleJumpToCenterZoom(t,s)}handleEaseTo(t,s){return this.currentHelper.handleEaseTo(t,s)}handleFlyTo(t,s){return this.currentHelper.handleFlyTo(t,s)}}const Do=(m,t)=>c.B(m,t&&t.filter(s=>s.identifier!=="source.canvas")),Ra=c.bO();class Ns extends c.E{constructor(t,s={}){var l,h;super(),this._rtlPluginLoaded=()=>{for(const y in this.tileManagers){const b=this.tileManagers[y].getSource().type;b!=="vector"&&b!=="geojson"||this.tileManagers[y].reload()}},this.map=t,this.dispatcher=new ui(As(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",(y,b)=>this.getGlyphs(y,b)),this.dispatcher.registerMessageHandler("GI",(y,b)=>this.getImages(y,b)),this.dispatcher.registerMessageHandler("GDA",(y,b)=>this.getDashes(y,b)),this.imageManager=new br,this.imageManager.setEventedParent(this);const g=((l=t._container)===null||l===void 0?void 0:l.lang)||typeof document<"u"&&((h=document.documentElement)===null||h===void 0?void 0:h.lang)||void 0;this.glyphManager=new en(t._requestManager,s.localIdeographFontFamily,g),this.lineAtlas=new Ii(256,512),this.crossTileSymbolIndex=new kn,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",c.bP()),ve().on(le,this._rtlPluginLoaded),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const b=this.tileManagers[y.sourceId];if(!b)return;const P=b.getSource();if(P&&P.vectorLayerIds)for(const M in this._layers){const k=this._layers[M];k.source===P.id&&this._validateLayer(k)}})}_setInitialValues(){var t;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new c.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((t=this.crossTileSymbolIndex)===null||t===void 0?void 0:t.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(t,s){var l,h,g;this._checkLoaded();const y=s===null?(g=(h=(l=this.stylesheet.state)===null||l===void 0?void 0:l[t])===null||h===void 0?void 0:h.default)!==null&&g!==void 0?g:null:s;if(c.bR(y,this._globalState[t]))return this;this._globalState[t]=y,this._applyGlobalStateChanges([t])}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const s=[];for(const l in t)!c.bR(this._globalState[l],t[l].default)&&(s.push(l),this._globalState[l]=t[l].default);this._applyGlobalStateChanges(s)}_applyGlobalStateChanges(t){if(t.length===0)return;const s=new Set,l={};for(const h of t){l[h]=this._globalState[h];for(const g in this._layers){const y=this._layers[g],b=y.getLayoutAffectingGlobalStateRefs(),P=y.getPaintAffectingGlobalStateRefs(),M=y.getVisibilityAffectingGlobalStateRefs();if(b.has(h)&&s.add(y.source),P.has(h))for(const{name:k,value:R}of P.get(h))this._updatePaintProperty(y,k,R);M!=null&&M.has(h)&&(y.recalculateVisibility(),this._updateLayer(y))}}this.dispatcher.broadcast("UGS",l);for(const h in this.tileManagers)s.has(h)&&(this._reloadSource(h),this._changed=!0)}loadURL(t,s={},l){this.fire(new c.l("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const h=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const g=this._loadStyleRequest;c.j(h,this._loadStyleRequest).then(y=>{this._loadStyleRequest=null,this._load(y.data,s,l)}).catch(y=>{this._loadStyleRequest=null,y&&!g.signal.aborted&&this.fire(new c.k(y))})}loadJSON(t,s={},l){this.fire(new c.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Ae.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,s.validate=s.validate!==!1,this._load(t,s,l)}).catch(()=>{})}loadEmpty(){this.fire(new c.l("dataloading",{dataType:"style"})),this._load(Ra,{validate:!1})}_load(t,s,l){var h,g;let y=s.transformStyle?s.transformStyle(l,t):t;if(!s.validate||!Do(this,c.C(y))){y=Object.assign({},y),this._loaded=!0,this.stylesheet=y;for(const b in y.sources)this.addSource(b,y.sources[b],{validate:!1});y.sprite?this._loadSprite(y.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(y.glyphs),this._createLayers(),this.light=new vt(this.stylesheet.light),this._setProjectionInternal(((h=this.stylesheet.projection)===null||h===void 0?void 0:h.type)||"mercator"),this.sky=new rr(this.stylesheet.sky),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.fire(new c.l("data",{dataType:"style"})),this.fire(new c.l("style.load"))}}_createLayers(){var t,s,l;const h=c.bS(this.stylesheet.layers);this.setGlobalState((t=this.stylesheet.state)!==null&&t!==void 0?t:null),this.dispatcher.broadcast("SL",h),this._order=h.map(g=>g.id),this._layers={},this._serializedLayers=null;for(const g of h){const y=c.bT(g,this._globalState);if(y.setEventedParent(this,{layer:{id:g.id}}),this._layers[g.id]=y,c.bU(y)&&this.tileManagers[y.source]){const b=(l=(s=g.paint)===null||s===void 0?void 0:s["raster-fade-duration"])!==null&&l!==void 0?l:y.paint.get("raster-fade-duration");this.tileManagers[y.source].setRasterFadeDuration(b)}}}_loadSprite(t,s=!1,l=void 0){this.imageManager.setLoaded(!1);const h=new AbortController;let g;this._spriteRequest=h,function(y,b,P,M){return c._(this,void 0,void 0,function*(){const k=_t(y),R=P>1?"@2x":"",D={},B={};for(const{id:U,url:W}of k){const X=b.transformRequest(at(W,R,".json"),"SpriteJSON");D[U]=c.j(X,M);const H=b.transformRequest(at(W,R,".png"),"SpriteImage");B[U]=We.getImage(H,M)}return yield Promise.all([...Object.values(D),...Object.values(B)]),function(U,W){return c._(this,void 0,void 0,function*(){const X={};for(const H in U){X[H]={};const ee=Ae.getImageCanvasContext((yield W[H]).data),ae=(yield U[H]).data;for(const Q in ae){const{width:ie,height:ce,x:re,y:ge,sdf:ke,pixelRatio:Se,stretchX:Ee,stretchY:Ce,content:$e,textFitWidth:Ge,textFitHeight:Ne}=ae[Q];X[H][Q]={data:null,pixelRatio:Se,sdf:ke,stretchX:Ee,stretchY:Ce,content:$e,textFitWidth:Ge,textFitHeight:Ne,spriteData:{width:ie,height:ce,x:re,y:ge,context:ee}}}}return X})}(D,B)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(y=>{if(this._spriteRequest=null,y)for(const b in y){this._spritesImagesIds[b]=[];const P=this._spritesImagesIds[b]?this._spritesImagesIds[b].filter(M=>!(M in y)):[];for(const M of P)this.imageManager.removeImage(M),this._changedImages[M]=!0;for(const M in y[b]){const k=b==="default"?M:`${b}:${M}`;this._spritesImagesIds[b].push(k),k in this.imageManager.images?this.imageManager.updateImage(k,y[b][M],!1):this.imageManager.addImage(k,y[b][M]),s&&(this._changedImages[k]=!0)}}}).catch(y=>{this._spriteRequest=null,g=y,h.signal.aborted||this.fire(new c.k(g))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"})),l&&l(g)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}_validateLayer(t){const s=this.tileManagers[t.source];if(!s)return;const l=t.sourceLayer;if(!l)return;const h=s.getSource();(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(l)===-1)&&this.fire(new c.k(new Error(`Source layer "${l}" does not exist on source "${h.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.tileManagers)if(!this.tileManagers[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,s=!1){const l=this._serializedAllLayers();if(!t||t.length===0)return Object.values(s?c.bV(l):l);const h=[];for(const g of t)if(l[g]){const y=s?c.bV(l[g]):l[g];h.push(y)}return h}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const s=Object.keys(this._layers);for(const l of s){const h=this._layers[l];h.type!=="custom"&&(t[l]=h.serialize())}return t}hasTransitions(){var t,s,l;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((s=this.sky)===null||s===void 0)&&s.hasTransition()||!((l=this.projection)===null||l===void 0)&&l.hasTransition())return!0;for(const h in this.tileManagers)if(this.tileManagers[h].hasTransition())return!0;for(const h in this._layers)if(this._layers[h].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const s=this._changed;if(s){const h=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(h.length||g.length)&&this._updateWorkerLayers(h,g);for(const y in this._updatedSources){const b=this._updatedSources[y];if(b==="reload")this._reloadSource(y);else{if(b!=="clear")throw new Error(`Invalid action ${b}`);this._clearSource(y)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const y in this._updatedPaintProps)this._layers[y].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const l={};for(const h in this.tileManagers){const g=this.tileManagers[h];l[h]=g.used,g.used=!1}for(const h of this._order){const g=this._layers[h];g.recalculate(t,this._availableImages),!g.isHidden(t.zoom)&&g.source&&(this.tileManagers[g.source].used=!0)}for(const h in l){const g=this.tileManagers[h];!!l[h]!=!!g.used&&g.fire(new c.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:h}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,s&&this.fire(new c.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const s in this.tileManagers)this.tileManagers[s].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.tileManagers)this.tileManagers[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,s){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,s={}){var l;this._checkLoaded();const h=this.serialize();if(t=s.transformStyle?s.transformStyle(h,t):t,((l=s.validate)===null||l===void 0||l)&&Do(this,c.C(t)))return!1;(t=c.bV(t)).layers=c.bS(t.layers);const g=c.bW(h,t),y=this._getOperationsToPerform(g);if(y.unimplemented.length>0)throw new Error(`Unimplemented: ${y.unimplemented.join(", ")}.`);if(y.operations.length===0)return!1;for(const b of y.operations)b();return this.stylesheet=t,this._serializedLayers=null,this.fire(new c.l("style.load",{style:this})),!0}_getOperationsToPerform(t){const s=[],l=[];for(const h of t)switch(h.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":s.push(()=>this.addLayer.apply(this,h.args));break;case"removeLayer":s.push(()=>this.removeLayer.apply(this,h.args));break;case"setPaintProperty":s.push(()=>this.setPaintProperty.apply(this,h.args));break;case"setLayoutProperty":s.push(()=>this.setLayoutProperty.apply(this,h.args));break;case"setFilter":s.push(()=>this.setFilter.apply(this,h.args));break;case"addSource":s.push(()=>this.addSource.apply(this,h.args));break;case"removeSource":s.push(()=>this.removeSource.apply(this,h.args));break;case"setLayerZoomRange":s.push(()=>this.setLayerZoomRange.apply(this,h.args));break;case"setLight":s.push(()=>this.setLight.apply(this,h.args));break;case"setGeoJSONSourceData":s.push(()=>this.setGeoJSONSourceData.apply(this,h.args));break;case"setGlyphs":s.push(()=>this.setGlyphs.apply(this,h.args));break;case"setSprite":s.push(()=>this.setSprite.apply(this,h.args));break;case"setTerrain":s.push(()=>this.map.setTerrain.apply(this,h.args));break;case"setSky":s.push(()=>this.setSky.apply(this,h.args));break;case"setProjection":this.setProjection.apply(this,h.args);break;case"setGlobalState":s.push(()=>this.setGlobalState.apply(this,h.args));break;case"setTransition":s.push(()=>{});break;default:l.push(h.command)}return{operations:s,unimplemented:l}}addImage(t,s){if(this.getImage(t))return this.fire(new c.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,s),this._afterImageUpdated(t)}updateImage(t,s){this.imageManager.updateImage(t,s)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new c.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,s,l={}){if(this._checkLoaded(),this.tileManagers[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(c.C.source,`sources.${t}`,s,null,l))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const h=this.tileManagers[t]=new Kn(t,s,this.dispatcher);h.style=this,h.setEventedParent(this,()=>({isSourceLoaded:h.loaded(),source:h.serialize(),sourceId:t})),h.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===t)return this.fire(new c.k(new Error(`Source "${t}" cannot be removed while layer "${l}" is using it.`)));const s=this.tileManagers[t];delete this.tileManagers[t],delete this._updatedSources[t],s.fire(new c.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,s){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const l=this.tileManagers[t].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(s),this._changed=!0}getSource(t){return this.tileManagers[t]&&this.tileManagers[t].getSource()}addLayer(t,s,l={}){this._checkLoaded();const h=t.id;if(this.getLayer(h))return void this.fire(new c.k(new Error(`Layer "${h}" already exists on this map.`)));let g;if(t.type==="custom"){if(Do(this,c.bX(t)))return;g=c.bT(t,this._globalState)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(h,t.source),t=c.bV(t),t=c.e(t,{source:h})),this._validate(c.C.layer,`layers.${h}`,t,{arrayIndex:-1},l))return;g=c.bT(t,this._globalState),this._validateLayer(g),g.setEventedParent(this,{layer:{id:h}})}const y=s?this._order.indexOf(s):this._order.length;if(s&&y===-1)this.fire(new c.k(new Error(`Cannot add layer "${h}" before non-existing layer "${s}".`)));else{if(this._order.splice(y,0,h),this._layerOrderChanged=!0,this._layers[h]=g,this._removedLayers[h]&&g.source&&g.type!=="custom"){const b=this._removedLayers[h];delete this._removedLayers[h],b.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",this.tileManagers[g.source].pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map)}}moveLayer(t,s){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new c.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===s)return;const l=this._order.indexOf(t);this._order.splice(l,1);const h=s?this._order.indexOf(s):this._order.length;s&&h===-1?this.fire(new c.k(new Error(`Cannot move layer "${t}" before non-existing layer "${s}".`))):(this._order.splice(h,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const s=this._layers[t];if(!s)return void this.fire(new c.k(new Error(`Cannot remove non-existing layer "${t}".`)));s.setEventedParent(null);const l=this._order.indexOf(t);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=s,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],s.onRemove&&s.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,s,l){this._checkLoaded();const h=this.getLayer(t);h?h.minzoom===s&&h.maxzoom===l||(s!=null&&(h.minzoom=s),l!=null&&(h.maxzoom=l),this._updateLayer(h)):this.fire(new c.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,s,l={}){this._checkLoaded();const h=this.getLayer(t);if(h){if(!c.bR(h.filter,s))return s==null?(h.setFilter(void 0),void this._updateLayer(h)):void(this._validate(c.C.filter,`layers.${h.id}.filter`,s,null,l)||(h.setFilter(c.bV(s)),this._updateLayer(h)))}else this.fire(new c.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return c.bV(this.getLayer(t).filter)}setLayoutProperty(t,s,l,h={}){this._checkLoaded();const g=this.getLayer(t);g?c.bR(g.getLayoutProperty(s),l)||(g.setLayoutProperty(s,l,h),this._updateLayer(g)):this.fire(new c.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,s){const l=this.getLayer(t);if(l)return l.getLayoutProperty(s);this.fire(new c.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,s,l,h={}){this._checkLoaded();const g=this.getLayer(t);g?c.bR(g.getPaintProperty(s),l)||this._updatePaintProperty(g,s,l,h):this.fire(new c.k(new Error(`Cannot style non-existing layer "${t}".`)))}_updatePaintProperty(t,s,l,h={}){t.setPaintProperty(s,l,h)&&this._updateLayer(t),c.bU(t)&&s==="raster-fade-duration"&&this.tileManagers[t.source].setRasterFadeDuration(l),this._changed=!0,this._updatedPaintProps[t.id]=!0,this._serializedLayers=null}getPaintProperty(t,s){return this.getLayer(t).getPaintProperty(s)}setFeatureState(t,s){this._checkLoaded();const l=t.source,h=t.sourceLayer,g=this.tileManagers[l];if(g===void 0)return void this.fire(new c.k(new Error(`The source '${l}' does not exist in the map's style.`)));const y=g.getSource().type;y==="geojson"&&h?this.fire(new c.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):y!=="vector"||h?(t.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),g.setFeatureState(h,t.id,s)):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,s){this._checkLoaded();const l=t.source,h=this.tileManagers[l];if(h===void 0)return void this.fire(new c.k(new Error(`The source '${l}' does not exist in the map's style.`)));const g=h.getSource().type,y=g==="vector"?t.sourceLayer:void 0;g!=="vector"||y?s&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new c.k(new Error("A feature id is required to remove its specific state property."))):h.removeFeatureState(y,t.id,s):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const s=t.source,l=t.sourceLayer,h=this.tileManagers[s];if(h!==void 0)return h.getSource().type!=="vector"||l?(t.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),h.getFeatureState(l,t.id)):void this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.k(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=c.bY(this.tileManagers,g=>g.serialize()),s=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,h=this.stylesheet;return c.bZ({version:h.version,name:h.name,metadata:h.metadata,light:h.light,sky:h.sky,center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,sprite:h.sprite,glyphs:h.glyphs,transition:h.transition,projection:h.projection,sources:t,layers:s,terrain:l},g=>g!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.tileManagers[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.tileManagers[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const s=y=>this._layers[y].type==="fill-extrusion",l={},h=[];for(let y=this._order.length-1;y>=0;y--){const b=this._order[y];if(s(b)){l[b]=y;for(const P of t){const M=P[b];if(M)for(const k of M)h.push(k)}}}h.sort((y,b)=>b.intersectionZ-y.intersectionZ);const g=[];for(let y=this._order.length-1;y>=0;y--){const b=this._order[y];if(s(b))for(let P=h.length-1;P>=0;P--){const M=h[P].feature;if(l[M.layer.id]<y)break;g.push(M),h.pop()}else for(const P of t){const M=P[b];if(M)for(const k of M)g.push(k.feature)}}return g}queryRenderedFeatures(t,s,l){s&&s.filter&&this._validate(c.C.filter,"queryRenderedFeatures.filter",s.filter,null,s);const h={};if(s&&s.layers){if(!(Array.isArray(s.layers)||s.layers instanceof Set))return this.fire(new c.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const M of s.layers){const k=this._layers[M];if(!k)return this.fire(new c.k(new Error(`The layer '${M}' does not exist in the map's style and cannot be queried for features.`))),[];h[k.source]=!0}}const g=[];s.availableImages=this._availableImages;const y=this._serializedAllLayers(),b=s.layers instanceof Set?s.layers:Array.isArray(s.layers)?new Set(s.layers):null,P=Object.assign(Object.assign({},s),{layers:b,globalState:this._globalState});for(const M in this.tileManagers)s.layers&&!h[M]||g.push(va(this.tileManagers[M],this._layers,y,t,P,l,this.map.terrain?(k,R,D)=>this.map.terrain.getElevation(k,R,D):void 0));return this.placement&&g.push(function(M,k,R,D,B,U,W){const X={},H=U.queryRenderedSymbols(D),ee=[];for(const ae of Object.keys(H).map(Number))ee.push(W[ae]);ee.sort(qr);for(const ae of ee){const Q=ae.featureIndex.lookupSymbolFeatures(H[ae.bucketInstanceId],k,ae.bucketIndex,ae.sourceLayerIndex,{filterSpec:B.filter,globalState:B.globalState},B.layers,B.availableImages,M);for(const ie in Q){const ce=X[ie]=X[ie]||[],re=Q[ie];re.sort((ge,ke)=>{const Se=ae.featureSortOrder;if(Se){const Ee=Se.indexOf(ge.featureIndex);return Se.indexOf(ke.featureIndex)-Ee}return ke.featureIndex-ge.featureIndex});for(const ge of re)ce.push(ge)}}return function(ae,Q,ie){for(const ce in ae)for(const re of ae[ce])Yn(re,ie[Q[ce].source]);return ae}(X,M,R)}(this._layers,y,this.tileManagers,t,P,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(t,s){s!=null&&s.filter&&this._validate(c.C.filter,"querySourceFeatures.filter",s.filter,null,s);const l=this.tileManagers[t];return l?function(h,g){const y=h.getRenderableIds().map(M=>h.getTileByID(M)),b=[],P={};for(let M=0;M<y.length;M++){const k=y[M],R=k.tileID.canonical.key;P[R]||(P[R]=!0,k.querySourceFeatures(b,g))}return b}(l,s?Object.assign(Object.assign({},s),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(t,s={}){this._checkLoaded();const l=this.light.getLight();let h=!1;for(const y in t)if(!c.bR(t[y],l[y])){h=!0;break}if(!h)return;const g={now:_e(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,s),this.light.updateTransitions(g)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,s={}){this._checkLoaded();const l=this.getSky();let h=!1;if(!t&&!l)return;if(t&&!l)h=!0;else if(!t&&l)h=!0;else for(const y in t)if(!c.bR(t[y],l[y])){h=!0;break}if(!h)return;const g={now:_e(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,s),this.sky.updateTransitions(g)}_setProjectionInternal(t){const s=function(l,h){const g={constrainOverride:h};if(Array.isArray(l)){const y=new Fd({type:l});return{projection:y,transform:new zo(g),cameraHelper:new Nd(y)}}switch(l){case"mercator":return{projection:new bn,transform:new Fs(g),cameraHelper:new Bs};case"globe":{const y=new Fd({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:y,transform:new zo(g),cameraHelper:new Nd(y)}}case"vertical-perspective":return{projection:new Tc,transform:new Ao(g),cameraHelper:new Fr};default:return c.w(`Unknown projection name: ${l}. Falling back to mercator projection.`),{projection:new bn,transform:new Fs(g),cameraHelper:new Bs}}}(t,this.map.transformConstrain);this.projection=s.projection,this.map.migrateProjection(s.transform,s.cameraHelper);for(const l in this.tileManagers)this.tileManagers[l].reload()}_validate(t,s,l,h,g={}){return(!g||g.validate!==!1)&&Do(this,t.call(c.C,c.e({key:s,style:this.serialize(),value:l,styleSpec:c.u},h)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ve().off(le,this._rtlPluginLoaded);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.tileManagers){const l=this.tileManagers[s];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.tileManagers[t].clearTiles()}_reloadSource(t){this.tileManagers[t].resume(),this.tileManagers[t].reload()}_updateSources(t){for(const s in this.tileManagers)this.tileManagers[s].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.tileManagers)this._reloadSource(t)}_updatePlacement(t,s,l,h,g=!1){let y=!1,b=!1;const P={};for(const M of this._order){const k=this._layers[M];if(k.type!=="symbol")continue;if(!P[k.source]){const D=this.tileManagers[k.source];P[k.source]=D.getRenderableIds(!0).map(B=>D.getTileByID(B)).sort((B,U)=>U.tileID.overscaledZ-B.tileID.overscaledZ||(B.tileID.isLessThan(U.tileID)?-1:1))}const R=this.crossTileSymbolIndex.addLayer(k,P[k.source],t.center.lng);y=y||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((g=g||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(_e(),t.zoom))&&(this.pauseablePlacement=new So(t,this.map.terrain,this._order,g,s,l,h,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(_e()),b=!0),y&&this.pauseablePlacement.placement.setStale()),b||y)for(const M of this._order){const k=this._layers[M];k.type==="symbol"&&this.placement.updateLayerOpacities(k,P[k.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(_e())}_releaseSymbolFadeTiles(){for(const t in this.tileManagers)this.tileManagers[t].releaseSymbolFadeTiles()}getImages(t,s){return c._(this,void 0,void 0,function*(){const l=yield this.imageManager.getImages(s.icons);this._updateTilesForChangedImages();const h=this.tileManagers[s.source];return h&&h.setDependencies(s.tileID.key,s.type,s.icons),l})}getGlyphs(t,s){return c._(this,void 0,void 0,function*(){const l=yield this.glyphManager.getGlyphs(s.stacks),h=this.tileManagers[s.source];return h&&h.setDependencies(s.tileID.key,s.type,[""]),l})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,s={}){this._checkLoaded(),t&&this._validate(c.C.glyphs,"glyphs",t,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}getDashes(t,s){return c._(this,void 0,void 0,function*(){const l={};for(const[h,g]of Object.entries(s.dashes))l[h]=this.lineAtlas.getDash(g.dasharray,g.round);return l})}addSprite(t,s,l={},h){this._checkLoaded();const g=[{id:t,url:s}],y=[..._t(this.stylesheet.sprite),...g];this._validate(c.C.sprite,"sprite",y,null,l)||(this.stylesheet.sprite=y,this._loadSprite(g,!0,h))}removeSprite(t){this._checkLoaded();const s=_t(this.stylesheet.sprite);if(s.find(l=>l.id===t)){if(this._spritesImagesIds[t])for(const l of this._spritesImagesIds[t])this.imageManager.removeImage(l),this._changedImages[l]=!0;s.splice(s.findIndex(l=>l.id===t),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}else this.fire(new c.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return _t(this.stylesheet.sprite)}setSprite(t,s={},l){this._checkLoaded(),t&&this._validate(c.C.sprite,"sprite",t,null,s)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,l):(this._unloadSprite(),l&&l(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const t in this.tileManagers){const s=this.tileManagers[t];s.setEventedParent(null),s.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const t in this._layers){const s=this._layers[t];s.setEventedParent(null),s.onRemove&&s.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var km=c.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class jl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,s,l,h,g,y,b,P,M){this.context=t;let k=this.boundPaintVertexBuffers.length!==h.length;for(let R=0;!k&&R<h.length;R++)this.boundPaintVertexBuffers[R]!==h[R]&&(k=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==l||k||this.boundIndexBuffer!==g||this.boundVertexOffset!==y||this.boundDynamicVertexBuffer!==b||this.boundDynamicVertexBuffer2!==P||this.boundDynamicVertexBuffer3!==M?this.freshBind(s,l,h,g,y,b,P,M):(t.bindVertexArray.set(this.vao),b&&b.bind(),g&&g.dynamicDraw&&g.bind(),P&&P.bind(),M&&M.bind())}freshBind(t,s,l,h,g,y,b,P){const M=t.numAttributes,k=this.context,R=k.gl;this.vao&&this.destroy(),this.vao=k.createVertexArray(),k.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=h,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=y,this.boundDynamicVertexBuffer2=b,this.boundDynamicVertexBuffer3=P,s.enableAttributes(R,t);for(const D of l)D.enableAttributes(R,t);y&&y.enableAttributes(R,t),b&&b.enableAttributes(R,t),P&&P.enableAttributes(R,t),s.bind(),s.setVertexAttribPointers(R,t,g);for(const D of l)D.bind(),D.setVertexAttribPointers(R,t,g);y&&(y.bind(),y.setVertexAttribPointers(R,t,g)),h&&h.bind(),b&&(b.bind(),b.setVertexAttribPointers(R,t,g)),P&&(P.bind(),P.setVertexAttribPointers(R,t,g)),k.currentNumAttributes=M}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Am=(m,t,s,l,h)=>({u_texture:0,u_ele_delta:m,u_fog_matrix:t,u_fog_color:s?s.properties.get("fog-color"):c.bp.white,u_fog_ground_blend:s?s.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:h?0:s?s.calculateFogBlendOpacity(l):0,u_horizon_color:s?s.properties.get("horizon-color"):c.bp.white,u_horizon_fog_blend:s?s.properties.get("horizon-fog-blend"):1,u_is_globe_mode:h?1:0}),Ro={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Vl(m){const t=[];for(let s=0;s<m.length;s++){if(m[s]===null)continue;const l=m[s].split(" ");t.push(l.pop())}return t}class jd{constructor(t,s,l,h,g,y,b,P,M=[]){const k=t.gl;this.program=k.createProgram();const R=Vl(s.staticAttributes),D=l?l.getBinderAttributes():[],B=R.concat(D),U=lr.prelude.staticUniforms?Vl(lr.prelude.staticUniforms):[],W=b.staticUniforms?Vl(b.staticUniforms):[],X=s.staticUniforms?Vl(s.staticUniforms):[],H=l?l.getBinderUniforms():[],ee=U.concat(W).concat(X).concat(H),ae=[];for(const Se of ee)ae.indexOf(Se)<0&&ae.push(Se);const Q=l?l.defines():[];Qn(k)&&Q.unshift("#version 300 es"),g&&Q.push("#define OVERDRAW_INSPECTOR;"),y&&Q.push("#define TERRAIN3D;"),P&&Q.push(P),M&&Q.push(...M);let ie=Q.concat(lr.prelude.fragmentSource,b.fragmentSource,s.fragmentSource).join(`
`),ce=Q.concat(lr.prelude.vertexSource,b.vertexSource,s.vertexSource).join(`
`);Qn(k)||(ie=function(Se){return Se.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(ie),ce=function(Se){return Se.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(ce));const re=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);if(k.shaderSource(re,ie),k.compileShader(re),!k.getShaderParameter(re,k.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${k.getShaderInfoLog(re)}`);k.attachShader(this.program,re);const ge=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);if(k.shaderSource(ge,ce),k.compileShader(ge),!k.getShaderParameter(ge,k.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${k.getShaderInfoLog(ge)}`);k.attachShader(this.program,ge),this.attributes={};const ke={};this.numAttributes=B.length;for(let Se=0;Se<this.numAttributes;Se++)B[Se]&&(k.bindAttribLocation(this.program,Se,B[Se]),this.attributes[B[Se]]=Se);if(k.linkProgram(this.program),!k.getProgramParameter(this.program,k.LINK_STATUS))throw new Error(`Program failed to link: ${k.getProgramInfoLog(this.program)}`);k.deleteShader(ge),k.deleteShader(re);for(let Se=0;Se<ae.length;Se++){const Ee=ae[Se];if(Ee&&!ke[Ee]){const Ce=k.getUniformLocation(this.program,Ee);Ce&&(ke[Ee]=Ce)}}this.fixedUniforms=h(t,ke),this.terrainUniforms=((Se,Ee)=>({u_depth:new c.b_(Se,Ee.u_depth),u_terrain:new c.b_(Se,Ee.u_terrain),u_terrain_dim:new c.bq(Se,Ee.u_terrain_dim),u_terrain_matrix:new c.c0(Se,Ee.u_terrain_matrix),u_terrain_unpack:new c.c1(Se,Ee.u_terrain_unpack),u_terrain_exaggeration:new c.bq(Se,Ee.u_terrain_exaggeration)}))(t,ke),this.projectionUniforms=((Se,Ee)=>({u_projection_matrix:new c.c0(Se,Ee.u_projection_matrix),u_projection_tile_mercator_coords:new c.c1(Se,Ee.u_projection_tile_mercator_coords),u_projection_clipping_plane:new c.c1(Se,Ee.u_projection_clipping_plane),u_projection_transition:new c.bq(Se,Ee.u_projection_transition),u_projection_fallback_matrix:new c.c0(Se,Ee.u_projection_fallback_matrix)}))(t,ke),this.binderUniforms=l?l.getUniforms(t,ke):[]}draw(t,s,l,h,g,y,b,P,M,k,R,D,B,U,W,X,H,ee,ae){const Q=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(l),t.setStencilMode(h),t.setColorMode(g),t.setCullFace(y),P){t.activeTexture.set(Q.TEXTURE2),Q.bindTexture(Q.TEXTURE_2D,P.depthTexture),t.activeTexture.set(Q.TEXTURE3),Q.bindTexture(Q.TEXTURE_2D,P.texture);for(const ce in this.terrainUniforms)this.terrainUniforms[ce].set(P[ce])}if(M)for(const ce in M)this.projectionUniforms[Ro[ce]].set(M[ce]);if(b)for(const ce in this.fixedUniforms)this.fixedUniforms[ce].set(b[ce]);X&&X.setUniforms(t,this.binderUniforms,U,{zoom:W});let ie=0;switch(s){case Q.LINES:ie=2;break;case Q.TRIANGLES:ie=3;break;case Q.LINE_STRIP:ie=1}for(const ce of B.get()){const re=ce.vaos||(ce.vaos={});(re[k]||(re[k]=new jl)).bind(t,this,R,X?X.getPaintVertexBuffers():[],D,ce.vertexOffset,H,ee,ae),Q.drawElements(s,ce.primitiveLength*ie,Q.UNSIGNED_SHORT,ce.primitiveOffset*ie*2)}}}function Vd(m,t,s){const l=1/c.aN(s,1,t.transform.tileZoom),h=Math.pow(2,s.tileID.overscaledZ),g=s.tileSize*Math.pow(2,t.transform.tileZoom)/h,y=g*(s.tileID.canonical.x+s.tileID.wrap*h),b=g*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[l,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[y>>16,b>>16],u_pixel_coord_lower:[65535&y,65535&b]}}const Cc=(m,t,s,l)=>{const h=m.style.light,g=h.properties.get("position"),y=[g.x,g.y,g.z],b=c.c4();h.properties.get("anchor")==="viewport"&&c.c5(b,m.transform.bearingInRadians),c.c6(y,y,b);const P=m.transform.transformLightDirection(y),M=h.properties.get("color");return{u_lightpos:y,u_lightpos_globe:P,u_lightintensity:h.properties.get("intensity"),u_lightcolor:[M.r,M.g,M.b],u_vertical_gradient:+t,u_opacity:s,u_fill_translate:l}},Mc=(m,t,s,l,h,g,y)=>c.e(Cc(m,t,s,l),Vd(g,m,y),{u_height_factor:-Math.pow(2,h.overscaledZ)/y.tileSize/8}),Ic=(m,t,s,l)=>c.e(Vd(t,m,s),{u_fill_translate:l}),Ud=(m,t)=>({u_world:m,u_fill_translate:t}),$d=(m,t,s,l,h)=>c.e(Ic(m,t,s,h),{u_world:l}),Gd=(m,t,s,l,h)=>{const g=m.transform;let y,b,P=0;if(s.paint.get("circle-pitch-alignment")==="map"){const M=c.aN(t,1,g.zoom);y=!0,b=[M,M],P=M/(c.a5*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*h}else y=!1,b=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(s.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+y,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:b,u_globe_extrude_scale:P,u_translate:l}},js=m=>({u_pixel_extrude_scale:[1/m.width,1/m.height]}),qd=m=>({u_viewport_size:[m.width,m.height]}),kc=(m,t=1)=>({u_color:m,u_overlay:0,u_overlay_scale:t}),Lo=(m,t,s,l)=>{const h=c.aN(m,1,t)/(c.a5*Math.pow(2,m.tileID.overscaledZ))*2*Math.PI*l;return{u_extrude_scale:c.aN(m,1,t),u_intensity:s,u_globe_extrude_scale:h}},Zd=(m,t,s,l)=>{const h=c.N();c.c7(h,0,m.width,m.height,0,0,1);const g=m.context.gl;return{u_matrix:h,u_world:[g.drawingBufferWidth,g.drawingBufferHeight],u_image:s,u_color_ramp:l,u_opacity:t.paint.get("heatmap-opacity")}},Ul=(m,t,s)=>{const l=s.paint.get("hillshade-accent-color");let h;switch(s.paint.get("hillshade-method")){case"basic":h=4;break;case"combined":h=1;break;case"igor":h=2;break;case"multidirectional":h=3;break;default:h=0}const g=s.getIlluminationProperties();for(let y=0;y<g.directionRadians.length;y++)s.paint.get("hillshade-illumination-anchor")==="viewport"&&(g.directionRadians[y]+=m.transform.bearingInRadians);return{u_image:0,u_latrange:Dm(0,t.tileID),u_exaggeration:s.paint.get("hillshade-exaggeration"),u_altitudes:g.altitudeRadians,u_azimuths:g.directionRadians,u_accent:l,u_method:h,u_highlights:g.highlightColor,u_shadows:g.shadowColor}},zm=(m,t)=>{const s=t.stride,l=c.N();return c.c7(l,0,c.a5,-c.a5,0,0,1),c.O(l,l,[0,-c.a5,0]),{u_matrix:l,u_image:1,u_dimension:[s,s],u_zoom:m.overscaledZ,u_unpack:t.getUnpackVector()}};function Dm(m,t){const s=Math.pow(2,t.canonical.z),l=t.canonical.y;return[new c.a9(0,l/s).toLngLat().lat,new c.a9(0,(l+1)/s).toLngLat().lat]}const Wd=(m,t,s=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:s,u_opacity:m.paint.get("color-relief-opacity")}),La=(m,t,s,l)=>{const h=m.transform;return{u_translation:Gl(m,t,s),u_ratio:l/c.aN(t,1,h.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Hd=(m,t,s,l,h)=>c.e(La(m,t,s,l),{u_image:0,u_image_height:h}),Ac=(m,t,s,l,h)=>{const g=m.transform,y=pi(t,g);return{u_translation:Gl(m,t,s),u_texsize:t.imageAtlasTexture.size,u_ratio:l/c.aN(t,1,g.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[y,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Xd=(m,t,s,l,h)=>{const g=pi(t,m.transform);return c.e(La(m,t,s,l),{u_tileratio:g,u_crossfade_from:h.fromScale,u_crossfade_to:h.toScale,u_image:0,u_mix:h.t,u_lineatlas_width:m.lineAtlas.width,u_lineatlas_height:m.lineAtlas.height})},$l=(m,t,s,l,h,g)=>{const y=pi(t,m.transform);return c.e(La(m,t,s,l),{u_image:0,u_image_height:g,u_tileratio:y,u_crossfade_from:h.fromScale,u_crossfade_to:h.toScale,u_image_dash:1,u_mix:h.t,u_lineatlas_width:m.lineAtlas.width,u_lineatlas_height:m.lineAtlas.height})};function pi(m,t){return 1/c.aN(m,1,t.tileZoom)}function Gl(m,t,s){return c.aO(m.transform,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const zc=(m,t,s,l,h)=>{return{u_tl_parent:m,u_scale_parent:t,u_buffer_scale:1,u_fade_t:s.mix,u_opacity:s.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(y=l.paint.get("raster-saturation"),y>0?1-1/(1.001-y):-y),u_contrast_factor:(g=l.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:Dc(l.paint.get("raster-hue-rotate")),u_coords_top:[h[0].x,h[0].y,h[1].x,h[1].y],u_coords_bottom:[h[3].x,h[3].y,h[2].x,h[2].y]};var g,y};function Dc(m){m*=Math.PI/180;const t=Math.sin(m),s=Math.cos(m);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const Rc=(m,t,s,l,h,g,y,b,P,M,k,R,D)=>{const B=y.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:B.cameraToCenterDistance,u_pitch:B.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:B.width/B.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_label_plane_matrix:b,u_coord_matrix:P,u_is_text:+k,u_pitch_with_map:+l,u_is_along_line:h,u_is_variable_anchor:g,u_texsize:R,u_texture:0,u_translation:M,u_pitched_scale:D}},ql=(m,t,s,l,h,g,y,b,P,M,k,R,D,B)=>{const U=y.transform;return c.e(Rc(m,t,s,l,h,g,y,b,P,M,k,R,B),{u_gamma_scale:l?Math.cos(U.pitch*Math.PI/180)*U.cameraToCenterDistance:1,u_device_pixel_ratio:y.pixelRatio,u_is_halo:1})},Vs=(m,t,s,l,h,g,y,b,P,M,k,R,D)=>c.e(ql(m,t,s,l,h,g,y,b,P,M,!0,k,0,D),{u_texsize_icon:R,u_texture_icon:1}),Lc=(m,t)=>({u_opacity:m,u_color:t}),Rm=(m,t,s,l,h)=>c.e(function(g,y,b,P){const M=b.imageManager.getPattern(g.from.toString()),k=b.imageManager.getPattern(g.to.toString()),{width:R,height:D}=b.imageManager.getPixelSize(),B=Math.pow(2,P.tileID.overscaledZ),U=P.tileSize*Math.pow(2,b.transform.tileZoom)/B,W=U*(P.tileID.canonical.x+P.tileID.wrap*B),X=U*P.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:M.tl,u_pattern_br_a:M.br,u_pattern_tl_b:k.tl,u_pattern_br_b:k.br,u_texsize:[R,D],u_mix:y.t,u_pattern_size_a:M.displaySize,u_pattern_size_b:k.displaySize,u_scale_a:y.fromScale,u_scale_b:y.toScale,u_tile_units_to_pixels:1/c.aN(P,1,b.transform.tileZoom),u_pixel_coord_upper:[W>>16,X>>16],u_pixel_coord_lower:[65535&W,65535&X]}}(s,h,t,l),{u_opacity:m}),Yd=(m,t)=>{},Lm={fillExtrusion:(m,t)=>({u_lightpos:new c.c2(m,t.u_lightpos),u_lightpos_globe:new c.c2(m,t.u_lightpos_globe),u_lightintensity:new c.bq(m,t.u_lightintensity),u_lightcolor:new c.c2(m,t.u_lightcolor),u_vertical_gradient:new c.bq(m,t.u_vertical_gradient),u_opacity:new c.bq(m,t.u_opacity),u_fill_translate:new c.c3(m,t.u_fill_translate)}),fillExtrusionPattern:(m,t)=>({u_lightpos:new c.c2(m,t.u_lightpos),u_lightpos_globe:new c.c2(m,t.u_lightpos_globe),u_lightintensity:new c.bq(m,t.u_lightintensity),u_lightcolor:new c.c2(m,t.u_lightcolor),u_vertical_gradient:new c.bq(m,t.u_vertical_gradient),u_height_factor:new c.bq(m,t.u_height_factor),u_opacity:new c.bq(m,t.u_opacity),u_fill_translate:new c.c3(m,t.u_fill_translate),u_image:new c.b_(m,t.u_image),u_texsize:new c.c3(m,t.u_texsize),u_pixel_coord_upper:new c.c3(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(m,t.u_pixel_coord_lower),u_scale:new c.c2(m,t.u_scale),u_fade:new c.bq(m,t.u_fade)}),fill:(m,t)=>({u_fill_translate:new c.c3(m,t.u_fill_translate)}),fillPattern:(m,t)=>({u_image:new c.b_(m,t.u_image),u_texsize:new c.c3(m,t.u_texsize),u_pixel_coord_upper:new c.c3(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(m,t.u_pixel_coord_lower),u_scale:new c.c2(m,t.u_scale),u_fade:new c.bq(m,t.u_fade),u_fill_translate:new c.c3(m,t.u_fill_translate)}),fillOutline:(m,t)=>({u_world:new c.c3(m,t.u_world),u_fill_translate:new c.c3(m,t.u_fill_translate)}),fillOutlinePattern:(m,t)=>({u_world:new c.c3(m,t.u_world),u_image:new c.b_(m,t.u_image),u_texsize:new c.c3(m,t.u_texsize),u_pixel_coord_upper:new c.c3(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(m,t.u_pixel_coord_lower),u_scale:new c.c2(m,t.u_scale),u_fade:new c.bq(m,t.u_fade),u_fill_translate:new c.c3(m,t.u_fill_translate)}),circle:(m,t)=>({u_camera_to_center_distance:new c.bq(m,t.u_camera_to_center_distance),u_scale_with_map:new c.b_(m,t.u_scale_with_map),u_pitch_with_map:new c.b_(m,t.u_pitch_with_map),u_extrude_scale:new c.c3(m,t.u_extrude_scale),u_device_pixel_ratio:new c.bq(m,t.u_device_pixel_ratio),u_globe_extrude_scale:new c.bq(m,t.u_globe_extrude_scale),u_translate:new c.c3(m,t.u_translate)}),collisionBox:(m,t)=>({u_pixel_extrude_scale:new c.c3(m,t.u_pixel_extrude_scale)}),collisionCircle:(m,t)=>({u_viewport_size:new c.c3(m,t.u_viewport_size)}),debug:(m,t)=>({u_color:new c.b$(m,t.u_color),u_overlay:new c.b_(m,t.u_overlay),u_overlay_scale:new c.bq(m,t.u_overlay_scale)}),depth:Yd,clippingMask:Yd,heatmap:(m,t)=>({u_extrude_scale:new c.bq(m,t.u_extrude_scale),u_intensity:new c.bq(m,t.u_intensity),u_globe_extrude_scale:new c.bq(m,t.u_globe_extrude_scale)}),heatmapTexture:(m,t)=>({u_matrix:new c.c0(m,t.u_matrix),u_world:new c.c3(m,t.u_world),u_image:new c.b_(m,t.u_image),u_color_ramp:new c.b_(m,t.u_color_ramp),u_opacity:new c.bq(m,t.u_opacity)}),hillshade:(m,t)=>({u_image:new c.b_(m,t.u_image),u_latrange:new c.c3(m,t.u_latrange),u_exaggeration:new c.bq(m,t.u_exaggeration),u_altitudes:new c.c9(m,t.u_altitudes),u_azimuths:new c.c9(m,t.u_azimuths),u_accent:new c.b$(m,t.u_accent),u_method:new c.b_(m,t.u_method),u_shadows:new c.c8(m,t.u_shadows),u_highlights:new c.c8(m,t.u_highlights)}),hillshadePrepare:(m,t)=>({u_matrix:new c.c0(m,t.u_matrix),u_image:new c.b_(m,t.u_image),u_dimension:new c.c3(m,t.u_dimension),u_zoom:new c.bq(m,t.u_zoom),u_unpack:new c.c1(m,t.u_unpack)}),colorRelief:(m,t)=>({u_image:new c.b_(m,t.u_image),u_unpack:new c.c1(m,t.u_unpack),u_dimension:new c.c3(m,t.u_dimension),u_elevation_stops:new c.b_(m,t.u_elevation_stops),u_color_stops:new c.b_(m,t.u_color_stops),u_color_ramp_size:new c.b_(m,t.u_color_ramp_size),u_opacity:new c.bq(m,t.u_opacity)}),line:(m,t)=>({u_translation:new c.c3(m,t.u_translation),u_ratio:new c.bq(m,t.u_ratio),u_device_pixel_ratio:new c.bq(m,t.u_device_pixel_ratio),u_units_to_pixels:new c.c3(m,t.u_units_to_pixels)}),lineGradient:(m,t)=>({u_translation:new c.c3(m,t.u_translation),u_ratio:new c.bq(m,t.u_ratio),u_device_pixel_ratio:new c.bq(m,t.u_device_pixel_ratio),u_units_to_pixels:new c.c3(m,t.u_units_to_pixels),u_image:new c.b_(m,t.u_image),u_image_height:new c.bq(m,t.u_image_height)}),linePattern:(m,t)=>({u_translation:new c.c3(m,t.u_translation),u_texsize:new c.c3(m,t.u_texsize),u_ratio:new c.bq(m,t.u_ratio),u_device_pixel_ratio:new c.bq(m,t.u_device_pixel_ratio),u_image:new c.b_(m,t.u_image),u_units_to_pixels:new c.c3(m,t.u_units_to_pixels),u_scale:new c.c2(m,t.u_scale),u_fade:new c.bq(m,t.u_fade)}),lineSDF:(m,t)=>({u_translation:new c.c3(m,t.u_translation),u_ratio:new c.bq(m,t.u_ratio),u_device_pixel_ratio:new c.bq(m,t.u_device_pixel_ratio),u_units_to_pixels:new c.c3(m,t.u_units_to_pixels),u_image:new c.b_(m,t.u_image),u_mix:new c.bq(m,t.u_mix),u_tileratio:new c.bq(m,t.u_tileratio),u_crossfade_from:new c.bq(m,t.u_crossfade_from),u_crossfade_to:new c.bq(m,t.u_crossfade_to),u_lineatlas_width:new c.bq(m,t.u_lineatlas_width),u_lineatlas_height:new c.bq(m,t.u_lineatlas_height)}),lineGradientSDF:(m,t)=>({u_translation:new c.c3(m,t.u_translation),u_ratio:new c.bq(m,t.u_ratio),u_device_pixel_ratio:new c.bq(m,t.u_device_pixel_ratio),u_units_to_pixels:new c.c3(m,t.u_units_to_pixels),u_image:new c.b_(m,t.u_image),u_image_height:new c.bq(m,t.u_image_height),u_tileratio:new c.bq(m,t.u_tileratio),u_crossfade_from:new c.bq(m,t.u_crossfade_from),u_crossfade_to:new c.bq(m,t.u_crossfade_to),u_image_dash:new c.b_(m,t.u_image_dash),u_mix:new c.bq(m,t.u_mix),u_lineatlas_width:new c.bq(m,t.u_lineatlas_width),u_lineatlas_height:new c.bq(m,t.u_lineatlas_height)}),raster:(m,t)=>({u_tl_parent:new c.c3(m,t.u_tl_parent),u_scale_parent:new c.bq(m,t.u_scale_parent),u_buffer_scale:new c.bq(m,t.u_buffer_scale),u_fade_t:new c.bq(m,t.u_fade_t),u_opacity:new c.bq(m,t.u_opacity),u_image0:new c.b_(m,t.u_image0),u_image1:new c.b_(m,t.u_image1),u_brightness_low:new c.bq(m,t.u_brightness_low),u_brightness_high:new c.bq(m,t.u_brightness_high),u_saturation_factor:new c.bq(m,t.u_saturation_factor),u_contrast_factor:new c.bq(m,t.u_contrast_factor),u_spin_weights:new c.c2(m,t.u_spin_weights),u_coords_top:new c.c1(m,t.u_coords_top),u_coords_bottom:new c.c1(m,t.u_coords_bottom)}),symbolIcon:(m,t)=>({u_is_size_zoom_constant:new c.b_(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.b_(m,t.u_is_size_feature_constant),u_size_t:new c.bq(m,t.u_size_t),u_size:new c.bq(m,t.u_size),u_camera_to_center_distance:new c.bq(m,t.u_camera_to_center_distance),u_pitch:new c.bq(m,t.u_pitch),u_rotate_symbol:new c.b_(m,t.u_rotate_symbol),u_aspect_ratio:new c.bq(m,t.u_aspect_ratio),u_fade_change:new c.bq(m,t.u_fade_change),u_label_plane_matrix:new c.c0(m,t.u_label_plane_matrix),u_coord_matrix:new c.c0(m,t.u_coord_matrix),u_is_text:new c.b_(m,t.u_is_text),u_pitch_with_map:new c.b_(m,t.u_pitch_with_map),u_is_along_line:new c.b_(m,t.u_is_along_line),u_is_variable_anchor:new c.b_(m,t.u_is_variable_anchor),u_texsize:new c.c3(m,t.u_texsize),u_texture:new c.b_(m,t.u_texture),u_translation:new c.c3(m,t.u_translation),u_pitched_scale:new c.bq(m,t.u_pitched_scale)}),symbolSDF:(m,t)=>({u_is_size_zoom_constant:new c.b_(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.b_(m,t.u_is_size_feature_constant),u_size_t:new c.bq(m,t.u_size_t),u_size:new c.bq(m,t.u_size),u_camera_to_center_distance:new c.bq(m,t.u_camera_to_center_distance),u_pitch:new c.bq(m,t.u_pitch),u_rotate_symbol:new c.b_(m,t.u_rotate_symbol),u_aspect_ratio:new c.bq(m,t.u_aspect_ratio),u_fade_change:new c.bq(m,t.u_fade_change),u_label_plane_matrix:new c.c0(m,t.u_label_plane_matrix),u_coord_matrix:new c.c0(m,t.u_coord_matrix),u_is_text:new c.b_(m,t.u_is_text),u_pitch_with_map:new c.b_(m,t.u_pitch_with_map),u_is_along_line:new c.b_(m,t.u_is_along_line),u_is_variable_anchor:new c.b_(m,t.u_is_variable_anchor),u_texsize:new c.c3(m,t.u_texsize),u_texture:new c.b_(m,t.u_texture),u_gamma_scale:new c.bq(m,t.u_gamma_scale),u_device_pixel_ratio:new c.bq(m,t.u_device_pixel_ratio),u_is_halo:new c.b_(m,t.u_is_halo),u_translation:new c.c3(m,t.u_translation),u_pitched_scale:new c.bq(m,t.u_pitched_scale)}),symbolTextAndIcon:(m,t)=>({u_is_size_zoom_constant:new c.b_(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.b_(m,t.u_is_size_feature_constant),u_size_t:new c.bq(m,t.u_size_t),u_size:new c.bq(m,t.u_size),u_camera_to_center_distance:new c.bq(m,t.u_camera_to_center_distance),u_pitch:new c.bq(m,t.u_pitch),u_rotate_symbol:new c.b_(m,t.u_rotate_symbol),u_aspect_ratio:new c.bq(m,t.u_aspect_ratio),u_fade_change:new c.bq(m,t.u_fade_change),u_label_plane_matrix:new c.c0(m,t.u_label_plane_matrix),u_coord_matrix:new c.c0(m,t.u_coord_matrix),u_is_text:new c.b_(m,t.u_is_text),u_pitch_with_map:new c.b_(m,t.u_pitch_with_map),u_is_along_line:new c.b_(m,t.u_is_along_line),u_is_variable_anchor:new c.b_(m,t.u_is_variable_anchor),u_texsize:new c.c3(m,t.u_texsize),u_texsize_icon:new c.c3(m,t.u_texsize_icon),u_texture:new c.b_(m,t.u_texture),u_texture_icon:new c.b_(m,t.u_texture_icon),u_gamma_scale:new c.bq(m,t.u_gamma_scale),u_device_pixel_ratio:new c.bq(m,t.u_device_pixel_ratio),u_is_halo:new c.b_(m,t.u_is_halo),u_translation:new c.c3(m,t.u_translation),u_pitched_scale:new c.bq(m,t.u_pitched_scale)}),background:(m,t)=>({u_opacity:new c.bq(m,t.u_opacity),u_color:new c.b$(m,t.u_color)}),backgroundPattern:(m,t)=>({u_opacity:new c.bq(m,t.u_opacity),u_image:new c.b_(m,t.u_image),u_pattern_tl_a:new c.c3(m,t.u_pattern_tl_a),u_pattern_br_a:new c.c3(m,t.u_pattern_br_a),u_pattern_tl_b:new c.c3(m,t.u_pattern_tl_b),u_pattern_br_b:new c.c3(m,t.u_pattern_br_b),u_texsize:new c.c3(m,t.u_texsize),u_mix:new c.bq(m,t.u_mix),u_pattern_size_a:new c.c3(m,t.u_pattern_size_a),u_pattern_size_b:new c.c3(m,t.u_pattern_size_b),u_scale_a:new c.bq(m,t.u_scale_a),u_scale_b:new c.bq(m,t.u_scale_b),u_pixel_coord_upper:new c.c3(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(m,t.u_pixel_coord_lower),u_tile_units_to_pixels:new c.bq(m,t.u_tile_units_to_pixels)}),terrain:(m,t)=>({u_texture:new c.b_(m,t.u_texture),u_ele_delta:new c.bq(m,t.u_ele_delta),u_fog_matrix:new c.c0(m,t.u_fog_matrix),u_fog_color:new c.b$(m,t.u_fog_color),u_fog_ground_blend:new c.bq(m,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.bq(m,t.u_fog_ground_blend_opacity),u_horizon_color:new c.b$(m,t.u_horizon_color),u_horizon_fog_blend:new c.bq(m,t.u_horizon_fog_blend),u_is_globe_mode:new c.bq(m,t.u_is_globe_mode)}),terrainDepth:(m,t)=>({u_ele_delta:new c.bq(m,t.u_ele_delta)}),terrainCoords:(m,t)=>({u_texture:new c.b_(m,t.u_texture),u_terrain_coords_id:new c.bq(m,t.u_terrain_coords_id),u_ele_delta:new c.bq(m,t.u_ele_delta)}),projectionErrorMeasurement:(m,t)=>({u_input:new c.bq(m,t.u_input),u_output_expected:new c.bq(m,t.u_output_expected)}),atmosphere:(m,t)=>({u_sun_pos:new c.c2(m,t.u_sun_pos),u_atmosphere_blend:new c.bq(m,t.u_atmosphere_blend),u_globe_position:new c.c2(m,t.u_globe_position),u_globe_radius:new c.bq(m,t.u_globe_radius),u_inv_proj_matrix:new c.c0(m,t.u_inv_proj_matrix)}),sky:(m,t)=>({u_sky_color:new c.b$(m,t.u_sky_color),u_horizon_color:new c.b$(m,t.u_horizon_color),u_horizon:new c.c3(m,t.u_horizon),u_horizon_normal:new c.c3(m,t.u_horizon_normal),u_sky_horizon_blend:new c.bq(m,t.u_sky_horizon_blend),u_sky_blend:new c.bq(m,t.u_sky_blend)})};class Fm{constructor(t,s,l){this.context=t;const h=t.gl;this.buffer=h.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Kd={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Bm{constructor(t,s,l,h){this.length=s.length,this.attributes=l,this.itemSize=s.bytesPerElement,this.dynamicDraw=h,this.context=t;const g=t.gl;this.buffer=g.createBuffer(),t.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let l=0;l<this.attributes.length;l++){const h=s.attributes[this.attributes[l].name];h!==void 0&&t.enableVertexAttribArray(h)}}setVertexAttribPointers(t,s,l){for(let h=0;h<this.attributes.length;h++){const g=this.attributes[h],y=s.attributes[g.name];y!==void 0&&t.vertexAttribPointer(y,g.components,t[Kd[g.type]],!1,this.itemSize,g.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Dt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Zl extends Dt{getDefault(){return c.bp.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Wl extends Dt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Hl extends Dt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Fc extends Dt{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Us extends Dt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Fa extends Dt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Fo extends Dt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Jn extends Dt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Qd extends Dt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class Jd extends Dt{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Bc extends Dt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class $s extends Dt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Xl extends Dt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class Yl extends Dt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Ba extends Dt{getDefault(){return c.bp.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Kl extends Dt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class ep extends Dt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class Bo extends Dt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Oo extends Dt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class tp extends Dt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Oc extends Dt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Pt extends Dt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ql extends Dt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Om extends Dt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class rp extends Dt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Oa extends Dt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Nm extends Dt{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class jm extends Dt{getDefault(){return null}set(t){var s;if(t===this.current&&!this.dirty)return;const l=this.gl;Qn(l)?l.bindVertexArray(t):(s=l.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class np extends Dt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Vm extends Dt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Nc extends Dt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class No extends Dt{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class Na extends No{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Jl extends No{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class jc extends No{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const Vc="Framebuffer is not complete";class eu{constructor(t,s,l,h,g){this.context=t,this.width=s,this.height=l;const y=t.gl,b=this.framebuffer=y.createFramebuffer();if(this.colorAttachment=new Na(t,b),h)this.depthAttachment=g?new jc(t,b):new Jl(t,b);else if(g)throw new Error("Stencil cannot be set without depth");if(y.checkFramebufferStatus(y.FRAMEBUFFER)!==y.FRAMEBUFFER_COMPLETE)throw new Error(Vc)}destroy(){const t=this.context.gl,s=this.colorAttachment.get();if(s&&t.deleteTexture(s),this.depthAttachment){const l=this.depthAttachment.get();l&&t.deleteRenderbuffer(l)}t.deleteFramebuffer(this.framebuffer)}}class tu{constructor(t){var s,l;if(this.gl=t,this.clearColor=new Zl(this),this.clearDepth=new Wl(this),this.clearStencil=new Hl(this),this.colorMask=new Fc(this),this.depthMask=new Us(this),this.stencilMask=new Fa(this),this.stencilFunc=new Fo(this),this.stencilOp=new Jn(this),this.stencilTest=new Qd(this),this.depthRange=new Jd(this),this.depthTest=new Bc(this),this.depthFunc=new $s(this),this.blend=new Xl(this),this.blendFunc=new Yl(this),this.blendColor=new Ba(this),this.blendEquation=new Kl(this),this.cullFace=new ep(this),this.cullFaceSide=new Bo(this),this.frontFace=new Oo(this),this.program=new tp(this),this.activeTexture=new Oc(this),this.viewport=new Pt(this),this.bindFramebuffer=new Ql(this),this.bindRenderbuffer=new Om(this),this.bindTexture=new rp(this),this.bindVertexBuffer=new Oa(this),this.bindElementBuffer=new Nm(this),this.bindVertexArray=new jm(this),this.pixelStoreUnpack=new np(this),this.pixelStoreUnpackPremultiplyAlpha=new Vm(this),this.pixelStoreUnpackFlipY=new Nc(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Qn(t)){this.HALF_FLOAT=t.HALF_FLOAT;const h=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=t.RGBA16F)!==null&&s!==void 0?s:h==null?void 0:h.RGBA16F_EXT,this.RGB16F=(l=t.RGB16F)!==null&&l!==void 0?l:h==null?void 0:h.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const h=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=h==null?void 0:h.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s){return new Fm(this,t,s)}createVertexBuffer(t,s,l){return new Bm(this,t,s,l)}createRenderbuffer(t,s,l){const h=this.gl,g=h.createRenderbuffer();return this.bindRenderbuffer.set(g),h.renderbufferStorage(h.RENDERBUFFER,t,s,l),this.bindRenderbuffer.set(null),g}createFramebuffer(t,s,l,h){return new eu(this,t,s,l,h)}clear({color:t,depth:s,stencil:l}){const h=this.gl;let g=0;t&&(g|=h.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(g|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),l!==void 0&&(g|=h.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),h.clear(g)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){c.bR(t.blendFunction,qt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Qn(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var s;return Qn(this.gl)?this.gl.deleteVertexArray(t):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let ms;function Gs(m,t,s,l,h){const g=m.context,y=m.transform,b=g.gl,P=m.useProgram("collisionBox"),M=[];let k=0,R=0;for(let H=0;H<l.length;H++){const ee=l[H],ae=t.getTile(ee).getBucket(s);if(!ae)continue;const Q=h?ae.textCollisionBox:ae.iconCollisionBox,ie=ae.collisionCircleArray;ie.length>0&&(M.push({circleArray:ie,circleOffset:R,coord:ee}),k+=ie.length/4,R=k),Q&&P.draw(g,b.LINES,bt.disabled,It.disabled,m.colorModeForRenderPass(),Mt.disabled,js(m.transform),m.style.map.terrain&&m.style.map.terrain.getTerrainData(ee),y.getProjectionData({overscaledTileID:ee,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),s.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,null,m.transform.zoom,null,null,Q.collisionVertexBuffer)}if(!h||!M.length)return;const D=m.useProgram("collisionCircle"),B=new c.ca;B.resize(4*k),B._trim();let U=0;for(const H of M)for(let ee=0;ee<H.circleArray.length/4;ee++){const ae=4*ee,Q=H.circleArray[ae+0],ie=H.circleArray[ae+1],ce=H.circleArray[ae+2],re=H.circleArray[ae+3];B.emplace(U++,Q,ie,ce,re,0),B.emplace(U++,Q,ie,ce,re,1),B.emplace(U++,Q,ie,ce,re,2),B.emplace(U++,Q,ie,ce,re,3)}(!ms||ms.length<2*k)&&(ms=function(H){const ee=2*H,ae=new c.cc;ae.resize(ee),ae._trim();for(let Q=0;Q<ee;Q++){const ie=6*Q;ae.uint16[ie+0]=4*Q+0,ae.uint16[ie+1]=4*Q+1,ae.uint16[ie+2]=4*Q+2,ae.uint16[ie+3]=4*Q+2,ae.uint16[ie+4]=4*Q+3,ae.uint16[ie+5]=4*Q+0}return ae}(k));const W=g.createIndexBuffer(ms,!0),X=g.createVertexBuffer(B,c.cb.members,!0);for(const H of M){const ee=qd(m.transform);D.draw(g,b.TRIANGLES,bt.disabled,It.disabled,m.colorModeForRenderPass(),Mt.disabled,ee,m.style.map.terrain&&m.style.map.terrain.getTerrainData(H.coord),null,s.id,X,W,c.aX.simpleSegment(0,2*H.circleOffset,H.circleArray.length,H.circleArray.length/2),null,m.transform.zoom,null,null,null)}X.destroy(),W.destroy()}const Uc=c.ar(new Float32Array(16));function Um(m,t,s,l,h,g){const{horizontalAlign:y,verticalAlign:b}=c.aS(m);return new c.P((-(y-.5)*t/h+l[0])*g,(-(b-.5)*s/h+l[1])*g)}function ja(m,t,s,l,h,g){const y=t.tileAnchorPoint.add(new c.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let b=l.mult(g);s||(b=b.rotate(-h));const P=y.add(b);return xt(P.x,P.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(s){const b=Nt(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(m),P=Math.atan(b.y/b.x)+(b.x<0?Math.PI:0);return m.add(l.rotate(P))}return m.add(l)}function $m(m,t,s,l,h,g,y,b,P,M,k,R){const D=m.text.placedSymbolArray,B=m.text.dynamicLayoutVertexArray,U=m.icon.dynamicLayoutVertexArray,W={};B.clear();for(let X=0;X<D.length;X++){const H=D.get(X),ee=H.hidden||!H.crossTileID||m.allowVerticalPlacement&&!H.placedOrientation?null:l[H.crossTileID];if(ee){const ae=new c.P(H.anchorX,H.anchorY),Q={getElevation:R,width:h.width,height:h.height,pitchedLabelPlaneMatrix:g,pitchWithMap:s,transform:h,tileAnchorPoint:ae,translation:M,unwrappedTileID:k},ie=s?wo(ae.x,ae.y,Q):Nt(ae.x,ae.y,Q),ce=wa(h.cameraToCenterDistance,ie.signedDistanceFromCamera);let re=c.aA(m.textSizeData,b,H)*ce/c.aM;s&&(re*=m.tilePixelRatio/y);const{width:ge,height:ke,anchor:Se,textOffset:Ee,textBoxScale:Ce}=ee,$e=Um(Se,ge,ke,Ee,Ce,re),Ge=h.getPitchedTextCorrection(ae.x+M[0],ae.y+M[1],k),Ne=ja(ie.point,Q,t,$e,-h.bearingInRadians,Ge),He=m.allowVerticalPlacement&&H.placedOrientation===c.az.vertical?Math.PI/2:0;for(let gt=0;gt<H.numGlyphs;gt++)c.aG(B,Ne,He);P&&H.associatedIconIndex>=0&&(W[H.associatedIconIndex]={shiftedAnchor:Ne,angle:He})}else Rs(H.numGlyphs,B)}if(P){U.clear();const X=m.icon.placedSymbolArray;for(let H=0;H<X.length;H++){const ee=X.get(H);if(ee.hidden)Rs(ee.numGlyphs,U);else{const ae=W[H];if(ae)for(let Q=0;Q<ee.numGlyphs;Q++)c.aG(U,ae.shiftedAnchor,ae.angle);else Rs(ee.numGlyphs,U)}}m.icon.dynamicLayoutVertexBuffer.updateData(U)}m.text.dynamicLayoutVertexBuffer.updateData(B)}function ip(m,t,s){return s.iconsInText&&t?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Va(m,t,s,l,h,g,y,b,P,M,k,R,D){const B=m.context,U=B.gl,W=m.transform,X=b==="map",H=P==="map",ee=b!=="viewport"&&s.layout.get("symbol-placement")!=="point",ae=X&&!H&&!ee,Q=!s.layout.get("symbol-sort-key").isConstant();let ie=!1;const ce=m.getDepthModeForSublayer(0,bt.ReadOnly),re=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ge=[],ke=W.getCircleRadiusCorrection();for(const Se of l){const Ee=t.getTile(Se),Ce=Ee.getBucket(s);if(!Ce)continue;const $e=h?Ce.text:Ce.icon;if(!$e||!$e.segments.get().length||!$e.hasVisibleVertices)continue;const Ge=$e.programConfigurations.get(s.id),Ne=h||Ce.sdfIcons,He=h?Ce.textSizeData:Ce.iconSizeData,gt=H||W.pitch!==0,Ft=m.useProgram(ip(Ne,h,Ce),Ge),er=c.ay(He,W.zoom),Zt=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Se);let ir,Wt,gr,sr,Wr=[0,0],Mr=null;if(h)Wt=Ee.glyphAtlasTexture,gr=U.LINEAR,ir=Ee.glyphAtlasTexture.size,Ce.iconsInText&&(Wr=Ee.imageAtlasTexture.size,Mr=Ee.imageAtlasTexture,sr=gt||m.options.rotating||m.options.zooming||He.kind==="composite"||He.kind==="camera"?U.LINEAR:U.NEAREST);else{const Xt=s.layout.get("icon-size").constantOr(0)!==1||Ce.iconsNeedLinear;Wt=Ee.imageAtlasTexture,gr=Ne||m.options.rotating||m.options.zooming||Xt||gt?U.LINEAR:U.NEAREST,ir=Ee.imageAtlasTexture.size}const Pr=c.aN(Ee,1,m.transform.zoom),nn=Nn(X,m.transform,Pr),xs=c.N();c.aB(xs,nn);const Hi=zl(H,X,m.transform,Pr),Di=c.aO(W,Ee,g,y),zn=W.getProjectionData({overscaledTileID:Se,applyGlobeMatrix:!D,applyTerrainMatrix:!0}),Ys=re&&Ce.hasTextData(),al=s.layout.get("icon-text-fit")!=="none"&&Ys&&Ce.hasIconData();if(ee){const Xt=m.style.map.terrain?(Ur,$r)=>m.style.map.terrain.getElevation(Se,Ur,$r):null,Ht=s.layout.get("text-rotation-alignment")==="map";Dl(Ce,m,h,nn,xs,H,M,Ht,Se.toUnwrapped(),W.width,W.height,Di,Xt)}const Ks=h&&re||al,ri=ee||Ks?Uc:H?nn:m.transform.clipSpaceToPixelsMatrix,Ri=Ne&&s.paint.get(h?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let yi;yi=Ne?Ce.iconsInText?Vs(He.kind,er,ae,H,ee,Ks,m,ri,Hi,Di,ir,Wr,ke):ql(He.kind,er,ae,H,ee,Ks,m,ri,Hi,Di,h,ir,0,ke):Rc(He.kind,er,ae,H,ee,Ks,m,ri,Hi,Di,h,ir,ke);const vi={program:Ft,buffers:$e,uniformValues:yi,projectionData:zn,atlasTexture:Wt,atlasTextureIcon:Mr,atlasInterpolation:gr,atlasInterpolationIcon:sr,isSDF:Ne,hasHalo:Ri};if(Q&&Ce.canOverlap){ie=!0;const Xt=$e.segments.get();for(const Ht of Xt)ge.push({segments:new c.aX([Ht]),sortKey:Ht.sortKey,state:vi,terrainData:Zt})}else ge.push({segments:$e.segments,sortKey:0,state:vi,terrainData:Zt})}ie&&ge.sort((Se,Ee)=>Se.sortKey-Ee.sortKey);for(const Se of ge){const Ee=Se.state;if(B.activeTexture.set(U.TEXTURE0),Ee.atlasTexture.bind(Ee.atlasInterpolation,U.CLAMP_TO_EDGE),Ee.atlasTextureIcon&&(B.activeTexture.set(U.TEXTURE1),Ee.atlasTextureIcon&&Ee.atlasTextureIcon.bind(Ee.atlasInterpolationIcon,U.CLAMP_TO_EDGE)),Ee.isSDF){const Ce=Ee.uniformValues;Ee.hasHalo&&(Ce.u_is_halo=1,ru(Ee.buffers,Se.segments,s,m,Ee.program,ce,k,R,Ce,Ee.projectionData,Se.terrainData)),Ce.u_is_halo=0}ru(Ee.buffers,Se.segments,s,m,Ee.program,ce,k,R,Ee.uniformValues,Ee.projectionData,Se.terrainData)}}function ru(m,t,s,l,h,g,y,b,P,M,k){const R=l.context;h.draw(R,R.gl.TRIANGLES,g,y,b,Mt.backCCW,P,k,M,s.id,m.layoutVertexBuffer,m.indexBuffer,t,s.paint,l.transform.zoom,m.programConfigurations.get(s.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function sp(m,t,s,l,h){const g=m.context,y=g.gl,b=It.disabled,P=new qt([y.ONE,y.ONE],c.bp.transparent,[!0,!0,!0,!0]),M=t.getBucket(s);if(!M)return;const k=l.key;let R=s.heatmapFbos.get(k);R||(R=Ua(g,t.tileSize,t.tileSize),s.heatmapFbos.set(k,R)),g.bindFramebuffer.set(R.framebuffer),g.viewport.set([0,0,t.tileSize,t.tileSize]),g.clear({color:c.bp.transparent});const D=M.programConfigurations.get(s.id),B=m.useProgram("heatmap",D,!h),U=m.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),W=m.style.map.terrain.getTerrainData(l);B.draw(g,y.TRIANGLES,bt.disabled,b,P,Mt.disabled,Lo(t,m.transform.zoom,s.paint.get("heatmap-intensity"),1),W,U,s.id,M.layoutVertexBuffer,M.indexBuffer,M.segments,s.paint,m.transform.zoom,D)}function op(m,t,s,l,h){const g=m.context,y=g.gl,b=m.transform;g.setColorMode(m.colorModeForRenderPass());const P=nu(g,t),M=s.key,k=t.heatmapFbos.get(M);if(!k)return;g.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,k.colorAttachment.get()),g.activeTexture.set(y.TEXTURE1),P.bind(y.LINEAR,y.CLAMP_TO_EDGE);const R=b.getProjectionData({overscaledTileID:s,applyTerrainMatrix:h,applyGlobeMatrix:!l});m.useProgram("heatmapTexture").draw(g,y.TRIANGLES,bt.disabled,It.disabled,m.colorModeForRenderPass(),Mt.disabled,Zd(m,t,0,1),null,R,t.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,t.paint,b.zoom),k.destroy(),t.heatmapFbos.delete(M)}function Ua(m,t,s){var l,h;const g=m.gl,y=g.createTexture();g.bindTexture(g.TEXTURE_2D,y),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR);const b=(l=m.HALF_FLOAT)!==null&&l!==void 0?l:g.UNSIGNED_BYTE,P=(h=m.RGBA16F)!==null&&h!==void 0?h:g.RGBA;g.texImage2D(g.TEXTURE_2D,0,P,t,s,0,g.RGBA,b,null);const M=m.createFramebuffer(t,s,!1,!1);return M.colorAttachment.set(y),M}function nu(m,t){return t.colorRampTexture||(t.colorRampTexture=new c.T(m,t.colorRamp,m.gl.RGBA)),t.colorRampTexture}function ap(m,t,s,l,h,g,y,b){let P=256;if(h.stepInterpolant){const M=t.getSource().maxzoom,k=y.canonical.z===M?Math.ceil(1<<m.transform.maxZoom-y.canonical.z):1;P=c.an(c.ce(g.maxLineLength/c.a5*1024*k),256,s.maxTextureSize)}return b.gradient=c.cf({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:P,image:b.gradient||void 0,clips:g.lineClipsArray}),b.texture?b.texture.update(b.gradient):b.texture=new c.T(s,b.gradient,l.RGBA),b.version=h.gradientVersion,b.texture}function lp(m,t,s,l,h){m.activeTexture.set(t.TEXTURE0),s.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),l.updatePaintBuffers(h)}function Tr(m,t,s,l,h,g){(h||m.lineAtlas.dirty)&&(t.activeTexture.set(s.TEXTURE0),m.lineAtlas.bind(t)),l.updatePaintBuffers(g)}function qs(m,t,s,l,h,g,y){const b=g.gradients[h.id];let P=b.texture;h.gradientVersion!==b.version&&(P=ap(m,t,s,l,h,g,y,b)),s.activeTexture.set(l.TEXTURE0),P.bind(h.stepInterpolant?l.NEAREST:l.LINEAR,l.CLAMP_TO_EDGE)}function Vn(m,t,s,l,h,g,y,b,P){const M=g.gradients[h.id];let k=M.texture;h.gradientVersion!==M.version&&(k=ap(m,t,s,l,h,g,y,M)),s.activeTexture.set(l.TEXTURE0),k.bind(h.stepInterpolant?l.NEAREST:l.LINEAR,l.CLAMP_TO_EDGE),s.activeTexture.set(l.TEXTURE1),m.lineAtlas.bind(s),b.updatePaintBuffers(P)}function iu(m,t,s,l,h){if(!s||!l||!l.imageAtlas)return;const g=l.imageAtlas.patternPositions;let y=g[s.to.toString()],b=g[s.from.toString()];if(!y&&b&&(y=b),!b&&y&&(b=y),!y||!b){const P=h.getPaintProperty(t);y=g[P],b=g[P]}y&&b&&m.setConstantPatternPositions(y,b)}function $a(m,t,s,l,h,g,y,b){const P=m.context.gl,M="fill-pattern",k=s.paint.get(M),R=k&&k.constantOr(1),D=s.getCrossfadeParameters();let B,U,W,X,H;const ee=m.transform,ae=s.paint.get("fill-translate"),Q=s.paint.get("fill-translate-anchor");y?(U=R&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=P.LINES):(U=R?"fillPattern":"fill",B=P.TRIANGLES);const ie=k.constantOr(null);for(const ce of l){const re=t.getTile(ce);if(R&&!re.patternsLoaded())continue;const ge=re.getBucket(s);if(!ge)continue;const ke=ge.programConfigurations.get(s.id),Se=m.useProgram(U,ke),Ee=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ce);R&&(m.context.activeTexture.set(P.TEXTURE0),re.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),ke.updatePaintBuffers(D)),iu(ke,M,ie,re,s);const Ce=ee.getProjectionData({overscaledTileID:ce,applyGlobeMatrix:!b,applyTerrainMatrix:!0}),$e=c.aO(ee,re,ae,Q);if(y){X=ge.indexBuffer2,H=ge.segments2;const Ne=[P.drawingBufferWidth,P.drawingBufferHeight];W=U==="fillOutlinePattern"&&R?$d(m,D,re,Ne,$e):Ud(Ne,$e)}else X=ge.indexBuffer,H=ge.segments,W=R?Ic(m,D,re,$e):{u_fill_translate:$e};const Ge=m.stencilModeForClipping(ce);Se.draw(m.context,B,h,Ge,g,Mt.backCCW,W,Ee,Ce,s.id,ge.layoutVertexBuffer,X,H,s.paint,m.transform.zoom,ke)}}function su(m,t,s,l,h,g,y,b){const P=m.context,M=P.gl,k="fill-extrusion-pattern",R=s.paint.get(k),D=R.constantOr(1),B=s.getCrossfadeParameters(),U=s.paint.get("fill-extrusion-opacity"),W=R.constantOr(null),X=m.transform;for(const H of l){const ee=t.getTile(H),ae=ee.getBucket(s);if(!ae)continue;const Q=m.style.map.terrain&&m.style.map.terrain.getTerrainData(H),ie=ae.programConfigurations.get(s.id),ce=m.useProgram(D?"fillExtrusionPattern":"fillExtrusion",ie);D&&(m.context.activeTexture.set(M.TEXTURE0),ee.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),ie.updatePaintBuffers(B));const re=X.getProjectionData({overscaledTileID:H,applyGlobeMatrix:!b,applyTerrainMatrix:!0});iu(ie,k,W,ee,s);const ge=c.aO(X,ee,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),ke=s.paint.get("fill-extrusion-vertical-gradient"),Se=D?Mc(m,ke,U,ge,H,B,ee):Cc(m,ke,U,ge);ce.draw(P,P.gl.TRIANGLES,h,g,y,Mt.backCCW,Se,Q,re,s.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,s.paint,m.transform.zoom,ie,m.style.map.terrain&&ae.centroidVertexBuffer)}}function gs(m,t,s,l,h,g,y,b,P){var M;const k=m.style.projection,R=m.context,D=m.transform,B=R.gl,U=[`#define NUM_ILLUMINATION_SOURCES ${s.paint.get("hillshade-highlight-color").values.length}`],W=m.useProgram("hillshade",null,!1,U),X=!m.options.moving;for(const H of l){const ee=t.getTile(H),ae=ee.fbo;if(!ae)continue;const Q=k.getMeshFromTileID(R,H.canonical,b,!0,"raster"),ie=(M=m.style.map.terrain)===null||M===void 0?void 0:M.getTerrainData(H);R.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,ae.colorAttachment.get());const ce=D.getProjectionData({overscaledTileID:H,aligned:X,applyGlobeMatrix:!P,applyTerrainMatrix:!0});W.draw(R,B.TRIANGLES,g,h[H.overscaledZ],y,Mt.backCCW,Ul(m,ee,s),ie,ce,s.id,Q.vertexBuffer,Q.indexBuffer,Q.segments)}}function Ga(m,t,s,l,h,g,y,b,P){var M;const k=m.style.projection,R=m.context,D=m.transform,B=R.gl,U=m.useProgram("colorRelief"),W=!m.options.moving;let X=!0,H=0;for(const ee of l){const ae=t.getTile(ee),Q=ae.dem;if(X){const Se=B.getParameter(B.MAX_TEXTURE_SIZE),{elevationTexture:Ee,colorTexture:Ce}=s.getColorRampTextures(R,Se,Q.getUnpackVector());R.activeTexture.set(B.TEXTURE1),Ee.bind(B.NEAREST,B.CLAMP_TO_EDGE),R.activeTexture.set(B.TEXTURE4),Ce.bind(B.LINEAR,B.CLAMP_TO_EDGE),X=!1,H=Ee.size[0]}if(!Q||!Q.data)continue;const ie=Q.stride,ce=Q.getPixels();if(R.activeTexture.set(B.TEXTURE0),R.pixelStoreUnpackPremultiplyAlpha.set(!1),ae.demTexture=ae.demTexture||m.getTileTexture(ie),ae.demTexture){const Se=ae.demTexture;Se.update(ce,{premultiply:!1}),Se.bind(B.LINEAR,B.CLAMP_TO_EDGE)}else ae.demTexture=new c.T(R,ce,B.RGBA,{premultiply:!1}),ae.demTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const re=k.getMeshFromTileID(R,ee.canonical,b,!0,"raster"),ge=(M=m.style.map.terrain)===null||M===void 0?void 0:M.getTerrainData(ee),ke=D.getProjectionData({overscaledTileID:ee,aligned:W,applyGlobeMatrix:!P,applyTerrainMatrix:!0});U.draw(R,B.TRIANGLES,g,h[ee.overscaledZ],y,Mt.backCCW,Wd(s,ae.dem,H),ge,ke,s.id,re.vertexBuffer,re.indexBuffer,re.segments)}}const Zs=[new c.P(0,0),new c.P(c.a5,0),new c.P(c.a5,c.a5),new c.P(0,c.a5)];function jo(m,t,s,l,h,g,y,b,P=!1,M=!1){const k=l[l.length-1].overscaledZ,R=m.context,D=R.gl,B=m.useProgram("raster"),U=m.transform,W=m.style.projection,X=m.colorModeForRenderPass(),H=!m.options.moving,ee=s.paint.get("raster-opacity"),ae=s.paint.get("raster-resampling"),Q=s.paint.get("raster-fade-duration"),ie=!!m.style.map.terrain;for(const ce of l){const re=m.getDepthModeForSublayer(ce.overscaledZ-k,ee===1?bt.ReadWrite:bt.ReadOnly,D.LESS),ge=t.getTile(ce),ke=ae==="nearest"?D.NEAREST:D.LINEAR;R.activeTexture.set(D.TEXTURE0),ge.texture.bind(ke,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),R.activeTexture.set(D.TEXTURE1);const{parentTile:Se,parentScaleBy:Ee,parentTopLeft:Ce,fadeValues:$e}=up(ge,t,Q,ie);ge.fadeOpacity=$e.tileOpacity,Se?(Se.fadeOpacity=$e.parentTileOpacity,Se.texture.bind(ke,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST)):ge.texture.bind(ke,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),ge.texture.useMipmap&&R.extTextureFilterAnisotropic&&m.transform.pitch>20&&D.texParameterf(D.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax);const Ge=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ce),Ne=U.getProjectionData({overscaledTileID:ce,aligned:H,applyGlobeMatrix:!M,applyTerrainMatrix:!0}),He=zc(Ce,Ee,$e.fadeMix,s,b),gt=W.getMeshFromTileID(R,ce.canonical,g,y,"raster");B.draw(R,D.TRIANGLES,re,h?h[ce.overscaledZ]:It.disabled,X,P?Mt.frontCCW:Mt.backCCW,He,Ge,Ne,s.id,gt.vertexBuffer,gt.indexBuffer,gt.segments)}}function up(m,t,s,l){const h={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(s===0||l)return h;if(m.fadingParentID){const g=t.getLoadedTile(m.fadingParentID);if(!g)return h;const y=Math.pow(2,g.tileID.overscaledZ-m.tileID.overscaledZ),b=[m.tileID.canonical.x*y%1,m.tileID.canonical.y*y%1],P=function(M,k,R){const D=_e(),B=(D-k.timeAdded)/R,U=M.fadingDirection===Ie.Incoming,W=c.an((D-M.timeAdded)/R,0,1),X=c.an(1-B,0,1),H=U?W:X;return{tileOpacity:H,parentTileOpacity:U?X:W,fadeMix:{opacity:1,mix:1-H}}}(m,g,s);return{parentTile:g,parentScaleBy:y,parentTopLeft:b,fadeValues:P}}if(m.selfFading){const g=function(y,b){const P=(_e()-y.timeAdded)/b,M=c.an(P,0,1);return{tileOpacity:M,fadeMix:{opacity:M,mix:0}}}(m,s);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:g}}return h}const cp=new c.bp(1,0,0,1),hp=new c.bp(0,1,0,1),dp=new c.bp(0,0,1,1),pp=new c.bp(1,0,1,1),_s=new c.bp(0,1,1,1);function $c(m,t,s,l){qa(m,0,t+s/2,m.transform.width,s,l)}function Gc(m,t,s,l){qa(m,t-s/2,0,s,m.transform.height,l)}function qa(m,t,s,l,h,g){const y=m.context,b=y.gl;b.enable(b.SCISSOR_TEST),b.scissor(t*m.pixelRatio,s*m.pixelRatio,l*m.pixelRatio,h*m.pixelRatio),y.clear({color:g}),b.disable(b.SCISSOR_TEST)}function fp(m,t,s){const l=m.context,h=l.gl,g=m.useProgram("debug"),y=bt.disabled,b=It.disabled,P=m.colorModeForRenderPass(),M="$debug",k=m.style.map.terrain&&m.style.map.terrain.getTerrainData(s);l.activeTexture.set(h.TEXTURE0);const R=t.getTileByID(s.key).latestRawTileData,D=Math.floor((R&&R.byteLength||0)/1024),B=t.getTile(s).tileSize,U=512/Math.min(B,512)*(s.overscaledZ/m.transform.zoom)*.5;let W=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(W+=` => ${s.overscaledZ}`),function(H,ee){H.initDebugOverlayCanvas();const ae=H.debugOverlayCanvas,Q=H.context.gl,ie=H.debugOverlayCanvas.getContext("2d");ie.clearRect(0,0,ae.width,ae.height),ie.shadowColor="white",ie.shadowBlur=2,ie.lineWidth=1.5,ie.strokeStyle="white",ie.textBaseline="top",ie.font="bold 36px Open Sans, sans-serif",ie.fillText(ee,5,5),ie.strokeText(ee,5,5),H.debugOverlayTexture.update(ae),H.debugOverlayTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE)}(m,`${W} ${D}kB`);const X=m.transform.getProjectionData({overscaledTileID:s,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(l,h.TRIANGLES,y,b,qt.alphaBlended,Mt.disabled,kc(c.bp.transparent,U),null,X,M,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),g.draw(l,h.LINE_STRIP,y,b,P,Mt.disabled,kc(c.bp.red),k,X,M,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function qc(m,t,s,l){const{isRenderingGlobe:h}=l,g=m.context,y=g.gl,b=m.transform,P=m.colorModeForRenderPass(),M=m.getDepthModeFor3D(),k=m.useProgram("terrain");g.bindFramebuffer.set(null),g.viewport.set([0,0,m.width,m.height]);for(const R of s){const D=t.getTerrainMesh(R.tileID),B=m.renderToTexture.getTexture(R),U=t.getTerrainData(R.tileID);g.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,B.texture);const W=t.getMeshFrameDelta(b.zoom),X=b.calculateFogMatrix(R.tileID.toUnwrapped()),H=Am(W,X,m.style.sky,b.pitch,h),ee=b.getProjectionData({overscaledTileID:R.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});k.draw(g,y.TRIANGLES,M,It.disabled,P,Mt.backCCW,H,U,ee,"terrain",D.vertexBuffer,D.indexBuffer,D.segments)}}function Zc(m,t){if(!t.mesh){const s=new c.aW;s.emplaceBack(-1,-1),s.emplaceBack(1,-1),s.emplaceBack(1,1),s.emplaceBack(-1,1);const l=new c.aY;l.emplaceBack(0,1,2),l.emplaceBack(0,2,3),t.mesh=new Gt(m.createVertexBuffer(s,ds.members),m.createIndexBuffer(l),c.aX.simpleSegment(0,0,s.length,l.length))}return t.mesh}class mp{constructor(t,s){this.context=new tu(t),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Kn.maxOverzooming+Kn.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new kn}resize(t,s,l){if(this.width=Math.floor(t*l),this.height=Math.floor(s*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style._order)this.style._layers[h].resize()}setup(){const t=this.context,s=new c.aW;s.emplaceBack(0,0),s.emplaceBack(c.a5,0),s.emplaceBack(0,c.a5),s.emplaceBack(c.a5,c.a5),this.tileExtentBuffer=t.createVertexBuffer(s,ds.members),this.tileExtentSegments=c.aX.simpleSegment(0,0,4,2);const l=new c.aW;l.emplaceBack(0,0),l.emplaceBack(c.a5,0),l.emplaceBack(0,c.a5),l.emplaceBack(c.a5,c.a5),this.debugBuffer=t.createVertexBuffer(l,ds.members),this.debugSegments=c.aX.simpleSegment(0,0,4,5);const h=new c.ch;h.emplaceBack(0,0,0,0),h.emplaceBack(c.a5,0,c.a5,0),h.emplaceBack(0,c.a5,0,c.a5),h.emplaceBack(c.a5,c.a5,c.a5,c.a5),this.rasterBoundsBuffer=t.createVertexBuffer(h,km.members),this.rasterBoundsSegments=c.aX.simpleSegment(0,0,4,2);const g=new c.aW;g.emplaceBack(0,0),g.emplaceBack(c.a5,0),g.emplaceBack(0,c.a5),g.emplaceBack(c.a5,c.a5),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(g,ds.members),this.rasterBoundsSegmentsPosOnly=c.aX.simpleSegment(0,0,4,5);const y=new c.aW;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(y,ds.members),this.viewportSegments=c.aX.simpleSegment(0,0,4,2);const b=new c.ci;b.emplaceBack(0),b.emplaceBack(1),b.emplaceBack(3),b.emplaceBack(2),b.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(b);const P=new c.aY;P.emplaceBack(1,0,2),P.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(P);const M=this.context.gl;this.stencilClearMode=new It({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO),this.tileExtentMesh=new Gt(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,s=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=c.N();c.c7(l,0,this.width,this.height,0,0,1),c.Q(l,l,[s.drawingBufferWidth,s.drawingBufferHeight,0]);const h={mainMatrix:l,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:l};this.useProgram("clippingMask",null,!0).draw(t,s.TRIANGLES,bt.disabled,this.stencilClearMode,qt.disabled,Mt.disabled,null,null,h,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,s,l){if(this.currentStencilSource===t.source||!t.isTileClipped()||!s||!s.length)return;this.currentStencilSource=t.source,this.nextStencilID+s.length>256&&this.clearStencil();const h=this.context;h.setColorMode(qt.disabled),h.setDepthMode(bt.disabled);const g={};for(const y of s)g[y.key]=this.nextStencilID++;this._renderTileMasks(g,s,l,!0),this._renderTileMasks(g,s,l,!1),this._tileClippingMaskIDs=g}_renderTileMasks(t,s,l,h){const g=this.context,y=g.gl,b=this.style.projection,P=this.transform,M=this.useProgram("clippingMask");for(const k of s){const R=t[k.key],D=this.style.map.terrain&&this.style.map.terrain.getTerrainData(k),B=b.getMeshFromTileID(this.context,k.canonical,h,!0,"stencil"),U=P.getProjectionData({overscaledTileID:k,applyGlobeMatrix:!l,applyTerrainMatrix:!0});M.draw(g,y.TRIANGLES,bt.disabled,new It({func:y.ALWAYS,mask:0},R,255,y.KEEP,y.KEEP,y.REPLACE),qt.disabled,l?Mt.disabled:Mt.backCCW,null,D,U,"$clipping",B.vertexBuffer,B.indexBuffer,B.segments)}}_renderTilesDepthBuffer(){const t=this.context,s=t.gl,l=this.style.projection,h=this.transform,g=this.useProgram("depth"),y=this.getDepthModeFor3D(),b=pr(h,{tileSize:h.tileSize});for(const P of b){const M=this.style.map.terrain&&this.style.map.terrain.getTerrainData(P),k=l.getMeshFromTileID(this.context,P.canonical,!0,!0,"raster"),R=h.getProjectionData({overscaledTileID:P,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(t,s.TRIANGLES,y,It.disabled,qt.disabled,Mt.backCCW,null,M,R,"$clipping",k.vertexBuffer,k.indexBuffer,k.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new It({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){const s=this.context.gl;return new It({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const s=this.context.gl,l=t.sort((y,b)=>b.overscaledZ-y.overscaledZ),h=l[l.length-1].overscaledZ,g=l[0].overscaledZ-h+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const y={};for(let b=0;b<g;b++)y[b+h]=new It({func:s.GEQUAL,mask:255},b+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=g,[y,l]}return[{[h]:It.disabled},l]}stencilConfigForOverlapTwoPass(t){const s=this.context.gl,l=t.sort((y,b)=>b.overscaledZ-y.overscaledZ),h=l[l.length-1].overscaledZ,g=l[0].overscaledZ-h+1;if(this.clearStencil(),g>1){const y={},b={};for(let P=0;P<g;P++)y[P+h]=new It({func:s.GREATER,mask:255},g+1+P,255,s.KEEP,s.KEEP,s.REPLACE),b[P+h]=new It({func:s.GREATER,mask:255},1+P,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID=2*g+1,[y,b,l]}return this.nextStencilID=3,[{[h]:new It({func:s.GREATER,mask:255},2,255,s.KEEP,s.KEEP,s.REPLACE)},{[h]:new It({func:s.GREATER,mask:255},1,255,s.KEEP,s.KEEP,s.REPLACE)},l]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new qt([t.CONSTANT_COLOR,t.ONE],new c.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?qt.unblended:qt.alphaBlended}getDepthModeForSublayer(t,s,l){if(!this.opaquePassEnabledForLayer())return bt.disabled;const h=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new bt(l||this.context.gl.LEQUAL,s,[h,h])}getDepthModeFor3D(){return new bt(this.context.gl.LEQUAL,bt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,s){var l,h;this.style=t,this.options=s,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(_e()),this.imageManager.beginFrame();const g=this.style._order,y=this.style.tileManagers,b={},P={},M={},k={isRenderingToTexture:!1,isRenderingGlobe:((l=t.projection)===null||l===void 0?void 0:l.transitionState)>0};for(const D in y){const B=y[D];B.used&&B.prepare(this.context),b[D]=B.getVisibleCoordinates(!1),P[D]=b[D].slice().reverse(),M[D]=B.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let D=0;D<g.length;D++)if(this.style._layers[g[D]].is3D()){this.opaquePassCutoff=D;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const D of g){const B=this.style._layers[D];if(!B.hasOffscreenPass()||B.isHidden(this.transform.zoom))continue;const U=P[B.source];(B.type==="custom"||U.length)&&this.renderLayer(this,y[B.source],B,U,k)}if((h=this.style.projection)===null||h===void 0||h.updateGPUdependent({context:this.context,useProgram:D=>this.useProgram(D)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?c.bp.black:c.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(D,B){const U=D.context,W=U.gl,X=((ce,re,ge)=>{const ke=Math.cos(re.rollInRadians),Se=Math.sin(re.rollInRadians),Ee=jt(re),Ce=re.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:ce.properties.get("sky-color"),u_horizon_color:ce.properties.get("horizon-color"),u_horizon:[(re.width/2-Ee*Se)*ge,(re.height/2+Ee*ke)*ge],u_horizon_normal:[-Se,ke],u_sky_horizon_blend:ce.properties.get("sky-horizon-blend")*re.height/2*ge,u_sky_blend:Ce}})(B,D.style.map.transform,D.pixelRatio),H=new bt(W.LEQUAL,bt.ReadWrite,[0,1]),ee=It.disabled,ae=D.colorModeForRenderPass(),Q=D.useProgram("sky"),ie=Zc(U,B);Q.draw(U,W.TRIANGLES,H,ee,ae,Mt.disabled,X,null,void 0,"sky",ie.vertexBuffer,ie.indexBuffer,ie.segments)}(this,this.style.sky),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const D=this.style._layers[g[this.currentLayer]],B=y[D.source],U=b[D.source];this._renderTileClippingMasks(D,U,!1),this.renderLayer(this,B,D,U,k)}this.renderPass="translucent";let R=!1;for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const D=this.style._layers[g[this.currentLayer]],B=y[D.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(D,k))continue;this.opaquePassEnabledForLayer()||R||(R=!0,k.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const U=(D.type==="symbol"?M:P)[D.source];this._renderTileClippingMasks(D,b[D.source],!!this.renderToTexture),this.renderLayer(this,B,D,U,k)}if(k.isRenderingGlobe&&function(D,B,U){const W=D.context,X=W.gl,H=D.useProgram("atmosphere"),ee=new bt(X.LEQUAL,bt.ReadOnly,[0,1]),ae=D.transform,Q=function(Ce,$e){const Ge=Ce.properties.get("position"),Ne=[-Ge.x,-Ge.y,-Ge.z],He=c.ar(new Float64Array(16));return Ce.properties.get("anchor")==="map"&&(c.bg(He,He,$e.rollInRadians),c.bh(He,He,-$e.pitchInRadians),c.bg(He,He,$e.bearingInRadians),c.bh(He,He,$e.center.lat*Math.PI/180),c.bJ(He,He,-$e.center.lng*Math.PI/180)),c.cg(Ne,Ne,He),Ne}(U,D.transform),ie=ae.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ce=B.properties.get("atmosphere-blend")*ie.projectionTransition;if(ce===0)return;const re=Os(ae.worldSize,ae.center.lat),ge=ae.inverseProjectionMatrix,ke=new Float64Array(4);ke[3]=1,c.aH(ke,ke,ae.modelViewProjectionMatrix),ke[0]/=ke[3],ke[1]/=ke[3],ke[2]/=ke[3],ke[3]=1,c.aH(ke,ke,ge),ke[0]/=ke[3],ke[1]/=ke[3],ke[2]/=ke[3],ke[3]=1;const Se=((Ce,$e,Ge,Ne,He)=>({u_sun_pos:Ce,u_atmosphere_blend:$e,u_globe_position:Ge,u_globe_radius:Ne,u_inv_proj_matrix:He}))(Q,ce,[ke[0],ke[1],ke[2]],re,ge),Ee=Zc(W,B);H.draw(W,X.TRIANGLES,ee,It.disabled,qt.alphaBlended,Mt.disabled,Se,null,null,"atmosphere",Ee.vertexBuffer,Ee.indexBuffer,Ee.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const D=function(B,U){let W=null;const X=Object.values(B._layers).flatMap(Q=>Q.source&&!Q.isHidden(U)?[B.tileManagers[Q.source]]:[]),H=X.filter(Q=>Q.getSource().type==="vector"),ee=X.filter(Q=>Q.getSource().type!=="vector"),ae=Q=>{(!W||W.getSource().maxzoom<Q.getSource().maxzoom)&&(W=Q)};return H.forEach(Q=>ae(Q)),W||ee.forEach(Q=>ae(Q)),W}(this.style,this.transform.zoom);D&&function(B,U,W){for(let X=0;X<W.length;X++)fp(B,U,W[X])}(this,D,D.getVisibleCoordinates())}this.options.showPadding&&function(D){const B=D.transform.padding;$c(D,D.transform.height-(B.top||0),3,cp),$c(D,B.bottom||0,3,hp),Gc(D,B.left||0,3,dp),Gc(D,D.transform.width-(B.right||0),3,pp);const U=D.transform.centerPoint;(function(W,X,H,ee){qa(W,X-1,H-10,2,20,ee),qa(W,X-10,H-1,20,2,ee)})(D,U.x,D.transform.height-U.y,_s)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const s=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let h=this.terrainFacilitator.dirty;h||(h=t?!c.cj(s,l):!c.ck(s,l)),h||(h=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),h&&(c.cl(s,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(g,y){const b=g.context,P=b.gl,M=g.transform,k=qt.unblended,R=new bt(P.LEQUAL,bt.ReadWrite,[0,1]),D=y.tileManager.getRenderableTiles(),B=g.useProgram("terrainDepth");b.bindFramebuffer.set(y.getFramebuffer("depth").framebuffer),b.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),b.clear({color:c.bp.transparent,depth:1});for(const U of D){const W=y.getTerrainMesh(U.tileID),X=y.getTerrainData(U.tileID),H=M.getProjectionData({overscaledTileID:U.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),ee={u_ele_delta:y.getMeshFrameDelta(M.zoom)};B.draw(b,P.TRIANGLES,R,It.disabled,k,Mt.backCCW,ee,X,H,"terrain",W.vertexBuffer,W.indexBuffer,W.segments)}b.bindFramebuffer.set(null),b.viewport.set([0,0,g.width,g.height])}(this,this.style.map.terrain),function(g,y){const b=g.context,P=b.gl,M=g.transform,k=qt.unblended,R=new bt(P.LEQUAL,bt.ReadWrite,[0,1]),D=y.getCoordsTexture(),B=y.tileManager.getRenderableTiles(),U=g.useProgram("terrainCoords");b.bindFramebuffer.set(y.getFramebuffer("coords").framebuffer),b.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),b.clear({color:c.bp.transparent,depth:1}),y.coordsIndex=[];for(const W of B){const X=y.getTerrainMesh(W.tileID),H=y.getTerrainData(W.tileID);b.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,D.texture);const ee={u_terrain_coords_id:(255-y.coordsIndex.length)/255,u_texture:0,u_ele_delta:y.getMeshFrameDelta(M.zoom)},ae=M.getProjectionData({overscaledTileID:W.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});U.draw(b,P.TRIANGLES,R,It.disabled,k,Mt.backCCW,ee,H,ae,"terrain",X.vertexBuffer,X.indexBuffer,X.segments),y.coordsIndex.push(W.tileID.key)}b.bindFramebuffer.set(null),b.viewport.set([0,0,g.width,g.height])}(this,this.style.map.terrain))}renderLayer(t,s,l,h,g){l.isHidden(this.transform.zoom)||(l.type==="background"||l.type==="custom"||(h||[]).length)&&(this.id=l.id,c.cm(l)?function(y,b,P,M,k,R){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:D}=R,B=It.disabled,U=y.colorModeForRenderPass();(P._unevaluatedLayout.hasValue("text-variable-anchor")||P._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(W,X,H,ee,ae,Q,ie,ce,re){const ge=X.transform,ke=X.style.map.terrain,Se=ae==="map",Ee=Q==="map";for(const Ce of W){const $e=ee.getTile(Ce),Ge=$e.getBucket(H);if(!Ge||!Ge.text||!Ge.text.segments.get().length)continue;const Ne=c.ay(Ge.textSizeData,ge.zoom),He=c.aN($e,1,X.transform.zoom),gt=Nn(Se,X.transform,He),Ft=H.layout.get("icon-text-fit")!=="none"&&Ge.hasIconData();if(Ne){const er=Math.pow(2,ge.zoom-$e.tileID.overscaledZ),Zt=ke?(ir,Wt)=>ke.getElevation(Ce,ir,Wt):null;$m(Ge,Se,Ee,re,ge,gt,er,Ne,Ft,c.aO(ge,$e,ie,ce),Ce.toUnwrapped(),Zt)}}}(M,y,P,b,P.layout.get("text-rotation-alignment"),P.layout.get("text-pitch-alignment"),P.paint.get("text-translate"),P.paint.get("text-translate-anchor"),k),P.paint.get("icon-opacity").constantOr(1)!==0&&Va(y,b,P,M,!1,P.paint.get("icon-translate"),P.paint.get("icon-translate-anchor"),P.layout.get("icon-rotation-alignment"),P.layout.get("icon-pitch-alignment"),P.layout.get("icon-keep-upright"),B,U,D),P.paint.get("text-opacity").constantOr(1)!==0&&Va(y,b,P,M,!0,P.paint.get("text-translate"),P.paint.get("text-translate-anchor"),P.layout.get("text-rotation-alignment"),P.layout.get("text-pitch-alignment"),P.layout.get("text-keep-upright"),B,U,D),b.map.showCollisionBoxes&&(Gs(y,b,P,M,!0),Gs(y,b,P,M,!1))}(t,s,l,h,this.style.placement.variableOffsets,g):c.cn(l)?function(y,b,P,M,k){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:R}=k,D=P.paint.get("circle-opacity"),B=P.paint.get("circle-stroke-width"),U=P.paint.get("circle-stroke-opacity"),W=!P.layout.get("circle-sort-key").isConstant();if(D.constantOr(1)===0&&(B.constantOr(1)===0||U.constantOr(1)===0))return;const X=y.context,H=X.gl,ee=y.transform,ae=y.getDepthModeForSublayer(0,bt.ReadOnly),Q=It.disabled,ie=y.colorModeForRenderPass(),ce=[],re=ee.getCircleRadiusCorrection();for(let ge=0;ge<M.length;ge++){const ke=M[ge],Se=b.getTile(ke),Ee=Se.getBucket(P);if(!Ee)continue;const Ce=P.paint.get("circle-translate"),$e=P.paint.get("circle-translate-anchor"),Ge=c.aO(ee,Se,Ce,$e),Ne=Ee.programConfigurations.get(P.id),He=y.useProgram("circle",Ne),gt=Ee.layoutVertexBuffer,Ft=Ee.indexBuffer,er=y.style.map.terrain&&y.style.map.terrain.getTerrainData(ke),Zt={programConfiguration:Ne,program:He,layoutVertexBuffer:gt,indexBuffer:Ft,uniformValues:Gd(y,Se,P,Ge,re),terrainData:er,projectionData:ee.getProjectionData({overscaledTileID:ke,applyGlobeMatrix:!R,applyTerrainMatrix:!0})};if(W){const ir=Ee.segments.get();for(const Wt of ir)ce.push({segments:new c.aX([Wt]),sortKey:Wt.sortKey,state:Zt})}else ce.push({segments:Ee.segments,sortKey:0,state:Zt})}W&&ce.sort((ge,ke)=>ge.sortKey-ke.sortKey);for(const ge of ce){const{programConfiguration:ke,program:Se,layoutVertexBuffer:Ee,indexBuffer:Ce,uniformValues:$e,terrainData:Ge,projectionData:Ne}=ge.state;Se.draw(X,H.TRIANGLES,ae,Q,ie,Mt.backCCW,$e,Ge,Ne,P.id,Ee,Ce,ge.segments,P.paint,y.transform.zoom,ke)}}(t,s,l,h,g):c.co(l)?function(y,b,P,M,k){if(P.paint.get("heatmap-opacity")===0)return;const R=y.context,{isRenderingToTexture:D,isRenderingGlobe:B}=k;if(y.style.map.terrain){for(const U of M){const W=b.getTile(U);b.hasRenderableParent(U)||(y.renderPass==="offscreen"?sp(y,W,P,U,B):y.renderPass==="translucent"&&op(y,P,U,D,B))}R.viewport.set([0,0,y.width,y.height])}else y.renderPass==="offscreen"?function(U,W,X,H){const ee=U.context,ae=ee.gl,Q=U.transform,ie=It.disabled,ce=new qt([ae.ONE,ae.ONE],c.bp.transparent,[!0,!0,!0,!0]);(function(re,ge,ke){const Se=re.gl;re.activeTexture.set(Se.TEXTURE1),re.viewport.set([0,0,ge.width/4,ge.height/4]);let Ee=ke.heatmapFbos.get(c.cd);Ee?(Se.bindTexture(Se.TEXTURE_2D,Ee.colorAttachment.get()),re.bindFramebuffer.set(Ee.framebuffer)):(Ee=Ua(re,ge.width/4,ge.height/4),ke.heatmapFbos.set(c.cd,Ee))})(ee,U,X),ee.clear({color:c.bp.transparent});for(let re=0;re<H.length;re++){const ge=H[re];if(W.hasRenderableParent(ge))continue;const ke=W.getTile(ge),Se=ke.getBucket(X);if(!Se)continue;const Ee=Se.programConfigurations.get(X.id),Ce=U.useProgram("heatmap",Ee),$e=Q.getProjectionData({overscaledTileID:ge,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Ge=Q.getCircleRadiusCorrection();Ce.draw(ee,ae.TRIANGLES,bt.disabled,ie,ce,Mt.backCCW,Lo(ke,Q.zoom,X.paint.get("heatmap-intensity"),Ge),null,$e,X.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,X.paint,Q.zoom,Ee)}ee.viewport.set([0,0,U.width,U.height])}(y,b,P,M):y.renderPass==="translucent"&&function(U,W){const X=U.context,H=X.gl;X.setColorMode(U.colorModeForRenderPass());const ee=W.heatmapFbos.get(c.cd);ee&&(X.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_2D,ee.colorAttachment.get()),X.activeTexture.set(H.TEXTURE1),nu(X,W).bind(H.LINEAR,H.CLAMP_TO_EDGE),U.useProgram("heatmapTexture").draw(X,H.TRIANGLES,bt.disabled,It.disabled,U.colorModeForRenderPass(),Mt.disabled,Zd(U,W,0,1),null,null,W.id,U.viewportBuffer,U.quadTriangleIndexBuffer,U.viewportSegments,W.paint,U.transform.zoom))}(y,P)}(t,s,l,h,g):c.cp(l)?function(y,b,P,M,k){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:R}=k,D=P.paint.get("line-opacity"),B=P.paint.get("line-width");if(D.constantOr(1)===0||B.constantOr(1)===0)return;const U=y.getDepthModeForSublayer(0,bt.ReadOnly),W=y.colorModeForRenderPass(),X=P.paint.get("line-dasharray"),H=X.constantOr(1),ee=P.paint.get("line-pattern"),ae=ee.constantOr(1),Q=P.paint.get("line-gradient"),ie=P.getCrossfadeParameters();let ce;ce=ae?"linePattern":H&&Q?"lineGradientSDF":H?"lineSDF":Q?"lineGradient":"line";const re=y.context,ge=re.gl,ke=y.transform;let Se=!0;for(const Ee of M){const Ce=b.getTile(Ee);if(ae&&!Ce.patternsLoaded())continue;const $e=Ce.getBucket(P);if(!$e)continue;const Ge=$e.programConfigurations.get(P.id),Ne=y.context.program.get(),He=y.useProgram(ce,Ge),gt=Se||He.program!==Ne,Ft=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ee),er=ee.constantOr(null),Zt=X&&X.constantOr(null);if(er&&Ce.imageAtlas){const Wr=Ce.imageAtlas,Mr=Wr.patternPositions[er.to.toString()],Pr=Wr.patternPositions[er.from.toString()];Mr&&Pr&&Ge.setConstantPatternPositions(Mr,Pr)}else if(Zt){const Wr=P.layout.get("line-cap")==="round",Mr=y.lineAtlas.getDash(Zt.to,Wr),Pr=y.lineAtlas.getDash(Zt.from,Wr);Ge.setConstantDashPositions(Mr,Pr)}const ir=ke.getProjectionData({overscaledTileID:Ee,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),Wt=ke.getPixelScale();let gr;ae?(gr=Ac(y,Ce,P,Wt,ie),lp(re,ge,Ce,Ge,ie)):H&&Q?(gr=$l(y,Ce,P,Wt,ie,$e.lineClipsArray.length),Vn(y,b,re,ge,P,$e,Ee,Ge,ie)):H?(gr=Xd(y,Ce,P,Wt,ie),Tr(y,re,ge,Ge,gt,ie)):Q?(gr=Hd(y,Ce,P,Wt,$e.lineClipsArray.length),qs(y,b,re,ge,P,$e,Ee)):gr=La(y,Ce,P,Wt);const sr=y.stencilModeForClipping(Ee);He.draw(re,ge.TRIANGLES,U,sr,W,Mt.disabled,gr,Ft,ir,P.id,$e.layoutVertexBuffer,$e.indexBuffer,$e.segments,P.paint,y.transform.zoom,Ge,$e.layoutVertexBuffer2),Se=!1}}(t,s,l,h,g):c.cq(l)?function(y,b,P,M,k){const R=P.paint.get("fill-color"),D=P.paint.get("fill-opacity");if(D.constantOr(1)===0)return;const{isRenderingToTexture:B}=k,U=y.colorModeForRenderPass(),W=P.paint.get("fill-pattern"),X=y.opaquePassEnabledForLayer()&&!W.constantOr(1)&&R.constantOr(c.bp.transparent).a===1&&D.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===X){const H=y.getDepthModeForSublayer(1,y.renderPass==="opaque"?bt.ReadWrite:bt.ReadOnly);$a(y,b,P,M,H,U,!1,B)}if(y.renderPass==="translucent"&&P.paint.get("fill-antialias")){const H=y.getDepthModeForSublayer(P.getPaintProperty("fill-outline-color")?2:0,bt.ReadOnly);$a(y,b,P,M,H,U,!0,B)}}(t,s,l,h,g):c.cr(l)?function(y,b,P,M,k){const R=P.paint.get("fill-extrusion-opacity");if(R===0)return;const{isRenderingToTexture:D}=k;if(y.renderPass==="translucent"){const B=new bt(y.context.gl.LEQUAL,bt.ReadWrite,y.depthRangeFor3D);if(R!==1||P.paint.get("fill-extrusion-pattern").constantOr(1))su(y,b,P,M,B,It.disabled,qt.disabled,D),su(y,b,P,M,B,y.stencilModeFor3D(),y.colorModeForRenderPass(),D);else{const U=y.colorModeForRenderPass();su(y,b,P,M,B,It.disabled,U,D)}}}(t,s,l,h,g):c.cs(l)?function(y,b,P,M,k){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const{isRenderingToTexture:R}=k,D=y.context,B=y.style.projection.useSubdivision,U=y.getDepthModeForSublayer(0,bt.ReadOnly),W=y.colorModeForRenderPass();if(y.renderPass==="offscreen")(function(X,H,ee,ae,Q,ie,ce){const re=X.context,ge=re.gl;for(const ke of ee){const Se=H.getTile(ke),Ee=Se.dem;if(!Ee||!Ee.data||!Se.needsHillshadePrepare)continue;const Ce=Ee.dim,$e=Ee.stride,Ge=Ee.getPixels();if(re.activeTexture.set(ge.TEXTURE1),re.pixelStoreUnpackPremultiplyAlpha.set(!1),Se.demTexture=Se.demTexture||X.getTileTexture($e),Se.demTexture){const He=Se.demTexture;He.update(Ge,{premultiply:!1}),He.bind(ge.NEAREST,ge.CLAMP_TO_EDGE)}else Se.demTexture=new c.T(re,Ge,ge.RGBA,{premultiply:!1}),Se.demTexture.bind(ge.NEAREST,ge.CLAMP_TO_EDGE);re.activeTexture.set(ge.TEXTURE0);let Ne=Se.fbo;if(!Ne){const He=new c.T(re,{width:Ce,height:Ce,data:null},ge.RGBA);He.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),Ne=Se.fbo=re.createFramebuffer(Ce,Ce,!0,!1),Ne.colorAttachment.set(He.texture)}re.bindFramebuffer.set(Ne.framebuffer),re.viewport.set([0,0,Ce,Ce]),X.useProgram("hillshadePrepare").draw(re,ge.TRIANGLES,Q,ie,ce,Mt.disabled,zm(Se.tileID,Ee),null,null,ae.id,X.rasterBoundsBuffer,X.quadTriangleIndexBuffer,X.rasterBoundsSegments),Se.needsHillshadePrepare=!1}})(y,b,M,P,U,It.disabled,W),D.viewport.set([0,0,y.width,y.height]);else if(y.renderPass==="translucent")if(B){const[X,H,ee]=y.stencilConfigForOverlapTwoPass(M);gs(y,b,P,ee,X,U,W,!1,R),gs(y,b,P,ee,H,U,W,!0,R)}else{const[X,H]=y.getStencilConfigForOverlapAndUpdateStencilID(M);gs(y,b,P,H,X,U,W,!1,R)}}(t,s,l,h,g):c.ct(l)?function(y,b,P,M,k){if(y.renderPass!=="translucent"||!M.length)return;const{isRenderingToTexture:R}=k,D=y.style.projection.useSubdivision,B=y.getDepthModeForSublayer(0,bt.ReadOnly),U=y.colorModeForRenderPass();if(D){const[W,X,H]=y.stencilConfigForOverlapTwoPass(M);Ga(y,b,P,H,W,B,U,!1,R),Ga(y,b,P,H,X,B,U,!0,R)}else{const[W,X]=y.getStencilConfigForOverlapAndUpdateStencilID(M);Ga(y,b,P,X,W,B,U,!1,R)}}(t,s,l,h,g):c.bU(l)?function(y,b,P,M,k){if(y.renderPass!=="translucent"||P.paint.get("raster-opacity")===0||!M.length)return;const{isRenderingToTexture:R}=k,D=b.getSource(),B=y.style.projection.useSubdivision;if(D instanceof In)jo(y,b,P,M,null,!1,!1,D.tileCoords,D.flippedWindingOrder,R);else if(B){const[U,W,X]=y.stencilConfigForOverlapTwoPass(M);jo(y,b,P,X,U,!1,!0,Zs,!1,R),jo(y,b,P,X,W,!0,!0,Zs,!1,R)}else{const[U,W]=y.getStencilConfigForOverlapAndUpdateStencilID(M);jo(y,b,P,W,U,!1,!0,Zs,!1,R)}}(t,s,l,h,g):c.cu(l)?function(y,b,P,M,k){const R=P.paint.get("background-color"),D=P.paint.get("background-opacity");if(D===0)return;const{isRenderingToTexture:B}=k,U=y.context,W=U.gl,X=y.style.projection,H=y.transform,ee=H.tileSize,ae=P.paint.get("background-pattern");if(y.isPatternMissing(ae))return;const Q=!ae&&R.a===1&&D===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==Q)return;const ie=It.disabled,ce=y.getDepthModeForSublayer(0,Q==="opaque"?bt.ReadWrite:bt.ReadOnly),re=y.colorModeForRenderPass(),ge=y.useProgram(ae?"backgroundPattern":"background"),ke=M||pr(H,{tileSize:ee,terrain:y.style.map.terrain});ae&&(U.activeTexture.set(W.TEXTURE0),y.imageManager.bind(y.context));const Se=P.getCrossfadeParameters();for(const Ee of ke){const Ce=H.getProjectionData({overscaledTileID:Ee,applyGlobeMatrix:!B,applyTerrainMatrix:!0}),$e=ae?Rm(D,y,ae,{tileID:Ee,tileSize:ee},Se):Lc(D,R),Ge=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ee),Ne=X.getMeshFromTileID(U,Ee.canonical,!1,!0,"raster");ge.draw(U,W.TRIANGLES,ce,ie,re,Mt.backCCW,$e,Ge,Ce,P.id,Ne.vertexBuffer,Ne.indexBuffer,Ne.segments)}}(t,0,l,h,g):c.cv(l)&&function(y,b,P,M){const{isRenderingGlobe:k}=M,R=y.context,D=P.implementation,B=y.style.projection,U=y.transform,W=U.getProjectionDataForCustomLayer(k),X={farZ:U.farZ,nearZ:U.nearZ,fov:U.fov*Math.PI/180,modelViewProjectionMatrix:U.modelViewProjectionMatrix,projectionMatrix:U.projectionMatrix,shaderData:{variantName:B.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${B.shaderPreludeCode.vertexSource}`,define:B.shaderDefine},defaultProjectionData:W},H=D.renderingMode?D.renderingMode:"2d";if(y.renderPass==="offscreen"){const ee=D.prerender;ee&&(y.setCustomLayerDefaults(),R.setColorMode(y.colorModeForRenderPass()),ee.call(D,R.gl,X),R.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),R.setColorMode(y.colorModeForRenderPass()),R.setStencilMode(It.disabled);const ee=H==="3d"?y.getDepthModeFor3D():y.getDepthModeForSublayer(0,bt.ReadOnly);R.setDepthMode(ee),D.render(R.gl,X),R.setDirty(),y.setBaseState(),R.bindFramebuffer.set(null)}}(t,0,l,g))}saveTileTexture(t){const s=this._tileTextures[t.size[0]];s?s.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const s=this.imageManager.getPattern(t.from.toString()),l=this.imageManager.getPattern(t.to.toString());return!s||!l}useProgram(t,s,l=!1,h=[]){this.cache=this.cache||{};const g=!!this.style.map.terrain,y=this.style.projection,b=l?lr.projectionMercator:y.shaderPreludeCode,P=l?xn:y.shaderDefine,M=t+(s?s.cacheKey:"")+`/${l?jn:y.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(g?"/terrain":"")+(h?`/${h.join("/")}`:"");return this.cache[M]||(this.cache[M]=new jd(this.context,lr[t],s,Lm[t],this._showOverdrawInspector,g,b,P,h)),this.cache[M]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var t,s;if(this._tileTextures){for(const l in this._tileTextures){const h=this._tileTextures[l];if(h)for(const g of h)g.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((t=this.tileExtentMesh.vertexBuffer)===null||t===void 0||t.destroy()),this.tileExtentMesh&&((s=this.tileExtentMesh.indexBuffer)===null||s===void 0||s.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const l in this.cache){const h=this.cache[l];h&&h.program&&this.context.gl.deleteProgram(h.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:s}=this.context.gl;return this.width!==t||this.height!==s}}function Wc(m,t){let s,l=!1,h=null,g=null;const y=()=>{h=null,l&&(m.apply(g,s),h=setTimeout(y,t),l=!1)};return(...b)=>(l=!0,g=this,s=b,h||y(),h)}class Hc{constructor(t){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let l;return s.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(l=h)}),(l&&l[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(!this._isValidHash(s))return!1;const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:l,pitch:+(s[4]||0)}),!0},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,s)},this._removeHash=()=>{const s=this._getCurrentHash();if(s.length===0)return;const l=s.join("/");let h=l;h.split("&").length>0&&(h=h.split("&")[0]),this._hashName&&(h=`${this._hashName}=${l}`);let g=window.location.hash.replace(h,"");g.startsWith("#&")?g=g.slice(0,1)+g.slice(2):g==="#"&&(g="");let y=window.location.href.replace(/(#.+)?$/,g);y=y.replace("&&","&"),window.history.replaceState(window.history.state,null,y)},this._updateHash=Wc(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const s=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,h=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,h),y=Math.round(s.lng*g)/g,b=Math.round(s.lat*g)/g,P=this._map.getBearing(),M=this._map.getPitch();let k="";if(k+=t?`/${y}/${b}/${l}`:`${l}/${b}/${y}`,(P||M)&&(k+="/"+Math.round(10*P)/10),M&&(k+=`/${Math.round(M)}`),this._hashName){const R=this._hashName;let D=!1;const B=window.location.hash.slice(1).split("&").map(U=>{const W=U.split("=")[0];return W===R?(D=!0,`${W}=${k}`):U}).filter(U=>U);return D||B.push(`${R}=${k}`),`#${B.join("&")}`}return`#${k}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new c.V(+t[2],+t[1])}catch{return!1}const s=+t[0],l=+(t[3]||0),h=+(t[4]||0);return s>=this._map.getMinZoom()&&s<=this._map.getMaxZoom()&&l>=-180&&l<=180&&h>=this._map.getMinPitch()&&h<=this._map.getMaxPitch()}}const ys={linearity:.3,easing:c.cw(0,0,.3,1)},gp=c.e({deceleration:2500,maxSpeed:1400},ys),ei=c.e({deceleration:20,maxSpeed:1400},ys),fi=c.e({deceleration:1e3,maxSpeed:360},ys),_p=c.e({deceleration:1e3,maxSpeed:90},ys),mi=c.e({deceleration:1e3,maxSpeed:360},ys);class Gm{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:_e(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=_e();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,roll:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)s.zoom+=g.zoomDelta||0,s.bearing+=g.bearingDelta||0,s.pitch+=g.pitchDelta||0,s.roll+=g.rollDelta||0,g.panDelta&&s.pan._add(g.panDelta),g.around&&(s.around=g.around),g.pinchAround&&(s.pinchAround=g.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,h={};if(s.pan.mag()){const g=Wa(s.pan.mag(),l,c.e({},gp,t||{})),y=s.pan.mult(g.amount/s.pan.mag()),b=this._map.cameraHelper.handlePanInertia(y,this._map.transform);h.center=b.easingCenter,h.offset=b.easingOffset,Za(h,g)}if(s.zoom){const g=Wa(s.zoom,l,ei);h.zoom=this._map.transform.zoom+g.amount,Za(h,g)}if(s.bearing){const g=Wa(s.bearing,l,fi);h.bearing=this._map.transform.bearing+c.an(g.amount,-179,179),Za(h,g)}if(s.pitch){const g=Wa(s.pitch,l,_p);h.pitch=this._map.transform.pitch+g.amount,Za(h,g)}if(s.roll){const g=Wa(s.roll,l,mi);h.roll=this._map.transform.roll+c.an(g.amount,-179,179),Za(h,g)}if(h.zoom||h.bearing){const g=s.pinchAround===void 0?s.around:s.pinchAround;h.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),c.e(h,{noMoveStart:!0})}}function Za(m,t){(!m.duration||m.duration<t.duration)&&(m.duration=t.duration,m.easing=t.easing)}function Wa(m,t,s){const{maxSpeed:l,linearity:h,deceleration:g}=s,y=c.an(m*h/(t/1e3),-l,l),b=Math.abs(y)/(g*h);return{easing:s.easing,duration:1e3*b,amount:y*(b/2)}}class Zr extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,l,h={}){l=l instanceof MouseEvent?l:new MouseEvent(t,l);const g=se.mousePos(s.getCanvas(),l),y=s.unproject(g);super(t,c.e({point:g,lngLat:y,originalEvent:l},h)),this._defaultPrevented=!1,this.target=s}}class Ha extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,l){const h=t==="touchend"?l.changedTouches:l.touches,g=se.touchPos(s.getCanvasContainer(),h),y=g.map(P=>s.unproject(P)),b=g.reduce((P,M,k,R)=>P.add(M.div(R.length)),new c.P(0,0));super(t,{points:g,point:b,lngLats:y,lngLat:s.unproject(b),originalEvent:l}),this._defaultPrevented=!1}}class yp extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,l){super(t,{originalEvent:l}),this._defaultPrevented=!1}}class qm{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new yp(t.type,this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new Zr(t.type,this._map,t))}mouseup(t){this._map.fire(new Zr(t.type,this._map,t))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new Zr(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Zr(t.type,this._map,t))}mouseover(t){this._map.fire(new Zr(t.type,this._map,t))}mouseout(t){this._map.fire(new Zr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Ha(t.type,this._map,t))}touchmove(t){this._map.fire(new Ha(t.type,this._map,t))}touchend(t){this._map.fire(new Ha(t.type,this._map,t))}touchcancel(t){this._map.fire(new Ha(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Zm{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Zr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Zr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Zr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Vo{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(c.P.convert(t),this._map.terrain)}}class Uo{constructor(t,s){this._map=t,this._tr=new Vo(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(se.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const l=s;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const h=this._startPos;this._lastPos=l,this._box||(this._box=se.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const g=Math.min(h.x,l.x),y=Math.max(h.x,l.x),b=Math.min(h.y,l.y),P=Math.max(h.y,l.y);se.setTransform(this._box,`translate(${g}px,${b}px)`),this._box.style.width=y-g+"px",this._box.style.height=P-b+"px"}mouseupWindow(t,s){if(!this._active||t.button!==0)return;const l=this._startPos,h=s;if(this.reset(),se.suppressClick(),l.x!==h.x||l.y!==h.y)return this._map.fire(new c.l("boxzoomend",{originalEvent:t})),{cameraAnimation:g=>g.fitScreenCoordinates(l,h,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(se.remove(this._box),this._box=null),se.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new c.l(t,{originalEvent:s}))}}function gi(m,t){if(m.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${t.length}`);const s={};for(let l=0;l<m.length;l++)s[m[l].identifier]=t[l];return s}class nt{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,s,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),l.length===this.numTouches&&(this.centroid=function(h){const g=new c.P(0,0);for(const y of h)g._add(y);return g.div(h.length)}(s),this.touches=gi(l,s)))}touchmove(t,s,l){if(this.aborted||!this.centroid)return;const h=gi(l,s);for(const g in this.touches){const y=h[g];(!y||y.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(t,s,l){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const h=!this.aborted&&this.centroid;if(this.reset(),h)return h}}}class ou{constructor(t){this.singleTap=new nt(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,s,l){this.singleTap.touchstart(t,s,l)}touchmove(t,s,l){this.singleTap.touchmove(t,s,l)}touchend(t,s,l){const h=this.singleTap.touchend(t,s,l);if(h){const g=t.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(h)<30;if(g&&y||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}}}class Xc{constructor(t){this._tr=new Vo(t),this._zoomIn=new ou({numTouches:1,numTaps:2}),this._zoomOut=new ou({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,l){this._zoomIn.touchstart(t,s,l),this._zoomOut.touchstart(t,s,l)}touchmove(t,s,l){this._zoomIn.touchmove(t,s,l),this._zoomOut.touchmove(t,s,l)}touchend(t,s,l){const h=this._zoomIn.touchend(t,s,l),g=this._zoomOut.touchend(t,s,l),y=this._tr;return h?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:y.zoom+1,around:y.unproject(h)},{originalEvent:t})}):g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:y.zoom-1,around:y.unproject(g)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $o{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const s=this._moveFunction(...t);if(s.bearingDelta||s.pitchDelta||s.rollDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(t,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(s)?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,s){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const h=Array.isArray(s)?s[0]:s;return!this._moved&&h.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=h,this._move(l,h))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&se.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Xa=0,Ya=2,Yc={[Xa]:1,[Ya]:2};class Ka{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const s=se.mouseButton(t);this._eventButton=s}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(s,l){const h=Yc[l];return s.buttons===void 0||(s.buttons&h)!==h}(t,this._eventButton)}isValidEndEvent(t){return se.mouseButton(t)===this._eventButton}}class Kc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class vp{constructor(t=new Ka({checkCorrectEvent:()=>!0}),s=new Kc){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=s}_executeRelevantHandler(t,s,l){return t instanceof MouseEvent?s(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?l(t):void 0}startMove(t){this._executeRelevantHandler(t,s=>this.mouseMoveStateManager.startMove(s),s=>this.oneFingerTouchMoveStateManager.startMove(s))}endMove(t){this._executeRelevantHandler(t,s=>this.mouseMoveStateManager.endMove(s),s=>this.oneFingerTouchMoveStateManager.endMove(s))}isValidStartEvent(t){return this._executeRelevantHandler(t,s=>this.mouseMoveStateManager.isValidStartEvent(s),s=>this.oneFingerTouchMoveStateManager.isValidStartEvent(s))}isValidMoveEvent(t){return this._executeRelevantHandler(t,s=>this.mouseMoveStateManager.isValidMoveEvent(s),s=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(s))}isValidEndEvent(t){return this._executeRelevantHandler(t,s=>this.mouseMoveStateManager.isValidEndEvent(s),s=>this.oneFingerTouchMoveStateManager.isValidEndEvent(s))}}const Go=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=t=>{t.preventDefault()}};class Wm{constructor(t,s){this._clickTolerance=t.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,s,l){return this._calculateTransform(t,s,l)}touchmove(t,s,l){if(this._active){if(!this._shouldBePrevented(l.length))return t.preventDefault(),this._calculateTransform(t,s,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,s,l){this._calculateTransform(t,s,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,l){l.length>0&&(this._active=!0);const h=gi(l,s),g=new c.P(0,0),y=new c.P(0,0);let b=0;for(const M in h){const k=h[M],R=this._touches[M];R&&(g._add(k),y._add(k.sub(R)),b++,h[M]=k)}if(this._touches=h,this._shouldBePrevented(b)||!y.mag())return;const P=y.div(b);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(b),panDelta:P}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class au{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,s,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,l){if(!this._firstTwoTouches)return;t.preventDefault();const[h,g]=this._firstTwoTouches,y=lu(l,s,h),b=lu(l,s,g);if(!y||!b)return;const P=this._aroundCenter?null:y.add(b).div(2);return this._move([y,b],P,t)}touchend(t,s,l){if(!this._firstTwoTouches)return;const[h,g]=this._firstTwoTouches,y=lu(l,s,h),b=lu(l,s,g);y&&b||(this._active&&se.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function lu(m,t,s){for(let l=0;l<m.length;l++)if(m[l].identifier===s)return t[l]}function xp(m,t){return Math.log(m/t)/Math.LN2}class Qc extends au{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const l=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(xp(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:xp(this._distance,l),pinchAround:s}}}function bp(m,t){return 180*m.angleWith(t)/Math.PI}class Jc extends au{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s,l){const h=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:bp(this._vector,h),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,l=bp(t,this._startVector);return Math.abs(l)<s}}function eh(m){return Math.abs(m.y)>Math.abs(m.x)}class wp extends au{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,s,l){super.touchstart(t,s,l),this._currentTouchCount=l.length}_start(t){this._lastPoints=t,eh(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const h=t[0].sub(this._lastPoints[0]),g=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(h,g,l.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(h.y+g.y)/2*-.5}):void 0}gestureBeginsVertically(t,s,l){if(this._valid!==void 0)return this._valid;const h=t.mag()>=2,g=s.mag()>=2;if(!h&&!g)return;if(!h||!g)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const y=t.y>0==s.y>0;return eh(t)&&eh(s)&&y}}const vs={panStep:100,bearingStep:15,pitchStep:10};class Vt{constructor(t){this._tr=new Vo(t);const s=vs;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,l=0,h=0,g=0,y=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?l=-1:(t.preventDefault(),g=-1);break;case 39:t.shiftKey?l=1:(t.preventDefault(),g=1);break;case 38:t.shiftKey?h=1:(t.preventDefault(),y=-1);break;case 40:t.shiftKey?h=-1:(t.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(l=0,h=0),{cameraAnimation:b=>{const P=this._tr;b.easeTo({duration:300,easeId:"keyboardHandler",easing:Hm,zoom:s?Math.round(P.zoom)+s*(t.shiftKey?2:1):P.zoom,bearing:P.bearing+l*this._bearingStep,pitch:P.pitch+h*this._pitchStep,offset:[-g*this._panStep,-y*this._panStep],center:P.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Hm(m){return m*(2-m)}const Qa=4.000244140625,uu=1/450;class cu{constructor(t,s){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=t,this._tr=new Vo(t),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=uu}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const l=_e(),h=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,s!==0&&s%Qa==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(h*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=se.mousePos(this._map.getCanvas(),t),l=this._tr;this._aroundPoint=this._aroundCenter?l.transform.locationToScreenPoint(c.V.convert(l.center)):s,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const b=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=b),typeof this._targetZoom=="number"&&(this._targetZoom+=b)}if(this._delta!==0){const b=this._type==="wheel"&&Math.abs(this._delta)>Qa?this._wheelZoomRate:this._defaultZoomRate;let P=2/(1+Math.exp(-Math.abs(this._delta*b)));this._delta<0&&P!==0&&(P=1/P);const M=typeof this._targetZoom!="number"?t.scale:c.aq(this._targetZoom);this._targetZoom=t.applyConstrain(t.getCameraLngLat(),c.at(M*P)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,l=this._startZoom,h=this._easing;let g,y=!1;if(this._type==="wheel"&&l&&h){const b=_e()-this._lastWheelEventTime,P=Math.min((b+5)/200,1),M=h(P);g=c.G.number(l,s,M),P<1?this._frameId||(this._frameId=!0):y=!0}else g=s,y=!0;return this._active=!0,y&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=g,{noInertia:!0,needsRenderFrame:!y,zoomDelta:g-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=c.cy;if(this._prevEase){const l=this._prevEase,h=(_e()-l.start)/l.duration,g=l.easing(h+.01)-l.easing(h),y=.27/Math.sqrt(g*g+1e-4)*.01,b=Math.sqrt(.0729-y*y);s=c.cw(y,b,.25,1)}return this._prevEase={start:_e(),duration:t,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class th{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Tp{constructor(t){this._tr=new Vo(t),this.reset()}reset(){this._active=!1}dblclick(t,s){return t.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sp{constructor(){this._tap=new ou({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,s,l){if(!this._swipePoint)if(this._tapTime){const h=s[0],g=t.timeStamp-this._tapTime<500,y=this._tapPoint.dist(h)<30;g&&y?l.length>0&&(this._swipePoint=h,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(t,s,l)}touchmove(t,s,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const h=s[0],g=h.y-this._swipePoint.y;return this._swipePoint=h,t.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(t,s,l)}touchend(t,s,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const h=this._tap.touchend(t,s,l);h&&(this._tapTime=t.timeStamp,this._tapPoint=h)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pp{constructor(t,s,l){this._el=t,this._mousePan=s,this._touchPan=l}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class _i{constructor(t,s,l,h){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=s,this._mousePitch=l,this._mouseRoll=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Ja{constructor(t,s,l,h){this._el=t,this._touchZoom=s,this._touchRotate=l,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ut{constructor(t,s){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=s,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=se.create("div","maplibregl-cooperative-gesture-screen",t);let s=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(s=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),h=document.createElement("div");h.className="maplibregl-desktop-message",h.textContent=s,this._container.appendChild(h);const g=document.createElement("div");g.className="maplibregl-mobile-message",g.textContent=l,this._container.appendChild(g),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(se.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,s){this._enabled&&(this._map.fire(new c.l("cooperativegestureprevented",{gestureType:t,originalEvent:s})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const dt=m=>m.zoom||m.drag||m.roll||m.pitch||m.rotate;class el extends c.l{}function hu(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta||m.rollDelta}class du{constructor(t,s){this.handleWindowEvent=h=>{this.handleEvent(h,`${h.type}Window`)},this.handleEvent=(h,g)=>{if(h.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const y=h.type==="renderFrame"?void 0:h,b={needsRenderFrame:!1},P={},M={};for(const{handlerName:D,handler:B,allowed:U}of this._handlers){if(!B.isEnabled())continue;let W;if(this._blockedByActive(M,U,D))B.reset();else if(B[g||h.type]){if(c.cz(h,g||h.type)){const X=se.mousePos(this._map.getCanvas(),h);W=B[g||h.type](h,X)}else if(c.cA(h,g||h.type)){const X=this._getMapTouches(h.touches),H=se.touchPos(this._map.getCanvas(),X);W=B[g||h.type](h,H,X)}else c.cB(g||h.type)||(W=B[g||h.type](h));this.mergeHandlerResult(b,P,W,D,y),W&&W.needsRenderFrame&&this._triggerRenderFrame()}(W||B.isActive())&&(M[D]=B)}const k={};for(const D in this._previousActiveHandlers)M[D]||(k[D]=y);this._previousActiveHandlers=M,(Object.keys(k).length||hu(b))&&(this._changes.push([b,P,k]),this._triggerRenderFrame()),(Object.keys(M).length||hu(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:R}=b;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Gm(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[h,g,y]of this._listeners)se.addEventListener(h,g,h===document?this.handleWindowEvent:this.handleEvent,y)}destroy(){for(const[t,s,l]of this._listeners)se.removeEventListener(t,s,t===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(t){const s=this._map,l=s.getCanvasContainer();this._add("mapEvent",new qm(s,t));const h=s.boxZoom=new Uo(s,t);this._add("boxZoom",h),t.interactive&&t.boxZoom&&h.enable();const g=s.cooperativeGestures=new ut(s,t.cooperativeGestures);this._add("cooperativeGestures",g),t.cooperativeGestures&&g.enable();const y=new Xc(s),b=new Tp(s);s.doubleClickZoom=new th(b,y),this._add("tapZoom",y),this._add("clickZoom",b),t.interactive&&t.doubleClickZoom&&s.doubleClickZoom.enable();const P=new Sp;this._add("tapDragZoom",P);const M=s.touchPitch=new wp(s);this._add("touchPitch",M),t.interactive&&t.touchPitch&&s.touchPitch.enable(t.touchPitch);const k=()=>s.project(s.getCenter()),R=function({enable:Q,clickTolerance:ie,aroundCenter:ce=!0,minPixelCenterThreshold:re=100,rotateDegreesPerPixelMoved:ge=.8},ke){const Se=new Ka({checkCorrectEvent:Ee=>se.mouseButton(Ee)===0&&Ee.ctrlKey||se.mouseButton(Ee)===2&&!Ee.ctrlKey});return new $o({clickTolerance:ie,move:(Ee,Ce)=>{const $e=ke();if(ce&&Math.abs($e.y-Ee.y)>re)return{bearingDelta:c.cx(new c.P(Ee.x,Ce.y),Ce,$e)};let Ge=(Ce.x-Ee.x)*ge;return ce&&Ce.y<$e.y&&(Ge=-Ge),{bearingDelta:Ge}},moveStateManager:Se,enable:Q,assignEvents:Go})}(t,k),D=function({enable:Q,clickTolerance:ie,pitchDegreesPerPixelMoved:ce=-.5}){const re=new Ka({checkCorrectEvent:ge=>se.mouseButton(ge)===0&&ge.ctrlKey||se.mouseButton(ge)===2});return new $o({clickTolerance:ie,move:(ge,ke)=>({pitchDelta:(ke.y-ge.y)*ce}),moveStateManager:re,enable:Q,assignEvents:Go})}(t),B=function({enable:Q,clickTolerance:ie,rollDegreesPerPixelMoved:ce=.3},re){const ge=new Ka({checkCorrectEvent:ke=>se.mouseButton(ke)===2&&ke.ctrlKey});return new $o({clickTolerance:ie,move:(ke,Se)=>{const Ee=re();let Ce=(Se.x-ke.x)*ce;return Se.y<Ee.y&&(Ce=-Ce),{rollDelta:Ce}},moveStateManager:ge,enable:Q,assignEvents:Go})}(t,k);s.dragRotate=new _i(t,R,D,B),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",D,["mouseRotate","mouseRoll"]),this._add("mouseRoll",B,["mousePitch"]),t.interactive&&t.dragRotate&&s.dragRotate.enable();const U=function({enable:Q,clickTolerance:ie}){const ce=new Ka({checkCorrectEvent:re=>se.mouseButton(re)===0&&!re.ctrlKey});return new $o({clickTolerance:ie,move:(re,ge)=>({around:ge,panDelta:ge.sub(re)}),activateOnStart:!0,moveStateManager:ce,enable:Q,assignEvents:Go})}(t),W=new Wm(t,s);s.dragPan=new Pp(l,U,W),this._add("mousePan",U),this._add("touchPan",W,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&s.dragPan.enable(t.dragPan);const X=new Jc,H=new Qc;s.touchZoomRotate=new Ja(l,H,X,P),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&s.touchZoomRotate.enable(t.touchZoomRotate),this._add("blockableMapEvent",new Zm(s));const ee=s.scrollZoom=new cu(s,()=>this._triggerRenderFrame());this._add("scrollZoom",ee,["mousePan"]),t.interactive&&t.scrollZoom&&s.scrollZoom.enable(t.scrollZoom);const ae=s.keyboard=new Vt(s);this._add("keyboard",ae),t.interactive&&t.keyboard&&s.keyboard.enable()}_add(t,s,l){this._handlers.push({handlerName:t,handler:s,allowed:l}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!dt(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,s,l){for(const h in t)if(h!==l&&(!s||s.indexOf(h)<0))return!0;return!1}_getMapTouches(t){const s=[];for(const l of t)this._el.contains(l.target)&&s.push(l);return s}mergeHandlerResult(t,s,l,h,g){if(!l)return;c.e(t,l);const y={handlerName:h,originalEvent:l.originalEvent||g};l.zoomDelta!==void 0&&(s.zoom=y),l.panDelta!==void 0&&(s.drag=y),l.rollDelta!==void 0&&(s.roll=y),l.pitchDelta!==void 0&&(s.pitch=y),l.bearingDelta!==void 0&&(s.rotate=y)}_applyChanges(){const t={},s={},l={};for(const[h,g,y]of this._changes)h.panDelta&&(t.panDelta=(t.panDelta||new c.P(0,0))._add(h.panDelta)),h.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+h.zoomDelta),h.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+h.bearingDelta),h.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+h.pitchDelta),h.rollDelta&&(t.rollDelta=(t.rollDelta||0)+h.rollDelta),h.around!==void 0&&(t.around=h.around),h.pinchAround!==void 0&&(t.pinchAround=h.pinchAround),h.noInertia&&(t.noInertia=h.noInertia),c.e(s,g),c.e(l,y);this._updateMapTransform(t,s,l),this._changes=[]}_updateMapTransform(t,s,l){const h=this._map,g=h._getTransformForUpdate(),y=h.terrain;if(!(hu(t)||y&&this._terrainMovement))return this._fireEvents(s,l,!0);h._stop(!0);let{panDelta:b,zoomDelta:P,bearingDelta:M,pitchDelta:k,rollDelta:R,around:D,pinchAround:B}=t;B!==void 0&&(D=B),D=D||h.transform.centerPoint,y&&!g.isPointOnMapSurface(D)&&(D=g.centerPoint);const U={panDelta:b,zoomDelta:P,rollDelta:R,pitchDelta:k,bearingDelta:M,around:D};this._map.cameraHelper.useGlobeControls&&!g.isPointOnMapSurface(D)&&(D=g.centerPoint);const W=D.distSqr(g.centerPoint)<.01?g.center:g.screenPointToLocation(b?D.sub(b):D);this._handleMapControls({terrain:y,tr:g,deltasForHelper:U,preZoomAroundLoc:W,combinedEventsInProgress:s,panDelta:b}),h._applyUpdatedTransform(g),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,l,!0)}_handleMapControls({terrain:t,tr:s,deltasForHelper:l,preZoomAroundLoc:h,combinedEventsInProgress:g,panDelta:y}){const b=this._map.cameraHelper;if(b.handleMapControlsRollPitchBearingZoom(l,s),t)return b.useGlobeControls?(this._terrainMovement||!g.drag&&!g.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void b.handleMapControlsPan(l,s,h)):this._terrainMovement||!g.drag&&!g.zoom?void(g.drag&&this._terrainMovement&&y?s.setCenter(s.screenPointToLocation(s.centerPoint.sub(y))):b.handleMapControlsPan(l,s,h)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void b.handleMapControlsPan(l,s,h));b.handleMapControlsPan(l,s,h)}_fireEvents(t,s,l){const h=dt(this._eventsInProgress),g=dt(t),y={};for(const R in t){const{originalEvent:D}=t[R];this._eventsInProgress[R]||(y[`${R}start`]=D),this._eventsInProgress[R]=t[R]}!h&&g&&this._fireEvent("movestart",g.originalEvent);for(const R in y)this._fireEvent(R,y[R]);g&&this._fireEvent("move",g.originalEvent);for(const R in t){const{originalEvent:D}=t[R];this._fireEvent(R,D)}const b={};let P;for(const R in this._eventsInProgress){const{handlerName:D,originalEvent:B}=this._eventsInProgress[R];this._handlersById[D].isActive()||(delete this._eventsInProgress[R],P=s[D]||B,b[`${R}end`]=P)}for(const R in b)this._fireEvent(R,b[R]);const M=dt(this._eventsInProgress),k=(h||g)&&!M;if(k&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const R=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&R.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(R)}if(l&&k){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),D=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;!R||!R.essential&&Ae.prefersReducedMotion?(this._map.fire(new c.l("moveend",{originalEvent:P})),D(this._map.getBearing())&&this._map.resetNorth()):(D(R.bearing||this._map.getBearing())&&(R.bearing=0),R.freezeElevation=!0,this._map.easeTo(R,{originalEvent:P})),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new c.l(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new el("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Tn extends c.E{constructor(t,s,l){super(),this._renderFrameCallback=()=>{const h=Math.min((_e()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=l.bearingSnap,this.cameraHelper=s,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(t,s){t.apply(this.transform,!0),this.transform=t,this.cameraHelper=s}getCenter(){return new c.V(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,s){return this.jumpTo({elevation:t},s),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,s,l){return t=c.P.convert(t).mult(-1),this.panTo(this.transform.center,c.e({offset:t},s),l)}panTo(t,s,l){return this.easeTo(c.e({center:t},s),l)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,l){return this.easeTo(c.e({zoom:t},s),l)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,s){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new c.l("movestart",s)).fire(new c.l("move",s)).fire(new c.l("moveend",s))),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,l){return this.easeTo(c.e({bearing:t},s),l)}resetNorth(t,s){return this.rotateTo(0,c.e({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(c.e({bearing:0,pitch:0,roll:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}getRoll(){return this.transform.roll}setRoll(t,s){return this.jumpTo({roll:t},s),this}cameraForBounds(t,s){t=dr.convert(t).adjustAntiMeridian();const l=s&&s.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),l,s)}_cameraForBoxAndBearing(t,s,l,h){const g={top:0,bottom:0,right:0,left:0};if(typeof(h=c.e({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},h)).padding=="number"){const M=h.padding;h.padding={top:M,bottom:M,right:M,left:M}}const y=c.e(g,h.padding);h.padding=y;const b=this.transform,P=new dr(t,s);return this.cameraHelper.cameraForBoxAndBearing(h,y,P,l,b)}fitBounds(t,s,l){return this._fitInternal(this.cameraForBounds(t,s),s,l)}fitScreenCoordinates(t,s,l,h,g){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(c.P.convert(t)),this.transform.screenPointToLocation(c.P.convert(s)),l,h),h,g)}_fitInternal(t,s,l){return t?(delete(s=c.e(t,s)).padding,s.linear?this.easeTo(s,l):this.flyTo(s,l)):this}jumpTo(t,s){this.stop();const l=this._getTransformForUpdate();let h=!1,g=!1,y=!1;const b=l.zoom;this.cameraHelper.handleJumpToCenterZoom(l,t);const P=l.zoom!==b;return"elevation"in t&&l.elevation!==+t.elevation&&l.setElevation(+t.elevation),"bearing"in t&&l.bearing!==+t.bearing&&(h=!0,l.setBearing(+t.bearing)),"pitch"in t&&l.pitch!==+t.pitch&&(g=!0,l.setPitch(+t.pitch)),"roll"in t&&l.roll!==+t.roll&&(y=!0,l.setRoll(+t.roll)),t.padding==null||l.isPaddingEqual(t.padding)||l.setPadding(t.padding),this._applyUpdatedTransform(l),this.fire(new c.l("movestart",s)).fire(new c.l("move",s)),P&&this.fire(new c.l("zoomstart",s)).fire(new c.l("zoom",s)).fire(new c.l("zoomend",s)),h&&this.fire(new c.l("rotatestart",s)).fire(new c.l("rotate",s)).fire(new c.l("rotateend",s)),g&&this.fire(new c.l("pitchstart",s)).fire(new c.l("pitch",s)).fire(new c.l("pitchend",s)),y&&this.fire(new c.l("rollstart",s)).fire(new c.l("roll",s)).fire(new c.l("rollend",s)),this.fire(new c.l("moveend",s))}calculateCameraOptionsFromTo(t,s,l,h=0){const g=c.a9.fromLngLat(t,s),y=c.a9.fromLngLat(l,h),b=y.x-g.x,P=y.y-g.y,M=y.z-g.z,k=Math.hypot(b,P,M);if(k===0)throw new Error("Can't calculate camera options with same From and To");const R=Math.hypot(b,P),D=c.at(this.transform.cameraToCenterDistance/k/this.transform.tileSize),B=180*Math.atan2(b,-P)/Math.PI;let U=180*Math.acos(R/k)/Math.PI;return U=M<0?90-U:90+U,{center:y.toLngLat(),elevation:h,zoom:D,pitch:U,bearing:B}}calculateCameraOptionsFromCameraLngLatAltRotation(t,s,l,h,g){const y=this.transform.calculateCenterFromCameraLngLatAlt(t,s,l,h);return{center:y.center,elevation:y.elevation,zoom:y.zoom,bearing:l,pitch:h,roll:g}}easeTo(t,s){this._stop(!1,t.easeId),((t=c.e({offset:[0,0],duration:500,easing:c.cy},t)).animate===!1||!t.essential&&Ae.prefersReducedMotion)&&(t.duration=0);const l=this._getTransformForUpdate(),h=this.getBearing(),g=l.pitch,y=l.roll,b="bearing"in t?this._normalizeBearing(t.bearing,h):h,P="pitch"in t?+t.pitch:g,M="roll"in t?this._normalizeBearing(t.roll,y):y,k="padding"in t?t.padding:l.padding,R=c.P.convert(t.offset);let D,B;t.around&&(D=c.V.convert(t.around),B=l.locationToScreenPoint(D));const U={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},W=this.cameraHelper.handleEaseTo(l,{bearing:b,pitch:P,roll:M,padding:k,around:D,aroundPoint:B,offsetAsPoint:R,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||h!==b,this._pitching=this._pitching||P!==g,this._rolling=this._rolling||M!==y,this._padding=!l.isPaddingEqual(k),this._zooming=this._zooming||W.isZooming,this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,U),this.terrain&&this._prepareElevation(W.elevationCenter),this._ease(X=>{W.easeFunc(X),this.terrain&&!t.freezeElevation&&this._updateElevation(X),this._applyUpdatedTransform(l),this._fireMoveEvents(s)},X=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(s,X)},t),this}_prepareEase(t,s,l={}){this._moving=!0,s||l.moving||this.fire(new c.l("movestart",t)),this._zooming&&!l.zooming&&this.fire(new c.l("zoomstart",t)),this._rotating&&!l.rotating&&this.fire(new c.l("rotatestart",t)),this._pitching&&!l.pitching&&this.fire(new c.l("pitchstart",t)),this._rolling&&!l.rolling&&this.fire(new c.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&s!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(l-(s-(l*t+this._elevationStart))/(1-t)),this._elevationTarget=s}this.transform.setElevation(c.G.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const s=t.getCameraLngLat(),l=t.getCameraAltitude(),h=this.terrain?this.terrain.getElevationForLngLatZoom(s,t.zoom):0;if(l<h){const g=this.calculateCameraOptionsFromTo(s,h,t.center,t.elevation);return{pitch:g.pitch,zoom:g.zoom}}return{}}_applyUpdatedTransform(t){const s=[];if(s.push(h=>this._elevateCameraIfInsideTerrain(h)),this.transformCameraUpdate&&s.push(h=>this.transformCameraUpdate(h)),!s.length)return;const l=t.clone();for(const h of s){const g=l.clone(),{center:y,zoom:b,roll:P,pitch:M,bearing:k,elevation:R}=h(g);y&&g.setCenter(y),R!==void 0&&g.setElevation(R),b!==void 0&&g.setZoom(b),P!==void 0&&g.setRoll(P),M!==void 0&&g.setPitch(M),k!==void 0&&g.setBearing(k),l.apply(g,!1)}this.transform.apply(l,!1)}_fireMoveEvents(t){this.fire(new c.l("move",t)),this._zooming&&this.fire(new c.l("zoom",t)),this._rotating&&this.fire(new c.l("rotate",t)),this._pitching&&this.fire(new c.l("pitch",t)),this._rolling&&this.fire(new c.l("roll",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const l=this._zooming,h=this._rotating,g=this._pitching,y=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,l&&this.fire(new c.l("zoomend",t)),h&&this.fire(new c.l("rotateend",t)),g&&this.fire(new c.l("pitchend",t)),y&&this.fire(new c.l("rollend",t)),this.fire(new c.l("moveend",t))}flyTo(t,s){if(!t.essential&&Ae.prefersReducedMotion){const Ce=c.U(t,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Ce,s)}this.stop(),t=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.cy},t);const l=this._getTransformForUpdate(),h=l.bearing,g=l.pitch,y=l.roll,b=l.padding,P="bearing"in t?this._normalizeBearing(t.bearing,h):h,M="pitch"in t?+t.pitch:g,k="roll"in t?this._normalizeBearing(t.roll,y):y,R="padding"in t?t.padding:l.padding,D=c.P.convert(t.offset);let B=l.centerPoint.add(D);const U=l.screenPointToLocation(B),W=this.cameraHelper.handleFlyTo(l,{bearing:P,pitch:M,roll:k,padding:R,locationAtOffset:U,offsetAsPoint:D,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let X=t.curve;const H=Math.max(l.width,l.height),ee=H/W.scaleOfZoom,ae=W.pixelPathLength;typeof W.scaleOfMinZoom=="number"&&(X=Math.sqrt(H/W.scaleOfMinZoom/ae*2));const Q=X*X;function ie(Ce){const $e=(ee*ee-H*H+(Ce?-1:1)*Q*Q*ae*ae)/(2*(Ce?ee:H)*Q*ae);return Math.log(Math.sqrt($e*$e+1)-$e)}function ce(Ce){return(Math.exp(Ce)-Math.exp(-Ce))/2}function re(Ce){return(Math.exp(Ce)+Math.exp(-Ce))/2}const ge=ie(!1);let ke=function(Ce){return re(ge)/re(ge+X*Ce)},Se=function(Ce){return H*((re(ge)*(ce($e=ge+X*Ce)/re($e))-ce(ge))/Q)/ae;var $e},Ee=(ie(!0)-ge)/X;if(Math.abs(ae)<2e-6||!isFinite(Ee)){if(Math.abs(H-ee)<1e-6)return this.easeTo(t,s);const Ce=ee<H?-1:1;Ee=Math.abs(Math.log(ee/H))/X,Se=()=>0,ke=$e=>Math.exp(Ce*X*$e)}return t.duration="duration"in t?+t.duration:1e3*Ee/("screenSpeed"in t?+t.screenSpeed/X:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=h!==P,this._pitching=M!==g,this._rolling=k!==y,this._padding=!l.isPaddingEqual(R),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(W.targetCenter),this._ease(Ce=>{const $e=Ce*Ee,Ge=1/ke($e),Ne=Se($e);this._rotating&&l.setBearing(c.G.number(h,P,Ce)),this._pitching&&l.setPitch(c.G.number(g,M,Ce)),this._rolling&&l.setRoll(c.G.number(y,k,Ce)),this._padding&&(l.interpolatePadding(b,R,Ce),B=l.centerPoint.add(D)),W.easeFunc(Ce,Ge,Ne,B),this.terrain&&!t.freezeElevation&&this._updateElevation(Ce),this._applyUpdatedTransform(l),this._fireMoveEvents(s)},()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(s)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,s){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,s)}return t||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(t,s,l){l.animate===!1||l.duration===0?(t(1),s()):(this._easeStart=_e(),this._easeOptions=l,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,s){t=c.W(t,-180,180);const l=Math.abs(t-s);return Math.abs(t-360-s)<l&&(t-=360),Math.abs(t+360-s)<l&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLat(c.V.convert(t),this.transform):null}}const ti={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class rh{constructor(t=ti){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=se.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=se.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=se.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){se.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,s){const l=this._map._getUIString(`AttributionControl.${s}`);t.title=l,t.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(h=>typeof h!="string"?"":h)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}const s=this._map.style.tileManagers;for(const h in s){const g=s[h];if(g.used||g.usedForTerrain){const y=g.getSource();y.attribution&&t.indexOf(y.attribution)<0&&t.push(y.attribution)}}t=t.filter(h=>String(h).trim()),t.sort((h,g)=>h.length-g.length),t=t.filter((h,g)=>{for(let y=g+1;y<t.length;y++)if(t[y].indexOf(h)>=0)return!1;return!0});const l=t.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,t.length?(this._innerContainer.innerHTML=se.sanitize(l),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ep{constructor(t={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const l=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=se.create("div","maplibregl-ctrl");const s=se.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){se.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Xm{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,l=s?this._queue.concat(s):this._queue;for(const h of l)if(h.id===t)return void(h.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const l of s)if(!l.cancelled&&(l.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Ym=c.aU([{name:"a_pos3d",type:"Int16",components:3}]);class tl extends c.E{constructor(t){super(),this._lastTilesetChange=_e(),this.tileManager=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(t,s){this.tileManager.update(t,s),this._renderableTilesKeys=[];const l={};for(const h of pr(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s,calculateTileZoom:this.tileManager._source.calculateTileZoom}))l[h.key]=!0,this._renderableTilesKeys.push(h.key),this._tiles[h.key]||(h.terrainRttPosMatrix32f=new Float64Array(16),c.c7(h.terrainRttPosMatrix32f,0,c.a5,c.a5,0,0,1),this._tiles[h.key]=new Ve(h,this.tileSize),this._lastTilesetChange=_e());for(const h in this._tiles)l[h]||delete this._tiles[h]}freeRtt(t){for(const s in this._tiles){const l=this._tiles[s];(!t||l.tileID.equals(t)||l.tileID.isChildOf(t)||t.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,s){return s?this._getTerrainCoordsForTileRanges(t,s):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const s={};for(const l of this._renderableTilesKeys){const h=this._tiles[l].tileID,g=t.clone(),y=c.bk();if(h.canonical.equals(t.canonical))c.c7(y,0,c.a5,c.a5,0,0,1);else if(h.canonical.isChildOf(t.canonical)){const b=h.canonical.z-t.canonical.z,P=h.canonical.x-(h.canonical.x>>b<<b),M=h.canonical.y-(h.canonical.y>>b<<b),k=c.a5>>b;c.c7(y,0,k,k,0,0,1),c.O(y,y,[-P*k,-M*k,0])}else{if(!t.canonical.isChildOf(h.canonical))continue;{const b=t.canonical.z-h.canonical.z,P=t.canonical.x-(t.canonical.x>>b<<b),M=t.canonical.y-(t.canonical.y>>b<<b),k=c.a5>>b;c.c7(y,0,c.a5,c.a5,0,0,1),c.O(y,y,[P*k,M*k,0]),c.Q(y,y,[1/2**b,1/2**b,0])}}g.terrainRttPosMatrix32f=new Float32Array(y),s[l]=g}return s}_getTerrainCoordsForTileRanges(t,s){const l={};for(const h of this._renderableTilesKeys){const g=this._tiles[h].tileID;if(!this._isWithinTileRanges(g,s))continue;const y=t.clone(),b=c.bk();if(g.canonical.z===t.canonical.z){const P=t.canonical.x-g.canonical.x+t.wrap*(1<<t.canonical.z),M=t.canonical.y-g.canonical.y;c.c7(b,0,c.a5,c.a5,0,0,1),c.O(b,b,[P*c.a5,M*c.a5,0])}else if(g.canonical.z>t.canonical.z){const P=g.canonical.z-t.canonical.z,M=g.canonical.x-(g.canonical.x>>P<<P)+t.wrap*(1<<g.canonical.z),k=g.canonical.y-(g.canonical.y>>P<<P),R=t.canonical.x-(g.canonical.x>>P),D=t.canonical.y-(g.canonical.y>>P),B=c.a5>>P;c.c7(b,0,B,B,0,0,1),c.O(b,b,[-M*B+R*c.a5,-k*B+D*c.a5,0])}else{const P=t.canonical.z-g.canonical.z,M=t.canonical.x-(t.canonical.x>>P<<P)+t.wrap*(1<<t.canonical.z),k=t.canonical.y-(t.canonical.y>>P<<P),R=(t.canonical.x>>P)-g.canonical.x,D=(t.canonical.y>>P)-g.canonical.y,B=c.a5<<P;c.c7(b,0,B,B,0,0,1),c.O(b,b,[M*c.a5+R*B,k*c.a5+D*B,0])}y.terrainRttPosMatrix32f=new Float32Array(b),l[h]=y}return l}getSourceTile(t,s){const l=this.tileManager._source;let h=t.overscaledZ-this.deltaZoom;if(h>l.maxzoom&&(h=l.maxzoom),h<l.minzoom)return;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(h).key);let g=this.findTileInCaches(this._sourceTileCache[t.key]);if(!(g!=null&&g.dem)&&s)for(;h>=l.minzoom&&!(g!=null&&g.dem);)g=this.findTileInCaches(t.scaledTo(h--).key);return g}findTileInCaches(t){let s=this.tileManager.getTileByID(t);return s||(s=this.tileManager._outOfViewCache.getByKey(t),s)}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,s){const l=s[t.canonical.z];return!!l&&(t.wrap>l.minWrap||t.wrap<l.maxWrap||t.canonical.x>=l.minTileXWrapped&&t.canonical.x<=l.maxTileXWrapped&&t.canonical.y>=l.minTileY&&t.canonical.y<=l.maxTileY)}}class ur{constructor(t,s,l){this._meshCache={},this.painter=t,this.tileManager=new tl(s),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,s,l,h=c.a5){var g;if(!(s>=0&&s<h&&l>=0&&l<h))return 0;const y=this.getTerrainData(t),b=(g=y.tile)===null||g===void 0?void 0:g.dem;if(!b)return 0;const P=c.cC([],[s/h*c.a5,l/h*c.a5],y.u_terrain_matrix),M=[P[0]*b.dim,P[1]*b.dim],k=Math.floor(M[0]),R=Math.floor(M[1]),D=M[0]-k,B=M[1]-R;return b.get(k,R)*(1-D)*(1-B)+b.get(k+1,R)*D*(1-B)+b.get(k,R+1)*(1-D)*B+b.get(k+1,R+1)*D*B}getElevationForLngLatZoom(t,s){if(!c.cD(s,t.wrap()))return 0;const{tileID:l,mercatorX:h,mercatorY:g}=this._getOverscaledTileIDFromLngLatZoom(t,s);return this.getElevation(l,h%c.a5,g%c.a5,c.a5)}getElevationForLngLat(t,s){const l=pr(s,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let h=0;for(const g of l)g.canonical.z>h&&(h=Math.min(g.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(t,h)}getElevation(t,s,l,h=c.a5){return this.getDEMElevation(t,s,l,h)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const h=this.painter.context,g=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new c.T(h,g,h.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new c.T(h,new c.R({width:1,height:1}),h.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.ar([])}const s=this.tileManager.getSourceTile(t,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const h=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new c.T(h,s.dem.getPixels(),h.gl.RGBA,{premultiply:!1}),s.demTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const l=s&&s.toString()+s.tileID.key+t.key;if(l&&!this._demMatrixCache[l]){const h=this.tileManager.getSource().maxzoom;let g=t.canonical.z-s.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=h?g=t.canonical.z-h:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const y=t.canonical.x-(t.canonical.x>>g<<g),b=t.canonical.y-(t.canonical.y>>g<<g),P=c.cE(new Float64Array(16),[1/(c.a5<<g),1/(c.a5<<g),0]);c.O(P,P,[y*c.a5,b*c.a5,0]),this._demMatrixCache[t.key]={matrix:P,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(t){const s=this.painter,l=s.width/devicePixelRatio,h=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===h||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new c.T(s.context,{width:l,height:h,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new c.T(s.context,{width:l,height:h,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(l,h,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,l,h))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let g=0,y=0;g<this._coordsTextureSize;g++)for(let b=0;b<this._coordsTextureSize;b++,y+=4)s[y+0]=255&b,s[y+1]=255&g,s[y+2]=b>>8<<4|g>>8,s[y+3]=0;const l=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),h=new c.T(t,l,t.gl.RGBA,{premultiply:!1});return h.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=h,h}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const s=new Uint8Array(4),l=this.painter.context,h=l.gl,g=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),y=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),b=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),h.readPixels(g,b-y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null);const P=s[0]+(s[2]>>4<<8),M=s[1]+((15&s[2])<<8),k=this.coordsIndex[255-s[3]],R=k&&this.tileManager.getTileByID(k);if(!R)return null;const D=this._coordsTextureSize,B=(1<<R.tileID.canonical.z)*D;return new c.a9((R.tileID.canonical.x*D+P)/B+R.tileID.wrap,(R.tileID.canonical.y*D+M)/B,this.getElevation(R.tileID,P,M,D))}depthAtPoint(t){const s=new Uint8Array(4),l=this.painter.context,h=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),h.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null),(s[0]/16777216+s[1]/65536+s[2]/256+s[3])/256}getTerrainMesh(t){var s;const l=((s=this.painter.style.projection)===null||s===void 0?void 0:s.transitionState)>0,h=l&&t.canonical.y===0,g=l&&t.canonical.y===(1<<t.canonical.z)-1,y=`m_${h?"n":""}_${g?"s":""}`;if(this._meshCache[y])return this._meshCache[y];const b=this.painter.context,P=new c.cF,M=new c.aY,k=this.meshSize,R=c.a5/k,D=k*k;for(let re=0;re<=k;re++)for(let ge=0;ge<=k;ge++)P.emplaceBack(ge*R,re*R,0);for(let re=0;re<D;re+=k+1)for(let ge=0;ge<k;ge++)M.emplaceBack(ge+re,k+ge+re+1,k+ge+re+2),M.emplaceBack(ge+re,k+ge+re+2,ge+re+1);const B=P.length,U=B+(k+1),W=(k+1)*k,X=h?c.br:0,H=h?0:1,ee=g?c.bs:c.a5,ae=g?0:1;for(let re=0;re<=k;re++)P.emplaceBack(re*R,X,H);for(let re=0;re<=k;re++)P.emplaceBack(re*R,ee,ae);for(let re=0;re<k;re++)M.emplaceBack(W+re,U+re,U+re+1),M.emplaceBack(W+re,U+re+1,W+re+1),M.emplaceBack(0+re,B+re+1,B+re),M.emplaceBack(0+re,0+re+1,B+re+1);const Q=P.length,ie=Q+2*(k+1);for(const re of[0,1])for(let ge=0;ge<=k;ge++)for(const ke of[0,1])P.emplaceBack(re*c.a5,ge*R,ke);for(let re=0;re<2*k;re+=2)M.emplaceBack(Q+re,Q+re+1,Q+re+3),M.emplaceBack(Q+re,Q+re+3,Q+re+2),M.emplaceBack(ie+re,ie+re+3,ie+re+1),M.emplaceBack(ie+re,ie+re+2,ie+re+3);const ce=new Gt(b.createVertexBuffer(P,Ym.members),b.createIndexBuffer(M),c.aX.simpleSegment(0,0,P.length,M.length));return this._meshCache[y]=ce,ce}getMeshFrameDelta(t){return 2*Math.PI*c.bE/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,s){var l;if(!c.cD(s,t.wrap()))return 0;const{tileID:h}=this._getOverscaledTileIDFromLngLatZoom(t,s);return(l=this.getMinMaxElevation(h).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(t){const s=this.getTerrainData(t).tile,l={minElevation:null,maxElevation:null};return s&&s.dem&&(l.minElevation=s.dem.min*this.exaggeration,l.maxElevation=s.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(t,s){const l=c.a9.fromLngLat(t.wrap()),h=(1<<s)*c.a5,g=l.x*h,y=l.y*h,b=Math.floor(g/c.a5),P=Math.floor(y/c.a5);return{tileID:new c.a2(s,0,s,b,P),mercatorX:g,mercatorY:y}}}class Sr{constructor(t,s,l){this._context=t,this._size=s,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new c.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(l.texture),{id:t,fbo:s,texture:l,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(s=>t.id!==s),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const Ws={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class rl{constructor(t,s){this.painter=t,this.terrain=s,this.pool=new Sr(t.context,30,s.tileManager.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=t._order.filter(l=>!t._layers[l].isHidden(s)),this._coordsAscending={};for(const l in t.tileManagers){this._coordsAscending[l]={};const h=t.tileManagers[l].getVisibleCoordinates(),g=t.tileManagers[l].getSource(),y=g instanceof In?g.terrainTileRanges:null;for(const b of h){const P=this.terrain.tileManager.getTerrainCoords(b,y);for(const M in P)this._coordsAscending[l][M]||(this._coordsAscending[l][M]=[]),this._coordsAscending[l][M].push(P[M])}}this._coordsAscendingStr={};for(const l of t._order){const h=t._layers[l],g=h.source;if(Ws[h.type]&&!this._coordsAscendingStr[g]){this._coordsAscendingStr[g]={};for(const y in this._coordsAscending[g])this._coordsAscendingStr[g][y]=this._coordsAscending[g][y].map(b=>b.key).sort().join()}}for(const l of this._renderableTiles)for(const h in this._coordsAscendingStr){const g=this._coordsAscendingStr[h][l.tileID.key];g&&g!==l.rttCoords[h]&&(l.rtt=[])}}renderLayer(t,s){if(t.isHidden(this.painter.transform.zoom))return!1;const l=Object.assign(Object.assign({},s),{isRenderingToTexture:!0}),h=t.type,g=this.painter,y=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Ws[h]&&(this._prevType&&Ws[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(t.id),!y))return!0;if(Ws[this._prevType]||Ws[h]&&y){this._prevType=h;const b=this._stacks.length-1,P=this._stacks[b]||[];for(const M of this._renderableTiles){if(this.pool.isFull()&&(qc(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(M),M.rtt[b]){const R=this.pool.getObjectForId(M.rtt[b].id);if(R.stamp===M.rtt[b].stamp){this.pool.useObject(R);continue}}const k=this.pool.getOrCreateFreeObject();this.pool.useObject(k),this.pool.stampObject(k),M.rtt[b]={id:k.id,stamp:k.stamp},g.context.bindFramebuffer.set(k.fbo.framebuffer),g.context.clear({color:c.bp.transparent,stencil:0}),g.currentStencilSource=void 0;for(let R=0;R<P.length;R++){const D=g.style._layers[P[R]],B=D.source?this._coordsAscending[D.source][M.tileID.key]:[M.tileID];g.context.viewport.set([0,0,k.fbo.width,k.fbo.height]),g._renderTileClippingMasks(D,B,!0),g.renderLayer(g,g.style.tileManagers[D.source],D,B,l),D.source&&(M.rttCoords[D.source]=this._coordsAscendingStr[D.source][M.tileID.key])}}return qc(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects(),Ws[h]}return!1}}const pu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},nh=N,fu={hash:!1,interactive:!0,bearingSnap:7,attributionControl:ti,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},ih={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class nl{constructor(t,s,l=!1){this.mousedown=g=>{this.startMove(g,se.mousePos(this.element,g)),se.addEventListener(window,"mousemove",this.mousemove),se.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=g=>{this.move(g,se.mousePos(this.element,g))},this.mouseup=g=>{this._rotatePitchHandler.dragEnd(g),this.offTemp()},this.touchstart=g=>{g.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=se.touchPos(this.element,g.targetTouches)[0],this.startMove(g,this._startPos),se.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),se.addEventListener(window,"touchend",this.touchend))},this.touchmove=g=>{g.targetTouches.length!==1?this.reset():(this._lastPos=se.touchPos(this.element,g.targetTouches)[0],this.move(g,this._lastPos))},this.touchend=g=>{g.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=s;const h=new vp;this._rotatePitchHandler=new $o({clickTolerance:3,move:(g,y)=>{const b=s.getBoundingClientRect(),P=new c.P((b.bottom-b.top)/2,(b.right-b.left)/2);return{bearingDelta:c.cx(new c.P(g.x,y.y),y,P),pitchDelta:l?-.5*(y.y-g.y):void 0}},moveStateManager:h,enable:!0,assignEvents:()=>{}}),this.map=t,se.addEventListener(s,"mousedown",this.mousedown),se.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),se.addEventListener(s,"touchcancel",this.reset)}startMove(t,s){this._rotatePitchHandler.dragStart(t,s),se.disableDrag()}move(t,s){const l=this.map,{bearingDelta:h,pitchDelta:g}=this._rotatePitchHandler.dragMove(t,s)||{};h&&l.setBearing(l.getBearing()+h),g&&l.setPitch(l.getPitch()+g)}off(){const t=this.element;se.removeEventListener(t,"mousedown",this.mousedown),se.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),se.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),se.removeEventListener(window,"touchend",this.touchend),se.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){se.enableDrag(),se.removeEventListener(window,"mousemove",this.mousemove),se.removeEventListener(window,"mouseup",this.mouseup),se.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),se.removeEventListener(window,"touchend",this.touchend)}}let Wi;function mu(m,t,s,l=!1){if(l||!s.getCoveringTilesDetailsProvider().allowWorldCopies())return m==null?void 0:m.wrap();const h=new c.V(m.lng,m.lat);if(m=new c.V(m.lng,m.lat),t){const g=new c.V(m.lng-360,m.lat),y=new c.V(m.lng+360,m.lat),b=s.locationToScreenPoint(m).distSqr(t);s.locationToScreenPoint(g).distSqr(t)<b?m=g:s.locationToScreenPoint(y).distSqr(t)<b&&(m=y)}for(;Math.abs(m.lng-s.center.lng)>180;){const g=s.locationToScreenPoint(m);if(g.x>=0&&g.y>=0&&g.x<=s.width&&g.y<=s.height)break;m.lng>s.center.lng?m.lng-=360:m.lng+=360}return m.lng!==h.lng&&s.isPointOnMapSurface(s.locationToScreenPoint(m))?m:h}const il={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function gu(m,t,s){const l=m.classList;for(const h in il)l.remove(`maplibregl-${s}-anchor-${h}`);l.add(`maplibregl-${s}-anchor-${t}`)}class sl extends c.E{constructor(t){if(super(),this._onKeyPress=s=>{const l=s.code,h=s.charCode||s.keyCode;l!=="Space"&&l!=="Enter"&&h!==32&&h!==13||this.togglePopup()},this._onMapClick=s=>{const l=s.originalEvent.target,h=this._element;this._popup&&(l===h||h.contains(l))&&this.togglePopup()},this._update=s=>{if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();((s==null?void 0:s.type)==="terrain"||(s==null?void 0:s.type)==="render"&&!l)&&this._map.once("render",this._update),this._lngLat=mu(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let g="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?g="rotateX(0deg)":this._pitchAlignment==="map"&&(g=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||s&&s.type!=="moveend"||(this._pos=this._pos.round()),se.setTransform(this._element,`${il[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${g} ${h}`),Ae.frameAsync(new AbortController).then(()=>{this._updateOpacity(s&&s.type==="moveend")}).catch(()=>{})},this._onMove=s=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.l("dragstart"))),this.fire(new c.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.l("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t==null?void 0:t.opacity,t==null?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=c.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=se.create("div");const s=se.createNS("http://www.w3.org/2000/svg","svg"),l=41,h=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${l}px`),s.setAttributeNS(null,"width",`${h}px`),s.setAttributeNS(null,"viewBox",`0 0 ${h} ${l}`);const g=se.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"stroke","none"),g.setAttributeNS(null,"stroke-width","1"),g.setAttributeNS(null,"fill","none"),g.setAttributeNS(null,"fill-rule","evenodd");const y=se.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"fill-rule","nonzero");const b=se.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"transform","translate(3.0, 29.0)"),b.setAttributeNS(null,"fill","#000000");const P=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const H of P){const ee=se.createNS("http://www.w3.org/2000/svg","ellipse");ee.setAttributeNS(null,"opacity","0.04"),ee.setAttributeNS(null,"cx","10.5"),ee.setAttributeNS(null,"cy","5.80029008"),ee.setAttributeNS(null,"rx",H.rx),ee.setAttributeNS(null,"ry",H.ry),b.appendChild(ee)}const M=se.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill",this._color);const k=se.createNS("http://www.w3.org/2000/svg","path");k.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),M.appendChild(k);const R=se.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"opacity","0.25"),R.setAttributeNS(null,"fill","#000000");const D=se.createNS("http://www.w3.org/2000/svg","path");D.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),R.appendChild(D);const B=se.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"transform","translate(6.0, 7.0)"),B.setAttributeNS(null,"fill","#FFFFFF");const U=se.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(8.0, 8.0)");const W=se.createNS("http://www.w3.org/2000/svg","circle");W.setAttributeNS(null,"fill","#000000"),W.setAttributeNS(null,"opacity","0.25"),W.setAttributeNS(null,"cx","5.5"),W.setAttributeNS(null,"cy","5.5"),W.setAttributeNS(null,"r","5.4999962");const X=se.createNS("http://www.w3.org/2000/svg","circle");X.setAttributeNS(null,"fill","#FFFFFF"),X.setAttributeNS(null,"cx","5.5"),X.setAttributeNS(null,"cy","5.5"),X.setAttributeNS(null,"r","5.4999962"),U.appendChild(W),U.appendChild(X),y.appendChild(b),y.appendChild(M),y.appendChild(R),y.appendChild(B),y.appendChild(U),s.appendChild(y),s.setAttributeNS(null,"height",l*this._scale+"px"),s.setAttributeNS(null,"width",h*this._scale+"px"),this._element.appendChild(s),this._offset=c.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",s=>{s.preventDefault()}),this._element.addEventListener("mousedown",s=>{s.preventDefault()}),gu(this._element,this._anchor,"marker"),t&&t.className)for(const s of t.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),se.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=c.V.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const h=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(38.1-13.5+h)],"bottom-right":[-h,-1*(38.1-13.5+h)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var s,l;const h=(s=this._map)===null||s===void 0?void 0:s.terrain,g=this._map.transform.isLocationOccluded(this._lngLat);if(!h||g){const B=g?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==B&&(this._element.style.opacity=B))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const y=this._map,b=y.terrain.depthAtPoint(this._pos),P=y.terrain.getElevationForLngLat(this._lngLat,y.transform);if(y.transform.lngLatToCameraDepth(this._lngLat,P)-b<.006)return void(this._element.style.opacity=this._opacity);const M=-this._offset.y/y.transform.pixelsPerMeter,k=Math.sin(y.getPitch()*Math.PI/180)*M,R=y.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),D=y.transform.lngLatToCameraDepth(this._lngLat,P+k)-R>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&D&&this._popup.remove(),this._element.style.opacity=D?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=c.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,s){return(this._opacity===void 0||t===void 0&&s===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),s!==void 0&&(this._opacityWhenCovered=s),this._map&&this._updateOpacity(!0),this}}const sh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let qo=0,Hs=!1;const oh={maxWidth:100,unit:"metric"};function ol(m,t,s){const l=s&&s.maxWidth||100,h=m._container.clientHeight/2,g=m._container.clientWidth/2,y=m.unproject([g-l/2,h]),b=m.unproject([g+l/2,h]),P=Math.round(m.project(b).x-m.project(y).x),M=Math.min(l,P,m._container.clientWidth),k=y.distanceTo(b);if(s&&s.unit==="imperial"){const R=3.2808*k;R>5280?Xs(t,M,R/5280,m._getUIString("ScaleControl.Miles")):Xs(t,M,R,m._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?Xs(t,M,k/1852,m._getUIString("ScaleControl.NauticalMiles")):k>=1e3?Xs(t,M,k/1e3,m._getUIString("ScaleControl.Kilometers")):Xs(t,M,k,m._getUIString("ScaleControl.Meters"))}function Xs(m,t,s,l){const h=function(g){const y=Math.pow(10,`${Math.floor(g)}`.length-1);let b=g/y;return b=b>=10?10:b>=5?5:b>=3?3:b>=2?2:b>=1?1:function(P){const M=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*M)/M}(b),y*b}(s);m.style.width=t*(h/s)+"px",m.innerHTML=`${h}&nbsp;${l}`}const ah={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0,padding:void 0},_u=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function yu(m){if(m){if(typeof m=="number"){const t=Math.round(Math.abs(m)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,m),"top-left":new c.P(t,t),"top-right":new c.P(-t,t),bottom:new c.P(0,-m),"bottom-left":new c.P(t,-t),"bottom-right":new c.P(-t,-t),left:new c.P(m,0),right:new c.P(-m,0)}}if(m instanceof c.P||Array.isArray(m)){const t=c.P.convert(m);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:c.P.convert(m.center||[0,0]),top:c.P.convert(m.top||[0,0]),"top-left":c.P.convert(m["top-left"]||[0,0]),"top-right":c.P.convert(m["top-right"]||[0,0]),bottom:c.P.convert(m.bottom||[0,0]),"bottom-left":c.P.convert(m["bottom-left"]||[0,0]),"bottom-right":c.P.convert(m["bottom-right"]||[0,0]),left:c.P.convert(m.left||[0,0]),right:c.P.convert(m.right||[0,0])}}return yu(new c.P(0,0))}const lh=N;w.AJAXError=c.cI,w.Event=c.l,w.Evented=c.E,w.LngLat=c.V,w.MercatorCoordinate=c.a9,w.Point=c.P,w.addProtocol=c.cJ,w.config=c.c,w.removeProtocol=c.cK,w.AttributionControl=rh,w.BoxZoomHandler=Uo,w.CanvasSource=V,w.CooperativeGesturesHandler=ut,w.DoubleClickZoomHandler=th,w.DragPanHandler=Pp,w.DragRotateHandler=_i,w.EdgeInsets=Po,w.FullscreenControl=class extends c.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var t;let s=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=s==null?void 0:s.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)s=s.shadowRoot.fullscreenElement;s===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=se.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){se.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=se.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);se.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},w.GeoJSONSource=vo,w.GeolocateControl=class extends c.E{constructor(m){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new c.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const s=new c.V(t.coords.longitude,t.coords.latitude),l=t.coords.accuracy,h=this._map.getBearing(),g=c.e({bearing:h},this.options.fitBoundsOptions),y=dr.fromLngLat(s,l);this._map.fitBounds(y,g,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const s=new c.V(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=t.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Hs)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=se.create("button","maplibregl-ctrl-geolocate",this._container),se.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=se.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new sl({element:this._dotElement}),this._circleElement=se.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new sl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{const l=(s==null?void 0:s[0])instanceof ResizeObserverEntry;s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.l("trackuserlocationend")),this.fire(new c.l("userlocationlostfocus")))})}},this.options=c.e({},sh,m)}onAdd(m){return this._map=m,this._container=se.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return c._(this,arguments,void 0,function*(t=!1){if(Wi!==void 0&&!t)return Wi;if(window.navigator.permissions===void 0)return Wi=!!window.navigator.geolocation,Wi;try{Wi=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Wi=!!window.navigator.geolocation}return Wi})}().then(t=>this._finishSetupUI(t)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),se.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,qo=0,Hs=!1}_isOutOfMapMaxBounds(m){const t=this._map.getMaxBounds(),s=m.coords;return t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const m=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&m))return;const t=this._map.project(m),s=this._map.unproject([t.x+100,t.y]),l=m.distanceTo(s)/100,h=2*this._accuracy/l;this._circleElement.style.width=`${h.toFixed(2)}px`,this._circleElement.style.height=`${h.toFixed(2)}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":qo--,Hs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.l("trackuserlocationstart")),this.fire(new c.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),qo++,qo>1?(m={maximumAge:6e5,timeout:0},Hs=!0):(m=this.options.positionOptions,Hs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},w.GlobeControl=class{constructor(){this._toggleProjection=()=>{var m;const t=(m=this._map.getProjection())===null||m===void 0?void 0:m.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var m;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((m=this._map.getProjection())===null||m===void 0?void 0:m.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(m){return this._map=m,this._container=se.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=se.create("button","maplibregl-ctrl-globe",this._container),se.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){se.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},w.Hash=Hc,w.ImageSource=In,w.KeyboardHandler=Vt,w.LngLatBounds=dr,w.LogoControl=Ep,w.Map=class extends Tn{constructor(m){var t,s;c.cG.mark(c.cH.create);const l=Object.assign(Object.assign(Object.assign({},fu),m),{canvasContextAttributes:Object.assign(Object.assign({},fu.canvasContextAttributes),m.canvasContextAttributes)});if(l.minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const h=new Fs,g=new Bs;if(l.minZoom!==void 0&&h.setMinZoom(l.minZoom),l.maxZoom!==void 0&&h.setMaxZoom(l.maxZoom),l.minPitch!==void 0&&h.setMinPitch(l.minPitch),l.maxPitch!==void 0&&h.setMaxPitch(l.maxPitch),l.renderWorldCopies!==void 0&&h.setRenderWorldCopies(l.renderWorldCopies),l.transformConstrain!==null&&h.setConstrainOverride(l.transformConstrain),super(h,g,{bearingSnap:l.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Xm,this._controls=[],this._mapId=c.af(),this._lostContextStyle={style:null,images:null},this._contextLost=b=>{b.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const P of Object.values(this.style._layers))if(P.type==="custom"&&console.warn(`Custom layer with id '${P.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),P._listeners)for(const[M]of Object.entries(P._listeners))console.warn(`Custom layer with id '${P.id}' had event listeners for event '${M}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new c.l("webglcontextlost",{originalEvent:b}))},this._contextRestored=b=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._lostContextStyle={style:null,images:null},this._setupPainter(),this.resize(),this._update(),this._resizeInternal(),this.fire(new c.l("webglcontextrestored",{originalEvent:b}))},this._onMapScroll=b=>{if(b.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=l.interactive,this._maxTileCacheSize=l.maxTileCacheSize,this._maxTileCacheZoomLevels=l.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},l.canvasContextAttributes),this._trackResize=l.trackResize===!0,this._bearingSnap=l.bearingSnap,this._centerClampedToGround=l.centerClampedToGround,this._refreshExpiredTiles=l.refreshExpiredTiles===!0,this._fadeDuration=l.fadeDuration,this._crossSourceCollisions=l.crossSourceCollisions===!0,this._collectResourceTiming=l.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},pu),l.locale),this._clickTolerance=l.clickTolerance,this._overridePixelRatio=l.pixelRatio,this._maxCanvasSize=l.maxCanvasSize,this._zoomLevelsToOverscale=l.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=l.transformCameraUpdate,this.transformConstrain=l.transformConstrain,this.cancelPendingTileRequestsWhileZooming=l.cancelPendingTileRequestsWhileZooming===!0,l.reduceMotion!==void 0&&(Ae.prefersReducedMotion=l.reduceMotion),this._imageQueueHandle=We.addThrottleControl(()=>this.isMoving()),this._requestManager=new Ke(l.transformRequest),typeof l.container=="string"){if(this._container=document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(l.maxBounds&&this.setMaxBounds(l.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let b=!1;const P=Wc(M=>{this._trackResize&&!this._removed&&(this.resize(M),this.redraw())},50);this._resizeObserver=new ResizeObserver(M=>{b?P(M):b=!0}),this._resizeObserver.observe(this._container)}this.handlers=new du(this,l),this._hash=l.hash&&new Hc(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,elevation:l.elevation,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,roll:l.roll}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,c.e({},l.fitBoundsOptions,{duration:0}))));const y=typeof l.style=="string"||((s=(t=l.style)===null||t===void 0?void 0:t.projection)===null||s===void 0?void 0:s.type)!=="globe";this.resize(null,y),this._localIdeographFontFamily=l.localIdeographFontFamily,this._validateStyle=l.validateStyle,l.style&&this.setStyle(l.style,{localIdeographFontFamily:l.localIdeographFontFamily}),l.attributionControl&&this.addControl(new rh(typeof l.attributionControl=="boolean"?void 0:l.attributionControl)),l.maplibreLogo&&this.addControl(new Ep,l.logoPosition),this.on("style.load",()=>{if(y||this._resizeTransform(),this.transform.unmodified){const b=c.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(b)}}),this.on("data",b=>{this._update(b.dataType==="style"),this.fire(new c.l(`${b.dataType}data`,b))}),this.on("dataloading",b=>{this.fire(new c.l(`${b.dataType}dataloading`,b))}),this.on("dataabort",b=>{this.fire(new c.l("sourcedataabort",b))})}_getMapId(){return this._mapId}setGlobalStateProperty(m,t){return this.style.setGlobalStateProperty(m,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(m,t){if(t===void 0&&(t=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new c.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=m.onAdd(this);this._controls.push(m);const l=this._controlPositions[t];return t.indexOf("bottom")!==-1?l.insertBefore(s,l.firstChild):l.appendChild(s),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new c.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(m);return t>-1&&this._controls.splice(t,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}coveringTiles(m){return pr(this.transform,m)}calculateCameraOptionsFromTo(m,t,s,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLat(s,this.transform)),super.calculateCameraOptionsFromTo(m,t,s,l)}resize(m,t=!0){if(this._lostContextStyle.style!==null)return this;this._resizeInternal(t);const s=!this._moving;return s&&(this.stop(),this.fire(new c.l("movestart",m)).fire(new c.l("move",m))),this.fire(new c.l("resize",m)),s&&this.fire(new c.l("moveend",m)),this}_resizeInternal(m=!0){const[t,s]=this._containerDimensions(),l=this._getClampedPixelRatio(t,s);if(this._resizeCanvas(t,s,l),this.painter.resize(t,s,l),this.painter.overLimit()){const h=this.painter.context.gl;this._maxCanvasSize=[h.drawingBufferWidth,h.drawingBufferHeight];const g=this._getClampedPixelRatio(t,s);this._resizeCanvas(t,s,g),this.painter.resize(t,s,g)}this._resizeTransform(m)}_resizeTransform(m=!0){var t;const[s,l]=this._containerDimensions();this.transform.resize(s,l,m),(t=this._requestedCameraState)===null||t===void 0||t.resize(s,l,m)}_getClampedPixelRatio(m,t){const{0:s,1:l}=this._maxCanvasSize,h=this.getPixelRatio(),g=m*h,y=t*h;return Math.min(g>s?s/g:1,y>l?l/y:1)*h}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(dr.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom){const t=this._getTransformForUpdate();return t.setMinZoom(m),this._applyUpdatedTransform(t),this._update(),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom){const t=this._getTransformForUpdate();return t.setMaxZoom(m),this._applyUpdatedTransform(t),this._update(),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.setMinPitch(m),this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(m>=this.transform.minPitch)return this.transform.setMaxPitch(m),this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.setRenderWorldCopies(m),this._update()}setTransformConstrain(m){return this.transform.setConstrainOverride(m),this._update()}project(m){return this.transform.locationToScreenPoint(c.V.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.screenPointToLocation(c.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,t,s){if(m==="mouseenter"||m==="mouseover"){let l=!1;return{layers:t,listener:s,delegates:{mousemove:g=>{const y=t.filter(P=>this.getLayer(P)),b=y.length!==0?this.queryRenderedFeatures(g.point,{layers:y}):[];b.length?l||(l=!0,s.call(this,new Zr(m,this,g.originalEvent,{features:b}))):l=!1},mouseout:()=>{l=!1}}}}if(m==="mouseleave"||m==="mouseout"){let l=!1;return{layers:t,listener:s,delegates:{mousemove:y=>{const b=t.filter(P=>this.getLayer(P));(b.length!==0?this.queryRenderedFeatures(y.point,{layers:b}):[]).length?l=!0:l&&(l=!1,s.call(this,new Zr(m,this,y.originalEvent)))},mouseout:y=>{l&&(l=!1,s.call(this,new Zr(m,this,y.originalEvent)))}}}}{const l=h=>{const g=t.filter(b=>this.getLayer(b)),y=g.length!==0?this.queryRenderedFeatures(h.point,{layers:g}):[];y.length&&(h.features=y,s.call(this,h),delete h.features)};return{layers:t,listener:s,delegates:{[m]:l}}}}_saveDelegatedListener(m,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(t)}_removeDelegatedListener(m,t,s){if(!this._delegatedListeners||!this._delegatedListeners[m])return;const l=this._delegatedListeners[m];for(let h=0;h<l.length;h++){const g=l[h];if(g.listener===s&&g.layers.length===t.length&&g.layers.every(y=>t.includes(y))){for(const y in g.delegates)this.off(y,g.delegates[y]);return void l.splice(h,1)}}}on(m,t,s){if(s===void 0)return super.on(m,t);const l=typeof t=="string"?[t]:t,h=this._createDelegatedListener(m,l,s);this._saveDelegatedListener(m,h);for(const g in h.delegates)this.on(g,h.delegates[g]);return{unsubscribe:()=>{this._removeDelegatedListener(m,l,s)}}}once(m,t,s){if(s===void 0)return super.once(m,t);const l=typeof t=="string"?[t]:t,h=this._createDelegatedListener(m,l,s);for(const g in h.delegates){const y=h.delegates[g];h.delegates[g]=(...b)=>{this._removeDelegatedListener(m,l,s),y(...b)}}this._saveDelegatedListener(m,h);for(const g in h.delegates)this.once(g,h.delegates[g]);return this}off(m,t,s){return s===void 0?super.off(m,t):(this._removeDelegatedListener(m,typeof t=="string"?[t]:t,s),this)}queryRenderedFeatures(m,t){if(!this.style)return[];let s;const l=m instanceof c.P||Array.isArray(m),h=l?m:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(l?{}:m)||{},h instanceof c.P||typeof h[0]=="number")s=[c.P.convert(h)];else{const g=c.P.convert(h[0]),y=c.P.convert(h[1]);s=[g,new c.P(y.x,g.y),y,new c.P(g.x,y.y),g]}return this.style.queryRenderedFeatures(s,t,this.transform)}querySourceFeatures(m,t){return this.style.querySourceFeatures(m,t)}setStyle(m,t){return(t=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(m,t))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const t=this._locale[m];if(t==null)throw new Error(`Missing UI string '${m}'`);return t}_updateStyle(m,t){var s,l;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(m,t));const h=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new Ns(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,t,h):this.style.loadJSON(m,t,h),this):((l=(s=this.style)===null||s===void 0?void 0:s.projection)===null||l===void 0||l.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Ns(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,t){if(typeof m=="string"){const s=this._requestManager.transformRequest(m,"Style");c.j(s,new AbortController).then(l=>{this._updateDiff(l.data,t)}).catch(l=>{l&&this.fire(new c.k(l))})}else typeof m=="object"&&this._updateDiff(m,t)}_updateDiff(m,t){try{this.style.setState(m,t)&&this._update(!0)}catch(s){c.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(m,t)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(m,t){return this._lazyInitEmptyStyle(),this.style.addSource(m,t),this._update(!0)}isSourceLoaded(m){const t=this.style&&this.style.tileManagers[m];if(t!==void 0)return t.loaded();this.fire(new c.k(new Error(`There is no tile manager with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const t=this.style.tileManagers[m.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&t.reload();for(const s in this.style._layers){const l=this.style._layers[s];l.type==="hillshade"&&l.source===m.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),l.type==="color-relief"&&l.source===m.source&&c.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ur(this.painter,t,m),this.painter.renderToTexture=new rl(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=s=>{var l;s.dataType==="style"?this.terrain.tileManager.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==m.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((l=s.source)===null||l===void 0?void 0:l.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new c.l("terrain",{terrain:m})),this}getTerrain(){var m,t;return(t=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const m=this.style&&this.style.tileManagers;for(const t of Object.values(m))if(!t.areTilesLoaded())return!1;return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}setSourceTileLodParams(m,t,s){if(s){const l=this.getSource(s);if(!l)throw new Error(`There is no source with ID "${s}", cannot set LOD parameters`);l.calculateTileZoom=Ot(Math.max(1,m),Math.max(1,t))}else for(const l in this.style.tileManagers)this.style.tileManagers[l].getSource().calculateTileZoom=Ot(Math.max(1,m),Math.max(1,t));return this._update(!0),this}refreshTiles(m,t){const s=this.style.tileManagers[m];if(!s)throw new Error(`There is no tile manager with ID "${m}", cannot refresh tile`);t===void 0?s.reload(!0):s.refreshTiles(t.map(l=>new c.ac(l.z,l.x,l.y)))}addImage(m,t,s={}){const{pixelRatio:l=1,sdf:h=!1,stretchX:g,stretchY:y,content:b,textFitWidth:P,textFitHeight:M}=s;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||c.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:k,height:R,data:D}=t,B=t;return this.style.addImage(m,{data:new c.R({width:k,height:R},new Uint8Array(D)),pixelRatio:l,stretchX:g,stretchY:y,content:b,textFitWidth:P,textFitHeight:M,sdf:h,version:0,userImage:B}),B.onAdd&&B.onAdd(this,m),this}}{const{width:k,height:R,data:D}=Ae.getImageData(t);this.style.addImage(m,{data:new c.R({width:k,height:R},D),pixelRatio:l,stretchX:g,stretchY:y,content:b,textFitWidth:P,textFitHeight:M,sdf:h,version:0})}}updateImage(m,t){const s=this.style.getImage(m);if(!s)return this.fire(new c.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=t instanceof HTMLImageElement||c.b(t)?Ae.getImageData(t):t,{width:h,height:g,data:y}=l;if(h===void 0||g===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(h!==s.data.width||g!==s.data.height)return this.fire(new c.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const b=!(t instanceof HTMLImageElement||c.b(t));return s.data.replace(y,b),this.style.updateImage(m,s),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new c.k(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return We.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,t){return this._lazyInitEmptyStyle(),this.style.addLayer(m,t),this._update(!0)}moveLayer(m,t){return this.style.moveLayer(m,t),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,t,s){return this.style.setLayerZoomRange(m,t,s),this._update(!0)}setFilter(m,t,s={}){return this.style.setFilter(m,t,s),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,t,s,l={}){return this.style.setPaintProperty(m,t,s,l),this._update(!0)}getPaintProperty(m,t){return this.style.getPaintProperty(m,t)}setLayoutProperty(m,t,s,l={}){return this.style.setLayoutProperty(m,t,s,l),this._update(!0)}getLayoutProperty(m,t){return this.style.getLayoutProperty(m,t)}setGlyphs(m,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,t,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,t,s,l=>{l||this._update(!0)}),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,t,s=>{s||this._update(!0)}),this}setLight(m,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(m,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(m,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,t){return this.style.setFeatureState(m,t),this._update()}removeFeatureState(m,t){return this.style.removeFeatureState(m,t),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,t=0;return this._container&&(m=this._container.clientWidth||400,t=this._container.clientHeight||300),[m,t]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const t=this._canvasContainer=se.create("div","maplibregl-canvas-container",m);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=se.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),l=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],l);const h=this._controlContainer=se.create("div","maplibregl-control-container",m),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{g[y]=se.create("div",`maplibregl-ctrl-${y} `,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,t,s){this._canvas.width=Math.floor(s*m),this._canvas.height=Math.floor(s*t),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const m=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{t={requestedAttributes:m},l&&(t.statusMessage=l.statusMessage,t.type=l.type)},{once:!0});let s=null;if(s=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,m):this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m),!s){const l="Failed to initialize WebGL";throw t?(t.message=l,new Error(JSON.stringify(t))):new Error(l)}this.painter=new mp(s,this.transform),ue.testSupport(s)}migrateProjection(m,t){super.migrateProjection(m,t),this.painter.transform=m,this.fire(new c.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){var t,s,l,h,g;const y=this._idleTriggered?this._fadeDuration:0,b=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let P=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const R=this.transform.zoom,D=_e();this.style.zoomHistory.update(R,D);const B=new c.H(R,{now:D,fadeDuration:y,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),U=B.crossFadingFactor();U===1&&U===this._crossFadingFactor||(P=!0,this._crossFadingFactor=U),this.style.update(B)}const M=((s=this.style.projection)===null||s===void 0?void 0:s.transitionState)>0!==b;(l=this.style.projection)===null||l===void 0||l.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((h=this.style.projection)===null||h===void 0?void 0:h.transitionState,(g=this.style.projection)===null||g===void 0?void 0:g.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||M)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,M),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,showPadding:this.showPadding}),this.fire(new c.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.cG.mark(c.cH.load),this.fire(new c.l("load"))),this.style&&(this.style.hasTransitions()||P)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const k=this._sourcesDirty||this._styleDirty||this._placementDirty;return k||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.l("idle")),!this._loaded||this._fullyLoaded||k||(this._fullyLoaded=!0,c.cG.mark(c.cH.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),We.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t!=null&&t.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),se.remove(this._canvasContainer),se.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),c.cG.clearMetrics(),this._removed=!0,this.fire(new c.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Ae.frame(this._frameRequest,m=>{c.cG.frame(m),this._frameRequest=null;try{this._render(m)}catch(t){if(!c.Z(t)&&!function(s){return s.message===Vc}(t))throw t}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return nh}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(m){return this._lazyInitEmptyStyle(),this.style.setProjection(m),this._update(!0)}},w.MapMouseEvent=Zr,w.MapTouchEvent=Ha,w.MapWheelEvent=yp,w.Marker=sl,w.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const t=this._map.getZoom(),s=t===this._map.getMaxZoom(),l=t===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,s)=>{const l=this._map._getUIString(`NavigationControl.${s}`);t.title=l,t.setAttribute("aria-label",l)},this.options=c.e({},ih,m),this._container=se.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),se.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),se.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=se.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new nl(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){se.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,t){const s=se.create("button",m,this._container);return s.type="button",s.addEventListener("click",t),s}},w.Popup=class extends c.E{constructor(m){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&se.remove(this._content),this._container&&(se.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=se.create("div","maplibregl-popup",this._map.getContainer()),this._tip=se.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const y of this.options.className.split(" "))this._container.classList.add(y);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=mu(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const s=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let l=this.options.anchor;const h=yu(this.options.offset);if(!l){const y=this._container.offsetWidth,b=this._container.offsetHeight,P=function(k){var R,D,B,U;return k?{top:(R=k.top)!==null&&R!==void 0?R:0,right:(D=k.right)!==null&&D!==void 0?D:0,bottom:(B=k.bottom)!==null&&B!==void 0?B:0,left:(U=k.left)!==null&&U!==void 0?U:0}:{top:0,right:0,bottom:0,left:0}}(this.options.padding);let M;M=s.y+h.bottom.y<b+P.top?["top"]:s.y>this._map.transform.height-b-P.bottom?["bottom"]:[],s.x<y/2+P.left?M.push("left"):s.x>this._map.transform.width-y/2-P.right&&M.push("right"),l=M.length===0?"bottom":M.join("-")}let g=s.add(h[l]);this.options.subpixelPositioning||(g=g.round()),se.setTransform(this._container,`${il[l]} translate(${g.x}px,${g.y}px)`),gu(this._container,l,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(ah),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=c.V.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const t=document.createDocumentFragment(),s=document.createElement("body");let l;for(s.innerHTML=m;l=s.firstChild,l;)t.appendChild(l);return this.setDOMContent(t)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=se.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}setPadding(m){this.options.padding=m,this._update()}_createCloseButton(){this.options.closeButton&&(this._closeButton=se.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(_u);m&&m.focus()}},w.RasterDEMTileSource=cs,w.RasterTileSource=_o,w.ScaleControl=class{constructor(m){this._onMove=()=>{ol(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,ol(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},oh),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=se.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){se.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},w.ScrollZoomHandler=cu,w.Style=Ns,w.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=se.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=se.create("button","maplibregl-ctrl-terrain",this._container),se.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){se.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},w.TwoFingersTouchPitchHandler=wp,w.TwoFingersTouchRotateHandler=Jc,w.TwoFingersTouchZoomHandler=Qc,w.TwoFingersTouchZoomRotateHandler=Ja,w.VectorTileSource=zs,w.VideoSource=xe,w.addSourceType=(m,t)=>c._(void 0,void 0,void 0,function*(){if(q(m))throw new Error(`A source type called "${m}" already exists.`);((s,l)=>{j[s]=l})(m,t)}),w.clearPrewarmedResources=function(){const m=Mn;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(mn),Mn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},w.createTileMesh=Ld,w.getMaxParallelImageRequests=function(){return c.c.MAX_PARALLEL_IMAGE_REQUESTS},w.getRTLTextPluginStatus=function(){return ve().getRTLTextPluginStatus()},w.getVersion=function(){return lh},w.getWorkerCount=function(){return Rr.workerCount},w.getWorkerUrl=function(){return c.c.WORKER_URL},w.importScriptInWorkers=function(m){return ya().broadcast("IS",m)},w.isTimeFrozen=function(){return we.isFrozen()},w.now=_e,w.prewarm=function(){As().acquire(mn)},w.restoreNow=function(){we.restoreNow()},w.setMaxParallelImageRequests=function(m){c.c.MAX_PARALLEL_IMAGE_REQUESTS=m},w.setNow=function(m){we.setNow(m)},w.setRTLTextPlugin=function(m,t){return ve().setRTLTextPlugin(m,t)},w.setWorkerCount=function(m){Rr.workerCount=m},w.setWorkerUrl=function(m){c.c.WORKER_URL=m}});var C=f;return C})})(M2);var mI=M2.exports;const bf=Z1(mI);function gI(){const i=Re.useRef(null),a=Re.useRef(null),f=Sd(),[v,S]=Re.useState(!0),[C,w]=Re.useState(null),[c,N]=Re.useState([]),[K,fe]=Re.useState(null),[pe,ye]=Re.useState("");Re.useEffect(()=>{(async()=>{try{const _e=await fetch(is.api.languagesGeojsonUrl);if(!_e.ok)throw new Error("Failed to load languages data");const ue=(await _e.json()).features.map(Y=>({...Y.properties,id:Y.properties.key_name})).sort((Y,ne)=>ne.count!==Y.count?ne.count-Y.count:Y.key_name.localeCompare(ne.key_name));N(ue)}catch(_e){w(_e.message),S(!1)}})()},[]),Re.useEffect(()=>{if(!i.current||c.length===0)return;a.current=new bf.Map({container:i.current,style:is.api.mapStyleUrl,center:[0,20],zoom:2,attributionControl:!0});let we=null;return a.current.on("load",async()=>{try{const _e=await fetch(is.api.languagesGeojsonUrl);if(!_e.ok)throw new Error("Failed to load languages data");we=await _e.json(),a.current.getSource("languages")||a.current.addSource("languages",{type:"geojson",data:we}),a.current.getLayer("languages-outline")||a.current.addLayer({id:"languages-outline",type:"line",source:"languages",paint:{"line-color":["interpolate",["linear"],["get","count"],0,"#90caf9",100,"#42a5f5",500,"#1e88e5",1e3,"#1565c0",2e3,"#0d47a1"],"line-width":["interpolate",["linear"],["get","count"],0,1,100,1.5,500,2,1e3,2.5,2e3,3],"line-opacity":.8}}),a.current.getSource("languages-filtered")||a.current.addSource("languages-filtered",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),a.current.getLayer("languages-filtered-outline")||a.current.addLayer({id:"languages-filtered-outline",type:"line",source:"languages-filtered",paint:{"line-color":"#4caf50","line-width":3,"line-opacity":.9}}),a.current.getSource("languages-highlight")||a.current.addSource("languages-highlight",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),a.current.getLayer("languages-highlight")||a.current.addLayer({id:"languages-highlight",type:"line",source:"languages-highlight",paint:{"line-color":"#ff9800","line-width":5,"line-opacity":1}}),a.current.on("click","languages-outline",se=>{const ue=se.features[0].properties,Y=se.lngLat;new bf.Popup().setLngLat(Y).setHTML(`
              <div class="p-2">
                <h3 class="font-semibold text-gray-900 mb-1">${ue.key_name}</h3>
                <p class="text-sm text-gray-600">Alias: <code class="text-xs">${ue.alias}</code></p>
                <p class="text-sm text-gray-600">Count: <span class="font-medium">${ue.count}</span></p>
              </div>
            `).addTo(a.current)}),a.current.on("mouseenter","languages-outline",()=>{a.current.getCanvas().style.cursor="pointer"}),a.current.on("mouseleave","languages-outline",()=>{a.current.getCanvas().style.cursor=""}),a.current.on("click","languages-highlight",se=>{const ue=se.features[0].properties,Y=se.lngLat;new bf.Popup().setLngLat(Y).setHTML(`
              <div class="p-2">
                <h3 class="font-semibold text-gray-900 mb-1">${ue.key_name}</h3>
                <p class="text-sm text-gray-600">Alias: <code class="text-xs">${ue.alias}</code></p>
                <p class="text-sm text-gray-600">Count: <span class="font-medium">${ue.count}</span></p>
              </div>
            `).addTo(a.current)}),S(!1)}catch(_e){w(_e.message),S(!1)}}),()=>{a.current&&a.current.remove()}},[c]),Re.useEffect(()=>{if(!a.current||!a.current.isStyleLoaded())return;const we=c.filter(_e=>{if(!pe.trim())return!0;const se=pe.toLowerCase();return _e.key_name.toLowerCase().includes(se)||_e.alias.toLowerCase().includes(se)});a.current.getSource("languages-filtered")&&fetch(is.api.languagesGeojsonUrl).then(_e=>_e.json()).then(_e=>{const se=_e.features.filter(ue=>{const Y=c.find(ne=>ne.key_name===ue.properties.key_name);return Y&&we.includes(Y)});a.current.getSource("languages-filtered").setData({type:"FeatureCollection",features:se})}).catch(_e=>console.error("Error updating filtered layer:",_e))},[pe,c]);const Ae=we=>{fe(we),!(!a.current||!a.current.isStyleLoaded())&&fetch(is.api.languagesGeojsonUrl).then(_e=>_e.json()).then(_e=>{const se=_e.features.find(Y=>Y.properties.key_name===we.key_name);if(!se){console.error("Feature not found:",we.key_name);return}const ue=a.current.getSource("languages-highlight");if(ue&&ue.setData({type:"FeatureCollection",features:[se]}),se.geometry&&se.geometry.type==="Polygon"){const Y=se.geometry.coordinates[0];if(!Y||Y.length===0){console.error("Invalid coordinates");return}let ne=Y[0][0],Be=Y[0][0],qe=Y[0][1],et=Y[0][1];Y.forEach(Ke=>{Ke&&Ke.length>=2&&(ne=Math.min(ne,Ke[0]),Be=Math.max(Be,Ke[0]),qe=Math.min(qe,Ke[1]),et=Math.max(et,Ke[1]))});const We=new bf.LngLatBounds([ne,qe],[Be,et]);a.current.fitBounds(We,{padding:{top:50,bottom:50,left:50,right:50},duration:1500,maxZoom:10})}}).catch(_e=>{console.error("Error loading feature:",_e)})};return de.jsxs("div",{className:"flex flex-col h-screen overflow-hidden bg-white",children:[de.jsx(Pm,{}),de.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[de.jsxs("div",{className:"w-80 bg-white border-r border-gray-200 flex flex-col overflow-hidden",children:[de.jsxs("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:[de.jsxs("button",{onClick:()=>f("/"),className:"mb-3 flex items-center gap-2 text-blue-600 hover:text-blue-700 font-semibold text-sm",children:[de.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:de.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Back to Maps"]}),de.jsxs("h3",{className:"text-sm font-semibold text-gray-700 mb-2",children:["Locales (",pe.trim()?c.filter(we=>{const _e=pe.toLowerCase();return we.key_name.toLowerCase().includes(_e)||we.alias.toLowerCase().includes(_e)}).length:c.length,")"]}),de.jsxs("div",{className:"relative mb-2",children:[de.jsx("input",{type:"text",placeholder:"Search locales...",value:pe,onChange:we=>ye(we.target.value),className:"w-full px-3 py-2 pl-9 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),de.jsx("svg",{className:"absolute left-2.5 top-2.5 w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:de.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]}),de.jsx("p",{className:"text-xs text-gray-500",children:"Click to highlight on map"})]}),de.jsx("div",{className:"flex-1 overflow-y-auto",children:v?de.jsx("div",{className:"flex items-center justify-center h-full",children:de.jsxs("div",{className:"text-center",children:[de.jsx("div",{className:"w-8 h-8 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mx-auto mb-2"}),de.jsx("p",{className:"text-xs text-gray-600",children:"Loading..."})]})}):C?de.jsx("div",{className:"p-4 text-center",children:de.jsx("p",{className:"text-sm text-red-600",children:C})}):de.jsx("div",{className:"divide-y divide-gray-100",children:c.filter(we=>{if(!pe.trim())return!0;const _e=pe.toLowerCase();return we.key_name.toLowerCase().includes(_e)||we.alias.toLowerCase().includes(_e)}).map(we=>de.jsx("button",{onClick:()=>Ae(we),className:`w-full px-4 py-2.5 text-left hover:bg-gray-50 transition-colors ${(K==null?void 0:K.id)===we.id?"bg-blue-50 border-l-4 border-l-blue-600":""}`,children:de.jsxs("div",{className:"flex items-center gap-2",children:[de.jsx("code",{className:"text-xs font-medium text-gray-700",children:we.alias}),de.jsx("span",{className:"text-xs text-gray-400",children:""}),de.jsx("span",{className:"text-xs font-semibold text-blue-600",children:we.count}),de.jsx("span",{className:"text-xs text-gray-400",children:"features"})]})},we.id))})})]}),de.jsxs("div",{className:"flex-1 relative",children:[v&&de.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-50 z-10",children:de.jsxs("div",{className:"text-center",children:[de.jsx("div",{className:"w-12 h-12 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mx-auto mb-4"}),de.jsx("p",{className:"text-gray-600",children:"Loading map..."})]})}),C&&de.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-50 z-10",children:de.jsxs("div",{className:"text-center",children:[de.jsxs("p",{className:"text-red-600 mb-4",children:["Error: ",C]}),de.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Retry"})]})}),de.jsx("div",{ref:i,className:"w-full h-full"})]})]})]})}function _I(){const[i,a]=Re.useState([]),[f,v]=Re.useState([]),[S,C]=Re.useState({}),[w,c]=Re.useState(!0),[N,K]=Re.useState(null);return Re.useEffect(()=>{(async()=>{var pe,ye,Ae;try{c(!0);const[we,_e]=await Promise.all([fetch(is.api.capabilitiesBaseUrl),fetch(is.api.layersInfoUrl)]);if(!we.ok||!_e.ok)throw new Error("Failed to fetch data");const se=await we.json(),ue=await _e.json(),Y=((pe=se.maps)==null?void 0:pe.map(We=>fetch(is.api.getMapCapabilitiesUrl(We.name)).then(Ke=>Ke.ok?Ke.json():null).catch(()=>null)))||[],ne=await Promise.all(Y),Be={};(ye=se.maps)==null||ye.forEach((We,Ke)=>{const _t=ne[Ke];_t&&_t.vector_layers&&_t.vector_layers.forEach(at=>{const Qt=`${We.name}:${at.id}`;Be[Qt]={geometryType:at.geometry_type||at.geometryType,fields:at.fields||{}}})});const qe=[],et={};ue.by_layer_name&&Object.keys(ue.by_layer_name).forEach(We=>{const Ke=ue.by_layer_name[We];Ke&&Ke.length>0&&(et[We]=Ke[0])}),(Ae=se.maps)==null||Ae.forEach(We=>{var Ke;(Ke=We.layers)==null||Ke.forEach(_t=>{const at=_t.name,Qt=et[at]||{};let br="unknown",jr={};const Xn=`${We.name}:${at}`;Be[Xn]?(br=Be[Xn].geometryType||"unknown",jr=Be[Xn].fields||{}):at.includes("centroids")||at.includes("points")?br="point":at.includes("lines")||at.includes("_lines")?br="linestring":(at.includes("areas")||at.includes("_areas")||!at.includes("_"))&&(br="multipolygon"),qe.push({id:at,name:at,map:We.name,minzoom:_t.minzoom||0,maxzoom:_t.maxzoom||20,tiles:_t.tiles||[],geometryType:br,fields:jr,description:Qt.description||`${at.replace(/_/g," ")} layer`,details:Qt.details||[],filtersPerZoomLevel:Qt.filters_per_zoom_level||[],tegolaConfig:Qt.tegola_config||null})})}),a(qe),v(se.maps||[]),C(et),c(!1)}catch(we){K(we.message),c(!1)}})()},[]),N?de.jsxs("div",{className:"flex flex-col items-center justify-center h-screen gap-6 bg-white",children:[de.jsx("div",{className:"w-20 h-20 bg-red-100 rounded-full flex items-center justify-center",children:de.jsx("svg",{className:"w-10 h-10 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:de.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),de.jsxs("div",{className:"text-center",children:[de.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Error loading data"}),de.jsx("p",{className:"text-red-600 mb-6 max-w-md",children:N}),de.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold shadow-lg hover:shadow-xl",children:"Retry"})]})]}):de.jsx(KM,{children:de.jsxs(EM,{children:[de.jsx($h,{path:"/",element:de.jsxs("div",{className:"flex flex-col h-screen overflow-hidden bg-white",children:[de.jsx(Pm,{}),de.jsx(lI,{maps:f,loading:w})]})}),de.jsx($h,{path:"/map/:mapName",element:de.jsx(pI,{allLayers:i,layersInfo:S,maps:f})}),de.jsx($h,{path:"/layer/:mapName/:layerName",element:de.jsx(fI,{allLayers:i,layersInfo:S})}),de.jsx($h,{path:"/locales-map",element:de.jsx(gI,{})})]})})}P_.createRoot(document.getElementById("root")).render(de.jsx(yP.StrictMode,{children:de.jsx(_I,{})}));
